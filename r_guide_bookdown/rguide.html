<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>A R Guide</title>
  <meta name="description" content="A guide for the R programming language." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="A R Guide" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A guide for the R programming language." />
  <meta name="github-repo" content="sam81/rguide" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="A R Guide" />
  
  <meta name="twitter:description" content="A guide for the R programming language." />
  

<meta name="author" content="Samuele Carcagno" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  


<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path=""><a href="#preface"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path=""><a href="#intro"><i class="fa fa-check"></i><b>1</b> Getting started with R</a><ul>
<li class="chapter" data-level="1.1" data-path=""><a href="#installing-r"><i class="fa fa-check"></i><b>1.1</b> Installing R</a><ul>
<li class="chapter" data-level="1.1.1" data-path=""><a href="#installing-the-base-program"><i class="fa fa-check"></i><b>1.1.1</b> Installing the base program</a></li>
<li class="chapter" data-level="1.1.2" data-path=""><a href="#installpkg"><i class="fa fa-check"></i><b>1.1.2</b> Installing add-on packages</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path=""><a href="#a-simple-introduction-to-r"><i class="fa fa-check"></i><b>1.2</b> A simple introduction to R</a><ul>
<li class="chapter" data-level="1.2.1" data-path=""><a href="#datasets"><i class="fa fa-check"></i><b>1.2.1</b> Datasets</a></li>
<li class="chapter" data-level="1.2.2" data-path=""><a href="#firing-up-and-quitting-r"><i class="fa fa-check"></i><b>1.2.2</b> Firing up and quitting R</a></li>
<li class="chapter" data-level="1.2.3" data-path=""><a href="#starting-to-work-with-r"><i class="fa fa-check"></i><b>1.2.3</b> Starting to work with R</a></li>
<li class="chapter" data-level="1.2.4" data-path=""><a href="#using-r-packages"><i class="fa fa-check"></i><b>1.2.4</b> Using R packages</a></li>
<li class="chapter" data-level="1.2.5" data-path=""><a href="#gettinghelp"><i class="fa fa-check"></i><b>1.2.5</b> Getting help</a></li>
<li class="chapter" data-level="1.2.6" data-path=""><a href="#gui"><i class="fa fa-check"></i><b>1.2.6</b> Working with a graphical user interface</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path=""><a href="#organizing-a-working-session"><i class="fa fa-check"></i><b>2</b> Organizing a working session</a><ul>
<li class="chapter" data-level="2.1" data-path=""><a href="#setting-and-changing-the-working-directory"><i class="fa fa-check"></i><b>2.1</b> Setting and changing the working directory</a></li>
<li class="chapter" data-level="2.2" data-path=""><a href="#varobj"><i class="fa fa-check"></i><b>2.2</b> Objects</a></li>
<li class="chapter" data-level="2.3" data-path=""><a href="#saving-and-using-the-workspace-image"><i class="fa fa-check"></i><b>2.3</b> Saving and using the “workspace image”</a></li>
<li class="chapter" data-level="2.4" data-path=""><a href="#working-in-batch-mode"><i class="fa fa-check"></i><b>2.4</b> Working in batch mode</a><ul>
<li class="chapter" data-level="2.4.1" data-path=""><a href="#executing-commands-written-in-a-file-from-an-r-session"><i class="fa fa-check"></i><b>2.4.1</b> Executing commands written in a file from an R session</a></li>
<li class="chapter" data-level="2.4.2" data-path=""><a href="#executing-commands-written-in-a-file-from-a-shell"><i class="fa fa-check"></i><b>2.4.2</b> Executing commands written in a file from a shell</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path=""><a href="#datamanip"><i class="fa fa-check"></i><b>3</b> Data types and data manipulation</a><ul>
<li class="chapter" data-level="3.1" data-path=""><a href="#vectors"><i class="fa fa-check"></i><b>3.1</b> Vectors</a></li>
<li class="chapter" data-level="3.2" data-path=""><a href="#indexing-vectors"><i class="fa fa-check"></i><b>3.2</b> Indexing vectors</a><ul>
<li class="chapter" data-level="3.2.1" data-path=""><a href="#the-seq-function"><i class="fa fa-check"></i><b>3.2.1</b> The <code>seq</code> function</a></li>
<li class="chapter" data-level="3.2.2" data-path=""><a href="#the-rep-function"><i class="fa fa-check"></i><b>3.2.2</b> The <code>rep</code> function</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path=""><a href="#matrix-facilities"><i class="fa fa-check"></i><b>3.3</b> Matrix facilities</a><ul>
<li class="chapter" data-level="3.3.1" data-path=""><a href="#matrix-operations"><i class="fa fa-check"></i><b>3.3.1</b> Matrix operations</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path=""><a href="#Lists"><i class="fa fa-check"></i><b>3.4</b> Lists</a></li>
<li class="chapter" data-level="3.5" data-path=""><a href="#dataframes"><i class="fa fa-check"></i><b>3.5</b> Dataframes</a><ul>
<li class="chapter" data-level="3.5.1" data-path=""><a href="#accessing-parts-of-a-dataframe"><i class="fa fa-check"></i><b>3.5.1</b> Accessing parts of a dataframe</a></li>
<li class="chapter" data-level="3.5.2" data-path=""><a href="#changing-the-names-of-variables-in-a-dataframe"><i class="fa fa-check"></i><b>3.5.2</b> Changing the names of variables in a dataframe</a></li>
<li class="chapter" data-level="3.5.3" data-path=""><a href="#other-ways-to-subset-a-dataframe"><i class="fa fa-check"></i><b>3.5.3</b> Other ways to subset a dataframe</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path=""><a href="#factors"><i class="fa fa-check"></i><b>3.6</b> Factors</a><ul>
<li class="chapter" data-level="3.6.1" data-path=""><a href="#renaming-the-levels-of-a-factor"><i class="fa fa-check"></i><b>3.6.1</b> Renaming the levels of a factor</a></li>
<li class="chapter" data-level="3.6.2" data-path=""><a href="#gl"><i class="fa fa-check"></i><b>3.6.2</b> Creating factors with <code>gl</code></a></li>
<li class="chapter" data-level="3.6.3" data-path=""><a href="#natural-sort-order-for-character-and-factor-vectors"><i class="fa fa-check"></i><b>3.6.3</b> Natural sort order for character and factor vectors</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path=""><a href="#objinfo"><i class="fa fa-check"></i><b>3.7</b> Getting info on R objects</a></li>
<li class="chapter" data-level="3.8" data-path=""><a href="#changing-the-format-of-your-data"><i class="fa fa-check"></i><b>3.8</b> Changing the format of your data</a><ul>
<li class="chapter" data-level="3.8.1" data-path=""><a href="#onerowperobservation"><i class="fa fa-check"></i><b>3.8.1</b> The “one row per observation” (long) format</a></li>
<li class="chapter" data-level="3.8.2" data-path=""><a href="#stack"><i class="fa fa-check"></i><b>3.8.2</b> The <code>stack</code> and <code>unstack</code> functions</a></li>
<li class="chapter" data-level="3.8.3" data-path=""><a href="#tapply"><i class="fa fa-check"></i><b>3.8.3</b> The <code>tapply</code> and <code>aggregate</code> functions</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path=""><a href="#the-scale-function"><i class="fa fa-check"></i><b>3.9</b> The <code>scale</code> function</a></li>
<li class="chapter" data-level="3.10" data-path=""><a href="#printing-out-data-on-the-console"><i class="fa fa-check"></i><b>3.10</b> Printing out data on the console</a><ul>
<li class="chapter" data-level="3.10.1" data-path=""><a href="#reading-numbers-in-exponential-notation"><i class="fa fa-check"></i><b>3.10.1</b> Reading numbers in exponential notation</a></li>
</ul></li>
<li class="chapter" data-level="3.11" data-path=""><a href="#creating-and-editing-data-objects-through-a-visual-interface"><i class="fa fa-check"></i><b>3.11</b> Creating and editing data objects through a visual interface</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path=""><a href="#programming"><i class="fa fa-check"></i><b>4</b> R programming</a><ul>
<li class="chapter" data-level="4.1" data-path=""><a href="#contrstruct"><i class="fa fa-check"></i><b>4.1</b> Control structures</a><ul>
<li class="chapter" data-level="4.1.1" data-path=""><a href="#conditionals"><i class="fa fa-check"></i><b>4.1.1</b> Conditionals</a></li>
<li class="chapter" data-level="4.1.2" data-path=""><a href="#loops"><i class="fa fa-check"></i><b>4.1.2</b> Loops</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path=""><a href="#functions"><i class="fa fa-check"></i><b>4.2</b> Functions</a></li>
<li class="chapter" data-level="4.3" data-path=""><a href="#stringprocessing"><i class="fa fa-check"></i><b>4.3</b> String processing</a><ul>
<li class="chapter" data-level="4.3.1" data-path=""><a href="#regexp"><i class="fa fa-check"></i><b>4.3.1</b> Using regular expressions</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path=""><a href="#tips-and-tricks"><i class="fa fa-check"></i><b>4.4</b> Tips and tricks</a><ul>
<li class="chapter" data-level="4.4.1" data-path=""><a href="#convert-a-string-into-a-command"><i class="fa fa-check"></i><b>4.4.1</b> Convert a string into a command</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path=""><a href="#creatingsimplerpackages"><i class="fa fa-check"></i><b>4.5</b> Creating simple R packages</a><ul>
<li class="chapter" data-level="4.5.1" data-path=""><a href="#the-bare-minimum-to-create-a-package"><i class="fa fa-check"></i><b>4.5.1</b> The bare minimum to create a package</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path=""><a href="#IO"><i class="fa fa-check"></i><b>5</b> File input/output</a><ul>
<li class="chapter" data-level="5.1" data-path=""><a href="#reading-in-data-from-a-file"><i class="fa fa-check"></i><b>5.1</b> Reading in data from a file</a><ul>
<li class="chapter" data-level="5.1.1" data-path=""><a href="#read.table"><i class="fa fa-check"></i><b>5.1.1</b> The <code>read.table</code> function</a></li>
<li class="chapter" data-level="5.1.2" data-path=""><a href="#scan"><i class="fa fa-check"></i><b>5.1.2</b> <code>scan</code></a></li>
<li class="chapter" data-level="5.1.3" data-path=""><a href="#low-level-file-input"><i class="fa fa-check"></i><b>5.1.3</b> Low-level file input</a></li>
<li class="chapter" data-level="5.1.4" data-path=""><a href="#binary-file-input"><i class="fa fa-check"></i><b>5.1.4</b> Binary file input</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path=""><a href="#writing-data-to-a-file"><i class="fa fa-check"></i><b>5.2</b> Writing data to a file</a><ul>
<li class="chapter" data-level="5.2.1" data-path=""><a href="#write.table"><i class="fa fa-check"></i><b>5.2.1</b> The <code>write.table</code> function</a></li>
<li class="chapter" data-level="5.2.2" data-path=""><a href="#saving-objecs-in-binary-format"><i class="fa fa-check"></i><b>5.2.2</b> Saving objecs in binary format</a></li>
<li class="chapter" data-level="5.2.3" data-path=""><a href="#cat"><i class="fa fa-check"></i><b>5.2.3</b> Low-level file output</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path=""><a href="#graphics"><i class="fa fa-check"></i><b>6</b> Graphics</a><ul>
<li class="chapter" data-level="6.1" data-path=""><a href="#overview-of-r-base-graphics-functions"><i class="fa fa-check"></i><b>6.1</b> Overview of R base graphics functions</a></li>
<li class="chapter" data-level="6.2" data-path=""><a href="#plot"><i class="fa fa-check"></i><b>6.2</b> The <code>plot</code> function</a></li>
<li class="chapter" data-level="6.3" data-path=""><a href="#drawing-functions"><i class="fa fa-check"></i><b>6.3</b> Drawing functions</a><ul>
<li class="chapter" data-level="6.3.1" data-path=""><a href="#the-matplot-function"><i class="fa fa-check"></i><b>6.3.1</b> The <code>matplot</code> function</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path=""><a href="#common-charts"><i class="fa fa-check"></i><b>6.4</b> Common charts</a><ul>
<li class="chapter" data-level="6.4.1" data-path=""><a href="#barplots"><i class="fa fa-check"></i><b>6.4.1</b> Barplots</a></li>
<li class="chapter" data-level="6.4.2" data-path=""><a href="#boxplots"><i class="fa fa-check"></i><b>6.4.2</b> Boxplots</a></li>
<li class="chapter" data-level="6.4.3" data-path=""><a href="#histograms"><i class="fa fa-check"></i><b>6.4.3</b> Histograms</a></li>
<li class="chapter" data-level="6.4.4" data-path=""><a href="#stripcharts"><i class="fa fa-check"></i><b>6.4.4</b> Stripcharts</a></li>
<li class="chapter" data-level="6.4.5" data-path=""><a href="#interactionplots"><i class="fa fa-check"></i><b>6.4.5</b> Interaction Plots</a></li>
<li class="chapter" data-level="6.4.6" data-path=""><a href="#stemplot"><i class="fa fa-check"></i><b>6.4.6</b> Stem (lollipop) plots</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path=""><a href="#par"><i class="fa fa-check"></i><b>6.5</b> Setting graphics parameters</a><ul>
<li class="chapter" data-level="6.5.1" data-path=""><a href="#saving-and-restoring-graphics-parameters"><i class="fa fa-check"></i><b>6.5.1</b> Saving and restoring graphics parameters</a></li>
<li class="chapter" data-level="6.5.2" data-path=""><a href="#lty"><i class="fa fa-check"></i><b>6.5.2</b> Line type with the <code>lty</code> parameter</a></li>
<li class="chapter" data-level="6.5.3" data-path=""><a href="#secpch"><i class="fa fa-check"></i><b>6.5.3</b> Symbols with the <code>pch</code> parameter</a></li>
<li class="chapter" data-level="6.5.4" data-path=""><a href="#parfonts"><i class="fa fa-check"></i><b>6.5.4</b> Fonts</a></li>
<li class="chapter" data-level="6.5.5" data-path=""><a href="#parcolors"><i class="fa fa-check"></i><b>6.5.5</b> Colors</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path=""><a href="#adding-elements-to-a-plot"><i class="fa fa-check"></i><b>6.6</b> Adding elements to a plot</a><ul>
<li class="chapter" data-level="6.6.1" data-path=""><a href="#legend"><i class="fa fa-check"></i><b>6.6.1</b> Adding a legend</a></li>
<li class="chapter" data-level="6.6.2" data-path=""><a href="#adding-text"><i class="fa fa-check"></i><b>6.6.2</b> Adding text</a></li>
<li class="chapter" data-level="6.6.3" data-path=""><a href="#addgrid"><i class="fa fa-check"></i><b>6.6.3</b> Adding a grid</a></li>
<li class="chapter" data-level="6.6.4" data-path=""><a href="#axes"><i class="fa fa-check"></i><b>6.6.4</b> Setting the axes</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path=""><a href="#glayout"><i class="fa fa-check"></i><b>6.7</b> Creating layouts for multiple graphs</a><ul>
<li class="chapter" data-level="6.7.1" data-path=""><a href="#mfrowmfcol"><i class="fa fa-check"></i><b>6.7.1</b> <code>mfrow</code> and <code>mfcol</code></a></li>
<li class="chapter" data-level="6.7.2" data-path=""><a href="#layout"><i class="fa fa-check"></i><b>6.7.2</b> <code>layout</code></a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path=""><a href="#grdevregions"><i class="fa fa-check"></i><b>6.8</b> Graphics device regions and coordinates</a></li>
<li class="chapter" data-level="6.9" data-path=""><a href="#plotfromscratch"><i class="fa fa-check"></i><b>6.9</b> Plotting from scratch</a></li>
<li class="chapter" data-level="6.10" data-path=""><a href="#managing-graphic-devices"><i class="fa fa-check"></i><b>6.10</b> Managing graphic devices</a><ul>
<li class="chapter" data-level="6.10.1" data-path=""><a href="#opening-another-graphics-window"><i class="fa fa-check"></i><b>6.10.1</b> Opening another graphics window</a></li>
<li class="chapter" data-level="6.10.2" data-path=""><a href="#exporting-graphics"><i class="fa fa-check"></i><b>6.10.2</b> Exporting graphics</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path=""><a href="#ggplot2"><i class="fa fa-check"></i><b>7</b> ggplot2</a><ul>
<li class="chapter" data-level="7.1" data-path=""><a href="#ggcommon"><i class="fa fa-check"></i><b>7.1</b> Common charts</a><ul>
<li class="chapter" data-level="7.1.1" data-path=""><a href="#scatterplots"><i class="fa fa-check"></i><b>7.1.1</b> Scatterplots</a></li>
<li class="chapter" data-level="7.1.2" data-path=""><a href="#ggtimeseries"><i class="fa fa-check"></i><b>7.1.2</b> Time series</a></li>
<li class="chapter" data-level="7.1.3" data-path=""><a href="#ggbarplots"><i class="fa fa-check"></i><b>7.1.3</b> Barplots</a></li>
<li class="chapter" data-level="7.1.4" data-path=""><a href="#ggintplots"><i class="fa fa-check"></i><b>7.1.4</b> Interaction plots</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path=""><a href="#scales"><i class="fa fa-check"></i><b>7.2</b> Scales</a><ul>
<li class="chapter" data-level="7.2.1" data-path=""><a href="#gglogticks"><i class="fa fa-check"></i><b>7.2.1</b> Log axis with pretty tickmarks</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path=""><a href="#ggtheming"><i class="fa fa-check"></i><b>7.3</b> Themes</a></li>
<li class="chapter" data-level="7.4" data-path=""><a href="#ggtipstricks"><i class="fa fa-check"></i><b>7.4</b> Tips and tricks</a><ul>
<li class="chapter" data-level="7.4.1" data-path=""><a href="#fixing-labels-that-wont-fit"><i class="fa fa-check"></i><b>7.4.1</b> Fixing labels that won’t fit</a></li>
<li class="chapter" data-level="7.4.2" data-path=""><a href="#ggasp"><i class="fa fa-check"></i><b>7.4.2</b> Setting the aspect ratio</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path=""><a href="#ggres"><i class="fa fa-check"></i><b>7.5</b> Further resources</a><ul>
<li class="chapter" data-level="7.5.1" data-path=""><a href="#books-articles-and-tutorials"><i class="fa fa-check"></i><b>7.5.1</b> Books, articles, and tutorials</a></li>
<li class="chapter" data-level="7.5.2" data-path=""><a href="#related-packages"><i class="fa fa-check"></i><b>7.5.2</b> Related packages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path=""><a href="#plotly"><i class="fa fa-check"></i><b>8</b> Plotly</a><ul>
<li class="chapter" data-level="8.1" data-path=""><a href="#ggplotly"><i class="fa fa-check"></i><b>8.1</b> <code>ggplotly</code></a></li>
<li class="chapter" data-level="8.2" data-path=""><a href="#using-plotly-with-knitr"><i class="fa fa-check"></i><b>8.2</b> Using plotly with knitr</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path=""><a href="#lattice"><i class="fa fa-check"></i><b>9</b> Lattice graphics</a><ul>
<li class="chapter" data-level="9.1" data-path=""><a href="#overview-of-lattice-graphics"><i class="fa fa-check"></i><b>9.1</b> Overview of lattice graphics</a></li>
<li class="chapter" data-level="9.2" data-path=""><a href="#lattmpancond"><i class="fa fa-check"></i><b>9.2</b> Introduction to model formulae and multi-panel conditioning</a></li>
<li class="chapter" data-level="9.3" data-path=""><a href="#lattcommon"><i class="fa fa-check"></i><b>9.3</b> Common charts</a><ul>
<li class="chapter" data-level="9.3.1" data-path=""><a href="#xyplot"><i class="fa fa-check"></i><b>9.3.1</b> <code>xyplot</code></a></li>
<li class="chapter" data-level="9.3.2" data-path=""><a href="#lattbarchart"><i class="fa fa-check"></i><b>9.3.2</b> <code>barchart</code></a></li>
<li class="chapter" data-level="9.3.3" data-path=""><a href="#barcharts-with-error-bars"><i class="fa fa-check"></i><b>9.3.3</b> Barcharts with error bars</a></li>
<li class="chapter" data-level="9.3.4" data-path=""><a href="#latthist"><i class="fa fa-check"></i><b>9.3.4</b> Histograms and density plots</a></li>
<li class="chapter" data-level="9.3.5" data-path=""><a href="#interaction-plots"><i class="fa fa-check"></i><b>9.3.5</b> Interaction plots</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path=""><a href="#customizingtrellis"><i class="fa fa-check"></i><b>9.4</b> Customizing lattice graphics</a><ul>
<li class="chapter" data-level="9.4.1" data-path=""><a href="#trellispar"><i class="fa fa-check"></i><b>9.4.1</b> Themes</a></li>
<li class="chapter" data-level="9.4.2" data-path=""><a href="#textual-elements"><i class="fa fa-check"></i><b>9.4.2</b> Textual elements</a></li>
<li class="chapter" data-level="9.4.3" data-path=""><a href="#strips"><i class="fa fa-check"></i><b>9.4.3</b> Strips</a></li>
<li class="chapter" data-level="9.4.4" data-path=""><a href="#log-axis-with-pretty-tickmarks"><i class="fa fa-check"></i><b>9.4.4</b> Log axis with pretty tickmarks</a></li>
<li class="chapter" data-level="9.4.5" data-path=""><a href="#adding-regression-linescurves-to-a-xyplot"><i class="fa fa-check"></i><b>9.4.5</b> Adding regression lines/curves to a <code>xyplot</code></a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path=""><a href="#trellispanel"><i class="fa fa-check"></i><b>9.5</b> Writing panel functions</a><ul>
<li class="chapter" data-level="9.5.1" data-path=""><a href="#combining-panel-functions"><i class="fa fa-check"></i><b>9.5.1</b> Combining panel functions</a></li>
<li class="chapter" data-level="9.5.2" data-path=""><a href="#adding-error-bars-to-an-xyplot-single-panel-no-groups"><i class="fa fa-check"></i><b>9.5.2</b> Adding error bars to an <code>xyplot</code> (single panel, no groups)</a></li>
<li class="chapter" data-level="9.5.3" data-path=""><a href="#adding-error-bars-to-an-xyplot-with-multiple-panels-no-groups"><i class="fa fa-check"></i><b>9.5.3</b> Adding error bars to an <code>xyplot</code> with multiple panels (no groups)</a></li>
<li class="chapter" data-level="9.5.4" data-path=""><a href="#adding-error-bars-to-an-xyplot-with-groups-single-panel"><i class="fa fa-check"></i><b>9.5.4</b> Adding error bars to an <code>xyplot</code> with groups (single panel)</a></li>
<li class="chapter" data-level="9.5.5" data-path=""><a href="#adding-error-bars-to-an-xyplot-with-groups-and-multiple-panels"><i class="fa fa-check"></i><b>9.5.5</b> Adding error bars to an <code>xyplot</code> with groups and multiple panels</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path=""><a href="#lattres"><i class="fa fa-check"></i><b>9.6</b> Further resources</a><ul>
<li class="chapter" data-level="9.6.1" data-path=""><a href="#lattmat"><i class="fa fa-check"></i><b>9.6.1</b> Books, articles, and tutorials</a></li>
<li class="chapter" data-level="9.6.2" data-path=""><a href="#lattrelpkg"><i class="fa fa-check"></i><b>9.6.2</b> Related packages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path=""><a href="#graphicscommon"><i class="fa fa-check"></i><b>10</b> Graphics: common elements across plotting libraries</a><ul>
<li class="chapter" data-level="10.1" data-path=""><a href="#colorscommon"><i class="fa fa-check"></i><b>10.1</b> Colors for graphics</a><ul>
<li class="chapter" data-level="10.1.1" data-path=""><a href="#color-opacity"><i class="fa fa-check"></i><b>10.1.1</b> Color opacity</a></li>
<li class="chapter" data-level="10.1.2" data-path=""><a href="#color-palettes"><i class="fa fa-check"></i><b>10.1.2</b> Color palettes</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path=""><a href="#plotmath"><i class="fa fa-check"></i><b>10.2</b> Mathematical expressions and variables</a></li>
<li class="chapter" data-level="10.3" data-path=""><a href="#fonts"><i class="fa fa-check"></i><b>10.3</b> Fonts for graphics</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path=""><a href="#graphicspublications"><i class="fa fa-check"></i><b>11</b> Preparing graphics for publications</a><ul>
<li class="chapter" data-level="11.1" data-path=""><a href="#figure-size-and-fonts"><i class="fa fa-check"></i><b>11.1</b> Figure size and fonts</a><ul>
<li class="chapter" data-level="11.1.1" data-path=""><a href="#baserlattfigsizefonts"><i class="fa fa-check"></i><b>11.1.1</b> Baser R and <code>lattice</code> plots</a></li>
<li class="chapter" data-level="11.1.2" data-path=""><a href="#ggplot2figsizefonts"><i class="fa fa-check"></i><b>11.1.2</b> <code>ggplot2</code></a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path=""><a href="#pubthemes"><i class="fa fa-check"></i><b>11.2</b> Themes</a><ul>
<li class="chapter" data-level="11.2.1" data-path=""><a href="#baserpubthemes"><i class="fa fa-check"></i><b>11.2.1</b> Base R</a></li>
<li class="chapter" data-level="11.2.2" data-path=""><a href="#ggplot2pubthemes"><i class="fa fa-check"></i><b>11.2.2</b> <code>ggplot2</code></a></li>
<li class="chapter" data-level="11.2.3" data-path=""><a href="#lattpubthemes"><i class="fa fa-check"></i><b>11.2.3</b> <code>lattice</code></a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path=""><a href="#multi-panel-figures"><i class="fa fa-check"></i><b>11.3</b> Multi-panel figures</a><ul>
<li class="chapter" data-level="11.3.1" data-path=""><a href="#ggplot2pubmultipanel"><i class="fa fa-check"></i><b>11.3.1</b> <code>ggplot2</code></a></li>
<li class="chapter" data-level="11.3.2" data-path=""><a href="#lattpubmultipanel"><i class="fa fa-check"></i><b>11.3.2</b> <code>lattice</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path=""><a href="#tidyverse"><i class="fa fa-check"></i><b>12</b> Tidyverse</a><ul>
<li class="chapter" data-level="12.1" data-path=""><a href="#tibbles"><i class="fa fa-check"></i><b>12.1</b> Tibbles</a></li>
<li class="chapter" data-level="12.2" data-path=""><a href="#dplyr"><i class="fa fa-check"></i><b>12.2</b> <code>dplyr</code></a><ul>
<li class="chapter" data-level="12.2.1" data-path=""><a href="#group_by-and-summarize"><i class="fa fa-check"></i><b>12.2.1</b> <code>group_by</code> and <code>summarize</code></a></li>
<li class="chapter" data-level="12.2.2" data-path=""><a href="#getting-counts-of-cases"><i class="fa fa-check"></i><b>12.2.2</b> Getting counts of cases</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path=""><a href="#tests-statistics-with-dplyr-and-broom"><i class="fa fa-check"></i><b>12.3</b> Tests statistics with <code>dplyr</code> and <code>broom</code></a></li>
</ul></li>
<li class="chapter" data-level="13" data-path=""><a href="#probability-distributions"><i class="fa fa-check"></i><b>13</b> Probability distributions</a><ul>
<li class="chapter" data-level="13.1" data-path=""><a href="#bernoulli"><i class="fa fa-check"></i><b>13.1</b> The Bernoulli distribution</a></li>
<li class="chapter" data-level="13.2" data-path=""><a href="#binomial"><i class="fa fa-check"></i><b>13.2</b> The binomial distribution</a></li>
<li class="chapter" data-level="13.3" data-path=""><a href="#normal"><i class="fa fa-check"></i><b>13.3</b> The normal distribution</a><ul>
<li class="chapter" data-level="13.3.1" data-path=""><a href="#using-the-normal-distribution-to-run-a-z-test"><i class="fa fa-check"></i><b>13.3.1</b> Using the normal distribution to run a <em>z</em>-test</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path=""><a href="#distrres"><i class="fa fa-check"></i><b>13.4</b> Further resources</a><ul>
<li class="chapter" data-level="13.4.1" data-path=""><a href="#distrrelpkg"><i class="fa fa-check"></i><b>13.4.1</b> Related packages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path=""><a href="#frequentist-hypothesis-tests"><i class="fa fa-check"></i><b>14</b> Frequentist hypothesis tests</a><ul>
<li class="chapter" data-level="14.1" data-path=""><a href="#chi2-test"><i class="fa fa-check"></i><b>14.1</b> <span class="math inline">\(\chi^2\)</span> test</a><ul>
<li class="chapter" data-level="14.1.1" data-path=""><a href="#testing-hypotheses-about-the-distribution-of-a-categorical-variable"><i class="fa fa-check"></i><b>14.1.1</b> Testing hypotheses about the distribution of a categorical variable</a></li>
<li class="chapter" data-level="14.1.2" data-path=""><a href="#testing-hypotheses-about-the-association-between-two-categorical-variables"><i class="fa fa-check"></i><b>14.1.2</b> Testing hypotheses about the association between two categorical variables</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path=""><a href="#students-t-test"><i class="fa fa-check"></i><b>14.2</b> Student’s <em>t</em>-test</a><ul>
<li class="chapter" data-level="14.2.1" data-path=""><a href="#one-sample-t-test"><i class="fa fa-check"></i><b>14.2.1</b> One sample <em>t</em>-test</a></li>
<li class="chapter" data-level="14.2.2" data-path=""><a href="#two-sample-t-test"><i class="fa fa-check"></i><b>14.2.2</b> Two-sample <em>t</em>-test</a></li>
<li class="chapter" data-level="14.2.3" data-path=""><a href="#paired-t-test"><i class="fa fa-check"></i><b>14.2.3</b> Paired <em>t</em>-test</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path=""><a href="#levenetest"><i class="fa fa-check"></i><b>14.3</b> The Levene test for homogeneity of variances</a></li>
<li class="chapter" data-level="14.4" data-path=""><a href="#analysis-of-variance"><i class="fa fa-check"></i><b>14.4</b> Analysis of variance</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path=""><a href="#correlation-and-regression"><i class="fa fa-check"></i><b>15</b> Correlation and regression</a><ul>
<li class="chapter" data-level="15.1" data-path=""><a href="#linear-regression"><i class="fa fa-check"></i><b>15.1</b> Linear regression</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path=""><a href="#adjusting-the-p-values-for-multiple-comparisons"><i class="fa fa-check"></i><b>16</b> Adjusting the <em>p</em>-values for multiple comparisons</a></li>
<li class="chapter" data-level="17" data-path=""><a href="#admin"><i class="fa fa-check"></i><b>17</b> Administration and maintenance</a><ul>
<li class="chapter" data-level="17.1" data-path=""><a href="#custom"><i class="fa fa-check"></i><b>17.1</b> Environment customisation</a></li>
<li class="chapter" data-level="17.2" data-path=""><a href="#compiling-r-on-debianubuntu"><i class="fa fa-check"></i><b>17.2</b> Compiling R on Debian/Ubuntu</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path=""><a href="#ess-using-emacs-speaks-statistics-with-r"><i class="fa fa-check"></i><b>18</b> ESS: Using Emacs Speaks Statistics with R</a><ul>
<li class="chapter" data-level="18.1" data-path=""><a href="#using-ess-for-editing-and-debugging-r-source-files"><i class="fa fa-check"></i><b>18.1</b> Using ESS for editing and debugging R source files</a></li>
<li class="chapter" data-level="18.2" data-path=""><a href="#using-ess-to-interact-with-a-r-process"><i class="fa fa-check"></i><b>18.2</b> Using ESS to interact with a R process</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path=""><a href="#writing-reports-with-rmarkdown-or-sweave"><i class="fa fa-check"></i><b>19</b> Writing reports with <code>rmarkdown</code> or Sweave</a><ul>
<li class="chapter" data-level="19.1" data-path=""><a href="#rmarkdown"><i class="fa fa-check"></i><b>19.1</b> <code>rmarkdown</code></a></li>
<li class="chapter" data-level="19.2" data-path=""><a href="#using-sweave-to-write-documents-with-r-and-latex"><i class="fa fa-check"></i><b>19.2</b> Using Sweave to write documents with R and LaTeX</a><ul>
<li class="chapter" data-level="19.2.1" data-path=""><a href="#what-is-sweave"><i class="fa fa-check"></i><b>19.2.1</b> What is Sweave?</a></li>
<li class="chapter" data-level="19.2.2" data-path=""><a href="#usage"><i class="fa fa-check"></i><b>19.2.2</b> Usage</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20" data-path=""><a href="#soundprocessing"><i class="fa fa-check"></i><b>20</b> Sound processing</a><ul>
<li class="chapter" data-level="20.1" data-path=""><a href="#libraries-for-sound-analysis-and-signal-processing"><i class="fa fa-check"></i><b>20.1</b> Libraries for sound analysis and signal processing</a><ul>
<li class="chapter" data-level="20.1.1" data-path=""><a href="#seewave"><i class="fa fa-check"></i><b>20.1.1</b> <code>seewave</code></a></li>
<li class="chapter" data-level="20.1.2" data-path=""><a href="#sound"><i class="fa fa-check"></i><b>20.1.2</b> <code>sound</code></a></li>
<li class="chapter" data-level="20.1.3" data-path=""><a href="#tuner"><i class="fa fa-check"></i><b>20.1.3</b> <code>tuneR</code></a></li>
<li class="chapter" data-level="20.1.4" data-path=""><a href="#signal"><i class="fa fa-check"></i><b>20.1.4</b> <code>signal</code></a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path=""><a href="#partial-list-of-packages-by-category"><i class="fa fa-check"></i><b>A</b> Partial list of packages by category</a><ul>
<li class="chapter" data-level="A.1" data-path=""><a href="#graphics-packages"><i class="fa fa-check"></i><b>A.1</b> Graphics packages</a></li>
<li class="chapter" data-level="A.2" data-path=""><a href="#gui-packages"><i class="fa fa-check"></i><b>A.2</b> GUI packages</a></li>
<li class="chapter" data-level="A.3" data-path=""><a href="#bibliography-management"><i class="fa fa-check"></i><b>A.3</b> Bibliography management</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path=""><a href="#miscellaneous-commands"><i class="fa fa-check"></i><b>B</b> Miscellaneous commands</a><ul>
<li class="chapter" data-level="B.1" data-path=""><a href="#data"><i class="fa fa-check"></i><b>B.1</b> Data</a></li>
<li class="chapter" data-level="B.2" data-path=""><a href="#help"><i class="fa fa-check"></i><b>B.2</b> Help</a></li>
<li class="chapter" data-level="B.3" data-path=""><a href="#objects"><i class="fa fa-check"></i><b>B.3</b> Objects</a></li>
<li class="chapter" data-level="B.4" data-path=""><a href="#organize-a-session"><i class="fa fa-check"></i><b>B.4</b> Organize a session</a></li>
<li class="chapter" data-level="B.5" data-path=""><a href="#r-administration"><i class="fa fa-check"></i><b>B.5</b> R administration</a></li>
<li class="chapter" data-level="B.6" data-path=""><a href="#syntax"><i class="fa fa-check"></i><b>B.6</b> Syntax</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path=""><a href="#other-manuals-and-sources-of-information-on-r"><i class="fa fa-check"></i><b>C</b> Other manuals and sources of information on R</a><ul>
<li class="chapter" data-level="C.1" data-path=""><a href="#in-italian"><i class="fa fa-check"></i><b>C.1</b> In Italian</a></li>
<li class="chapter" data-level="C.2" data-path=""><a href="#other-useful-statistics-resources"><i class="fa fa-check"></i><b>C.2</b> Other useful statistics resources</a><ul>
<li class="chapter" data-level="C.2.1" data-path=""><a href="#in-italian-1"><i class="fa fa-check"></i><b>C.2.1</b> In Italian</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="D" data-path=""><a href="#fullcoltable"><i class="fa fa-check"></i><b>D</b> Full colors table</a></li>
<li class="chapter" data-level="" data-path=""><a href="#references"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A R Guide</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">A R Guide</h1>
<h2 class="subtitle"><em>0.4.0</em></h2>
<p class="author"><em>Samuele Carcagno</em></p>
<p class="date"><em>20 settembre, 2020</em></p>
</div>

<p><img src="images/psych_fun.png" width="225" style="display: block; margin: auto;" /></p>

<p><a href="http://samcarcagno.altervista.org/soft/r.html">A R Guide</a> by Samuele Carcagno <a href="mailto:sam.carcagno@gmail.com">sam.carcagno@gmail.com</a> is licensed under a <a href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</p>
<p><img src="images/by-sa_88x31.png" width="44" style="display: block; margin: auto;" /></p>
<p>Based on a work at <a href="https://github.com/sam81/rguide" class="uri">https://github.com/sam81/rguide</a>.</p>
<p>The latest html version of this guide is available at <a href="https://sam81.github.io/r_guide_bookdown/rguide.html" class="uri">https://sam81.github.io/r_guide_bookdown/rguide.html</a></p>
<p>A pdf version of this guide can be downloaded at <a href="https://sam81.github.io/r_guide_bookdown/rguide.pdf" class="uri">https://sam81.github.io/r_guide_bookdown/rguide.pdf</a></p>
<p>Associated datasets available at <a href="https://sam81.github.io/r_guide_bookdown/rguide_datasets.zip" class="uri">https://sam81.github.io/r_guide_bookdown/rguide_datasets.zip</a></p>
<p>Associated code available at <a href="https://sam81.github.io/r_guide_bookdown/rguide_code.zip" class="uri">https://sam81.github.io/r_guide_bookdown/rguide_code.zip</a></p>

<div id="preface" class="section level1 unnumbered">
<h1>Preface</h1>
<p>I started writing this guide in 2006 while I was learning R. It was always a work in progress, with incomplete bits and parts, and it wasn’t updated for several years. Much has changed since then both in the R ecosystem, and in the way I use R for data analysis. I’m now in the process of revising it to reflect these changes. Because this guide was initially written when I still had very little knowledge not only of R but of programming in general, it tends to explain things with a very simple, beginner-friendly approach. I hope to maintain this aspect of the guide as I revise it. This remains very much a work in progress and comes with NO WARRANTY whatsoever of being correct in any of its parts.</p>
<p>For me, this is like a R desk reference. Once I figure out some new useful function, how to solve a particular problem in R, or how to generate a certain graphic, I write it down in this guide. Next time I have to solve the same problem I quickly know where to find the answer, rather than wading through internet forums, stack overflow, or other websites hunting down for the answer.</p>

</div>
<div id="intro" class="section level1">
<h1><span class="header-section-number">1</span> Getting started with R</h1>

<div id="installing-r" class="section level2">
<h2><span class="header-section-number">1.1</span> Installing R</h2>
<p>The information on installing R provided in this section is relatively generic and limited. For detailed information please refer to the “R Installation and Administration Manual” available at the CRAN website <a href="https://cran.r-project.org" class="uri">https://cran.r-project.org</a>. CRAN stands for “Comprehensive R Archive Network”, and is the main point of reference for the R software. There you can find R sources, binaries, documentation, and add-on packages.</p>
<div id="installing-the-base-program" class="section level3">
<h3><span class="header-section-number">1.1.1</span> Installing the base program</h3>
<p>First of all you need to install the base R program. There are two ways of doing this, you can either compile the source code yourself, or you can install the precompiled binaries for your specific operating system. The second way is the easiest one, and usually you will want to go with it.</p>
<div id="gnulinux-and-other-unix-systems" class="section level4">
<h4><span class="header-section-number">1.1.1.1</span> GNU/Linux and other Unix systems</h4>
<p>Precompiled binaries are available for some GNU/Linux distributions, there is a list of these on the <a href="https://cran.r-project.org/doc/FAQ/R-FAQ.html">R FAQ</a>. For other distributions you can build R from source. There are precompiled binaries for Debian GNU/Linux, so you can install the R base system and a number of add-on packages with the usual methods under Debian, that is, by using <code>apt-get</code>, or a graphical package manager such as <code>Synaptic</code>, or whatever else you normally use.</p>
</div>
<div id="windows" class="section level4">
<h4><span class="header-section-number">1.1.1.2</span> Windows</h4>
<p>There are precompiled binaries for Windows, you just have to download them, then double click on the installer’s icon to start the installation. Most Windows versions are supported.</p>
</div>
<div id="mac-os-x" class="section level4">
<h4><span class="header-section-number">1.1.1.3</span> Mac Os X</h4>
<p>Precompiled binaries are also available for Mac Os X, you can download them and then double click on the installer’s icon to start the installation.</p>
</div>
</div>
<div id="installpkg" class="section level3">
<h3><span class="header-section-number">1.1.2</span> Installing add-on packages</h3>
<p>There is a vast number of add-on <a href="https://cran.r-project.org/web/packages/available_packages_by_name.html">packages</a> (for a categorized view see <a href="https://cran.r-project.org/web/views/">CRAN task views</a>) that implement statistical functions that are not available with the base program. They’re not strictly necessary, but if you keep using R, sooner or later you will want to install some of these packages.</p>
<div id="gnulinux-and-other-unix-systems-1" class="section level4">
<h4><span class="header-section-number">1.1.2.1</span> GNU/Linux and other Unix systems</h4>
<p>There are different ways to get packages installed. For Debian there are precompiled versions of some packages, so you can get them with <code>apt-get</code> or whatever else you usually use to install Debian packages; this will also take care of possible dependencies (some packages need other packages or system libraries to be installed in order to work). For other packages, from an R session you can call the <code>install.packages</code> function, for example:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">install.packages</span>(<span class="st">&quot;gplots&quot;</span>)</a></code></pre></div>
<p>will install the <code>gplots</code> package. You can also install more than one package in one go:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">install.packages</span>(<span class="kw">c</span>(<span class="st">&quot;gplots&quot;</span>, <span class="st">&quot;signal&quot;</span>))</a></code></pre></div>
<p>will install the <code>gplots</code> and <code>signal</code> packages. Another way to install a package is to download the related tarball from CRAN and then from a console issue the command:</p>
<pre><code>R CMD INSTALL /packagename</code></pre>
<p>where <code>packagename</code> is the full path to the tarball you have downloaded. There are other ways and other specific options to install add-on packages. You should refer to the “R Installation and Administration Manual” for further information.</p>
</div>
<div id="windows-1" class="section level4">
<h4><span class="header-section-number">1.1.2.2</span> Windows</h4>
<p>The R graphical user interface (GUI) on Windows provides an interface to download and install the packages directly from the internet.</p>
</div>
</div>
</div>
<div id="a-simple-introduction-to-r" class="section level2">
<h2><span class="header-section-number">1.2</span> A simple introduction to R</h2>
<p>This section will give a simple introduction to R, just to get familiar with it and get a general idea of how it works. This section assumes no previous knowledge of programming. If you know other computer languages, or have even a basic knowledge of programming, getting started will be easy. If you don’t, don’t worry, R syntax is very elegant and simple, it might take a little while, but after looking at some examples, and importantly, trying them out yourself, you’ll be up and running without problems. This tutorial deals only with learning to use R from the command line, if you’d rather use R with a GUI, that is, with a “point and click” interface, please have a look at Section <a href="#gui">1.2.6</a> for some information on how to get started.</p>
<div id="datasets" class="section level3">
<h3><span class="header-section-number">1.2.1</span> Datasets</h3>
<p>This guide uses several datasets. If you want to follow the examples given in the guide you can download the datasets from this URL: <a href="https://sam81.github.io/r_guide_bookdown/rguide_datasets.zip" class="uri">https://sam81.github.io/r_guide_bookdown/rguide_datasets.zip</a></p>
</div>
<div id="firing-up-and-quitting-r" class="section level3">
<h3><span class="header-section-number">1.2.2</span> Firing up and quitting R</h3>
<p>Under GNU/Linux systems you can start R from a shell, just type <code>R</code> and press <kbd>Enter</kbd>. Under Windows you can click on the R icon to start the R GUI.</p>
<p>You can save yourself a lot of typing by using the up arrow key ↑ to retrieve past commands.</p>
<p>Commands can be terminated either by a semi-colon <code>;</code> or by pressing <kbd>Enter</kbd> and starting a newline. If you start a newline before a command is complete, R will prompt you to complete the command with a <code>+</code> sign, you can then complete the command. If you don’t know how to complete the command and get stuck, you can stop R prompting you with the plus sign by pressing the <kbd>CTRL</kbd> and <kbd>C</kbd> keys simultaneously.</p>
<p>To quit R type <code>quit()</code> or <code>q()</code>, R will ask you if you want to save the current session, if you answer <code>y</code>, R will save all the objects active in the current session and the command history.</p>
</div>
<div id="starting-to-work-with-r" class="section level3">
<h3><span class="header-section-number">1.2.3</span> Starting to work with R</h3>
<p>The first thing you can try, is doing some math, at the command prompt type <code>5+4</code> and press <kbd>Enter</kbd>, the result will be</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="dv">5</span> <span class="op">+</span><span class="st"> </span><span class="dv">4</span></a></code></pre></div>
<pre><code>## [1] 9</code></pre>
<p>well, obviously 9. Other arithmetic operators are listed in Table <a href="#tab:arithmetic">1.1</a></p>
<table>
<caption><span id="tab:arithmetic">Table 1.1: </span> Arithmetic Operators.</caption>
<thead>
<tr class="header">
<th>Symbol</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>+</code></td>
<td>Addition</td>
</tr>
<tr class="even">
<td><code>-</code></td>
<td>Subtraction</td>
</tr>
<tr class="odd">
<td><code>*</code></td>
<td>Multiplication</td>
</tr>
<tr class="even">
<td><code>/</code></td>
<td>Division</td>
</tr>
<tr class="odd">
<td><code>^</code></td>
<td>Exponentiation</td>
</tr>
</tbody>
</table>
<p>Now let’s create a variable, we’ll call it <code>foo</code>, and assign to it a number</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">foo =<span class="st"> </span><span class="dv">5</span></a></code></pre></div>
<p>the equal sign <code>=</code> is the assignment operator in R, in the above case it means “the value of <code>foo</code> is 5”, <code>foo</code> is an object. The “arrow symbol”, constructed by a “less than” sign followed by a dash, <code>&lt;-</code>, can also be used as an assignment operator, and <code>foo = 5</code> is equivalent to</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">foo &lt;-<span class="st"> </span><span class="dv">5</span></a></code></pre></div>
<div class="rmdnote">
<p>
In R both <code>=</code> and <code>&lt;-</code> can be used as assignment operators. For example, the expression <code>x = 5</code> and the expression <code>x &lt;- 5</code> are equivalent, and both are in common use, although some style guides recommend one over the other. In a few corner cases using <code>&lt;-</code> instead of <code>=</code> may lead to different behaviors (e.g. when trying to make assignments inside function calls; something that you generally shouldn’t do).
</p>
<p>
I tend to stick to using <code>=</code> because it requires only a single keystroke, looks more readable to me, and is the assignment operator used in almost all other programming languages.
</p>
</div>
<p>Because <code>foo</code> is an object of numeric type, we can perform arithmetic operations on it:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">foo <span class="op">*</span><span class="st"> </span><span class="dv">2</span></a></code></pre></div>
<pre><code>## [1] 10</code></pre>
<p>we can also store the results of an arithmetic operation in an object:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">another_foo =<span class="st"> </span><span class="dv">5</span><span class="op">^</span><span class="dv">2</span></a></code></pre></div>
<p>if you want to display the value of this new object you can use</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">print</span>(another_foo)</a></code></pre></div>
<pre><code>## [1] 25</code></pre>
<p>or, for short, just type its name and press <kbd>Enter</kbd></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">another_foo</a></code></pre></div>
<pre><code>## [1] 25</code></pre>
<p>since the two objects we have created are both numeric we can also sum them:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">foo <span class="op">+</span><span class="st"> </span>another_foo</a></code></pre></div>
<pre><code>## [1] 30</code></pre>
<div class="rmdnote">
<p>
In R variable names can be made up of letters, numbers, and the underscore (<code>_</code>), or the dot (<code>.</code>) characters. For example <code>foo</code>, <code>foo1</code>, <code>foo_1</code>, and <code>foo.1</code> are all syntactically valid variable names. However, there are some restrictions; for example variable names cannot start with a number, or with an underscore. Also, there are reserved keywords, such as <code>for</code>, <code>if</code>, <code>else</code>, that cannot be used as variable names. For more info see the help page for <code>make.names</code> by typing <code>?make.names</code> in the R interpreter.
</p>
</div>
<p>Let’s look at something more interesting, we can create an object that stores a series of numbers, for example the money we have spent each day of a week, in Euros; we can do this using the <code>c</code> function, which concatenates a series of values into a <em>vector</em>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">expenses =<span class="st"> </span><span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">9</span>, <span class="dv">45</span>, <span class="dv">3</span>)</a></code></pre></div>
<p>you might want to find out how much you’ve spent on average during the week, this is easily accomplished with the function <code>mean</code></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1"><span class="kw">mean</span>(expenses)</a></code></pre></div>
<pre><code>## [1] 15.28571</code></pre>
<p>the function <code>sd</code> gives you the standard deviation</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1"><span class="kw">sd</span>(expenses)</a></code></pre></div>
<pre><code>## [1] 14.24446</code></pre>
<p>Surely you’ve wondered why <code>[1]</code> appears every time R gives you a result, now that we’ve introduced the vector we can get to it. Try to create a long vector, you can easily do this by creating a sequence of numbers, for example:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1">long_vec =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">100</span>, <span class="dt">by=</span><span class="dv">1</span>)</a></code></pre></div>
<p>will create a vector containing the sequence of numbers from 1 to 100, now try to display it and see what happens. All the elements of the vector won’t fit in a single line of the screen, and at the start of each line you’ll get between  the index, that is the position, of the first element on that line. There’s also a shorthand to create such a vector:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1">long_vec =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">100</span></a></code></pre></div>
<p>R can also deal with string variables:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1">name =<span class="st"> &quot;John&quot;</span></a>
<a class="sourceLine" id="cb24-2" title="2">msg1 =<span class="st"> &quot;said to check the supplies&quot;</span></a></code></pre></div>
<p>strings can be concatenated together with the <code>paste</code> function:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1"><span class="kw">paste</span>(name, msg1)</a></code></pre></div>
<pre><code>## [1] &quot;John said to check the supplies&quot;</code></pre>
<p>by default strings pasted together with the <code>paste</code> function are separated by a blank space, but this can be changed by supplying a <code>sep</code> argument to the function:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1"><span class="kw">paste</span>(name, msg1, <span class="dt">sep=</span><span class="st">&quot;;&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;John;said to check the supplies&quot;</code></pre>
<p>if we want the strings to be attached together with no separator at all, we can write <code>paste(name, msg1, sep=&quot;&quot;)</code>, but it is more convenient to use the <code>paste0</code> function instead:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1"><span class="kw">paste0</span>(name, msg1)</a></code></pre></div>
<pre><code>## [1] &quot;Johnsaid to check the supplies&quot;</code></pre>
<p>more string facilities are presented in Section <a href="#stringprocessing">4.3</a>.</p>
</div>
<div id="using-r-packages" class="section level3">
<h3><span class="header-section-number">1.2.4</span> Using R packages</h3>
<p>As mention in Section <a href="#installpkg">1.1.2</a> there are many add-on packages, with additional statistical and graphical functions for R. That section had some instructions on how to install them, but did not explain how to use them. In order to use a function from a package that you have already installed you can load the package with the <code>library</code> function. For example, if you want to use the <code>geometric.mean</code> function from the <code>psych</code> package in order to compute the geometric mean of a set of numbers you can run the following commands:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1"><span class="kw">library</span>(psych)</a>
<a class="sourceLine" id="cb31-2" title="2"><span class="kw">geometric.mean</span>(<span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">54</span>, <span class="dv">7</span>, <span class="dv">15</span>))</a></code></pre></div>
<pre><code>## [1] 12.27187</code></pre>
<p>Loading a package in this way will import all the functions of that package in the current <em>namespace</em>, in other words, this lets you call directly those functions from the current session. Occasionally there may be “clashes” in the namespace; suppose there is another package called <code>foz</code> (I’m making it up) tha you also need to use in your session. Package <code>foz</code> also happens to have a function called <code>geometric.mean</code> that behaves slightly differently from the function in the <code>psych</code> package. If you load package <code>foz</code> after package <code>psych</code>, the <code>geometric.mean</code> function from <code>foz</code> will <em>mask</em> the one from <code>psych</code> (you will get a warning on the R terminal). So, what can you do if you want to use the <code>geometric.mean</code> function from <code>psych</code> when it’s masked? You can call it with the following syntax:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1">psych<span class="op">::</span><span class="kw">geometric.mean</span>(<span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">54</span>, <span class="dv">7</span>, <span class="dv">15</span>))</a></code></pre></div>
<pre><code>## [1] 12.27187</code></pre>
<p>note that this syntax works also if the <code>psych</code> package is not loaded, in other words you can call functions from packages with the <code>pkgname::fncname</code> syntax without loading the package.</p>
</div>
<div id="gettinghelp" class="section level3">
<h3><span class="header-section-number">1.2.5</span> Getting help</h3>
<p>R comes with an excellent online help facility which documents and gives examples for all available functions. There is also a web interface for the help system which is easier to use, you can start it with</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1"><span class="kw">help.start</span>()</a></code></pre></div>
<p>this fires up a web browser from which you can access a search engine for all the available documentation. The documentation is also available as a <code>pdf</code> file, the `<code>Full Reference Manual'' which documents the base system. Printable</code>pdf` manuals are also available for all the other additional packages.</p>
<div id="the-online-help-system" class="section level4">
<h4><span class="header-section-number">1.2.5.1</span> The online help system</h4>
<p>You can quickly look up the documentation for a function, for example <code>sd</code>, with</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" title="1">?sd</a></code></pre></div>
<p>or</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1"><span class="kw">help</span>(sd)</a></code></pre></div>
<p>it is often indifferent using quotes or not, but sometimes they are required, for example</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" title="1">?<span class="op">*</span><span class="st"> </span><span class="co">## doesn&#39;t work</span></a>
<a class="sourceLine" id="cb38-2" title="2">Error<span class="op">:</span><span class="st"> </span>syntax error</a>
<a class="sourceLine" id="cb38-3" title="3">?<span class="st">&quot;*&quot;</span>  <span class="co">## this works!</span></a></code></pre></div>
<p>to quit the help screen press <kbd>Q</kbd>.</p>
<p>You can easily run the example code given in the help pages for a given function with</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" title="1"><span class="kw">example</span>(function_name)</a></code></pre></div>
<p>it is better to set the graphics parameter <code>ask</code> as <code>TRUE</code> before running the examples</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" title="1"><span class="kw">par</span>(<span class="dt">ask=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<p>to pause between successive plots, if there is more than one.</p>
<p>The online help system searches by default the available documentation for the base system and all the packages that are currently loaded. If you want to look the documentation for a function present in a package that is not loaded, you need to specify the package in question:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" title="1"><span class="kw">help</span>(<span class="st">&quot;levene.test&quot;</span>, <span class="dt">package=</span>car)</a></code></pre></div>
<p>if you know the function exists but don’t know the package it is in, try</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" title="1"><span class="kw">help</span>(levene.test, <span class="dt">try.all.packages=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb42-2" title="2">Help <span class="cf">for</span> topic <span class="st">&#39;levene.test&#39;</span> is not <span class="cf">in</span> any loaded package but can be</a>
<a class="sourceLine" id="cb42-3" title="3">found <span class="cf">in</span> the following packages<span class="op">:</span></a>
<a class="sourceLine" id="cb42-4" title="4"></a>
<a class="sourceLine" id="cb42-5" title="5">Package               Library</a>
<a class="sourceLine" id="cb42-6" title="6">car                   <span class="op">/</span>usr<span class="op">/</span>lib<span class="op">/</span>R<span class="op">/</span>site<span class="op">-</span>library</a></code></pre></div>
<p>The function <code>help.search</code> can be used when you don’t exactly know the name of the function you’re looking for</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" title="1"><span class="kw">help.search</span>(<span class="st">&quot;levene&quot;</span>)</a>
<a class="sourceLine" id="cb43-2" title="2">Help files with alias or concept or title matching <span class="st">&#39;levene&#39;</span> using</a>
<a class="sourceLine" id="cb43-3" title="3">fuzzy matching<span class="op">:</span></a>
<a class="sourceLine" id="cb43-4" title="4"></a>
<a class="sourceLine" id="cb43-5" title="5"></a>
<a class="sourceLine" id="cb43-6" title="6"><span class="kw">levene.test</span>(car)        Levene<span class="st">&#39;s Test</span></a>
<a class="sourceLine" id="cb43-7" title="7"><span class="st">...</span></a></code></pre></div>
</div>
</div>
<div id="gui" class="section level3">
<h3><span class="header-section-number">1.2.6</span> Working with a graphical user interface</h3>
<p>The default version of R for Windows and macOS comes with a very limited graphical user interface (GUI), while the GNU/Linux version comes with no GUI at all. There are, however, several independent projects aimed at developing a GUI for R. The following sections give info on some of them.</p>
<div id="r-studio" class="section level4">
<h4><span class="header-section-number">1.2.6.1</span> R Studio</h4>
<p>R Studio is currently the most popular GUI for R. It can be installed on all major operating systems: <a href="https://www.rstudio.com" class="uri">https://www.rstudio.com</a>.</p>
</div>
<div id="the-r-commander" class="section level4">
<h4><span class="header-section-number">1.2.6.2</span> The R Commander</h4>
<p>An extensive GUI for R is provided by the <code>Rcmdr</code> package (<a href="https://www.rcommander.com/">R commander</a>). This GUI allows you to do many of the operations you can do using R from the command line, through a point and click visual interface. The R commander is just a R package, so in order to use it, you need to have R installed in the first place, then you have to install the <code>Rcmdr</code> package and all the other packages it depends on. After everything is installed correctly, fire up R and call the R commander as you do with any other package:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" title="1"><span class="kw">library</span>(Rcmdr)</a></code></pre></div>
<p>you will be greeted by a GUI with menus that allow you to type in data, perform statistical analyses and create graphs. The R commander works on both GNU/Linux and Windows platforms. For further information, please refer to the R commander manual or look up the following web page: <a href="http://www.rcommander.com/" class="uri">http://www.rcommander.com/</a>.</p>
</div>
<div id="jgr" class="section level4">
<h4><span class="header-section-number">1.2.6.3</span> JGR</h4>
<p>The JGR package provides a clean, simple graphical user interface for R, which is platform independent. The package is written in JAVA and requires the JAVA SDK to run. More info is available at the project webpage: <a href="https://www.rforge.net/JGR/" class="uri">https://www.rforge.net/JGR/</a></p>

</div>
</div>
</div>
</div>
<div id="organizing-a-working-session" class="section level1">
<h1><span class="header-section-number">2</span> Organizing a working session</h1>
<div id="setting-and-changing-the-working-directory" class="section level2">
<h2><span class="header-section-number">2.1</span> Setting and changing the working directory</h2>
<p>The command <code>getwd</code> displays the pathname of the current working directory, that is where R will look for and store files if not otherwise instructed.</p>
<p>To change the current working directory, use the command <code>setwd(&quot;dirname&quot;)</code>, where <code>dirname</code> is the pathname of the working directory you’re moving into. Note that this has to be an existent working directory, because R cannot create a new directory with this command. Here’s an example of how to specify the pathname on Windows:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" title="1"><span class="kw">setwd</span>(<span class="st">&quot;C:/mydata/rats&quot;</span>)</a></code></pre></div>
<p>note that you have to use a slash <code>&quot;/&quot;</code> and not backslash <code>&quot;\&quot;</code> like you usually do in Windows to specify the pathname. On Unix-based OSs the pathname is specified as it would be in a shell command, e.g.:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" title="1"><span class="kw">setwd</span>(<span class="st">&quot;/home/user123/Documents/analysis_exp_xyz&quot;</span>)</a></code></pre></div>
<p>You can also specify a pathname relative to your current working directory, without specifying the full pathname. It is indifferent using single <code>' '</code> or double <code>&quot; &quot;</code> quotes, this holds true when you need to quote character strings. For example to change the working directory up one level in the directory hierarchy you can write:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" title="1"><span class="kw">setwd</span>(<span class="st">&quot;../&quot;</span>)</a></code></pre></div>
<p>If you want to see the files present in your current working directory you can use:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" title="1"><span class="kw">dir</span>()</a></code></pre></div>
<p>It is also possible to issue commands to the OS from within R with the <code>system</code> function, for example</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" title="1"><span class="kw">system</span>(<span class="st">&quot;ls&quot;</span>)</a></code></pre></div>
<p>under GNU/Linux or Unix systems, will list the files present in the current directory.</p>
</div>
<div id="varobj" class="section level2">
<h2><span class="header-section-number">2.2</span> Objects</h2>
<p>All the variables, functions, arrays etc…, that you work with in R are stored and manipulated as <em>objects</em>. To list all the objects currently active in your <em>workspace</em>, you can use the command:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" title="1"><span class="kw">objects</span>()</a></code></pre></div>
<p>or alternatively</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" title="1"><span class="kw">ls</span>()</a></code></pre></div>
<p>if you want to remove some of these objects from memory, you can use the command:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" title="1"><span class="kw">rm</span>(X, Y, W, foo, rats)</a></code></pre></div>
<p>you can also give the variables to be removed, as a character vector:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" title="1"><span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;Y&quot;</span>, <span class="st">&quot;foo&quot;</span>, <span class="st">&quot;rats&quot;</span>))</a></code></pre></div>
<p>if you want to remove all the objects in your workspace, you can combine the <code>ls</code> and <code>rm</code> commands as follows:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" title="1"><span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">ls</span>())</a></code></pre></div>
<p>this however doesn’t remove objects whose name starts with a dot, to remove also those you can use:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" title="1"><span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">ls</span>(<span class="dt">all=</span><span class="ot">TRUE</span>))</a></code></pre></div>
</div>
<div id="saving-and-using-the-workspace-image" class="section level2">
<h2><span class="header-section-number">2.3</span> Saving and using the “workspace image”</h2>
<p>You can use a ``workspace image’’ that you have previously saved by starting R from the directory in which it was saved. In this way you can use the objects created in a previous session and the up arrow as well to retrieve commands from that session. To take full advantage from workspace images you’d better use different working directories for different analyses, studies, experiments and so on, in this way you can restore the workspace image of a specific analysis you were running and above all, you avoid accidentally overwriting objects from different analyses by creating another object with the same name during your current analysis.</p>
<p>When saving the workspace image R stores two files in the current working directory, one with the objects and one with the command history. This files begin with a dot under GNU/Linux and so are hidden.</p>
<p>You can save the workspace image either on exit, answering yes to the prompt you’re given, or during a session with the <code>save.image</code> function, the latter is a good measure against accidental losses of objects due to a power failure.</p>
</div>
<div id="working-in-batch-mode" class="section level2">
<h2><span class="header-section-number">2.4</span> Working in batch mode</h2>
<div id="executing-commands-written-in-a-file-from-an-r-session" class="section level3">
<h3><span class="header-section-number">2.4.1</span> Executing commands written in a file from an R session</h3>
<p>Instead of writing and executing commands line by line, it is often convenient to write the commands in a text file and then run them all at once in batch mode. You just write the commands with a text editor in a file, as if it were on the R console, save it in a directory, and then from within an R session issue the command:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" title="1"><span class="kw">source</span>(<span class="st">&quot;C:mydata/myfile.txt&quot;</span>)</a></code></pre></div>
<p>By default R displays only the results of the commands written in the source file, you can change this using the option:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" title="1"><span class="kw">source</span>(<span class="st">&quot;C:mydata/myfile.txt&quot;</span>, <span class="dt">echo=</span><span class="ot">TRUE</span>)</a></code></pre></div>
</div>
<div id="executing-commands-written-in-a-file-from-a-shell" class="section level3">
<h3><span class="header-section-number">2.4.2</span> Executing commands written in a file from a shell</h3>
<p>It is also possible to execute R commands written in a file without starting an R session: From within your system’s shell (for example bash on GNU/Linux or dos on Windows) issue the command</p>
<pre><code>  $ R CMD BATCH myfile.R</code></pre>
<p>where <code>myfile.R</code> is the file you’ve written the R commands in.</p>

</div>
</div>
</div>
<div id="datamanip" class="section level1">
<h1><span class="header-section-number">3</span> Data types and data manipulation</h1>
<div id="vectors" class="section level2">
<h2><span class="header-section-number">3.1</span> Vectors</h2>
<p>One of the simplest and among the most important data types in R is the vector, which can be numerical or containing strings of characters. A simple way to build a vector is through the <code>c</code> function, which concatenates a series of data values, for example:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" title="1">temperature =<span class="st"> </span><span class="kw">c</span>(<span class="dv">34</span>, <span class="dv">45</span>, <span class="dv">23</span>, <span class="dv">29</span>, <span class="dv">26</span>, <span class="dv">31</span>, <span class="dv">44</span>, <span class="dv">32</span>, <span class="dv">19</span>, <span class="dv">22</span>, <span class="dv">34</span>)</a></code></pre></div>
<p>in this case <code>c</code> concatenates a series of numerical data into a vector and the assignment operator <code>=</code> assigns it to the variable “temperature”, so that it can be retrieved later. Once the variable is created you can apply functions to it, for example</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" title="1"><span class="kw">mean</span>(temperature)</a></code></pre></div>
<pre><code>## [1] 30.81818</code></pre>
<p>will compute the mean of the data vector. If you want to save the result of this function, you just have to assign it to another object:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" title="1">mean_temp =<span class="st"> </span><span class="kw">mean</span>(temperature)</a></code></pre></div>
<p>note that in this case the value is assigned to the object <code>mean_temp</code> but it is not printed, you can display it with</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" title="1"><span class="kw">print</span>(mean_temp)</a></code></pre></div>
<pre><code>## [1] 30.81818</code></pre>
<p>or for short, just calling the object</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" title="1">mean_temp</a></code></pre></div>
<pre><code>## [1] 30.81818</code></pre>
<p>You can also perform simple arithmetic operations on a vector, for example:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" title="1">temperature <span class="op">+</span><span class="st"> </span><span class="dv">10</span></a></code></pre></div>
<pre><code>##  [1] 44 55 33 39 36 41 54 42 29 32 44</code></pre>
<p>will add 10 to each element of the vector.</p>
<p>You can also build vectors of characters, quoting each element of the vector</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" title="1">color =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;red&quot;</span> )</a></code></pre></div>
<p>The <code>length</code> function is used to access the number of element present in a vector</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" title="1"><span class="kw">length</span>(color)</a></code></pre></div>
<pre><code>## [1] 3</code></pre>
</div>
<div id="indexing-vectors" class="section level2">
<h2><span class="header-section-number">3.2</span> Indexing vectors</h2>
<p>It is possible to access only subsets of data in a vector and also assign them to another vector. The most basic form of indexing is based on the position of the data in the vector. For example, to access only the datum in the third position of a vector called temperature, you would simply type:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" title="1">temperature[<span class="dv">3</span>]</a></code></pre></div>
<pre><code>## [1] 23</code></pre>
<p>if you would like to access the data in more than one position of the vector, let’s say the first, the third and the sixth, you can again use the function concatenate inside the indexing command:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" title="1">temperature[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">6</span>)]</a></code></pre></div>
<pre><code>## [1] 34 23 31</code></pre>
<p>to access the data from, say, the third position to the tenth position you can use:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" title="1">temperature[<span class="dv">3</span><span class="op">:</span><span class="dv">10</span>]</a></code></pre></div>
<pre><code>## [1] 23 29 26 31 44 32 19 22</code></pre>
<p>and if you want to assign this subset to another vector called <code>&quot;white&quot;</code>, you can just type:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" title="1">white =<span class="st"> </span>temperature[<span class="dv">3</span><span class="op">:</span><span class="dv">10</span>]</a></code></pre></div>
<p>if you want to access all the vector but the first five positions:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" title="1">temperature[<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)]</a></code></pre></div>
<pre><code>## [1] 31 44 32 19 22 34</code></pre>
<p>since in R there is not a “delete” command, you can use this form of subsetting to remove elements of a vector, for example, if you would like to cancel the fourth element of the <code>temperature</code> vector you would write:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" title="1">temperature =<span class="st"> </span>temperature[<span class="op">-</span><span class="dv">4</span>]</a></code></pre></div>
<p>Furthermore, to access subsets of data you can do much more magic using logical operators (see Table <a href="#tab:logicalops">3.1</a>) and other tricks, for example if you want to access in a vector only the data greater than a certain value, you can use the <code>&gt;</code> (greater than) logical operator:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" title="1">temperature[temperature<span class="op">&gt;</span><span class="dv">30</span>]</a></code></pre></div>
<pre><code>## [1] 34 45 31 44 32 34</code></pre>
<p>In order to concatenate logical commands, you can use the &amp; (and) logical operator:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" title="1">temperature[temperature<span class="op">&gt;</span><span class="dv">30</span> <span class="op">&amp;</span><span class="st"> </span>temperature<span class="op">&lt;</span><span class="dv">35</span>]</a></code></pre></div>
<pre><code>## [1] 34 31 32 34</code></pre>
<table>
<caption><span id="tab:logicalops">Table 3.1: </span> Logical Operators.</caption>
<thead>
<tr class="header">
<th>Operator</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>&amp;</code></td>
<td align="left">Intersection (“and”)</td>
</tr>
<tr class="even">
<td><code>&amp;&amp;</code></td>
<td align="left">“and” (lazy evaluation)</td>
</tr>
<tr class="odd">
<td><code>|</code></td>
<td align="left">Union (“or”)</td>
</tr>
<tr class="even">
<td><code>||</code></td>
<td align="left">“or” (lazy evaluation)</td>
</tr>
<tr class="odd">
<td><code>!</code></td>
<td align="left">Negation</td>
</tr>
<tr class="even">
<td><code>xor</code></td>
<td align="left">Exclusive “or”</td>
</tr>
<tr class="odd">
<td><code>isTRUE(x)</code></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<table>
<caption><span id="tab:relationalops">Table 3.2: </span> Relational Operators.</caption>
<thead>
<tr class="header">
<th>Operator</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>&lt;</code></td>
<td align="left">Less than</td>
</tr>
<tr class="even">
<td><code>&lt;=</code></td>
<td align="left">Less than or equal to</td>
</tr>
<tr class="odd">
<td><code>&gt;</code></td>
<td align="left">Greater than</td>
</tr>
<tr class="even">
<td><code>&gt;=</code></td>
<td align="left">Greater than or equal to</td>
</tr>
<tr class="odd">
<td><code>==</code></td>
<td align="left">Equal to</td>
</tr>
<tr class="even">
<td><code>!=</code></td>
<td align="left">Not equal to</td>
</tr>
</tbody>
</table>
<p>It is also possible to apply labels to the positions of a vector, and then access the datum in a given position through its label:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" title="1">temperature =<span class="st"> </span><span class="kw">c</span>(<span class="dv">34</span>, <span class="dv">45</span>, <span class="dv">23</span>, <span class="dv">29</span>, <span class="dv">26</span>)</a>
<a class="sourceLine" id="cb86-2" title="2"><span class="kw">names</span>(temperature) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Johnny&quot;</span>, <span class="st">&quot;Jack&quot;</span>, <span class="st">&quot;Tony&quot;</span>, <span class="st">&quot;Pippo&quot;</span>, <span class="st">&quot;Linda&quot;</span>)</a>
<a class="sourceLine" id="cb86-3" title="3">temperature[<span class="st">&quot;Tony&quot;</span>]</a></code></pre></div>
<pre><code>## Tony 
##   23</code></pre>
<div id="the-seq-function" class="section level3">
<h3><span class="header-section-number">3.2.1</span> The <code>seq</code> function</h3>
<p>The <code>seq</code> function can be used to create evenly spaced sequences of numbers</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" title="1"><span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">10</span>)</a></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<p>the default increment is 1, but you can change it with the option <code>by</code>:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" title="1"><span class="kw">seq</span>(<span class="dv">1</span>, <span class="fl">1.9</span>, <span class="dt">by=</span><span class="fl">0.1</span>)</a></code></pre></div>
<pre><code>##  [1] 1.0 1.1 1.2 1.3 1.4 1.5 1.6 1.7 1.8 1.9</code></pre>
<p>There’s a shortcut for sequences with an increment of 1</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" title="1">a =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></a>
<a class="sourceLine" id="cb92-2" title="2">a</a></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
</div>
<div id="the-rep-function" class="section level3">
<h3><span class="header-section-number">3.2.2</span> The <code>rep</code> function</h3>
<p>You can use the <code>rep</code> function to create vectors which contain repetitions of the same elements. Let’s start from the most simple use:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" title="1">vector1 =<span class="st"> </span><span class="kw">rep</span>(<span class="dv">3</span>, <span class="dv">13</span>)</a></code></pre></div>
<p>simply creates a vector of 13 elements, all having the value 3. More interestingly, you can repeat sequences of numbers:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" title="1"><span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##  [1] 1 2 3 4 1 2 3 4 1 2 3 4</code></pre>
<p>as you see the above command repeats the sequence 1,2,3,4 three times. Furthermore, you can also specify the number of times a given element of the sequence should be repeated:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" title="1"><span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dv">3</span>, <span class="dt">each=</span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>##  [1] 1 1 2 2 3 3 4 4 1 1 2 2 3 3 4 4 1 1 2 2 3 3 4 4</code></pre>
<p>There are other ways to achieve this same effect, for example:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" title="1"><span class="kw">rep</span>(<span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>)), <span class="dv">3</span>)</a></code></pre></div>
<pre><code>##  [1] 1 1 2 2 3 3 4 4 1 1 2 2 3 3 4 4 1 1 2 2 3 3 4 4</code></pre>
<p>would yield the same effect.</p>
<p>Even if it can look pretty useless at first, the <code>rep</code> function comes in very handy for example, when you want to transform the data in a table from “one row per participant”, to “one row per observation”, which is necessary for example to run a repeated measures ANOVA with the <code>aov</code> function. <code>rep</code> makes it all easier as you can create vectors in which the occurrence of the levels of a factor are repeated over and over.</p>
</div>
</div>
<div id="matrix-facilities" class="section level2">
<h2><span class="header-section-number">3.3</span> Matrix facilities</h2>
<p>There are different ways for creating a matrix in R, you often start from a vector, and then transform it into a matrix with the <code>matrix</code> function:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" title="1">matr =<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb101-2" title="2">matr =<span class="st"> </span><span class="kw">matrix</span>(matr, <span class="dt">ncol=</span><span class="dv">3</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb101-3" title="3">matr</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    3    5    6
## [2,]    2    5    7
## [3,]    9    1    5
## [4,]    4    2    3</code></pre>
<p>you give to the <code>matrix</code> function either the <code>ncol</code> or the <code>nrow</code> parameters to specify the layout of the matrix. The default method that R uses to fill in the matrix is by columns, so if you want to fill it by rows, you need to set true the option <code>byrow</code>, as in the example above.</p>
<p>Matrix indexing is similar to vector indexing:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" title="1">matr[<span class="dv">2</span>,<span class="dv">1</span>]</a></code></pre></div>
<pre><code>## [1] 2</code></pre>
<p>the first index refers to the row number, and the second index to the column number. Omitting one of the two indexes is useful for slicing, for example</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" title="1">matr[,<span class="dv">2</span>]</a></code></pre></div>
<pre><code>## [1] 5 5 1 2</code></pre>
<p>gives <em>all the rows</em> in the second column. This could alternatively been written as</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" title="1">matr[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,<span class="dv">2</span>]</a></code></pre></div>
<pre><code>## [1] 5 5 1 2</code></pre>
<p>where the index is a  of rows. This notation is useful when you want to extract only part of the rows or columns, for example</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" title="1">matr[<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>,<span class="dv">2</span>]</a></code></pre></div>
<pre><code>## [1] 5 1 2</code></pre>
<p>When the rows or columns to be extracted are not consecutive, you can use a <em>vector</em> of indexes for slicing</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb111-1" title="1">matr[<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">4</span>),<span class="dv">2</span>]</a></code></pre></div>
<pre><code>## [1] 5 2</code></pre>
<p>To query the dimension of the matrix you can use the <code>dim</code> function, in this case our matrix has 4 rows and 3 columns:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" title="1"><span class="kw">dim</span>(matr)</a></code></pre></div>
<pre><code>## [1] 4 3</code></pre>
<p>The rows and columns of a matrix can also be assigned a name attribute through the <code>dimnames</code> function. The dimnames have to be a list of character vectors the same length as the matrix dimensions they refer to:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" title="1"><span class="kw">dimnames</span>(matr) =<span class="st"> </span><span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&quot;row1&quot;</span>, <span class="st">&quot;row2&quot;</span>, <span class="st">&quot;row3&quot;</span>, <span class="st">&quot;row4&quot;</span>), <span class="kw">c</span>(<span class="st">&quot;col1&quot;</span>, <span class="st">&quot;col2&quot;</span>, <span class="st">&quot;col3&quot;</span>))</a>
<a class="sourceLine" id="cb115-2" title="2"><span class="kw">dimnames</span>(matr) <span class="co">#dimnames is a list</span></a></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;row1&quot; &quot;row2&quot; &quot;row3&quot; &quot;row4&quot;
## 
## [[2]]
## [1] &quot;col1&quot; &quot;col2&quot; &quot;col3&quot;</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" title="1">matr <span class="co">#now the matrix is printed with its dimnames</span></a></code></pre></div>
<pre><code>##      col1 col2 col3
## row1    3    5    6
## row2    2    5    7
## row3    9    1    5
## row4    4    2    3</code></pre>
<p>the names of the rows can be retrieved with  and the names of the columns with :</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" title="1"><span class="kw">rownames</span>(matr)</a></code></pre></div>
<pre><code>## [1] &quot;row1&quot; &quot;row2&quot; &quot;row3&quot; &quot;row4&quot;</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" title="1"><span class="kw">colnames</span>(matr)</a></code></pre></div>
<pre><code>## [1] &quot;col1&quot; &quot;col2&quot; &quot;col3&quot;</code></pre>
<p>and these names can be indirectly used for sub-setting;</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" title="1">matr[<span class="dv">1</span>, <span class="kw">which</span>(<span class="kw">colnames</span>(matr) <span class="op">==</span><span class="st"> &#39;col2&#39;</span>)]</a></code></pre></div>
<pre><code>## [1] 5</code></pre>
<div id="matrix-operations" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Matrix operations</h3>
<p>The function <code>t</code> gives the transpose of a matrix. The inverse of a
matrix is obtained through the function <code>solve</code>. Some other
operators are listed in Table <a href="#tab:matrop">3.3</a>). Example:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" title="1">beta =<span class="st"> </span><span class="kw">solve</span>(<span class="kw">t</span>(x)<span class="op">%*%</span>x)<span class="op">%*%</span>(<span class="kw">t</span>(x)<span class="op">%*%</span>y)</a></code></pre></div>
<table>
<caption><span id="tab:matrop">Table 3.3: </span> Matrix operations.</caption>
<thead>
<tr class="header">
<th>Operator</th>
<th align="left">Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>%*%</code></td>
<td align="left">Matrix multiplication</td>
</tr>
<tr class="even">
<td><code>det</code></td>
<td align="left">Determinant</td>
</tr>
<tr class="odd">
<td><code>solve</code> I</td>
<td align="left">nverse</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="Lists" class="section level2">
<h2><span class="header-section-number">3.4</span> Lists</h2>
<p>Lists are objects that can contain elements of different modes (e.g numeric, character, logical), as well as other objects (vectors, matrices and also other lists). Let’s build a small list to see how we can work on it:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" title="1">vec1 =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">12</span></a>
<a class="sourceLine" id="cb126-2" title="2">vec2 =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;w&#39;</span>,<span class="st">&#39;h&#39;</span>,<span class="st">&#39;m&#39;</span>)</a>
<a class="sourceLine" id="cb126-3" title="3">mylist =<span class="st"> </span><span class="kw">list</span>(vec1, vec2)</a>
<a class="sourceLine" id="cb126-4" title="4">mylist</a></code></pre></div>
<pre><code>## [[1]]
##  [1]  1  2  3  4  5  6  7  8  9 10 11 12
## 
## [[2]]
## [1] &quot;w&quot; &quot;h&quot; &quot;m&quot;</code></pre>
<p>The syntax for subsetting a list is a bit awkward (but as we’ll see later, naming the elements of a list makes things easier). To access an element of a list you can use the double brackets notation, for example</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" title="1">mylist[[<span class="dv">1</span>]]</a></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10 11 12</code></pre>
<p>returns the first element of the list <code>mylist</code>, which is a vector of length 12, if you want to access, say, the third element of this vector, the syntax is as follows</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb130-1" title="1">mylist[[<span class="dv">1</span>]][<span class="dv">3</span>]</a></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>Naming the elements of the list makes things easier</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" title="1">mylist=<span class="kw">list</span>(<span class="dt">a=</span>vec1, <span class="dt">b=</span>vec2)</a>
<a class="sourceLine" id="cb132-2" title="2">mylist</a></code></pre></div>
<pre><code>## $a
##  [1]  1  2  3  4  5  6  7  8  9 10 11 12
## 
## $b
## [1] &quot;w&quot; &quot;h&quot; &quot;m&quot;</code></pre>
<p>now the first element of the list is named <code>a</code>, and the second <code>b</code>, and we can access them with a special “dollar sign” notation</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" title="1">mylist<span class="op">$</span>a <span class="co">## return element of the list named a</span></a></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10 11 12</code></pre>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb136-1" title="1">mylist<span class="op">$</span>a[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</a></code></pre></div>
<pre><code>## [1] 1 2 3</code></pre>
<p>It is also possible to use the double brackets notation with names</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb138-1" title="1">mylist[[<span class="st">&quot;a&quot;</span>]][<span class="dv">3</span>]</a></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>To eliminate an element of a list, set it to <code>NULL</code></p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" title="1">vec1 =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb140-2" title="2">vec2 =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>)</a>
<a class="sourceLine" id="cb140-3" title="3">myList =<span class="st"> </span><span class="kw">list</span>(<span class="dt">vec1=</span>vec1, <span class="dt">vec2=</span>vec2)</a>
<a class="sourceLine" id="cb140-4" title="4">myList</a></code></pre></div>
<pre><code>## $vec1
## [1] 1 2 3
## 
## $vec2
## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;</code></pre>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" title="1">myList<span class="op">$</span>vec1 =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb142-2" title="2">myList</a></code></pre></div>
<pre><code>## $vec2
## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;</code></pre>
<p>note that this is different from eliminating an element of the vectors contained in the list, you can do the latter with</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" title="1">myList<span class="op">$</span>vec2 =<span class="st"> </span>myList<span class="op">$</span>vec2[<span class="op">-</span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb144-2" title="2">myList</a></code></pre></div>
<pre><code>## $vec2
## [1] &quot;b&quot; &quot;c&quot;</code></pre>
</div>
<div id="dataframes" class="section level2">
<h2><span class="header-section-number">3.5</span> Dataframes</h2>
<p>Dataframes are one of the most important objects in R. You can think of it as a rectangular data structure, in which each column stores either the values of a numeric variable, or the levels of a factor, and each row represents an observation. Let’s look at an example, we’ll build a dataframe from 3 vectors, the first vector stores a variable, number of beers drunk during a week for twelve young people, the second is a factor vector, that specifies for each person whether he/she is a university student or not, so it has two levels, the third is also a factor vector, which tells the sex of each person, so it has two levels as well.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" title="1">n_beers =<span class="st"> </span><span class="kw">c</span>(<span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb146-2" title="2">occupation =<span class="st"> </span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;s&quot;</span>, <span class="st">&quot;w&quot;</span>), <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb146-3" title="3">sex =<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;m&quot;</span>, <span class="dv">6</span>), <span class="kw">rep</span>(<span class="st">&quot;f&quot;</span>, <span class="dv">6</span>))</a>
<a class="sourceLine" id="cb146-4" title="4">occupation =<span class="st"> </span><span class="kw">as.factor</span>(occupation)</a>
<a class="sourceLine" id="cb146-5" title="5">sex =<span class="st"> </span><span class="kw">as.factor</span>(sex)</a></code></pre></div>
<p>well, now let’s create the dataframe:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb147-1" title="1">dats =<span class="st"> </span><span class="kw">data.frame</span>(n_beers, occupation, sex)</a></code></pre></div>
<p>it’s as simple as this, you have just put the three vectors together, let’s have a look at it</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb148-1" title="1">dats</a></code></pre></div>
<pre><code>##    n_beers occupation sex
## 1        6          s   m
## 2        8          w   m
## 3        4          s   m
## 4        8          w   m
## 5        9          s   m
## 6        4          w   m
## 7        5          s   f
## 8        3          w   f
## 9        4          s   f
## 10       2          w   f
## 11       3          s   f
## 12       1          w   f</code></pre>
<p>as we said, each row holds the data of a single observation, in this case it corresponds to the data of a participant, but as we’ll see later, this is not always necessarily true. Each row gives a full specification for each observation, we know that the first participant drunk 6 beers, he’s a student, and he’s male, and we could tell the same data for the other participants. Since we have all this information, we could now compare for example the number of beers drunk by male vs females, or by male students vs female students. There are special functions to compute these values quickly like <code>tapply</code> and <code>by</code> (see <a href="#tapply">3.8.3</a>), and other functions to get statistical tests, they will be dealt with as we go along.</p>
<div id="accessing-parts-of-a-dataframe" class="section level3">
<h3><span class="header-section-number">3.5.1</span> Accessing parts of a dataframe</h3>
<p>You can access, or refer to a column of a dataframe with the <code>$</code> operator, in the example above suppose we removed all the original variables after creating the dataframe</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb150-1" title="1"><span class="kw">rm</span>(n_beers, occupation, sex)</a></code></pre></div>
<p>we can’t now access them directly by name</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb151-1" title="1"><span class="kw">mean</span>(n_beers) <span class="co">#this will throw an object &#39;n_beers&#39; not found error</span></a></code></pre></div>
<p>we have to retrieve them from the dataframe</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb152-1" title="1"><span class="kw">mean</span>(dats<span class="op">$</span>n_beers)</a></code></pre></div>
<pre><code>## [1] 4.75</code></pre>
<p>the example might seem artificial (why did I remove them in the first place?), but very often you read in the data directly as a dataframe with the <code>read.table</code> function (see sec.~, so you’ll have to access them from the dataframe. Another option is to use the function <code>attach</code>, which attaches the dataframe to the path that R searches when evaluating a variable, in this way you don’t have to refer to the dataframe to access the values of a variable</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb154-1" title="1"><span class="kw">attach</span>(dats)</a>
<a class="sourceLine" id="cb154-2" title="2"><span class="kw">mean</span>(n_beers)</a></code></pre></div>
<pre><code>## [1] 4.75</code></pre>
<p>this is OK only if you’re working with a single dataframe, and you don’t want to manipulate the variables in it. In fact if you accidentally attach two dataframes that share some variable names, or you try to change an object of a dataframe after it has been attached, strange things may happen, you’ve been warned, the details are in the R manual. The function <code>detach</code> detaches the dataframe from the search path.</p>
</div>
<div id="changing-the-names-of-variables-in-a-dataframe" class="section level3">
<h3><span class="header-section-number">3.5.2</span> Changing the names of variables in a dataframe</h3>
<p>Sometimes you might want to change the names of the variables in a dataframe, for example when you create new dataframes with the <code>unstack</code> function, or just because you don’t like the way you called it initially. You can visualise the names for the variables with the function <code>names</code></p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb156-1" title="1"><span class="kw">names</span>(dats)</a></code></pre></div>
<pre><code>## [1] &quot;n_beers&quot;    &quot;occupation&quot; &quot;sex&quot;</code></pre>
<p>or if you want to see just the first one:</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb158-1" title="1"><span class="kw">names</span>(dats)[<span class="dv">1</span>]</a></code></pre></div>
<pre><code>## [1] &quot;n_beers&quot;</code></pre>
<p>you can change it with a simple assignment:</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb160-1" title="1"><span class="kw">names</span>(dats)[<span class="dv">1</span>] =<span class="st"> &quot;beers&quot;</span></a></code></pre></div>
<p>or if you want to change more than one:</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb161-1" title="1"><span class="kw">names</span>(dats) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;brs&quot;</span>, <span class="st">&quot;occ&quot;</span>, <span class="st">&quot;sx&quot;</span>)</a></code></pre></div>
</div>
<div id="other-ways-to-subset-a-dataframe" class="section level3">
<h3><span class="header-section-number">3.5.3</span> Other ways to subset a dataframe</h3>
<p>A dataframe actually is just a special kind of list (a list of class dataframe), so we can use the normal list notation to subset dataframes</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb162-1" title="1">dats[[<span class="dv">1</span>]]</a></code></pre></div>
<pre><code>##  [1] 6 8 4 8 9 4 5 3 4 2 3 1</code></pre>
<p>Sometimes it’s useful to think of a dataframe as a matrix, and use matrix notation for subsetting</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb164-1" title="1">dats[<span class="dv">1</span>,] <span class="co">## extract first row, all columns</span></a></code></pre></div>
<pre><code>##   brs occ sx
## 1   6   s  m</code></pre>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb166-1" title="1">dats[<span class="kw">which</span>(dats<span class="op">$</span>n_beers<span class="op">&gt;</span><span class="dv">4</span>),]  <span class="co">## records for subjs who drink &gt; 4 beers</span></a></code></pre></div>
<pre><code>## [1] brs occ sx 
## &lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
</div>
<div id="factors" class="section level2">
<h2><span class="header-section-number">3.6</span> Factors</h2>
<p>Data Vectors can be made not only of numerical values or of strings, but also <em>factors</em>. Factor vectors are very similar to character vectors, and could be seen as character vectors with some special properties. A factor vector usually consists of two or more levels, and can be created with the <code>factor</code> function. For example, suppose we are studying the drinking habits of 6 individuals, and we have measured their alcohol consumption (in alcohol units) during a week:</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb168-1" title="1">alcoholUnits =<span class="st"> </span><span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">2</span>, <span class="dv">15</span>, <span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">4</span>)</a></code></pre></div>
<p>the first three individuals are males, and the last three females and we can encode this information using a <code>factor</code> vector:</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb169-1" title="1">sex =<span class="st"> </span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;m&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;f&quot;</span>))</a>
<a class="sourceLine" id="cb169-2" title="2">sex</a></code></pre></div>
<pre><code>## [1] m m m f f f
## Levels: f m</code></pre>
<p>as you can see a factor has a <code>levels</code> attribute that specifies the possible values the factor can assume, and by default it is given by the unique values the factor vector can assume, sorted in alphabetical order.</p>
<p>One important side effect of the <code>levels</code> attribute is that the way factor levels are ordered determines the sorting order of statistical summaries and graphics. For example, if we use the <code>tapply</code> function to calculate the average alcohol units consumption by sex:</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb171-1" title="1"><span class="kw">tapply</span>(alcoholUnits, <span class="kw">list</span>(sex), mean)</a></code></pre></div>
<pre><code>## f m 
## 5 8</code></pre>
<p>the results for females are shown before the results for males. If we want the results for males to be presented before the results for females we can specify this ordering when creating the factor:</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb173-1" title="1">sex =<span class="st"> </span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;m&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;f&quot;</span>), <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;m&quot;</span>, <span class="st">&quot;f&quot;</span>))</a>
<a class="sourceLine" id="cb173-2" title="2"><span class="kw">tapply</span>(alcoholUnits, <span class="kw">list</span>(sex), mean)</a></code></pre></div>
<pre><code>## m f 
## 8 5</code></pre>
<p>ordering the levels of a factor for display purposes should not be confused with the concept of an <code>ordered</code> factor.</p>
<div id="renaming-the-levels-of-a-factor" class="section level3">
<h3><span class="header-section-number">3.6.1</span> Renaming the levels of a factor</h3>
<p>To rename the levels of a factor we can use the <code>labels</code> argument to the <code>factor</code> function. Suppose that we have a sex factor coded as ‘f’ for females and ‘m’ for males:</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb175-1" title="1">sex =<span class="st"> </span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;m&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;f&quot;</span>))</a></code></pre></div>
<p>we can change the coding to ‘Male’ and ‘Female’ as follows:</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb176-1" title="1">sex =<span class="st"> </span><span class="kw">factor</span>(sex, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;f&quot;</span>, <span class="st">&quot;m&quot;</span>), <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Male&quot;</span>))</a>
<a class="sourceLine" id="cb176-2" title="2">sex</a></code></pre></div>
<pre><code>## [1] Male   Male   Male   Female Female Female
## Levels: Female Male</code></pre>
<p>alternatively we can also use the <code>levels</code> function:</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb178-1" title="1">sex =<span class="st"> </span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;m&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;f&quot;</span>))</a></code></pre></div>
<p>currently the levels are <code>c('f', 'm')</code>:</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb179-1" title="1"><span class="kw">levels</span>(sex) <span class="co">#this gets the current levels</span></a></code></pre></div>
<pre><code>## [1] &quot;f&quot; &quot;m&quot;</code></pre>
<p>we can change them with:</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb181-1" title="1"><span class="kw">levels</span>(sex) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Male&quot;</span>) <span class="co">#this sets the levels</span></a></code></pre></div>
<p>we can also change just the name of one of the levels if we want to:</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb182-1" title="1">sex =<span class="st"> </span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;m&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;f&quot;</span>, <span class="st">&quot;f&quot;</span>)) <span class="co">#original factor</span></a>
<a class="sourceLine" id="cb182-2" title="2"><span class="kw">levels</span>(sex)[<span class="kw">which</span>(<span class="kw">levels</span>(sex) <span class="op">==</span><span class="st"> &quot;m&quot;</span>)] =<span class="st"> &quot;Male&quot;</span></a>
<a class="sourceLine" id="cb182-3" title="3">sex</a></code></pre></div>
<pre><code>## [1] Male Male Male f    f    f   
## Levels: f Male</code></pre>
</div>
<div id="gl" class="section level3">
<h3><span class="header-section-number">3.6.2</span> Creating factors with <code>gl</code></h3>
<p>A handy function for creating factors for data with a regular pattern of factor levels is <code>gl</code>:</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb184-1" title="1">sex =<span class="st"> </span><span class="kw">gl</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dt">label=</span><span class="kw">c</span>(<span class="st">&quot;male&quot;</span>, <span class="st">&quot;female&quot;</span>), <span class="dt">length=</span><span class="dv">6</span>)</a>
<a class="sourceLine" id="cb184-2" title="2">sex</a></code></pre></div>
<pre><code>## [1] male   male   male   female female female
## Levels: male female</code></pre>
<p>the first argument to the function specifies the number of levels, and the second argument the number of consecutive repetitions of each level, the pattern is repeated up to the number of elements specified by the length argument. Note the different pattern created when the number of consecutive repetitions is set to 1 and the total length is left unchanged:</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb186-1" title="1">sex =<span class="st"> </span><span class="kw">gl</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dt">label=</span><span class="kw">c</span>(<span class="st">&quot;male&quot;</span>, <span class="st">&quot;female&quot;</span>), <span class="dt">length=</span><span class="dv">6</span>)</a>
<a class="sourceLine" id="cb186-2" title="2">sex</a></code></pre></div>
<pre><code>## [1] male   female male   female male   female
## Levels: male female</code></pre>
</div>
<div id="natural-sort-order-for-character-and-factor-vectors" class="section level3">
<h3><span class="header-section-number">3.6.3</span> Natural sort order for character and factor vectors</h3>
<p>It’s common to assign identifiers to participants in an experiment as:</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb188-1" title="1">ids =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;P1&quot;</span>, <span class="st">&quot;P2&quot;</span>, <span class="st">&quot;P3&quot;</span>, <span class="st">&quot;P4&quot;</span>, <span class="st">&quot;P5&quot;</span>, <span class="st">&quot;P6&quot;</span>,<span class="st">&quot;P7&quot;</span>, <span class="st">&quot;P8&quot;</span>, <span class="st">&quot;P9&quot;</span>, <span class="st">&quot;P10&quot;</span>, <span class="st">&quot;P11&quot;</span>)</a></code></pre></div>
<p>when you use these identifiers for summarizing or plotting data as a function of participant id R will sort the output in strict alphabetical order, which is equivalent to the output of this function:</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb189-1" title="1"><span class="kw">sort</span>(ids)</a></code></pre></div>
<pre><code>##  [1] &quot;P1&quot;  &quot;P10&quot; &quot;P11&quot; &quot;P2&quot;  &quot;P3&quot;  &quot;P4&quot;  &quot;P5&quot;  &quot;P6&quot;  &quot;P7&quot;  &quot;P8&quot;  &quot;P9&quot;</code></pre>
<p>often what you want instead is a natural sort order, in which <code>P10</code> comes after <code>P9</code> and not after <code>P1</code>. To force R to use a natural sort order you can use a factor vector and sort the factor levels using the <code>mixedsort</code> function in the package <code>gtools</code>:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb191-1" title="1"><span class="kw">library</span>(gtools)</a>
<a class="sourceLine" id="cb191-2" title="2">fids =<span class="st"> </span><span class="kw">factor</span>(ids, <span class="dt">levels=</span><span class="kw">mixedsort</span>(<span class="kw">levels</span>(ids)))</a>
<a class="sourceLine" id="cb191-3" title="3"><span class="kw">sort</span>(fids)</a></code></pre></div>
<pre><code>## factor(0)
## Levels:</code></pre>
</div>
</div>
<div id="objinfo" class="section level2">
<h2><span class="header-section-number">3.7</span> Getting info on R objects</h2>
<p>The most useful function to summarise information about many R object is <code>str</code>:</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb193-1" title="1">a =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="fl">.1</span>)</a>
<a class="sourceLine" id="cb193-2" title="2"><span class="kw">str</span>(a)</a></code></pre></div>
<pre><code>##  num [1:101] 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 ...</code></pre>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb195-1" title="1">b =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>)</a>
<a class="sourceLine" id="cb195-2" title="2"><span class="kw">str</span>(b)</a></code></pre></div>
<pre><code>##  chr [1:3] &quot;a&quot; &quot;b&quot; &quot;c&quot;</code></pre>
<p>in the example shown <code>str</code> gives information on the storage mode of the two vectors, numeric for <code>a</code> and character for <code>b</code>, it also gives information on the number of elements present and on the shape of the array (compare the output of <code>str</code> for a vector and a matrix). <code>str</code> gives also useful compact summaries of the contents of lists, including nested lists.</p>
<p>Another useful function is <code>mode</code>, which gives the storage mode of an R object:</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb197-1" title="1"><span class="kw">mode</span>(a)</a></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb199-1" title="1"><span class="kw">mode</span>(b)</a></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
</div>
<div id="changing-the-format-of-your-data" class="section level2">
<h2><span class="header-section-number">3.8</span> Changing the format of your data</h2>
<p>In general statistical software require your data to be entered in a specific format in order to perform statistical analyses on them, and R is no exception. R provides many powerful functions to change the format of your data if they happen to be in a format that is not suitable for applying a given statistical function on them. The process of changing the format of your data with these functions might seem very complicated at first, however you should keep in mind the following things:</p>
<ul>
<li><p>You don’t really need to learn all of the functions that R provides to manipulate your data and change their format. Once you learn a procedure that does the job you can stick with it and you’ll be fine most of the times.</p></li>
<li><p>Once you understand the “logic” and the structure of the data format that R expects to apply some statistical functions, changing the layout of your data to match this structure will be easy. Moreover, the data format that R wants is most of the times one and only one: The “one row per observation format”, which will be explained below.</p></li>
<li><p>In this tutorial you will see different examples in which the format of the data, stored in a given file don’t match the format R wants. This is just for illustrative purposes. In real life if you’re doing a research or an experiment, you can often gather your data in a format that is already suitable for performing statistical analyses.</p></li>
<li><p>You don’t really have to use R to change the layout of your data if you don’t like the functions it provides to do this job. You can always use some external programs to achieve the same results, for example spreadsheets programs such as Libreoffice Calc. What’s really important is that you understand the structure of the format the R expects.</p></li>
</ul>
<p>This said, I would advice you to learn some of the functions that R provides to rearrange your data for at least two reasons: 1) They’re very powerful and can actually save you time once you learn them, and 2) many examples in this tutorial and in other books use them, so you’ll often need to know them to understand what’s going on :)</p>
<div id="onerowperobservation" class="section level3">
<h3><span class="header-section-number">3.8.1</span> The “one row per observation” (long) format</h3>
<p>While statistic textbooks and scientific articles often show data in a “wide” format that is suitable and immediate for the “human eye”, like the one shown in Table <a href="#tab:formath">3.4</a>, statistical software often don’t quite like it and would rather have the same data rearranged in a “long” format, as shown in Table <a href="#tab:formatss">3.5</a>.</p>
<table>
<caption><span id="tab:formath">Table 3.4: </span> Data format suitable for the “human eye”.</caption>
<thead>
<tr class="header">
<th>Group A</th>
<th align="left">Group B</th>
<th>Group C</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>5</td>
<td align="left">4</td>
<td>7</td>
</tr>
<tr class="even">
<td>2</td>
<td align="left">4</td>
<td>5</td>
</tr>
<tr class="odd">
<td>3</td>
<td align="left">5</td>
<td>7</td>
</tr>
<tr class="even">
<td>4</td>
<td align="left">5</td>
<td>8</td>
</tr>
<tr class="odd">
<td>6</td>
<td align="left">4</td>
<td>7</td>
</tr>
</tbody>
</table>
<table>
<caption><span id="tab:formatss">Table 3.5: </span> Data format suitable for R.</caption>
<thead>
<tr class="header">
<th>Value</th>
<th>Group</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>5</td>
<td>A</td>
</tr>
<tr class="even">
<td>2</td>
<td>A</td>
</tr>
<tr class="odd">
<td>3</td>
<td>A</td>
</tr>
<tr class="even">
<td>4</td>
<td>A</td>
</tr>
<tr class="odd">
<td>6</td>
<td>A</td>
</tr>
<tr class="even">
<td>4</td>
<td>B</td>
</tr>
<tr class="odd">
<td>4</td>
<td>B</td>
</tr>
<tr class="even">
<td>5</td>
<td>B</td>
</tr>
<tr class="odd">
<td>5</td>
<td>B</td>
</tr>
<tr class="even">
<td>4</td>
<td>B</td>
</tr>
<tr class="odd">
<td>7</td>
<td>C</td>
</tr>
<tr class="even">
<td>5</td>
<td>C</td>
</tr>
<tr class="odd">
<td>7</td>
<td>C</td>
</tr>
<tr class="even">
<td>8</td>
<td>C</td>
</tr>
<tr class="odd">
<td>7</td>
<td>C</td>
</tr>
</tbody>
</table>
<p>The main difference is that while in the first format you have more than one observation in the same row, and you can identify the group to which each observation belongs to through the column headers (“Group A”, “Group B” and “Group C”), in the second format you have only one observation for each row. This observation is then fully identified with a “label” that appears in the second column. A better way to describe the second column is to say that in the above case “Group” is a <strong>factor</strong>, and “A”, “B” and “C” define the <strong>levels</strong> of this factor for each group.</p>
<p>You could also be running an experiment in which you manipulate more than one factor. For example you might have two groups, “Patients” and “Controls”, which are tested under two conditions: condition “1” and condition “2”. In this case you might display your data as shown in Table <a href="#tab:formath2">3.6</a> to make them easily readable to humans. However for analyzing your data with R you would need to reshape the data as shown in Table <a href="#tab:formatss2">3.7</a>, with one column specifying the group, and another column specifying the condition for a given observation.</p>
<table>
<caption><span id="tab:formath2">Table 3.6: </span> Data format suitable for the “human eye” with more than one factor.</caption>
<thead>
<tr class="header">
<th>Patients Condition1</th>
<th>Patients Condition 2</th>
<th>Controls Condition 1</th>
<th>Controls Condition 2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>7</td>
<td>6</td>
<td>6</td>
<td>4</td>
</tr>
<tr class="even">
<td>5 4</td>
<td>5</td>
<td>2</td>
<td></td>
</tr>
<tr class="odd">
<td>8 7</td>
<td>7</td>
<td>4</td>
<td></td>
</tr>
<tr class="even">
<td>8 8</td>
<td>6</td>
<td>5</td>
<td></td>
</tr>
<tr class="odd">
<td>6 5</td>
<td>5</td>
<td>3</td>
<td></td>
</tr>
</tbody>
</table>
<table>
<caption><span id="tab:formatss2">Table 3.7: </span> Data format suitable for R with more than one factor.</caption>
<thead>
<tr class="header">
<th>Value</th>
<th>Group</th>
<th>Condition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>7</td>
<td>P</td>
<td>1</td>
</tr>
<tr class="even">
<td>5</td>
<td>P</td>
<td>1</td>
</tr>
<tr class="odd">
<td>8</td>
<td>P</td>
<td>1</td>
</tr>
<tr class="even">
<td>8</td>
<td>P</td>
<td>1</td>
</tr>
<tr class="odd">
<td>6</td>
<td>P</td>
<td>1</td>
</tr>
<tr class="even">
<td>6</td>
<td>P</td>
<td>2</td>
</tr>
<tr class="odd">
<td>4</td>
<td>P</td>
<td>2</td>
</tr>
<tr class="even">
<td>7</td>
<td>P</td>
<td>2</td>
</tr>
<tr class="odd">
<td>8</td>
<td>P</td>
<td>2</td>
</tr>
<tr class="even">
<td>5</td>
<td>P</td>
<td>2</td>
</tr>
<tr class="odd">
<td>6</td>
<td>C</td>
<td>1</td>
</tr>
<tr class="even">
<td>5</td>
<td>C</td>
<td>1</td>
</tr>
<tr class="odd">
<td>7</td>
<td>C</td>
<td>1</td>
</tr>
<tr class="even">
<td>6</td>
<td>C</td>
<td>1</td>
</tr>
<tr class="odd">
<td>5</td>
<td>C</td>
<td>1</td>
</tr>
<tr class="even">
<td>4</td>
<td>C</td>
<td>2</td>
</tr>
<tr class="odd">
<td>2</td>
<td>C</td>
<td>2</td>
</tr>
<tr class="even">
<td>4</td>
<td>C</td>
<td>2</td>
</tr>
<tr class="odd">
<td>5</td>
<td>C</td>
<td>2</td>
</tr>
<tr class="even">
<td>3</td>
<td>C</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>Finally, you might be running an experiment with a repeated measures design, in which all participants are exposed to all the levels of the within subjects factors. For example you might have your participants recall word lists either under the effects of a drug or not (factor 1) and with words concrete or abstract words (factor 2). In this case the data for presentation might look like the ones in Table <a href="#tab:repeatedh">3.8</a>, in which each row represents a single participant. Again for R you need to rearrange the data so that each row represents a single observation, and in the case of a repeated measures design you need to add another column that identifies the levels of the “participants” factor as shown in Table <a href="#tab:repeatedr">3.9</a></p>
<table>
<caption><span id="tab:repeatedh">Table 3.8: </span> Data format suitable for the “human eye” in a repeated measures design.</caption>
<thead>
<tr class="header">
<th>Drug Concrete</th>
<th>Drug Abstract</th>
<th>No-Drug Concrete</th>
<th>No-Drug Abstract</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>7</td>
<td>6</td>
<td>6</td>
<td>4</td>
</tr>
<tr class="even">
<td>5</td>
<td>4</td>
<td>5</td>
<td>2</td>
</tr>
<tr class="odd">
<td>8</td>
<td>7</td>
<td>7</td>
<td>4</td>
</tr>
<tr class="even">
<td>8</td>
<td>8</td>
<td>6</td>
<td>5</td>
</tr>
<tr class="odd">
<td>6</td>
<td>5</td>
<td>5</td>
<td>3</td>
</tr>
</tbody>
</table>
<table>
<caption><span id="tab:repeatedr">Table 3.9: </span> Data Format Suitable for R, repeated measures design.</caption>
<thead>
<tr class="header">
<th>Value</th>
<th>Drug Exposure</th>
<th>Word Type</th>
<th>Participant</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>7</td>
<td>D</td>
<td>C</td>
<td>1</td>
</tr>
<tr class="even">
<td>5</td>
<td>D</td>
<td>C</td>
<td>2</td>
</tr>
<tr class="odd">
<td>8</td>
<td>D</td>
<td>C</td>
<td>3</td>
</tr>
<tr class="even">
<td>8</td>
<td>D</td>
<td>C</td>
<td>4</td>
</tr>
<tr class="odd">
<td>6</td>
<td>D</td>
<td>C</td>
<td>5</td>
</tr>
<tr class="even">
<td>6</td>
<td>D</td>
<td>A</td>
<td>1</td>
</tr>
<tr class="odd">
<td>4</td>
<td>D</td>
<td>A</td>
<td>2</td>
</tr>
<tr class="even">
<td>7</td>
<td>D</td>
<td>A</td>
<td>3</td>
</tr>
<tr class="odd">
<td>8</td>
<td>D</td>
<td>A</td>
<td>4</td>
</tr>
<tr class="even">
<td>5</td>
<td>D</td>
<td>A</td>
<td>5</td>
</tr>
<tr class="odd">
<td>6</td>
<td>N</td>
<td>C</td>
<td>1</td>
</tr>
<tr class="even">
<td>5</td>
<td>N</td>
<td>C</td>
<td>2</td>
</tr>
<tr class="odd">
<td>7</td>
<td>N</td>
<td>C</td>
<td>3</td>
</tr>
<tr class="even">
<td>6</td>
<td>N</td>
<td>C</td>
<td>4</td>
</tr>
<tr class="odd">
<td>5</td>
<td>N</td>
<td>C</td>
<td>5</td>
</tr>
<tr class="even">
<td>4</td>
<td>N</td>
<td>A</td>
<td>1</td>
</tr>
<tr class="odd">
<td>2</td>
<td>N</td>
<td>A</td>
<td>2</td>
</tr>
<tr class="even">
<td>4</td>
<td>N</td>
<td>A</td>
<td>3</td>
</tr>
<tr class="odd">
<td>5</td>
<td>N</td>
<td>A</td>
<td>4</td>
</tr>
<tr class="even">
<td>3</td>
<td>N</td>
<td>A</td>
<td>5</td>
</tr>
</tbody>
</table>
</div>
<div id="stack" class="section level3">
<h3><span class="header-section-number">3.8.2</span> The <code>stack</code> and <code>unstack</code> functions</h3>
<p>One of the utilities provided by R to manipulate the format of your
data is the <code>stack</code> function. If you have your data in a <strong>dataframe</strong>
with a layout similar to that shown in Table <a href="#tab:formath">3.4</a>, you
can use the <code>stack</code> function to get a “one row per observation” format. What the <code>stack</code> function does is to create a single long vector from the vectors you have in your dataframe, and an additional factor vector which identifies the level for each observation. Here’s an example, the data are in the file <code>stack.txt</code>:</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb201-1" title="1">dats =<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;stack.txt&quot;</span>, <span class="dt">header=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<p>this creates the dataframe</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb202-1" title="1">dats =<span class="st"> </span><span class="kw">stack</span>(dats)</a></code></pre></div>
<p>this reshapes the dataframe into a “one row per observation” form.</p>
<p>Please note that R assigns names to the vectors in the new dataframe, you can see them in the header of the dataframe, you might need to know them for successive operations.</p>
<p>The <code>unstack</code> function simply does the opposite of the <code>stack</code> function, and you can use it if you want to switch back to your original dataframe format.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb203-1" title="1">dats =<span class="st"> </span><span class="kw">unstack</span>(dats)</a></code></pre></div>
<p>The <code>unstack</code> function can do more tricks, if you have a dataframe with one observation per row, a column with a response variable, and two or more factor columns, you can unstack the values of the response variable according to the levels of only one factors or according to the levels of two or more factors. Suppose <code>lat</code> is your response variable, and you have two factors, <code>congr</code> with 3 levels and <code>isi</code>, also with 3 levels. The command:</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb204-1" title="1">dats =<span class="st"> </span><span class="kw">unstack</span>(dats, <span class="dt">form=</span>lat<span class="op">~</span>congr)</a></code></pre></div>
<p>unstack the values of the response variable according to the levels of the <code>congr</code> factor, thus creating 3 columns, one for each level.</p>
<p>The command:</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb205-1" title="1">dats =<span class="st"> </span><span class="kw">unstackd</span>(ats,<span class="dt">form=</span>lat<span class="op">~</span>congr<span class="op">:</span>isi)</a></code></pre></div>
<p>unstacks the values of the response variable according to the levels of both factors, thus creating <span class="math inline">\(3x3= 9\)</span> columns, the first column contains the values at level 1 of <code>congr</code> and level 1 of <code>isi</code>, the second one contains the values at level 1 of <code>congr</code> and level 2 of <code>isi</code>, and so on for all the possible combinations.</p>
</div>
<div id="tapply" class="section level3">
<h3><span class="header-section-number">3.8.3</span> The <code>tapply</code> and <code>aggregate</code> functions</h3>
<p>The <code>tapply</code> function allows you to extract information from a dataframe, for example the mean or standard deviation of a given variable on the bases of one or more factor. The function name is related to the fact that it is used to <em>apply</em> a function (e.g. the mean) to a subsets of the dataframe chosen on the basis of one or more factors. We’ll use the <code>InsectSprays</code> dataset to illustrate the use of <code>tapply</code>. The dataset contains the number of insects still alive in agricultural experimental units treated with six different types of pesticide.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb206-1" title="1"><span class="kw">data</span>(InsectSprays)</a>
<a class="sourceLine" id="cb206-2" title="2"><span class="kw">head</span>(InsectSprays)</a></code></pre></div>
<pre><code>##   count spray
## 1    10     A
## 2     7     A
## 3    20     A
## 4    14     A
## 5    14     A
## 6    12     A</code></pre>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb208-1" title="1">meanSpray =<span class="st"> </span><span class="kw">tapply</span>(<span class="dt">X=</span>InsectSprays<span class="op">$</span>count,</a>
<a class="sourceLine" id="cb208-2" title="2">                  <span class="dt">INDEX=</span>InsectSprays<span class="op">$</span>spray,</a>
<a class="sourceLine" id="cb208-3" title="3">                  <span class="dt">FUN=</span>mean)</a>
<a class="sourceLine" id="cb208-4" title="4">meanSpray</a></code></pre></div>
<pre><code>##         A         B         C         D         E         F 
## 14.500000 15.333333  2.083333  4.916667  3.500000 16.666667</code></pre>
<p>the arguments to <code>tapply</code> are <code>X</code>, the column of the dataframe to which the function should be applied, <code>INDEX</code>, the factor used for subsetting the dataframe, and <code>FUN</code>, the function to be applied. The function returns an array, in this case a vector, but can be a matrix, or multi-dimensional array. The <code>INDEX</code> argument indeed can be a <em>list</em> of factors, in this case the function chosen is applied to group of values given by a unique combination of the levels of these factors. We’ll see an example by modifying the <code>InsectSprays</code> dataset including another fictitious factor. The new factor will be the season in which the fields were sprayed. The values will be returned in a matrix.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb210-1" title="1">season =<span class="st"> </span><span class="kw">gl</span>(<span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">72</span>, <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;winter&quot;</span>, <span class="st">&quot;spring&quot;</span>,</a>
<a class="sourceLine" id="cb210-2" title="2">                                 <span class="st">&quot;summer&quot;</span>, <span class="st">&quot;autumn&quot;</span>))</a>
<a class="sourceLine" id="cb210-3" title="3">Ins =<span class="st"> </span><span class="kw">data.frame</span>(InsectSprays, season)</a>
<a class="sourceLine" id="cb210-4" title="4">meanSpray =<span class="st"> </span><span class="kw">tapply</span>(<span class="dt">X=</span>Ins<span class="op">$</span>count,</a>
<a class="sourceLine" id="cb210-5" title="5">                   <span class="dt">INDEX=</span><span class="kw">list</span>(Ins<span class="op">$</span>spray, Ins<span class="op">$</span>season),</a>
<a class="sourceLine" id="cb210-6" title="6">                   <span class="dt">FUN=</span>mean)</a>
<a class="sourceLine" id="cb210-7" title="7">meanSpray</a></code></pre></div>
<pre><code>##      winter    spring    summer    autumn
## A 12.333333 13.333333 16.666667 15.666667
## B 16.333333 13.666667 17.666667 13.666667
## C  2.666667  2.000000  2.000000  1.666667
## D  6.666667  4.333333  5.000000  3.666667
## E  3.666667  4.666667  1.666667  4.000000
## F 11.666667 17.666667 16.333333 21.000000</code></pre>
<p>The <code>tapply</code> is often very useful, for example, after having calculated the means in this way, it is very easy to visualise the data with a barplot</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb212-1" title="1"><span class="kw">barplot</span>(meanSpray, <span class="dt">beside=</span><span class="ot">TRUE</span>, <span class="dt">legend=</span>T)</a></code></pre></div>
<p>The <code>aggregate</code> function is very similar to tapply, but rather than returning an array, it returns a dataframe, which can be useful in some situations.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb213-1" title="1">InsDf =<span class="st"> </span><span class="kw">aggregate</span>(<span class="dt">x=</span>Ins<span class="op">$</span>count,</a>
<a class="sourceLine" id="cb213-2" title="2">                  <span class="dt">by=</span><span class="kw">list</span>(<span class="dt">sprayType=</span>Ins<span class="op">$</span>spray, <span class="dt">season=</span>Ins<span class="op">$</span>season),</a>
<a class="sourceLine" id="cb213-3" title="3">                  <span class="dt">FUN=</span>mean)</a>
<a class="sourceLine" id="cb213-4" title="4">InsDf</a></code></pre></div>
<pre><code>##    sprayType season         x
## 1          A winter 12.333333
## 2          B winter 16.333333
## 3          C winter  2.666667
## 4          D winter  6.666667
## 5          E winter  3.666667
## 6          F winter 11.666667
## 7          A spring 13.333333
## 8          B spring 13.666667
## 9          C spring  2.000000
## 10         D spring  4.333333
## 11         E spring  4.666667
## 12         F spring 17.666667
## 13         A summer 16.666667
## 14         B summer 17.666667
## 15         C summer  2.000000
## 16         D summer  5.000000
## 17         E summer  1.666667
## 18         F summer 16.333333
## 19         A autumn 15.666667
## 20         B autumn 13.666667
## 21         C autumn  1.666667
## 22         D autumn  3.666667
## 23         E autumn  4.000000
## 24         F autumn 21.000000</code></pre>
<p>if you don’t give a name to the grouping factors as we did with <code>SprayType=Ins$spray</code> a default name will be given. One slightly annoying thing is that, as far as I know, it is not possible to assign a name to the resulting variable (it will just be named <code>x</code>). However it can be changed afterwards, here’s a solution that should work whatever the number of factors in the dataframe:</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb215-1" title="1"><span class="kw">names</span>(InsDf)</a></code></pre></div>
<pre><code>## [1] &quot;sprayType&quot; &quot;season&quot;    &quot;x&quot;</code></pre>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb217-1" title="1"><span class="kw">names</span>(InsDf)[<span class="kw">which</span>(<span class="kw">names</span>(InsDf)<span class="op">==</span><span class="st">&quot;x&quot;</span>)] =<span class="st"> &quot;count&quot;</span></a>
<a class="sourceLine" id="cb217-2" title="2"><span class="kw">names</span>(InsDf)</a></code></pre></div>
<pre><code>## [1] &quot;sprayType&quot; &quot;season&quot;    &quot;count&quot;</code></pre>
</div>
</div>
<div id="the-scale-function" class="section level2">
<h2><span class="header-section-number">3.9</span> The <code>scale</code> function</h2>
<p>The <code>scale</code> function can be used to easily transform your data into <span class="math inline">\(z\)</span> scores. Here’s a trivial example:</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb219-1" title="1">a =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb219-2" title="2"><span class="kw">scale</span>(a)</a></code></pre></div>
<pre><code>##      [,1]
## [1,]   -1
## [2,]    0
## [3,]    1
## attr(,&quot;scaled:center&quot;)
## [1] 2
## attr(,&quot;scaled:scale&quot;)
## [1] 1</code></pre>
</div>
<div id="printing-out-data-on-the-console" class="section level2">
<h2><span class="header-section-number">3.10</span> Printing out data on the console</h2>
<p>As you probably have already noted, after you’ve created a data object, just typing its name on the console and pressing <code>Enter</code> will display the values it contains. Sometimes however, you might want to see only part of the data, for example to do some checking, or because the data object is too big and it’s not printed nicely on the console. The functions <code>head</code> and <code>tail</code> let you look only at the first or the last part of your data respectively. For example, let’s load the <code>iris</code> dataset in the <code>datasets</code> package, the command:</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb221-1" title="1"><span class="kw">library</span>(datasets)</a>
<a class="sourceLine" id="cb221-2" title="2"><span class="kw">head</span>(iris)</a></code></pre></div>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1          5.1         3.5          1.4         0.2  setosa
## 2          4.9         3.0          1.4         0.2  setosa
## 3          4.7         3.2          1.3         0.2  setosa
## 4          4.6         3.1          1.5         0.2  setosa
## 5          5.0         3.6          1.4         0.2  setosa
## 6          5.4         3.9          1.7         0.4  setosa</code></pre>
<p>will print only the first 6 observations. You can visualise more (or less) than 6 observations by setting the <code>n</code> option:</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb223-1" title="1"><span class="kw">head</span>(iris, <span class="dt">n=</span><span class="dv">10</span>)</a></code></pre></div>
<pre><code>##    Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1           5.1         3.5          1.4         0.2  setosa
## 2           4.9         3.0          1.4         0.2  setosa
## 3           4.7         3.2          1.3         0.2  setosa
## 4           4.6         3.1          1.5         0.2  setosa
## 5           5.0         3.6          1.4         0.2  setosa
## 6           5.4         3.9          1.7         0.4  setosa
## 7           4.6         3.4          1.4         0.3  setosa
## 8           5.0         3.4          1.5         0.2  setosa
## 9           4.4         2.9          1.4         0.2  setosa
## 10          4.9         3.1          1.5         0.1  setosa</code></pre>
<p>using <code>tail</code> will show the last rows of the dataframe, and again you can instruct the function to show more or less rows by passing the <code>n</code> argument:</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb225-1" title="1"><span class="kw">tail</span>(iris, <span class="dt">n=</span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>##     Sepal.Length Sepal.Width Petal.Length Petal.Width   Species
## 149          6.2         3.4          5.4         2.3 virginica
## 150          5.9         3.0          5.1         1.8 virginica</code></pre>
<p>A data structure that is a modern take on dataframes, the <code>tibble</code>, will be described in Chapter <a href="#tidyverse">12</a>. Tibble printouts by default only show the rows and columns that fit on the screen (a default which I find annoying). See Section <a href="#tibbles">12.1</a> for instructions on how to override this default if you’re using tibbles and don’t like their default print behavior.</p>
<div id="reading-numbers-in-exponential-notation" class="section level3">
<h3><span class="header-section-number">3.10.1</span> Reading numbers in exponential notation</h3>
<p>Often R prints out numbers in exponential notation. In order to understand exponential notation it’s first necessary to introduce <em>scientific notation</em>.</p>
<p>A number in scientific notation is in the form <span class="math inline">\(a\cdot 10^b\)</span>, for example 300 could be written in scientific notation as <span class="math inline">\(3\cdot 10^2\)</span>. The components of a number in scientific notation are also named as <span class="math inline">\(mantissa \cdot 10^{characteristic}\)</span>. Remember that a number with a negative exponent, for example <span class="math inline">\(10^{-2}\)</span> can be rewritten as
<span class="math display">\[10^{-2}= \frac{1}{10^2}=0.01\]</span>
so, for example, <span class="math inline">\(0.003\)</span> can be rewritten in scientific notation as <span class="math inline">\(3\cdot 10^{-3}\)</span>, because
<span class="math display">\[3\cdot 10^{-3}= 3\cdot \frac{1}{10^3}= 0.003\]</span></p>
<p>R, as most calculators doesn’t actually use scientific notation, it uses instead <em>exponential</em> notation. The exponential notation is a shorthand version of the scientific notation, in which, for example, <span class="math inline">\(10^3\)</span> is replaced by <span class="math inline">\(e3\)</span>, where <span class="math inline">\(e\)</span> stands for <em>exponent</em>. So in our previous examples 300 would be written as <span class="math inline">\(3e2\)</span> and 0.003 would be written as <span class="math inline">\(3e3\)</span>. Below are a few conversion examples.</p>
<table>
<caption><span id="tab:numberformat">Table 3.10: </span> Number Formats.</caption>
<thead>
<tr class="header">
<th>Number</th>
<th>Scientific Notation</th>
<th>Exponential Notation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(10\)</span></td>
<td><span class="math inline">\(1\cdot 10^1\)</span></td>
<td><span class="math inline">\(1e1\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(20\)</span></td>
<td><span class="math inline">\(2\cdot 10^1\)</span></td>
<td><span class="math inline">\(2e1\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(200\)</span></td>
<td><span class="math inline">\(2\cdot 10^2\)</span></td>
<td><span class="math inline">\(2e2\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(350\)</span></td>
<td><span class="math inline">\(3.5\cdot 10^2\)</span></td>
<td><span class="math inline">\(3.5e2\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(0.00353\)</span></td>
<td><span class="math inline">\(3.53\cdot 10^-3\)</span></td>
<td><span class="math inline">\(3.53e-3\)</span></td>
</tr>
</tbody>
</table>
<p>As a quick and dirty rule, remember that when you’re multiplying a number by <span class="math inline">\(10^{exponent}\)</span>, as you add to the exponent, you’re adding a 0 to the number, or shifting the point by one position towards the right if it’s a decimal number. As you subtract to the exponent, you’re deleting a 0 from the number, or shifting the point by one position towards the left.</p>
</div>
</div>
<div id="creating-and-editing-data-objects-through-a-visual-interface" class="section level2">
<h2><span class="header-section-number">3.11</span> Creating and editing data objects through a visual interface</h2>
<p>If you want to use a visual interface for creating a dataframe, first create an empty dataframe with:</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb227-1" title="1">mydataframe =<span class="st"> </span><span class="kw">data.frame</span>()</a></code></pre></div>
<p>then you can call a spreadsheet like editor to fill in the dataframe with:</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb228-1" title="1"><span class="kw">data.entry</span>(mydataframe)</a></code></pre></div>
<p>or</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb229-1" title="1"><span class="kw">fix</span>(mydataframe)</a></code></pre></div>
<p>If the data object is a vector, <code>fix</code> will call a text editor to edit the object instead of the spreadsheet like interface, so if you want the latter, use the function <code>data.entry</code> instead. However, using a simple text editor for fixing a vector might be more practical, if you want to use a different text editor from the one that <code>fix</code> calls by default, you can change the <code>editor</code> option:</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb230-1" title="1"><span class="kw">fix</span>(myvector, <span class="dt">editor=</span><span class="st">&quot;emacs&quot;</span>)</a></code></pre></div>
<p>or just call the editor on the object:</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb231-1" title="1"><span class="kw">emacs</span>(myvector)</a></code></pre></div>
<p>On Windows you could try:</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb232-1" title="1"><span class="kw">fix</span>(myvector, <span class="dt">editor=</span><span class="st">&quot;notepad&quot;</span>)</a></code></pre></div>

</div>
</div>
<div id="programming" class="section level1">
<h1><span class="header-section-number">4</span> R programming</h1>
<div id="contrstruct" class="section level2">
<h2><span class="header-section-number">4.1</span> Control structures</h2>
<div id="conditionals" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Conditionals</h3>
<div id="conditionalexecution" class="section level4">
<h4><span class="header-section-number">4.1.1.1</span> If..else conditional execution</h4>
<p>It is possible to insert and execute control structures directly from the R interpreter, but for the following examples, I’ll assume you’re writing the commands to a batch file, and then executing them through the <code>source()</code> command.</p>
<p>The general form of conditional execution in R is:</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb233-1" title="1">  <span class="cf">if</span> (cond){</a>
<a class="sourceLine" id="cb233-2" title="2">    do_this</a>
<a class="sourceLine" id="cb233-3" title="3">   } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb233-4" title="4">     do_something_else</a>
<a class="sourceLine" id="cb233-5" title="5">   }</a></code></pre></div>
<p>here’s a trivial example:</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb234-1" title="1">money =<span class="st"> </span><span class="dv">1300</span></a>
<a class="sourceLine" id="cb234-2" title="2"><span class="cf">if</span> (money <span class="op">&gt;</span><span class="st"> </span><span class="dv">1200</span>){</a>
<a class="sourceLine" id="cb234-3" title="3">    <span class="kw">print</span>(<span class="st">&quot;good!&quot;</span>)</a>
<a class="sourceLine" id="cb234-4" title="4">} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb234-5" title="5">    <span class="kw">print</span>(<span class="st">&quot;troubles...&quot;</span>)</a>
<a class="sourceLine" id="cb234-6" title="6">}</a></code></pre></div>
<pre><code>## [1] &quot;good!&quot;</code></pre>
<p>it’s important that the <code>else</code> statement is on the same line where the previous command ends (in the above example that’s the closing brace on the fourth line), otherwise the interpreter sees it as unrelated to the previous <code>if</code> and will give an error (the <code>if</code> statement could also be used by itself, so it would be seen as a complete statement if <code>else</code> does not appear on the same line).</p>
<p>It is also possible to execute more than one command upon the fulfilment of a given condition:</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb236-1" title="1">money =<span class="st"> </span><span class="dv">900</span></a>
<a class="sourceLine" id="cb236-2" title="2">expenses=<span class="dv">1200</span></a>
<a class="sourceLine" id="cb236-3" title="3"><span class="cf">if</span> (money <span class="op">&gt;</span><span class="st"> </span>expenses){</a>
<a class="sourceLine" id="cb236-4" title="4">    <span class="kw">print</span>(<span class="st">&quot;good!&quot;</span>)</a>
<a class="sourceLine" id="cb236-5" title="5">    shopping=<span class="st"> </span>money<span class="op">-</span>expenses</a>
<a class="sourceLine" id="cb236-6" title="6">} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb236-7" title="7">    <span class="kw">print</span>(<span class="st">&quot;troubles...&quot;</span>)</a>
<a class="sourceLine" id="cb236-8" title="8">    shopping=<span class="ot">NA</span></a>
<a class="sourceLine" id="cb236-9" title="9">}</a></code></pre></div>
<pre><code>## [1] &quot;troubles...&quot;</code></pre>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb238-1" title="1"><span class="kw">print</span>(<span class="st">&quot;Money available for shopping:&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Money available for shopping:&quot;</code></pre>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb240-1" title="1"><span class="kw">print</span>(shopping)</a></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>Finally it is possible to add branches to your control structure with the <code>else if</code> statement:</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb242-1" title="1">expenses =<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb242-2" title="2">laptop  =<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb242-3" title="3"><span class="cf">if</span> ((money<span class="op">-</span>expenses) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1000</span>){</a>
<a class="sourceLine" id="cb242-4" title="4">    <span class="kw">print</span>(<span class="st">&quot;great!! buy new laptop&quot;</span>)</a>
<a class="sourceLine" id="cb242-5" title="5">    shopping=(money<span class="op">-</span>expenses)<span class="op">-</span>laptop</a>
<a class="sourceLine" id="cb242-6" title="6">} <span class="cf">else</span> <span class="cf">if</span> ((money<span class="op">-</span>expenses) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;&amp;</span><span class="st"> </span>(money<span class="op">-</span>expenses) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1000</span>){</a>
<a class="sourceLine" id="cb242-7" title="7">    <span class="kw">print</span>(<span class="st">&quot;no laptop, just shopping and save some&quot;</span>)</a>
<a class="sourceLine" id="cb242-8" title="8">    shopping=<span class="st"> </span>(money<span class="op">-</span>expenses)<span class="op">/</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb242-9" title="9">} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb242-10" title="10">    <span class="kw">print</span>(<span class="st">&quot;troubles...&quot;</span>)</a>
<a class="sourceLine" id="cb242-11" title="11">    shopping=<span class="ot">NA</span></a>
<a class="sourceLine" id="cb242-12" title="12">}</a></code></pre></div>
<pre><code>## [1] &quot;troubles...&quot;</code></pre>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb244-1" title="1"><span class="kw">print</span>(<span class="st">&quot;Money available for shopping:&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Money available for shopping:&quot;</code></pre>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb246-1" title="1"><span class="kw">print</span>(shopping)</a></code></pre></div>
<pre><code>## [1] NA</code></pre>
</div>
<div id="ifelse" class="section level4">
<h4><span class="header-section-number">4.1.1.2</span> <code>ifelse</code></h4>
<p>The <code>ifelse</code> function is handy for testing all the elements of a vector on a given condition, the general form is:</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb248-1" title="1">  <span class="kw">ifelse</span>(condition, value_if_cond_true, value_if_cond_false)</a></code></pre></div>
<p>for example, let’s say we want to categorise the results of a classroom test, scored from 1 to 10 as “pass” if the score was equal to, or greater than 6 and “fail” if the score was less than 6:</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb249-1" title="1">score =<span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">6</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">6</span>,<span class="dv">7</span>)</a>
<a class="sourceLine" id="cb249-2" title="2">admission =<span class="st"> </span><span class="kw">ifelse</span>(score <span class="op">&gt;=</span><span class="st"> </span><span class="dv">6</span>, <span class="st">&quot;pass&quot;</span>, <span class="st">&quot;fail&quot;</span>)</a>
<a class="sourceLine" id="cb249-3" title="3">admission</a></code></pre></div>
<pre><code>## [1] &quot;fail&quot; &quot;pass&quot; &quot;pass&quot; &quot;fail&quot; &quot;pass&quot; &quot;pass&quot; &quot;pass&quot;</code></pre>
<p>so, the first argument of the <code>ifelse</code> function, is the condition that we want to test, the second argument is the value that should be returned if the condition is met, and the third argument is the value that should be returned if it is not.</p>
</div>
<div id="xor" class="section level4">
<h4><span class="header-section-number">4.1.1.3</span> <code>xor</code></h4>
<p>The function <code>xor</code> implements the exclusive logical “or” operator, that is, it evaluates to <code>TRUE</code> if exclusively one of two alternative conditions is met, otherwise, it evaluates to false. The latter occurs both, when none of the conditions is met and when both are met simultaneously.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb251-1" title="1">a=<span class="dv">6</span></a>
<a class="sourceLine" id="cb251-2" title="2"><span class="kw">xor</span>(a<span class="op">&gt;</span><span class="dv">5</span>, a<span class="op">&gt;</span><span class="dv">7</span>)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb253-1" title="1"><span class="kw">xor</span>(a<span class="op">&gt;</span><span class="dv">5</span>, a<span class="op">&gt;</span><span class="dv">3</span>)</a></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>in the first example, only the first condition (a&gt;5) is met, so the function evaluates to true. In the second example, both conditions are satisfied, but since we’re using <code>xor</code> and you can have one thing or the other, but not both together, the function evaluates to false.</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb255-1" title="1">a</a></code></pre></div>
<pre><code>## [1] 6</code></pre>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb257-1" title="1">a=a[<span class="op">-</span><span class="kw">which</span>(a<span class="op">&gt;</span><span class="dv">5</span>)]</a></code></pre></div>
</div>
</div>
<div id="loops" class="section level3">
<h3><span class="header-section-number">4.1.2</span> Loops</h3>
<div id="for-loops" class="section level4">
<h4><span class="header-section-number">4.1.2.1</span> <code>for</code> loops</h4>
<p><code>for</code> loops can be used to iterate over elements of a vector:</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb258-1" title="1"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>){</a>
<a class="sourceLine" id="cb258-2" title="2">    <span class="kw">print</span>(i)</a>
<a class="sourceLine" id="cb258-3" title="3">}</a></code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3
## [1] 4</code></pre>
<p>in the above case the vector is given by the sequence of numbers <code>1:4</code>. The following example uses a vector consisting of a sequence of letters:</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb260-1" title="1">letts =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>)</a>
<a class="sourceLine" id="cb260-2" title="2"><span class="cf">for</span> (ltt <span class="cf">in</span> letts){</a>
<a class="sourceLine" id="cb260-3" title="3">    <span class="kw">print</span>(ltt)</a>
<a class="sourceLine" id="cb260-4" title="4">}</a></code></pre></div>
<pre><code>## [1] &quot;a&quot;
## [1] &quot;b&quot;
## [1] &quot;c&quot;
## [1] &quot;d&quot;</code></pre>
<p><code>for</code> loops can iterate also over elements of a list:</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb262-1" title="1">lst =<span class="st"> </span><span class="kw">list</span>(<span class="dt">a=</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">8</span>), <span class="dt">b=</span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">7</span>), <span class="dt">c=</span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">-4</span>))</a>
<a class="sourceLine" id="cb262-2" title="2"><span class="cf">for</span> (itm <span class="cf">in</span> lst){</a>
<a class="sourceLine" id="cb262-3" title="3">    <span class="kw">print</span>(itm[<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb262-4" title="4">}</a></code></pre></div>
<pre><code>## [1] 8
## [1] 7
## [1] -4</code></pre>
<p><code>for</code> loops can be nested at will:</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb264-1" title="1"><span class="cf">for</span> (ltt <span class="cf">in</span> letts){</a>
<a class="sourceLine" id="cb264-2" title="2">    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>){</a>
<a class="sourceLine" id="cb264-3" title="3">        <span class="kw">print</span>(<span class="kw">paste0</span>(ltt, <span class="st">&quot; - &quot;</span>, i))</a>
<a class="sourceLine" id="cb264-4" title="4">    }</a>
<a class="sourceLine" id="cb264-5" title="5">}</a></code></pre></div>
<pre><code>## [1] &quot;a - 1&quot;
## [1] &quot;a - 2&quot;
## [1] &quot;a - 3&quot;
## [1] &quot;a - 4&quot;
## [1] &quot;b - 1&quot;
## [1] &quot;b - 2&quot;
## [1] &quot;b - 3&quot;
## [1] &quot;b - 4&quot;
## [1] &quot;c - 1&quot;
## [1] &quot;c - 2&quot;
## [1] &quot;c - 3&quot;
## [1] &quot;c - 4&quot;
## [1] &quot;d - 1&quot;
## [1] &quot;d - 2&quot;
## [1] &quot;d - 3&quot;
## [1] &quot;d - 4&quot;</code></pre>
</div>
<div id="while-loops" class="section level4">
<h4><span class="header-section-number">4.1.2.2</span> <code>while</code> loops</h4>
<p><code>while</code> loops continue until a certain condition is met:</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb266-1" title="1">i =<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb266-2" title="2"><span class="cf">while</span> (i<span class="op">&lt;</span><span class="dv">4</span>){</a>
<a class="sourceLine" id="cb266-3" title="3">    <span class="kw">print</span>(i)</a>
<a class="sourceLine" id="cb266-4" title="4">    i =<span class="st"> </span>i<span class="op">+</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb266-5" title="5">}</a></code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3</code></pre>
</div>
</div>
</div>
<div id="functions" class="section level2">
<h2><span class="header-section-number">4.2</span> Functions</h2>
<p>Functions are one of the fundamental building blocks of programming. While using R we call functions all the time, but why write new ones? A major reason is to make your analysis code more modular, readable, compact, and reusable. Whenever you’re repeatedly performing a series of operations on well-defined inputs and outputs in your analyses scripts you should consider “packaging” those operations into functions. The syntax for declaring a function is:</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb268-1" title="1">my_func =<span class="st"> </span><span class="cf">function</span>(arg1, arg2){</a>
<a class="sourceLine" id="cb268-2" title="2">    <span class="co">## function code here</span></a>
<a class="sourceLine" id="cb268-3" title="3">}</a></code></pre></div>
<p>where <code>my_func</code> is the name of the function, and <code>arg1</code>, <code>arg2</code> are the arguments we want to pass to the function. For example let’s define a function that computes the <a href="https://en.wikipedia.org/wiki/Root_mean_square">root mean square (RMS)</a> of a vector:</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb269-1" title="1">RMS =<span class="st"> </span><span class="cf">function</span>(vls){</a>
<a class="sourceLine" id="cb269-2" title="2">    RMS_val =<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>(vls<span class="op">^</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb269-3" title="3"></a>
<a class="sourceLine" id="cb269-4" title="4">    <span class="kw">return</span>(RMS_val)</a>
<a class="sourceLine" id="cb269-5" title="5">}</a></code></pre></div>
<p>the last line indicates the value returned by the function, if no explicit <code>return</code> statement is provided, the function will return the value of the last evaluated expression. We can now run the function:</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb270-1" title="1"><span class="kw">RMS</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">-8</span>, <span class="dv">9</span>, <span class="dv">-4</span>))</a></code></pre></div>
<pre><code>## [1] 6.164414</code></pre>
<p>Let’s suppose now that we want our <code>RMS</code> function to handle the possibility of missing values in the input vector. If there are one or more <code>NA</code> the <code>RMS</code> function, as is defined right now, will return <code>NA</code>:</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb272-1" title="1"><span class="kw">RMS</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">-8</span>, <span class="dv">9</span>, <span class="ot">NA</span>))</a></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>we want this to be the default behavior, but we want to give users the option to ignore the missing values and compute the RMS of the subset of remaining values. We can do this by defining the <code>RMS</code> function as follows:</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb274-1" title="1">RMS =<span class="st"> </span><span class="cf">function</span>(vls, <span class="dt">na.rm=</span><span class="ot">FALSE</span>){</a>
<a class="sourceLine" id="cb274-2" title="2">    <span class="cf">if</span> (na.rm <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>){</a>
<a class="sourceLine" id="cb274-3" title="3">        vls =<span class="st"> </span>vls[<span class="kw">is.na</span>(vls) <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>]</a>
<a class="sourceLine" id="cb274-4" title="4">    }</a>
<a class="sourceLine" id="cb274-5" title="5">    RMS_val =<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">mean</span>(vls<span class="op">^</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb274-6" title="6"></a>
<a class="sourceLine" id="cb274-7" title="7">    <span class="kw">return</span>(RMS_val)</a>
<a class="sourceLine" id="cb274-8" title="8">}</a></code></pre></div>
<p>running the function with the default value for <code>na.rm</code> still gives the same result as before:</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb275-1" title="1"><span class="kw">RMS</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">-8</span>, <span class="dv">9</span>, <span class="ot">NA</span>))</a></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>specifying <code>na.rm = TRUE</code>, instead, computes the RMS of the non-missing values</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb277-1" title="1"><span class="kw">RMS</span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">-8</span>, <span class="dv">9</span>, <span class="ot">NA</span>), <span class="dt">na.rm=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 6.595453</code></pre>
</div>
<div id="stringprocessing" class="section level2">
<h2><span class="header-section-number">4.3</span> String processing</h2>
<p>One of the strengths of R, in my opinion, lies in the way it deals with character strings. Certain objects, for example dataframes, allow to mix strings with other data types, subsets of certain objects (again dataframes are an example, but also lists), can be easily given meaningful names and retrieved. This adds much flexibility and ease of use to R compared to other languages (e.g. MATLAB). One aspect that is perhaps less known however, are the powerful string processing functions that R gives you. Once you get to know them you’ll realise you can do all your data analysis in R, without the need to use other languages, like python or perl for pre-processing.</p>
<p>The simplest thing you can do with a string, is counting its characters, which you can do with the <code>nchar</code> function:</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb279-1" title="1">my_string =<span class="st"> &#39;I love R&#39;</span></a>
<a class="sourceLine" id="cb279-2" title="2"><span class="kw">nchar</span>(my_string)</a></code></pre></div>
<pre><code>## [1] 8</code></pre>
<p>The second thing you can do with strings is extracting parts of them. There are various way to achieve this. Two of the most useful functions are <code>substr</code> and <code>strsplit</code>.</p>
<p><code>substring</code>, as the name suggests, returns part of a string:</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb281-1" title="1"><span class="kw">substr</span>(my_string, <span class="dt">start=</span><span class="dv">1</span>, <span class="dt">stop=</span><span class="dv">4</span>)</a></code></pre></div>
<pre><code>## [1] &quot;I lo&quot;</code></pre>
<p>if you want to get a portion of a string from some point in the middle, to the end:</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb283-1" title="1"><span class="kw">substr</span>(my_string, <span class="dt">start=</span><span class="dv">5</span>, <span class="dt">stop=</span><span class="kw">nchar</span>(my_string))</a></code></pre></div>
<pre><code>## [1] &quot;ve R&quot;</code></pre>
<p><code>substr</code> can be also used to replace parts of a string</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb285-1" title="1"><span class="kw">substr</span>(my_string,<span class="dt">start=</span><span class="dv">1</span>,<span class="dt">stop=</span><span class="dv">3</span>)=<span class="st">&#39;qqq&#39;</span></a>
<a class="sourceLine" id="cb285-2" title="2">my_string</a></code></pre></div>
<pre><code>## [1] &quot;qqqove R&quot;</code></pre>
<div id="regexp" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Using regular expressions</h3>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb287-1" title="1">b=<span class="kw">c</span>(<span class="st">&#39;the&#39;</span>,<span class="st">&#39;atheist&#39;</span>,<span class="st">&#39;theme&#39;</span>,<span class="st">&#39;therion&#39;</span>,<span class="st">&#39;thin&#39;</span>,<span class="st">&#39;jjthe&#39;</span>)   </a>
<a class="sourceLine" id="cb287-2" title="2"><span class="kw">grep</span>(<span class="st">&#39;^the&#39;</span>,b,<span class="dt">value=</span><span class="ot">TRUE</span>) <span class="co">## match only when pattern appears at the beginning</span></a></code></pre></div>
<pre><code>## [1] &quot;the&quot;     &quot;theme&quot;   &quot;therion&quot;</code></pre>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb289-1" title="1"><span class="kw">grep</span>(<span class="st">&#39;the$&#39;</span>,b,<span class="dt">value=</span><span class="ot">TRUE</span>) <span class="co">## match only when pattern appears at the end</span></a></code></pre></div>
<pre><code>## [1] &quot;the&quot;   &quot;jjthe&quot;</code></pre>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb291-1" title="1"><span class="kw">grep</span>(<span class="st">&#39;^the$&#39;</span>,b,<span class="dt">value=</span>T) <span class="co">## match exactly &#39;the&#39; not followed or preceded by anything</span></a></code></pre></div>
<pre><code>## [1] &quot;the&quot;</code></pre>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb293-1" title="1"><span class="kw">grep</span>(<span class="st">&#39;the[i,m]&#39;</span>,b,<span class="dt">value=</span><span class="ot">TRUE</span>)<span class="co">## match &#39;the&#39; followed by &#39;i&#39; or &#39;m&#39;</span></a></code></pre></div>
<pre><code>## [1] &quot;atheist&quot; &quot;theme&quot;</code></pre>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb295-1" title="1"><span class="kw">grep</span>(<span class="st">&#39;the[^i]&#39;</span>,b,<span class="dt">value=</span><span class="ot">TRUE</span>)<span class="co">## match &#39;the&#39; followed by anything except &#39;i&#39;   </span></a></code></pre></div>
<pre><code>## [1] &quot;theme&quot;   &quot;therion&quot;</code></pre>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb297-1" title="1"><span class="kw">grep</span>(<span class="st">&#39;the.&#39;</span>,b,<span class="dt">value=</span><span class="ot">TRUE</span>)<span class="co">## match &#39;the&#39; followed by anything</span></a></code></pre></div>
<pre><code>## [1] &quot;atheist&quot; &quot;theme&quot;   &quot;therion&quot;</code></pre>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb299-1" title="1"><span class="kw">grep</span>(<span class="st">&#39;.the&#39;</span>,b,<span class="dt">value=</span><span class="ot">TRUE</span>)<span class="co">## match &#39;the&#39; preceded by anything</span></a></code></pre></div>
<pre><code>## [1] &quot;atheist&quot; &quot;jjthe&quot;</code></pre>
<p><code>glob2rx</code> translates a wildcard pattern, as used in most shells (for example for listing files with the Unix <code>ls</code>), in a regular expression, so if you’re used to wildcards this comes is handy</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb301-1" title="1"><span class="kw">glob2rx</span>(<span class="st">&#39;the*&#39;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;^the&quot;</code></pre>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb303-1" title="1"><span class="kw">glob2rx</span>(<span class="st">&#39;the&#39;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;^the$&quot;</code></pre>
</div>
</div>
<div id="tips-and-tricks" class="section level2">
<h2><span class="header-section-number">4.4</span> Tips and tricks</h2>
<div id="convert-a-string-into-a-command" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Convert a string into a command</h3>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb305-1" title="1">cmd =<span class="st"> &quot;vec = c(1,2,3)&quot;</span></a>
<a class="sourceLine" id="cb305-2" title="2"><span class="kw">eval</span>(<span class="kw">parse</span>(<span class="dt">text=</span>cmd))</a></code></pre></div>
</div>
</div>
<div id="creatingsimplerpackages" class="section level2">
<h2><span class="header-section-number">4.5</span> Creating simple R packages</h2>
<p>If you start writing your own functions and you use them often, probably you will soon get tired of sourcing the files containing each function to make them available at each session. There are at least two ways around this problem:</p>
<ul>
<li>put all your function files in a directory and write a function that systematically sources them all.</li>
<li>build a R package</li>
</ul>
<p>The first solution is rather simple, give the <code>.R</code> extension to your R function files and put them in a directory. Although there is not a built-in function to source all the R files present in a directory, the documentation for the <code>source</code> function gives an example on how to do it (see <code>?source</code>):</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb306-1" title="1">  <span class="co">## If you want to source() a bunch of files, something like</span></a>
<a class="sourceLine" id="cb306-2" title="2">  <span class="co">## the following may be useful:</span></a>
<a class="sourceLine" id="cb306-3" title="3">  sourceDir =<span class="st"> </span><span class="cf">function</span>(path, <span class="dt">trace =</span> <span class="ot">TRUE</span>, ...) {</a>
<a class="sourceLine" id="cb306-4" title="4">    <span class="cf">for</span> (nm <span class="cf">in</span> <span class="kw">list.files</span>(path, <span class="dt">pattern =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">.[RrSsQq]$&quot;</span>)) {</a>
<a class="sourceLine" id="cb306-5" title="5">      <span class="cf">if</span>(trace) <span class="kw">cat</span>(nm,<span class="st">&quot;:&quot;</span>)           </a>
<a class="sourceLine" id="cb306-6" title="6">      <span class="kw">source</span>(<span class="kw">file.path</span>(path, nm), ...)</a>
<a class="sourceLine" id="cb306-7" title="7">      <span class="cf">if</span>(trace) <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb306-8" title="8">    }</a>
<a class="sourceLine" id="cb306-9" title="9">  }</a></code></pre></div>
<p>the function sources all the files with the <code>.R</code> extension found in the directory indicated by the <code>path</code> argument. You can copy this function to a file, let’s say <code>sourceDir.R</code>, put it in your HOME directory and source it in your <code>.First</code> function in <code>.Rprofile</code> (see Section <a href="#custom">17.1</a> for details the <code>.First</code> function and the <code>.Rprofile</code> file)</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb307-1" title="1">  <span class="co">## This goes in .Rprofile in ~/</span></a>
<a class="sourceLine" id="cb307-2" title="2">  .First =<span class="st"> </span><span class="cf">function</span>(){</a>
<a class="sourceLine" id="cb307-3" title="3">     <span class="kw">source</span>(<span class="st">&quot;~/sourceDir.R&quot;</span>)</a>
<a class="sourceLine" id="cb307-4" title="4">  }</a></code></pre></div>
<p>now each time you call <code>sourceDir</code> with a directory as an argument, you will have all the functions defined there available. If you want them available at the beginning of each session, just add a call to <code>sourceDir</code> for the directories you want to add in your
<code>.First</code> function as well. So for example, if your R function files are in the directory <code>myRfunctions</code>, add the following to your <code>.First</code> function:</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb308-1" title="1">  <span class="co">## This goes in .Rprofile in ~/</span></a>
<a class="sourceLine" id="cb308-2" title="2">  .First =<span class="st"> </span><span class="cf">function</span>(){</a>
<a class="sourceLine" id="cb308-3" title="3">     <span class="kw">source</span>(<span class="st">&quot;~/sourceDir.R&quot;</span>)</a>
<a class="sourceLine" id="cb308-4" title="4">     <span class="kw">sourceDir</span>(<span class="st">&quot;~/myRfunctions&quot;</span>)</a>
<a class="sourceLine" id="cb308-5" title="5">  }</a></code></pre></div>
<p>Building a R package requires a bit more work. The detailed documentation for doing this is provided in the <strong>Writing R Extensions</strong> manual available at the CRAN website <a href="http://cran.r-project.org/" class="uri">http://cran.r-project.org/</a>. That documentation looks at best daunting for a beginner, indeed writing a R package is not trivial, however if all you have is pure R code, and you just want to build a simple package for your own use, the task should not be too difficult to achieve. A very useful document is <strong>An introduction to the R package mechanism</strong>, it can be found at the following URL <a href="http://biosun1.harvard.edu/courses/individual/bio271/lectures/L6/Rpkg.pdf" class="uri">http://biosun1.harvard.edu/courses/individual/bio271/lectures/L6/Rpkg.pdf</a>. In the following sections I’ll try to explain how to build a simple R package, much of what I say is drawn from the above cited documents.</p>
<div id="the-bare-minimum-to-create-a-package" class="section level3">
<h3><span class="header-section-number">4.5.1</span> The bare minimum to create a package</h3>
<p>The quickest way to get started is to use the function <code>package.skeleton</code> to create the first ``draft’’ of your package. Start a R session, make sure that there are not R objects in your session, otherwise they will be bundled in your package</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb309-1" title="1"><span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">ls</span>(<span class="dt">all=</span><span class="ot">TRUE</span>))</a></code></pre></div>
<p>now source all the function files you want to include in your package, for example</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb310-1" title="1"><span class="kw">source</span>(<span class="st">&quot;/home/sam/myFunctions.R&quot;</span>)</a>
<a class="sourceLine" id="cb310-2" title="2"><span class="kw">source</span>(<span class="st">&quot;/home/sam/soundFunctions.R&quot;</span>)</a></code></pre></div>
<p>and the call the <code>package.skeleton</code> function with the name you want to give to your package as the argument, for example ``mypkg’’</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb311-1" title="1"><span class="kw">package.skeleton</span>(<span class="st">&quot;mypkg&quot;</span>)</a></code></pre></div>
<p>this will create a directory called <code>mypkg</code> with two sub-directories, <code>R</code> containing your code, and <code>man</code> containing the documentation files. Furthermore a file called <code>DESCRIPTION</code> will be created. If the objects you are packaging include datasets, a <code>data</code> directory will also be created. These are the essential elements needed to build a package. The exact content of these files and directories, and how to edit them will be explained later, for the moment I’ll give an overview of the steps required to start using your package. The next step consists of building the package. Start a shell (not a R session), move one directory above the <code>mypkg</code> directory we’ve just created and give the command</p>
<pre><code>$ R CMD build mypkg </code></pre>
<p>to build the package, this will create a tar gzipped file with everything necessary to install the package, the next step to do is indeed the installation. I would recommend installing your own packages in a separate directory from the default package installation directory, let’s say <code>~/personalRLibrary</code>, to install the package in this directory, still from the shell call</p>
<pre><code>$ R CMD INSTALL -l ~/personalRLibrary nameOfTarFile.tar.gz</code></pre>
<p>now from a R session you can call your package with</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb314-1" title="1"><span class="kw">library</span>(mypkg, <span class="dt">lib=</span><span class="st">&quot;~/personalRLibrary&quot;</span>)</a></code></pre></div>
<p>if you want to add permanently your personal R library to the library search path, you can add the following line to the <code>.First</code> function in your <code>.Rprofile</code></p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb315-1" title="1"><span class="co">## This goes in .Rprofile in ~/</span></a>
<a class="sourceLine" id="cb315-2" title="2">.First =<span class="st"> </span><span class="cf">function</span>(){</a>
<a class="sourceLine" id="cb315-3" title="3">    <span class="kw">.libPaths</span>(<span class="kw">c</span>((<span class="kw">.libPaths</span>()), <span class="st">&quot;~/personalRLibrary/&quot;</span>))</a>
<a class="sourceLine" id="cb315-4" title="4">}</a></code></pre></div>
<p>in this way, after starting a new session you’ll be able to load your package without having to specify in which library it is located</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb316-1" title="1">   <span class="kw">library</span>(mypkg)</a></code></pre></div>
<p>The one described above is a very quick but rough way of creating a package, in order to properly create a R package a number of additional steps, like writing the documentation, and adding examples, need to be followed. Some of these steps will be described in the following sections. Always remember that a very useful thing to do when learning how to build a package is to download some source packages and explore their contents.</p>
<div id="editing-the-description-file" class="section level4">
<h4><span class="header-section-number">4.5.1.1</span> Editing the <code>DESCRIPTION</code> file</h4>
<p>The <code>DESCRIPTION</code> file follows the Debian control format, and has a key-value pair syntax. The default fields created by <code>package.skeleton</code> are pretty much self-explanatory. Other fields that can be added are</p>
<ul>
<li><em>Depends</em> If your package depends on a particular version of R, or on other packages, these should be listed here. For example:</li>
</ul>
<pre><code>  Depends: R (&gt;= 1.9.0), gtools, gdata, stats</code></pre>
<ul>
<li><em>URL</em> The URL of a website where you can find out mode about the package. For example:</li>
</ul>
<pre><code>URL: http://www.example.com</code></pre>
</div>
<div id="editing-the-documentation" class="section level4">
<h4><span class="header-section-number">4.5.1.2</span> Editing the documentation</h4>
<p>The documentation files reside in the <code>man</code> directory of your package. There is one documentation file for each function or data set present in the package. The documentation files are written in a  like format called <code>Rd</code>. <code>package.skeleton</code> creates a skeleton of the documentation file, which just needs to be edited, the default fields are pretty much self-explanatory. For a more detailed explanation you can read the <em>Writing R Extensions</em> manual <a href="http://cran.r-project.org/doc/manuals/R-exts.html" class="uri">http://cran.r-project.org/doc/manuals/R-exts.html</a>. I’ll give you just a few tips:</p>
<p>It is possible to add additional sections beside the default ones, for example it may be useful to add a ``Warnings’’ section if you have any warnings to give on the use of the function</p>
<pre><code>\section{Warning}{Calling this function with arguments foo foo2 can cause ...}</code></pre>
<p>In the <code>seealso</code> section, you can refer to other functions contained in your package, for example</p>
<pre><code>\code{\link{functionFoo}}</code></pre>
<p>will automagically add a hyperlink to the documentation for the function <code>functionFoo</code></p>
<p>In the <code>Examples</code> section, you write code as if you were writing it in a R script. You can use datasets from your own package, or from the standard R dataset. Keep in mind that the examples should be directly executable by the user, either through copy and paste, or through the <code>example()</code> function. When the package is installed, the examples will appear in a directory called <code>R-ex</code>, however you do not need to bother about this, the R code for your examples needs to be written within the documentation <code>Rd</code> files.</p>
<p>The documentation requires the presence of one or more standard keywords. One way to get a list of these keywords is to download the tarball with the R sources, after unpacking it, you can find the keywords in a file within the <code>doc</code> directory called <code>KEYWORDS.db</code>.</p>
</div>
<div id="converting-rd-files-to-other-formats" class="section level4">
<h4><span class="header-section-number">4.5.1.3</span> Converting Rd files to other formats</h4>
<p>HTML and LaTeX versions of the documentation files are automatically produced in the package installation process, you can find them in the <code>html</code> and <code>latex</code> directories of your package installation directory, respectively. You can also produce a single pdf or dvi file containing all the documentation using the following command from a shell</p>
<pre><code>$ ## produce dvi
$ R CMD Rd2dvi /path/to/your/package/sources/
$ ## produce pdf
$ R CMD Rd2dvi --pdf /path/to/your/package/sources/</code></pre>
</div>
<div id="adding-additional-function-or-data-files-to-the-package" class="section level4">
<h4><span class="header-section-number">4.5.1.4</span> Adding additional function or data files to the package</h4>
<p>Adding additional function files is quite straightforward, the files contained in the <code>R</code> sub-directory of your package directory are plain R files, so you can just write your functions, drop the files with your functions there, and next time you build the package the new functions will be included. The function <code>prompt</code> can be used to build the documentation templates for new functions:</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb322-1" title="1">myfun =<span class="st"> </span><span class="cf">function</span>(arg){val =<span class="st"> </span>arg <span class="op">+</span><span class="st"> </span><span class="dv">3</span>}</a>
<a class="sourceLine" id="cb322-2" title="2"><span class="kw">prompt</span>(myfun)</a></code></pre></div>
<p>this will create a <code>.Rd</code> file which you can edit, and drop in the <code>man</code> directory.</p>
<p>Datasets can be saved using the <code>save</code> function:</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb323-1" title="1">mydata =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="fl">.1</span>)</a>
<a class="sourceLine" id="cb323-2" title="2"><span class="kw">save</span>(mydata, <span class="dt">file=</span><span class="st">&#39;mydata.rda&#39;</span>)</a></code></pre></div>
<p>documentation again can be produced using the <code>prompt</code> function</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb324-1" title="1"><span class="kw">prompt</span>(mydata)</a></code></pre></div>
</div>
<div id="checking-the-package" class="section level4">
<h4><span class="header-section-number">4.5.1.5</span> Checking the package</h4>
<p>The sanity check for the package can be done by issuing the following command from a shell</p>
<pre><code>$ R CMD check /path/to/your/package/sources/</code></pre>
</div>
<div id="other-resources" class="section level4">
<h4><span class="header-section-number">4.5.1.6</span> Other resources</h4>
<p><span class="citation">Wickham (<a href="#ref-Wickham2015">2015</a>)</span> is a book dedicated to the development of R packages. The draft of the 2 edition of the book is available <a href="https://r-pkgs.org/">here</a>.</p>

</div>
</div>
</div>
</div>
<div id="IO" class="section level1">
<h1><span class="header-section-number">5</span> File input/output</h1>
<div id="reading-in-data-from-a-file" class="section level2">
<h2><span class="header-section-number">5.1</span> Reading in data from a file</h2>
<div id="read.table" class="section level3">
<h3><span class="header-section-number">5.1.1</span> The <code>read.table</code> function</h3>
<p>If the data are in a table-like format, with each row corresponding to an observation or a single case, and each column to a variable, the most convenient function to load them in R is <code>read.table</code>. This function reads in the data file as a dataframe. For example the data in the data file <code>ratsData.txt</code> that contain information (height, weight, and species) of 6 rats can be easily read in with the following command:</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb326-1" title="1">ratsData =<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">file=</span><span class="st">&quot;datasets/ratsData.txt&quot;</span>, <span class="dt">header=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb326-2" title="2">ratsData</a></code></pre></div>
<pre><code>##   identifier height weight species
## 1       sa01    3.2    300       A
## 2       sa02    2.6    246       A
## 3       sa03    2.9    317       A
## 4       sb01    2.4    229       B
## 5       sb02    2.5    230       B
## 6       sb03    2.4    245       B</code></pre>
<p>in this case we’ve set the option <code>header=TRUE</code> because the file contains a header on the first line with the variable names.</p>
</div>
<div id="scan" class="section level3">
<h3><span class="header-section-number">5.1.2</span> <code>scan</code></h3>
<p>Another very handy function for reading in data is <code>scan</code>, it can easily read in both tabular data in which all the columns are of the same type, or they are of different type, as long as they follow a regular pattern. We’ll read in the <code>ratsData.txt</code> file as an example:</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb328-1" title="1">x =<span class="st"> </span><span class="kw">scan</span>(<span class="dt">file=</span><span class="st">&quot;datasets/ratsData.txt&quot;</span>, <span class="dt">what=</span><span class="kw">list</span>(<span class="dt">identifier=</span><span class="kw">character</span>(),</a>
<a class="sourceLine" id="cb328-2" title="2">          <span class="dt">height=</span><span class="kw">numeric</span>(), <span class="dt">weight=</span><span class="kw">numeric</span>(), <span class="dt">species=</span><span class="kw">character</span>()),</a>
<a class="sourceLine" id="cb328-3" title="3">          <span class="dt">skip=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb328-4" title="4"><span class="kw">str</span>(x)</a></code></pre></div>
<pre><code>## List of 4
##  $ identifier: chr [1:6] &quot;sa01&quot; &quot;sa02&quot; &quot;sa03&quot; &quot;sb01&quot; ...
##  $ height    : num [1:6] 3.2 2.6 2.9 2.4 2.5 2.4
##  $ weight    : num [1:6] 300 246 317 229 230 245
##  $ species   : chr [1:6] &quot;A&quot; &quot;A&quot; &quot;A&quot; &quot;B&quot; ...</code></pre>
<p>the <code>what</code> argument tells the <code>scan</code> function the mode (numeric, character, etc…) of the elements to be read in, if <code>what</code> is a list of modes, then each corresponds to a column in the data file. So in the above example we have the first column, the variable <code>identifier</code>, which is of character mode, the second column, <code>height</code> is of numeric mode, like the third column, <code>weight</code>, while the last column, <code>species</code> is of character mode again. Notice that we’re telling <code>scan</code> to skip the first line of the file (<code>skip=1</code>) because it contains the header. The object returned by <code>scan</code> in this case is a list, we can get the single elements of the list, corresponding to each column of the data file, with the usual methods for lists:</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb330-1" title="1">x[[<span class="dv">1</span>]] <span class="co">#first item in list (first column in file)</span></a></code></pre></div>
<pre><code>## [1] &quot;sa01&quot; &quot;sa02&quot; &quot;sa03&quot; &quot;sb01&quot; &quot;sb02&quot; &quot;sb03&quot;</code></pre>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb332-1" title="1">x[[<span class="st">&quot;weight&quot;</span>]] <span class="co">#item named weight in list (third column in file)</span></a></code></pre></div>
<pre><code>## [1] 300 246 317 229 230 245</code></pre>
<p><code>scan</code> can do much more than what was shown in this example, like specifying the separator between the fields of the data file (comma, tabs, or whatever else, defaults to blank space), or specifying the maximum number of lines to be read, see <code>?scan</code> for more details. I’ll present just another simple example in which we’ll read in a file whose data are all numeric. The file is <code>rts.txt</code></p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb334-1" title="1">x =<span class="st"> </span><span class="kw">scan</span>(<span class="st">&quot;datasets/rts.txt&quot;</span>, <span class="dt">what=</span><span class="kw">numeric</span>())</a>
<a class="sourceLine" id="cb334-2" title="2"><span class="kw">str</span>(x)</a></code></pre></div>
<pre><code>##  num [1:36] 0.12 0.132 0.102 0.096 0.103 0.087 0.113 0.134 0.109 0.132 ...</code></pre>
<p>in this case the object returned is a long vector of the same mode as the <code>what</code> argument, a numeric vector. The file is however organised into three columns, which represent three different numeric variables. It is easy to reorganise our vector to reflect the structure of our data:</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb336-1" title="1">nRows =<span class="st"> </span><span class="kw">length</span>(x)<span class="op">/</span><span class="dv">3</span></a>
<a class="sourceLine" id="cb336-2" title="2">xm =<span class="st"> </span><span class="kw">matrix</span>(x, <span class="dt">nrow=</span>nRows, <span class="dt">byrow=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<p>so we’ve got a matrix with the 3 columns of data originally found in the file, turning it into a dataframe would be equally easy at this point</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb337-1" title="1">xd =<span class="st"> </span><span class="kw">as.data.frame</span>(xm)</a></code></pre></div>
<p>However also in this case it is possible to simply read in each column of the file as the element of a list:</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb338-1" title="1">x =<span class="st"> </span><span class="kw">scan</span>(<span class="st">&quot;datasets/rts.txt&quot;</span>, <span class="dt">what=</span><span class="kw">list</span>(<span class="dt">v1=</span><span class="kw">numeric</span>(),</a>
<a class="sourceLine" id="cb338-2" title="2">          <span class="dt">v2=</span><span class="kw">numeric</span>(), <span class="dt">v3=</span><span class="kw">numeric</span>()))</a>
<a class="sourceLine" id="cb338-3" title="3"><span class="kw">str</span>(x)</a></code></pre></div>
<pre><code>## List of 3
##  $ v1: num [1:12] 0.12 0.096 0.113 0.132 0.124 0.105 0.109 0.143 0.127 0.098 ...
##  $ v2: num [1:12] 0.132 0.103 0.134 0.147 0.139 0.115 0.129 0.15 0.145 0.117 ...
##  $ v3: num [1:12] 0.102 0.087 0.109 0.123 0.124 0.102 0.097 0.119 0.113 0.092 ...</code></pre>
</div>
<div id="low-level-file-input" class="section level3">
<h3><span class="header-section-number">5.1.3</span> Low-level file input</h3>
<p>Sometimes the file to be read is not nicely organised into separate columns each representing a variable, in this case the function <code>readLines</code> can either read-in the file as a character vector, in which each element is a line from the file. The lines can then be further processed to extract the data (see Section <a href="#stringprocessing">4.3</a> for information on string processing facilities).</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb340-1" title="1">lns =<span class="st"> </span><span class="kw">readLines</span>(<span class="st">&quot;datasets/lorem_ipsum.txt&quot;</span>)</a>
<a class="sourceLine" id="cb340-2" title="2">lns[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]</a></code></pre></div>
<pre><code>## [1] &quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit.&quot;       
## [2] &quot;Donec lacus neque, rhoncus et ultricies volutpat, cursus in mi.&quot;</code></pre>
<p>If you want to read all of the file as a single string, a solution is:</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb342-1" title="1">fileName =<span class="st"> &quot;datasets/lorem_ipsum.txt&quot;</span>; </a>
<a class="sourceLine" id="cb342-2" title="2">txt =<span class="st"> </span><span class="kw">readChar</span>(fileName, <span class="kw">file.info</span>(fileName)<span class="op">$</span>size)</a></code></pre></div>
</div>
<div id="binary-file-input" class="section level3">
<h3><span class="header-section-number">5.1.4</span> Binary file input</h3>
<p>Other functions that may be useful are <code>readChar</code> and <code>readBin</code>, but note that these are intended for binary-mode file connections.</p>
</div>
</div>
<div id="writing-data-to-a-file" class="section level2">
<h2><span class="header-section-number">5.2</span> Writing data to a file</h2>
<div id="write.table" class="section level3">
<h3><span class="header-section-number">5.2.1</span> The <code>write.table</code> function</h3>
<p>The function <code>write.table</code> provides a simple interface for writing data to a file. It can be used to write a dataframe or a matrix to a file. For example, let’s load the <code>iris</code> dataframe:</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb343-1" title="1"><span class="kw">data</span>(iris)</a></code></pre></div>
<p>and then write it to a text file:</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb344-1" title="1"><span class="kw">write.table</span>(iris, <span class="dt">file=</span><span class="st">&quot;iris.txt&quot;</span>,</a>
<a class="sourceLine" id="cb344-2" title="2">                    <span class="dt">col.names=</span><span class="ot">TRUE</span>, <span class="dt">row.names=</span><span class="ot">FALSE</span>)</a></code></pre></div>
<p>the above command will store it in the text file <code>iris.txt</code> with the labels for the variables it contains in the first row (<code>col.names=T</code>), but without the numbers associated with each row (<code>row.names=F</code>). The <code>sep</code> option is used to choose the separator for the data, the default is a blank space <code>sep=&quot; &quot;</code>, but you can choose a comma <code>sep=&quot;,&quot;</code> a semicolon <code>sep=&quot;;&quot;</code> or other meaningful separators.</p>
<p>The <code>write.table</code> function can be used to write <code>csv</code> files.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> For example, the following command will write the <code>iris</code> dataset to a <code>CSV</code> file:</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb345-1" title="1"><span class="kw">write.table</span>(iris, <span class="dt">file=</span><span class="st">&quot;iris.csv&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;,&quot;</span>,</a>
<a class="sourceLine" id="cb345-2" title="2">                    <span class="dt">col.names=</span><span class="ot">TRUE</span>, <span class="dt">row.names=</span><span class="ot">FALSE</span>)</a></code></pre></div>
</div>
<div id="saving-objecs-in-binary-format" class="section level3">
<h3><span class="header-section-number">5.2.2</span> Saving objecs in binary format</h3>
<p>Probably the most convenent function to save R objects (dataframes, lists, matricies, etc…) in binary format is <code>saveRDS</code>:</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb346-1" title="1"><span class="kw">saveRDS</span>(iris, <span class="dt">file=</span><span class="st">&quot;iris.rds&quot;</span>)</a></code></pre></div>
<p>the <code>readRDS</code> function can be used to read back the object into R:</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb347-1" title="1">iris_dset =<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;iris.rds&quot;</span>)</a></code></pre></div>
</div>
<div id="cat" class="section level3">
<h3><span class="header-section-number">5.2.3</span> Low-level file output</h3>
<div id="cat-1" class="section level4">
<h4><span class="header-section-number">5.2.3.1</span> <code>cat</code></h4>
<p>A useful low-level function for writing to a file is <code>cat</code>. Suppose you have two vectors, one with the heights of 5 individuals, and one with an identifier for each, and you want to write these data to a file:</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb348-1" title="1">height =<span class="st"> </span><span class="kw">c</span>(<span class="dv">176</span>, <span class="dv">180</span>, <span class="dv">159</span>, <span class="dv">156</span>, <span class="dv">183</span>)</a>
<a class="sourceLine" id="cb348-2" title="2">id =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;s1&quot;</span>, <span class="st">&quot;s2&quot;</span>, <span class="st">&quot;s3&quot;</span>, <span class="st">&quot;s4&quot;</span>, <span class="st">&quot;s5&quot;</span>)</a></code></pre></div>
<p>you can use <code>cat</code> in a <code>for</code> loop to write the data to the file, but let’s first write a header</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb349-1" title="1"><span class="kw">cat</span>(<span class="st">&quot;id height </span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">file=</span><span class="st">&quot;out_dir/cat_ex.txt&quot;</span>, <span class="dt">sep=</span><span class="st">&quot; &quot;</span>, <span class="dt">append=</span><span class="ot">FALSE</span>)</a></code></pre></div>
<p>the first argument is the object to write, in this case a character string with the names of our variables to make a header, and a newline (<code>\n') character to start a new line. Now the</code>for` loop:</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb350-1" title="1"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(id)){</a>
<a class="sourceLine" id="cb350-2" title="2">  <span class="kw">cat</span>(id[i], height[i], <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">file=</span><span class="st">&quot;out_dir/cat_ex.txt&quot;</span>,</a>
<a class="sourceLine" id="cb350-3" title="3">      <span class="dt">sep=</span><span class="st">&quot; &quot;</span>, <span class="dt">append=</span><span class="ot">TRUE</span>)}</a></code></pre></div>
<p>note that this time we’ve set <code>append=TRUE</code> to avoid overwriting both the header, and any previous output from the preceding cycle in the for loop. We’ve been using a blank space as a separator, but we could have used something else, for example a comma (<code>sep=&quot;,&quot;</code>).</p>
<p>While using <code>cat</code> to automatically open and close a file as we did above is convenient, when we need to repeatedly write to the same file it’s more efficient to explicitly open a file connection first, write to it, and then close it as shown below:</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb351-1" title="1">fHandle =<span class="st"> </span><span class="kw">file</span>(<span class="st">&quot;out_dir/test_write.txt&quot;</span>, <span class="st">&quot;w&quot;</span>)</a>
<a class="sourceLine" id="cb351-2" title="2"></a>
<a class="sourceLine" id="cb351-3" title="3"><span class="kw">cat</span>(<span class="st">&quot;id height </span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">file=</span>fHandle, <span class="dt">sep=</span><span class="st">&quot; &quot;</span>)</a>
<a class="sourceLine" id="cb351-4" title="4"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(id)){</a>
<a class="sourceLine" id="cb351-5" title="5">    <span class="kw">cat</span>(id[i], height[i], <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">file=</span>fHandle,</a>
<a class="sourceLine" id="cb351-6" title="6">        <span class="dt">sep=</span><span class="st">&quot; &quot;</span>)</a>
<a class="sourceLine" id="cb351-7" title="7">}</a>
<a class="sourceLine" id="cb351-8" title="8"></a>
<a class="sourceLine" id="cb351-9" title="9"><span class="kw">close</span>(fHandle)</a></code></pre></div>
</div>
<div id="writelines" class="section level4">
<h4><span class="header-section-number">5.2.3.2</span> <code>writeLines</code></h4>
<p>The <code>writeLines</code> function is the complement of the <code>readLines</code> function. In the next example we read-in a file with <code>readLines</code>, modify a line, and write the modified text with <code>writeLines</code> to another file:</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb352-1" title="1">lns =<span class="st"> </span><span class="kw">readLines</span>(<span class="st">&quot;datasets/lorem_ipsum.txt&quot;</span>)</a>
<a class="sourceLine" id="cb352-2" title="2">lns[<span class="dv">1</span>] =<span class="st"> &quot;ipsum lorem&quot;</span></a>
<a class="sourceLine" id="cb352-3" title="3"><span class="kw">writeLines</span>(lns, <span class="st">&quot;out_dir/writeLines_demo_1.txt&quot;</span>)</a></code></pre></div>
<p>The input to <code>writeLines</code> doesn’t need to be a character vector, a single string (even with multiple lines) will be fine too, as shown in the example below:</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb353-1" title="1">txt_lines =<span class="st"> &quot;Some text,</span></a>
<a class="sourceLine" id="cb353-2" title="2"><span class="st">this is line two.</span></a>
<a class="sourceLine" id="cb353-3" title="3"><span class="st">this is line three&quot;</span></a>
<a class="sourceLine" id="cb353-4" title="4"><span class="kw">writeLines</span>(txt_lines, <span class="st">&quot;out_dir/writeLines_demo_2.txt&quot;</span>)</a></code></pre></div>
</div>
<div id="binary-file-output" class="section level4">
<h4><span class="header-section-number">5.2.3.3</span> Binary file output</h4>
<p>Other useful functions include <code>writeChar</code> and <code>writeBin</code>, but note that these are intended for binary-mode file connections.</p>

</div>
</div>
</div>
</div>
<div id="graphics" class="section level1">
<h1><span class="header-section-number">6</span> Graphics</h1>
<p>There are four main plotting libraries that can be used in R. The first is the base graphics system that comes builtin with every R installation and will be described in this chapter. The other three main plotting libraries (<code>ggplot2</code>, <code>lattice</code>, and <code>plotly</code>), can be installed as additional packages. Each of these libraries provides a complete, independent system to generate plots in R.</p>
<p>Choosing one plotting library over the other is mostly a matter of personal preference because nearly any graphic that can be built with one library can also be built with the others. Some graphics are easier to build with one library than another and vice-versa. In recent years <code>ggplot2</code> has gained lots of popularity and <code>lattice</code> is less popular than it used to be. Despite the increasing popularity of <code>ggplot2</code> the base R graphics that are described in this chapter are still widely used. <code>plotly</code> is a recent entry and is somehow a special case because it is primarily designed to generate interactive graphics that can be displayed on html pages, while the other plotting libraries have very limited interactive functionality and are primarily designed to generate static high-quality graphics. <code>plotly</code> is also special because through the <code>ggplotly</code> function it can convert a <code>ggplot2</code> graph into an interactive <code>plotly</code> graphic. Other graphics libraries that are worth mentioning, but will not be described in this guide are <a href="https://cran.r-project.org/web/packages/rgl/index.html"><code>rgl</code></a>, which allows the creation of interactive 3D graphics, and <a href="https://cran.r-project.org/web/packages/vegalite/"><code>vegalite</code></a>, another library designed for the creation of interactive html graphics.</p>
<p>Because the base R graphics library is still widely used and (in my opinion) is somewhat simpler to use for beginners, I would recommend learning it first. The <code>ggplot2</code> library is described in Chapter <a href="#ggplot2">7</a>, the <code>plotly</code> library is described in Chapter <a href="#plotly">8</a>, and the <code>lattice</code> library is described in Chapter <a href="#lattice">9</a>. Chapter <a href="#graphicscommon">10</a> covers some plotting aspects (choosing colors, fonts, and using mathematical expressions in labels) that are common/similar across the different the different R plotting libraries. Chapter <a href="#graphicspublications">11</a> gives tips and advice for preparing figures for academic journal publications, using any of the R graphics libraries. General advice (i.e. not tied to the use of any specific graphics system) on the construction of effective and professional graphics is given in <span class="citation">Wilke (<a href="#ref-Wilke2019">2019</a>)</span>.</p>
<div id="overview-of-r-base-graphics-functions" class="section level2">
<h2><span class="header-section-number">6.1</span> Overview of R base graphics functions</h2>
<p>R base graphics has a number of “high-level” plotting functions. Some of these are listed in Table <a href="#tab:baseplotfuncs">6.1</a>, and will be described in detail in the following sections. Graphics can also be produced using “low-level” plotting functions; these are introduced in Section <a href="#plotfromscratch">6.9</a>.</p>
<table>
<caption><span id="tab:baseplotfuncs">Table 6.1: </span> Some “high-level” plotting functions in the base R graphics system.</caption>
<thead>
<tr class="header">
<th>Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>plot</code></td>
</tr>
<tr class="even">
<td><code>barplot</code></td>
</tr>
<tr class="odd">
<td><code>boxplot</code></td>
</tr>
<tr class="even">
<td><code>histogram</code></td>
</tr>
<tr class="odd">
<td><code>matplot</code></td>
</tr>
<tr class="even">
<td><code>stripchart</code></td>
</tr>
<tr class="odd">
<td><code>interaction.plot</code></td>
</tr>
</tbody>
</table>
</div>
<div id="plot" class="section level2">
<h2><span class="header-section-number">6.2</span> The <code>plot</code> function</h2>
<p>The <code>plot</code> function is most commonly used to draw a scatterplot of two variables, however if given a R object with a plot method as an argument, it will produce different types of graphics depending on the object it is plotting. Let’s look at an example of a scatterplot with some simulated data:</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb354-1" title="1">a =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">5</span>, <span class="fl">1.6</span>, <span class="dt">n=</span><span class="dv">50</span>)</a>
<a class="sourceLine" id="cb354-2" title="2">b =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">15</span>, <span class="fl">4.3</span>, <span class="dt">n=</span><span class="dv">50</span>)</a></code></pre></div>
<p>this creates two vectors of length 50 with values normally distributed, now we can plot the values of vector <code>b</code>, against the values of vector <code>b</code> with:</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb355-1" title="1"><span class="kw">plot</span>(<span class="dt">x=</span>a, <span class="dt">y=</span>b) <span class="co">## or for short plot(a, b)</span></a></code></pre></div>
<div class="figure"><span id="fig:scatterplot"></span>
<img src="06_graphics_files/figure-html/scatterplot-1.png" alt="A scatterplot." width="326.4" />
<p class="caption">
Figure 6.1: A scatterplot.
</p>
</div>
<p>the resulting scatterplot appears in Figure <a href="#fig:scatterplot">6.1</a>.</p>
<p>If we were to plot the change of a variable over time it could be a good idea to connect the values at different time points in the plot with lines, this is easily achieved setting the option <code>type</code>. Below is an example, the result is shown in Figure <a href="#fig:timewlines">6.2</a>.</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb356-1" title="1">ti =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">50</span></a>
<a class="sourceLine" id="cb356-2" title="2">b =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">15</span>, <span class="fl">4.3</span>, <span class="dt">n=</span><span class="dv">50</span>)</a>
<a class="sourceLine" id="cb356-3" title="3"><span class="kw">plot</span>(ti, b, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>)</a></code></pre></div>
<div class="figure"><span id="fig:timewlines"></span>
<img src="06_graphics_files/figure-html/timewlines-1.png" alt="Values connected by lines." width="326.4" />
<p class="caption">
Figure 6.2: Values connected by lines.
</p>
</div>
<p>Some other possible values for the option <code>type</code> are <code>p</code> for points (the default), <code>b</code> for <em>both</em> points and lines, and <code>o</code> for overplotted points and lines (very similar to <code>b</code>).</p>
</div>
<div id="drawing-functions" class="section level2">
<h2><span class="header-section-number">6.3</span> Drawing functions</h2>
<p>The <code>plot</code> function can be used for drawing mathematical functions, for example:</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb357-1" title="1">vec =<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from=</span><span class="dv">0</span>, <span class="dt">to=</span><span class="dv">4</span><span class="op">*</span>pi, <span class="dt">length=</span><span class="dv">120</span>)</a>
<a class="sourceLine" id="cb357-2" title="2"><span class="kw">plot</span>(vec, <span class="kw">sin</span>(vec), <span class="dt">type=</span><span class="st">&quot;l&quot;</span>)</a></code></pre></div>
<div class="figure"><span id="fig:drawfunction"></span>
<img src="06_graphics_files/figure-html/drawfunction-1.png" alt="Drawing a mathematical function." width="326.4" />
<p class="caption">
Figure 6.3: Drawing a mathematical function.
</p>
</div>
<p>in this case we use <code>l</code> for the plot type in order to obtain a continuous line rather than discrete points. It is also possible to plot markers at the points in which the function is actually evaluated. Using the option <code>b</code> for the plot type, both a continuous line and point markers are plotted. There are lots of options to define the appearance of a plot. Many of these options are presented in Section <a href="#par">6.5</a>.</p>
<div id="the-matplot-function" class="section level3">
<h3><span class="header-section-number">6.3.1</span> The <code>matplot</code> function</h3>
<p>The <code>matplot</code> function can be used to plot the columns of a matrix against the columns of another once. The following example plots the sine and cosine functions together using the <code>matplot</code> function, the result is shown in Figure <a href="#fig:sincos">6.4</a></p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb358-1" title="1">a=<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from=</span><span class="dv">0</span>, <span class="dt">to=</span> <span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length=</span><span class="dv">20</span>)</a>
<a class="sourceLine" id="cb358-2" title="2">s =<span class="st"> </span><span class="kw">sin</span>(a)</a>
<a class="sourceLine" id="cb358-3" title="3">c =<span class="st"> </span><span class="kw">cos</span>(a)</a>
<a class="sourceLine" id="cb358-4" title="4">aa =<span class="st"> </span><span class="kw">cbind</span>(a, a) <span class="co">#matrix of hor coord</span></a>
<a class="sourceLine" id="cb358-5" title="5">cs =<span class="st"> </span><span class="kw">cbind</span>(c, s) <span class="co">#matrix of vert coord</span></a>
<a class="sourceLine" id="cb358-6" title="6"><span class="kw">matplot</span>(<span class="dt">x=</span>aa, <span class="dt">y=</span>cs, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>, <span class="dt">lwd=</span><span class="fl">1.8</span>, <span class="dt">ylab=</span><span class="st">&quot;sine and cosine functions&quot;</span>)</a></code></pre></div>
<div class="figure"><span id="fig:sincos"></span>
<img src="06_graphics_files/figure-html/sincos-1.png" alt="Sine and cosine functions with `matplot`." width="326.4" />
<p class="caption">
Figure 6.4: Sine and cosine functions with <code>matplot</code>.
</p>
</div>
</div>
</div>
<div id="common-charts" class="section level2">
<h2><span class="header-section-number">6.4</span> Common charts</h2>
<div id="barplots" class="section level3">
<h3><span class="header-section-number">6.4.1</span> Barplots</h3>
<p>Barplots sometimes come in handy when you want to summarise your data. Suppose we have administered a test to three different groups of people, which we will designate as <code>a</code>, <code>b</code> and <code>c</code>. We want to summarise and compare the performance of each group with a nice graph, a barplot will make it. The data are stored in the file <code>test.txt</code>, in the format shown in Table <a href="#tab:test">6.2</a>.</p>
<table>
<caption><span id="tab:test">Table 6.2: </span> Data for the test example.</caption>
<thead>
<tr class="header">
<th><strong>a</strong></th>
<th><strong>b</strong></th>
<th><strong>c</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>4</td>
<td>6</td>
<td>5</td>
</tr>
<tr class="even">
<td>5</td>
<td>8</td>
<td>3</td>
</tr>
<tr class="odd">
<td>3</td>
<td>7</td>
<td>8</td>
</tr>
<tr class="even">
<td>6</td>
<td>5</td>
<td>4</td>
</tr>
<tr class="odd">
<td>5</td>
<td>9</td>
<td>9</td>
</tr>
<tr class="even">
<td>7</td>
<td>7</td>
<td>8</td>
</tr>
<tr class="odd">
<td>5</td>
<td>6</td>
<td>5</td>
</tr>
<tr class="even">
<td>8</td>
<td>5</td>
<td>7</td>
</tr>
<tr class="odd">
<td>5</td>
<td>8</td>
<td>6</td>
</tr>
<tr class="even">
<td>4</td>
<td>10</td>
<td>4</td>
</tr>
</tbody>
</table>
<p>We can read in the file directly as a dataframe:</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb359-1" title="1">test =<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;datasets/test.txt&quot;</span>, <span class="dt">header=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<p>We want to use the <code>tapply</code> function to get quickly summary tables with the means and standard deviations for the three groups. However the format of the data frame at this point is not suitable for the <code>tapply</code> function, because it has 3 observations for each row, and the <code>tapply</code> function can be used only with the format “one row per observation”, in which we have the values of the observations in one column and a set of “labels” identifying the group to which a given observation belongs to in another column. Fortunately, we can easily change the format of our dataframe with the <code>stack</code> command. What it does is just to create a single “values” vector from the three columns we had previously, and to add automatically another “index” vector with the labels we need:</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb360-1" title="1">test2 =<span class="st"> </span><span class="kw">stack</span>(test)</a></code></pre></div>
<p>we can have a look at the first elements of the new dataframe typing:</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb361-1" title="1"><span class="kw">head</span>(test2, <span class="dt">n=</span><span class="dv">10</span>)</a></code></pre></div>
<pre><code>##    values ind
## 1       4   a
## 2       5   a
## 3       3   a
## 4       6   a
## 5       5   a
## 6       7   a
## 7       5   a
## 8       8   a
## 9       5   a
## 10      4   a</code></pre>
<p>note that the <code>stack</code> function has automatically named the two vectors <code>values</code> and <code>ind</code>, we need to know these names to use the <code>tapply</code> function.</p>
<p>Now we’ll create the two summary tables using the <code>tapply</code> function, one with the means and one with the standard deviations for the three groups:</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb363-1" title="1">test_means =<span class="st"> </span><span class="kw">tapply</span>(<span class="dt">X=</span>test2<span class="op">$</span>values, <span class="dt">IND=</span>test2<span class="op">$</span>ind, <span class="dt">FUN=</span>mean)</a>
<a class="sourceLine" id="cb363-2" title="2">test_sd =<span class="st"> </span><span class="kw">tapply</span>(<span class="dt">X=</span>test2<span class="op">$</span>values, <span class="dt">IND=</span>test2<span class="op">$</span>ind, <span class="dt">FUN=</span>sd)</a></code></pre></div>
<p>Now we can draw a barplot displaying the means for each group:</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb364-1" title="1"><span class="kw">barplot</span>(test_means, <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;darkred&quot;</span>, <span class="st">&quot;salmon2&quot;</span>, <span class="st">&quot;plum4&quot;</span>))</a></code></pre></div>
<div class="figure"><span id="fig:barplot1"></span>
<img src="06_graphics_files/figure-html/barplot1-1.png" alt="A barplot." width="326.4" />
<p class="caption">
Figure 6.5: A barplot.
</p>
</div>
<p>we’ve added colors to the graph using the <code>col</code> option. You can look at the resulting graph in Figure <a href="#fig:barplot1">6.5</a>.</p>
<p>You can control the width of the bars specifying the <code>width</code> option, and setting the range for the x axis with the <code>xlim</code> option, specifying only the width does nothing, you must also set the <code>xlim</code>. You set <code>xlim</code> with a vector of the form <code>xlim = c(from, to)</code>, in which <code>from</code> is the origin and <code>to</code> is the end of the axis. In the example below we will set <code>xlim</code> to go from 0 to 3 and the bars to have a width of 0.5:</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb365-1" title="1"><span class="kw">barplot</span>(test_means,<span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;darkred&quot;</span>, <span class="st">&quot;salmon2&quot;</span>, <span class="st">&quot;plum4&quot;</span>),</a>
<a class="sourceLine" id="cb365-2" title="2">        <span class="dt">xlim =</span> <span class="kw">C</span>(<span class="dv">0</span>,<span class="dv">3</span>), <span class="dt">width=</span><span class="fl">0.5</span>)</a></code></pre></div>
<p>this sets the width of all bars at 0.5, we could specify the width for each single bar instead, by giving to <code>width</code> a vector with the width values for each bar.</p>
<p>You can also control the spacing between the bars with the <code>space</code> option. The default is set to 0.2.</p>
<div id="barplots-with-error-bars" class="section level4">
<h4><span class="header-section-number">6.4.1.1</span> Barplots with error bars</h4>
<p>Now let’s say we want to get the same barplot but with error bars showing the standard deviation for each group. We could achieve this by adding lines to the current graph, but there is a better option: we can use the <code>barplot2</code> function, which comes with the <code>gplots</code> library and provides an easy way of adding error bars to a barplot. So once we have the <code>gplots</code> package installed we first load it:</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb366-1" title="1"><span class="kw">library</span>(gplots)</a></code></pre></div>
<p>and then we can draw our barplot with error bars. To get them, we need to set the option <code>plot.ci=TRUE</code> and then specify the upper and lower bounds of the error bars with the <code>ci.u</code> and <code>ci.l</code> commands. So we first create the values for <code>ci.u</code> and <code>ci.l</code>, so that the error bars represent one standard deviation around the mean. We’ll use the values from the two tables we had created before, with means and standard deviations for the three groups:</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb367-1" title="1">upper =<span class="st"> </span>test_means <span class="op">+</span><span class="st"> </span>(test_sd)</a>
<a class="sourceLine" id="cb367-2" title="2">lower =<span class="st"> </span>test_means <span class="op">-</span><span class="st"> </span>(test_sd)</a></code></pre></div>
<p>Now we can draw our barplot, you can see the result in Figure <a href="#fig:barplotbars">6.6</a>:</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb368-1" title="1"><span class="kw">barplot2</span>(test_means, <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;darkred&quot;</span>, <span class="st">&quot;salmon2&quot;</span>, <span class="st">&quot;plum4&quot;</span>),</a>
<a class="sourceLine" id="cb368-2" title="2">         <span class="dt">plot.ci=</span><span class="ot">TRUE</span>, <span class="dt">ci.u=</span>upper, <span class="dt">ci.l=</span>lower)</a></code></pre></div>
<div class="figure"><span id="fig:barplotbars"></span>
<img src="06_graphics_files/figure-html/barplotbars-1.png" alt="Barplot with error bars." width="326.4" />
<p class="caption">
Figure 6.6: Barplot with error bars.
</p>
</div>
</div>
<div id="barplots-with-stacked-bars-or-with-side-to-side-bars" class="section level4">
<h4><span class="header-section-number">6.4.1.2</span> Barplots with stacked bars or with side-to-side bars</h4>
<p>A barplot can be used to map the values of a variable across two factors. To illustrate this we’ll use the <code>npk</code> dataset, which contains data from a factorial experiment on the effects of N, P, K (nitrogen, phosphate, potassium) on the growth of peas.</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb369-1" title="1"><span class="kw">data</span>(npk)</a>
<a class="sourceLine" id="cb369-2" title="2">npk<span class="op">$</span>P =<span class="st"> </span><span class="kw">factor</span>(npk<span class="op">$</span>P, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;1&quot;</span>), <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;P=0&quot;</span>, <span class="st">&quot;P=1&quot;</span>))</a>
<a class="sourceLine" id="cb369-3" title="3">npk<span class="op">$</span>K =<span class="st"> </span><span class="kw">factor</span>(npk<span class="op">$</span>K, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;1&quot;</span>), <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;K=0&quot;</span>, <span class="st">&quot;K=1&quot;</span>))</a>
<a class="sourceLine" id="cb369-4" title="4"><span class="kw">head</span>(npk)</a></code></pre></div>
<pre><code>##   block N   P   K yield
## 1     1 0 P=1 K=1  49.5
## 2     1 1 P=1 K=0  62.8
## 3     1 0 P=0 K=0  46.8
## 4     1 1 P=0 K=1  57.0
## 5     2 1 P=0 K=0  59.8
## 6     2 1 P=1 K=1  58.5</code></pre>
<p>in the dataset <code>N</code>, <code>P</code>, and <code>K</code> are indicator variables for the application of the respective element (0=no, 1=yes). We renamed the levels of the P and K factors to make legends and strip labels easier to read. We first obtain means and standard deviations as a function of N and P with the <code>tapply</code> function:</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb371-1" title="1">mean_NP =<span class="st"> </span><span class="kw">tapply</span>(npk<span class="op">$</span>yield, <span class="kw">list</span>(npk<span class="op">$</span>P, npk<span class="op">$</span>N), mean)</a>
<a class="sourceLine" id="cb371-2" title="2">sd_NP =<span class="st"> </span><span class="kw">tapply</span>(npk<span class="op">$</span>yield, <span class="kw">list</span>(npk<span class="op">$</span>P, npk<span class="op">$</span>N), sd)</a></code></pre></div>
<p>in this case the resulting means and standard deviations are stored in a matrix instead of a vector. If we pass these values to the <code>barplot2</code> function we obtain a stacked barplot (Figure <a href="#fig:stackedbarplot">6.7</a>):</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb372-1" title="1"><span class="kw">barplot2</span>(mean_NP, <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;gray70&quot;</span>, <span class="st">&quot;indianred&quot;</span>),</a>
<a class="sourceLine" id="cb372-2" title="2">         <span class="dt">xlab=</span><span class="st">&quot;N&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Mean yield&quot;</span>)</a>
<a class="sourceLine" id="cb372-3" title="3"><span class="kw">legend</span>(<span class="dt">x=</span><span class="dv">2</span>, <span class="dt">y=</span><span class="dv">155</span>, <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">&quot;P=0&quot;</span>, <span class="st">&quot;P=1&quot;</span>),</a>
<a class="sourceLine" id="cb372-4" title="4">       <span class="dt">fill=</span><span class="kw">c</span>(<span class="st">&quot;gray70&quot;</span>, <span class="st">&quot;indianred&quot;</span>), <span class="dt">xpd=</span><span class="ot">NA</span>)</a></code></pre></div>
<div class="figure"><span id="fig:stackedbarplot"></span>
<img src="06_graphics_files/figure-html/stackedbarplot-1.png" alt="Stacked barplot." width="326.4" />
<p class="caption">
Figure 6.7: Stacked barplot.
</p>
</div>
<p>we’ve added a legend manually; we could have passed the <code>legend=T</code> argument inside the <code>barplot2</code> function to automatically add a legend instead, but the positioning of the automatic legend leaves often to be desired (see Section <a href="#legend">6.6.1</a> more info on legends). The lower (gray) parts of the bars represent the mean yield without phosphate administration, while the upper (red) parts represent the mean yield with phosphate administration.</p>
<p>The same data can be displayed with a barplot with bars “side to side” (Figure <a href="#fig:barplotsidetoside">6.8</a>). To obtain such a plot we need to set the <code>beside</code> argument to <code>TRUE</code>:</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb373-1" title="1"><span class="kw">barplot2</span>(mean_NP, <span class="dt">plot.ci=</span>T, <span class="dt">ci.l=</span>mean_NP<span class="op">-</span>sd_NP, <span class="dt">ci.u=</span>mean_NP<span class="op">+</span>sd_NP,</a>
<a class="sourceLine" id="cb373-2" title="2">         <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;gray70&quot;</span>, <span class="st">&quot;indianred&quot;</span>), <span class="dt">legend=</span>F, <span class="dt">beside=</span>T,</a>
<a class="sourceLine" id="cb373-3" title="3">         <span class="dt">xlab=</span><span class="st">&quot;N&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Mean yield&quot;</span>)</a>
<a class="sourceLine" id="cb373-4" title="4"><span class="kw">legend</span>(<span class="dt">x=</span><span class="dv">5</span>, <span class="dt">y=</span><span class="dv">85</span>, <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">&quot;P=0&quot;</span>, <span class="st">&quot;P=1&quot;</span>),</a>
<a class="sourceLine" id="cb373-5" title="5">       <span class="dt">fill=</span><span class="kw">c</span>(<span class="st">&quot;gray70&quot;</span>, <span class="st">&quot;indianred&quot;</span>), <span class="dt">xpd=</span><span class="ot">NA</span>)</a></code></pre></div>
<div class="figure"><span id="fig:barplotsidetoside"></span>
<img src="06_graphics_files/figure-html/barplotsidetoside-1.png" alt="Barplot with bars side to side." width="326.4" />
<p class="caption">
Figure 6.8: Barplot with bars side to side.
</p>
</div>
<p>It would be somewhat difficult to add error bars to a stacked barplot, and the <code>barplot2</code> function does not allow it (when <code>beside</code> is set to <code>FALSE</code>, settings <code>plot.ci=TRUE</code> is ignored). It is sensible, instead, to add error bars to the barplot with side to side bars, as we did in the last example.</p>
</div>
</div>
<div id="boxplots" class="section level3">
<h3><span class="header-section-number">6.4.2</span> Boxplots</h3>
<p>Boxplots can be used to visualise the central tendency and the dispersion of the data for a given sample, and to directly compare these same characteristics for different samples. Let’s look at one of them, the data are organised in a dataframe in the file <code>boxplot1.txt</code>. They are the scores for two different groups (group a and group b) in a test. With the boxplot we want to see how the scores are distributed in the two groups. The dataframe contains a column <code>score</code>, with the score for each subject and another column <code>group</code> that defines the group a given observation comes from. So we first read in the dataframe, and then ask for the boxplots with the distribution of scores, as a function of the group they belong to.</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb374-1" title="1">dat =<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;datasets/boxplot1.txt&quot;</span>, <span class="dt">header=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb374-2" title="2"><span class="kw">boxplot</span>(dat<span class="op">$</span>score<span class="op">~</span>dat<span class="op">$</span>group, <span class="dt">names=</span><span class="kw">c</span>(<span class="st">&quot;group a&quot;</span>, <span class="st">&quot;group b&quot;</span>))</a></code></pre></div>
<div class="figure"><span id="fig:boxplot1"></span>
<img src="06_graphics_files/figure-html/boxplot1-1.png" alt="Boxplots comparing the distribution for two groups." width="326.4" />
<p class="caption">
Figure 6.9: Boxplots comparing the distribution for two groups.
</p>
</div>
<p>The results are in Figure <a href="#fig:boxplot1">6.9</a>, the thick black lines in the middle of the boxes represent the median, if this is about the middle of the box, it is consisten with the data having a normal distribution. The two lines that delimit the box are called “hinges”, and they are approximately the first and the third quartiles. The horizontal lines that form the `Ts’ above and below the box are called ``whiskers’’, and inside them are contained all the observations that fall within a distance of 1.5 times the size of the box, upwards or downwards. Points that fall outside this distance are outliers and they are represented as a circle. In our case there are two outliers in group a. Apart from checking if the distribution is normal, you can also check if the variances are approximately equal, by comparing the size of the boxes (the distance between the hinges). If one boxplot is clearly bigger than the other one (for example two times bigger), then the variances for the two groups are likely not to be equal.</p>
</div>
<div id="histograms" class="section level3">
<h3><span class="header-section-number">6.4.3</span> Histograms</h3>
<p>Histograms can be used to visualise the distribution of a sample, the function <code>hist</code>, can be used to plots a histogram of frequencies (counts) of the sample, or of its density function (setting the option <code>freq=F</code>). Let’s first create a sample with a normal distribution, and then plot its histogram, the result is in Figure <a href="#fig:hist">6.10</a>.</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb375-1" title="1">my_distr =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dv">5</span>, <span class="fl">1.7</span>)</a>
<a class="sourceLine" id="cb375-2" title="2"><span class="kw">hist</span>(my_distr)</a></code></pre></div>
<div class="figure"><span id="fig:hist"></span>
<img src="06_graphics_files/figure-html/hist-1.png" alt="Frequency distribution of a random sample." width="326.4" />
<p class="caption">
Figure 6.10: Frequency distribution of a random sample.
</p>
</div>
</div>
<div id="stripcharts" class="section level3">
<h3><span class="header-section-number">6.4.4</span> Stripcharts</h3>
<p>If the groups contain a small number of observations, it might be better to use a stripchart to visualise their distributions. In a stripchart each point represents a single observation. By default they are drawn on a line, so if two observations have the same score, they overlap. To avoid this problem you can give a certain amount of jitter to the plot, so that observations with the same score are scattered a little and can be easily distinguished. Here’s the code for producing a stripchart, the data are in the file <code>stripchart1.txt</code> and they are arranged in the same way as the data in <code>boxplot1.txt</code>, just the sample sizes are smaller, with 6 observations per group.</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb376-1" title="1"><span class="kw">stripchart</span>(dat<span class="op">$</span>score<span class="op">~</span>dat<span class="op">$</span>group, <span class="dt">method=</span><span class="st">&quot;jitter&quot;</span>,</a>
<a class="sourceLine" id="cb376-2" title="2">           <span class="dt">jitter=</span><span class="fl">0.1</span>, <span class="dt">pch=</span><span class="dv">1</span>, <span class="dt">vertical=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<div class="figure"><span id="fig:stripchart1"></span>
<img src="06_graphics_files/figure-html/stripchart1-1.png" alt="Stripchart example." width="326.4" />
<p class="caption">
Figure 6.11: Stripchart example.
</p>
</div>
</div>
<div id="interactionplots" class="section level3">
<h3><span class="header-section-number">6.4.5</span> Interaction Plots</h3>
<p>Interaction plots can be used to visualise the means for the levels of a factor, at the levels of another factor. In a two-way ANOVA design this type of plot would allow you to spot possible interactions between the two factors involved. To illustrate interaction plots we’ll use the built in R dataset <code>ToothGrowth</code>:</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb377-1" title="1"><span class="kw">data</span>(ToothGrowth) <span class="co">#load dataset</span></a>
<a class="sourceLine" id="cb377-2" title="2"><span class="kw">head</span>(ToothGrowth)</a></code></pre></div>
<pre><code>##    len supp dose
## 1  4.2   VC  0.5
## 2 11.5   VC  0.5
## 3  7.3   VC  0.5
## 4  5.8   VC  0.5
## 5  6.4   VC  0.5
## 6 10.0   VC  0.5</code></pre>
<p>that contains measurements of the length of odontoblasts (cells responsible for tooth growth) in 60 guinea pigs. Each guinea pig had received one of three doses of vitamin C (0.5, 1, and 2 mg/day) by one of two delivery methods, orange juice (OJ) or ascorbic acid (VC).</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb379-1" title="1"><span class="kw">interaction.plot</span>(<span class="dt">x.factor=</span>ToothGrowth<span class="op">$</span>supp,</a>
<a class="sourceLine" id="cb379-2" title="2">                 <span class="dt">trace.factor=</span>ToothGrowth<span class="op">$</span>dose,</a>
<a class="sourceLine" id="cb379-3" title="3">                 <span class="dt">response=</span>ToothGrowth<span class="op">$</span>len,</a>
<a class="sourceLine" id="cb379-4" title="4">                 <span class="dt">ylab=</span><span class="st">&quot;Mean growth&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Delivery&quot;</span>,</a>
<a class="sourceLine" id="cb379-5" title="5">                 <span class="dt">trace.label=</span><span class="st">&quot;Dose&quot;</span>)</a></code></pre></div>
<div class="figure"><span id="fig:int"></span>
<img src="06_graphics_files/figure-html/int-1.png" alt="Interaction plot with different line types." width="326.4" />
<p class="caption">
Figure 6.12: Interaction plot with different line types.
</p>
</div>
<p>The first argument is the factor that will be represented on the x axis; the second argument is the <em>trace factor</em>, whose levels will be represented as lines of a different type, or of different colors. The third argument is the response variable. Note that we didn’t pass the mean of the response variable to the function, we passed the raw data and the function computed the mean for us. Optionally we can also set the x and y labels, as done in the example, and the <code>trace.label</code>, that sets the title of the legend. The plot is shown in Figure <a href="#fig:int">6.12</a>. It suggests the presence of an interaction because while at the lower doses OJ results in higher mean growth VC, at the highest dose the mean growth appears similar whichever delivery method is used.</p>
<p>The placement of the legend with <code>interaction.plot</code> is not always ideal. We can fix that by setting the <code>legend</code> argument to <code>FALSE</code>, and supplying a legend manually:</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb380-1" title="1"><span class="kw">par</span>(<span class="dt">oma=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">2.2</span>))</a>
<a class="sourceLine" id="cb380-2" title="2"><span class="kw">interaction.plot</span>(<span class="dt">x.factor=</span>ToothGrowth<span class="op">$</span>supp,</a>
<a class="sourceLine" id="cb380-3" title="3">                 <span class="dt">trace.factor=</span>ToothGrowth<span class="op">$</span>dose,</a>
<a class="sourceLine" id="cb380-4" title="4">                 <span class="dt">response=</span>ToothGrowth<span class="op">$</span>len,</a>
<a class="sourceLine" id="cb380-5" title="5">                 <span class="dt">ylab=</span><span class="st">&quot;Mean growth&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Delivery&quot;</span>,</a>
<a class="sourceLine" id="cb380-6" title="6">                 <span class="dt">trace.label=</span><span class="st">&quot;Dose&quot;</span>, <span class="dt">legend=</span>F)</a>
<a class="sourceLine" id="cb380-7" title="7"><span class="kw">legend</span>(<span class="fl">2.1</span>, <span class="dv">27</span>, <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">&quot;2&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;0.5&quot;</span>), <span class="dt">lty=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),</a>
<a class="sourceLine" id="cb380-8" title="8">       <span class="dt">title=</span><span class="st">&quot;Dose&quot;</span>, <span class="dt">xpd=</span><span class="ot">NA</span>, <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>)</a></code></pre></div>
<div class="figure"><span id="fig:intmanleg"></span>
<img src="06_graphics_files/figure-html/intmanleg-1.png" alt="Interaction plot with manual legend." width="359.04" />
<p class="caption">
Figure 6.13: Interaction plot with manual legend.
</p>
</div>
<p>Note how we also set the <code>oma</code> parameter to add an outer margin on the right side, so as to have enough space to place the legend outside the plot. We also set the <code>xpd</code> graphics parameter to <code>NA</code> so that the legend would not be clipped. Graphics parameters will be explained in Section <a href="#par">6.5</a>.</p>
<p>Another good way to represent the levels for the trace factor, is through the use of symbols and/or colors, in the following graph (see the result in Figure <a href="#fig:intb">6.14</a>) line type <code>lty</code>, symbols <code>pch</code>, and colors are used to differentiate between the levels of the trace factor. In order to get this you need to set the option <code>type</code> to <code>b</code>: that means use both line type and points (symbols); setting this option to <code>l</code> will give just different line types while setting it to <code>p</code>, will give just different symbols. In these examples I specified the line types and the symbols to use, but this is not necessary, if you don’t, R will cycle through different line types and/or symbols as needed to represent all the levels of the trace factor. See Section <a href="#lty">6.5.2</a> for a description of the different line types, and Section <a href="#secpch">6.5.3</a> for a description of the different symbols available in R.</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb381-1" title="1"><span class="kw">par</span>(<span class="dt">oma=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">2.25</span>))</a>
<a class="sourceLine" id="cb381-2" title="2"><span class="kw">interaction.plot</span>(<span class="dt">x.factor=</span>ToothGrowth<span class="op">$</span>supp,</a>
<a class="sourceLine" id="cb381-3" title="3">                 <span class="dt">trace.factor=</span>ToothGrowth<span class="op">$</span>dose,</a>
<a class="sourceLine" id="cb381-4" title="4">                 <span class="dt">response=</span>ToothGrowth<span class="op">$</span>len,</a>
<a class="sourceLine" id="cb381-5" title="5">                 <span class="dt">type=</span><span class="st">&quot;b&quot;</span>, <span class="dt">lty=</span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>), <span class="dt">pch=</span><span class="kw">c</span>(<span class="dv">16</span>,<span class="dv">15</span>,<span class="dv">17</span>),</a>
<a class="sourceLine" id="cb381-6" title="6">                 <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;gray60&quot;</span>, <span class="st">&quot;gray40&quot;</span>, <span class="st">&quot;gray10&quot;</span>),</a>
<a class="sourceLine" id="cb381-7" title="7">                 <span class="dt">ylab=</span><span class="st">&quot;Mean growth&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;Delivery&quot;</span>,</a>
<a class="sourceLine" id="cb381-8" title="8">                 <span class="dt">trace.label=</span><span class="st">&quot;Dose&quot;</span>, <span class="dt">legend=</span>F)</a>
<a class="sourceLine" id="cb381-9" title="9"><span class="kw">legend</span>(<span class="fl">2.2</span>, <span class="dv">27</span>, <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">&quot;2&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;0.5&quot;</span>), <span class="dt">lty=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">pch=</span><span class="kw">c</span>(<span class="dv">17</span>,<span class="dv">15</span>,<span class="dv">16</span>),</a>
<a class="sourceLine" id="cb381-10" title="10">       <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;gray10&quot;</span>, <span class="st">&quot;gray40&quot;</span>, <span class="st">&quot;gray60&quot;</span>),</a>
<a class="sourceLine" id="cb381-11" title="11">       <span class="dt">title=</span><span class="st">&quot;Dose&quot;</span>, <span class="dt">xpd=</span><span class="ot">NA</span>, <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>)</a></code></pre></div>
<div class="figure"><span id="fig:intb"></span>
<img src="06_graphics_files/figure-html/intb-1.png" alt="Interaction plot with different line types and different symbols." width="359.04" />
<p class="caption">
Figure 6.14: Interaction plot with different line types and different symbols.
</p>
</div>
</div>
<div id="stemplot" class="section level3">
<h3><span class="header-section-number">6.4.6</span> Stem (lollipop) plots</h3>
<p>There is no function in base R to generate a stem plot, also known as a “lollipop” plot. However, Matti Pastel <a href="http://mpastell.com/2009/09/11/matlab-style-stem-plot-with-r/">published in his blog</a> the following function to generate one:</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb382-1" title="1">stem =<span class="st"> </span><span class="cf">function</span>(x, y, <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">linecol=</span><span class="dv">1</span>, <span class="dt">clinecol=</span><span class="dv">1</span>, ...){</a>
<a class="sourceLine" id="cb382-2" title="2">    <span class="cf">if</span> (<span class="kw">missing</span>(y)){</a>
<a class="sourceLine" id="cb382-3" title="3">        y =<span class="st"> </span>x</a>
<a class="sourceLine" id="cb382-4" title="4">        x =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(x)</a>
<a class="sourceLine" id="cb382-5" title="5">    }</a>
<a class="sourceLine" id="cb382-6" title="6">    <span class="kw">plot</span>(x, y, <span class="dt">pch=</span>pch, ...)</a>
<a class="sourceLine" id="cb382-7" title="7">    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(x)){</a>
<a class="sourceLine" id="cb382-8" title="8">        <span class="kw">lines</span>(<span class="kw">c</span>(x[i], x[i]), <span class="kw">c</span>(<span class="dv">0</span>,y[i]), <span class="dt">col=</span>linecol)</a>
<a class="sourceLine" id="cb382-9" title="9">    }</a>
<a class="sourceLine" id="cb382-10" title="10">    <span class="kw">lines</span>(<span class="kw">c</span>(x[<span class="dv">1</span>]<span class="op">-</span><span class="dv">2</span>,x[<span class="kw">length</span>(x)]<span class="op">+</span><span class="dv">2</span>), <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="dt">col=</span>clinecol)</a>
<a class="sourceLine" id="cb382-11" title="11">}</a></code></pre></div>
<p>Figure <a href="#fig:stemplot1">6.15</a> shows a stem plot generated with this function using the code below:</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb383-1" title="1">x =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="fl">0.25</span>)</a>
<a class="sourceLine" id="cb383-2" title="2">y =<span class="st"> </span><span class="kw">sin</span>(x)</a>
<a class="sourceLine" id="cb383-3" title="3"><span class="kw">stem</span>(x, y, <span class="dt">xlab=</span><span class="st">&quot;x&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;sin(x)&quot;</span>)</a></code></pre></div>
<div class="figure"><span id="fig:stemplot1"></span>
<img src="06_graphics_files/figure-html/stemplot1-1.png" alt="Stem plot." width="326.4" />
<p class="caption">
Figure 6.15: Stem plot.
</p>
</div>
</div>
</div>
<div id="par" class="section level2">
<h2><span class="header-section-number">6.5</span> Setting graphics parameters</h2>
<p>Graphics parameters allow you to tweak many elements of a plot, such as the font for the labels, the symbols or line types to use and so on, see <code>?par</code> to get a full list and description of these parameters. Graphics parameters can be set and accessed with the function <code>par</code>, called without arguments, as <code>par()</code>, it will give you a full list of the current defaults, if you want to query only one or a few parameters use:</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb384-1" title="1"><span class="kw">par</span>(<span class="st">&quot;lwd&quot;</span>)          <span class="co">## see current line width</span></a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb386-1" title="1"><span class="kw">par</span>(<span class="kw">c</span>(<span class="st">&quot;lwd&quot;</span>,<span class="st">&quot;pch&quot;</span>)) <span class="co">## see lwd and plotting symbols</span></a></code></pre></div>
<pre><code>## $lwd
## [1] 1
## 
## $pch
## [1] 1</code></pre>
<p>to change the value of a parameter you can use:</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb388-1" title="1"><span class="kw">par</span>(<span class="dt">lwd=</span><span class="fl">1.4</span>)       <span class="co">## change line width</span></a>
<a class="sourceLine" id="cb388-2" title="2"><span class="kw">par</span>(<span class="dt">pch=</span><span class="st">&quot;*&quot;</span>,       <span class="co">## change plotting symbol</span></a>
<a class="sourceLine" id="cb388-3" title="3">    <span class="dt">bg =</span><span class="st">&quot;gray80&quot;</span>)  <span class="co">## use a light gray background</span></a></code></pre></div>
<p>Moreover, most plotting functions like <code>plot</code>, and <code>barplot</code>, allow you to set some of the parameters for the current plot as an argument to the function itself, for example in <code>plot</code> you can choose the type of plot (points vs lines) and the plotting symbol as options with <code>type</code> and <code>pch</code>:</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb389-1" title="1">d =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">15</span>,<span class="dv">4</span>,<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb389-2" title="2">e =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">15</span>,<span class="dv">9</span>,<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb389-3" title="3"><span class="kw">plot</span>(d<span class="op">~</span>e, <span class="dt">type=</span><span class="st">&quot;p&quot;</span>, <span class="dt">pch=</span><span class="dv">3</span>)</a></code></pre></div>
<p>The following sections will give a more in depth explanation of some graphics parameters. Before that, however, we’ll have a closer look at how to use <code>par</code>.</p>
<div id="saving-and-restoring-graphics-parameters" class="section level3">
<h3><span class="header-section-number">6.5.1</span> Saving and restoring graphics parameters</h3>
<p>Often you’ll want to change the graphics parameters only for a few plots, and then reset them back to the defaults. The function <code>par</code> when used to change the value of some graphics parameters returns a list with the <em>old</em> values of the graphics parameters that have changed:</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb390-1" title="1"><span class="kw">par</span>(<span class="st">&quot;lwd&quot;</span>, <span class="st">&quot;col&quot;</span>) <span class="co">#these are the default parameters</span></a></code></pre></div>
<pre><code>## $lwd
## [1] 1
## 
## $col
## [1] &quot;black&quot;</code></pre>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb392-1" title="1">oldpar =<span class="st"> </span><span class="kw">par</span>(<span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>) <span class="co">#while changing the parameters</span></a>
<a class="sourceLine" id="cb392-2" title="2">                                <span class="co">#we store the old values in a list</span></a>
<a class="sourceLine" id="cb392-3" title="3">oldpar</a></code></pre></div>
<pre><code>## $lwd
## [1] 1
## 
## $col
## [1] &quot;black&quot;</code></pre>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb394-1" title="1">s =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="fl">.1</span>) </a>
<a class="sourceLine" id="cb394-2" title="2"><span class="kw">plot</span>(s, <span class="kw">sin</span>(s))           <span class="co">#we plot something</span></a></code></pre></div>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb395-1" title="1"><span class="kw">par</span>(oldpar)              <span class="co"># and then we restore the old parameters</span></a></code></pre></div>
<p>note that calling <code>par</code>, opens a graphics device if one is not already open, the changes you do using <code>par</code> apply only to this graphics device, any other new graphic device that you open will have the default graphics parameters.</p>
</div>
<div id="lty" class="section level3">
<h3><span class="header-section-number">6.5.2</span> Line type with the <code>lty</code> parameter</h3>
<p>There are six line types that you can call in R just with names or numbers (actually there are seven, the first one is “blank” or 0 which just draws nothing). These are listed in Table <a href="#tab:lty">6.3</a> and shown in Figure <a href="#fig:lty">6.16</a>. There is a different, more complicated way for setting many more line types, please, consult the manual for further information on that.</p>
<table>
<caption><span id="tab:lty">Table 6.3: </span> The six default line types in R.</caption>
<thead>
<tr class="header">
<th>No.</th>
<th align="left">Name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td align="left">solid</td>
</tr>
<tr class="even">
<td>2</td>
<td align="left">dashed</td>
</tr>
<tr class="odd">
<td>3</td>
<td align="left">dotted</td>
</tr>
<tr class="even">
<td>4</td>
<td align="left">dotdash</td>
</tr>
<tr class="odd">
<td>5</td>
<td align="left">longdash</td>
</tr>
<tr class="even">
<td>6</td>
<td align="left">twodash</td>
</tr>
</tbody>
</table>
<div class="figure"><span id="fig:lty"></span>
<img src="06_graphics_files/figure-html/lty-1.png" alt="The six default line types in R" width="359.04" />
<p class="caption">
Figure 6.16: The six default line types in R
</p>
</div>
</div>
<div id="secpch" class="section level3">
<h3><span class="header-section-number">6.5.3</span> Symbols with the <code>pch</code> parameter</h3>
<p><code>pch</code> is a graphical parameter for changing the way points are plotted in certain graphical functions. This parameter can be set in two ways, the first one is to give a symbol to be plotted as a character, for example</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb396-1" title="1">pch=<span class="st">&quot;+&quot;</span></a>
<a class="sourceLine" id="cb396-2" title="2">pch=<span class="st">&quot;T&quot;</span></a>
<a class="sourceLine" id="cb396-3" title="3">pch=<span class="st">&quot;*&quot;</span></a>
<a class="sourceLine" id="cb396-4" title="4">pch=<span class="st">&quot;3&quot;</span> </a></code></pre></div>
<p>in this case you enclose the character you want to use between quotes, you can’t use more than a single character. The other way to set the <code>pch</code> is to use a number between 0 and 25, which will select one of 26 special symbols available for plotting (see Figure <a href="#fig:pch">6.17</a>), like circles, triangles, and so on:</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb397-1" title="1">pch=<span class="dv">1</span></a>
<a class="sourceLine" id="cb397-2" title="2">pch=<span class="dv">3</span></a>
<a class="sourceLine" id="cb397-3" title="3">pch=<span class="dv">5</span></a></code></pre></div>
<div class="figure"><span id="fig:pch"></span>
<img src="06_graphics_files/figure-html/pch-1.png" alt="Plotting symbols from 0 to 25" width="440.64" />
<p class="caption">
Figure 6.17: Plotting symbols from 0 to 25
</p>
</div>
</div>
<div id="parfonts" class="section level3">
<h3><span class="header-section-number">6.5.4</span> Fonts</h3>
<p>The <code>par</code> interface can be used to set a number of font parameters. One thing to keep in mind is that certain font properties can also be set at the device (X11, pdf, png, etc…) level. Properties set with <code>par</code> after opening the device will override properties set at the device level. Additionally, each device deals with fonts differently, and setting a given font family with <code>par</code> for a given deice (e.g. X11) will not necessarily work for other devices (e.g. pdf). The font parameters that can be set through the <code>par</code> interface are listed in Table <a href="#tab:parfonts">6.4</a></p>
<table>
<caption><span id="tab:parfonts">Table 6.4: </span> Parameters for fonts.</caption>
<thead>
<tr class="header">
<th>Parameter</th>
<th align="left">Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>family</code></td>
<td align="left">font family (e.g. “sans”, “serif”, “mono”)</td>
</tr>
<tr class="even">
<td><code>font</code></td>
<td align="left">font type for text (1=plain, 2=bold, 3=italic, 4=bold italic)</td>
</tr>
<tr class="odd">
<td><code>font.axis</code></td>
<td align="left">font type for axis annotation (1=plain, 2=bold, 3=italic, 4=bolditalic)</td>
</tr>
<tr class="even">
<td><code>font.lab</code></td>
<td align="left">font type for x and y labels (1=plain, 2=bold, 3=italic, 4=bolditalic)</td>
</tr>
<tr class="odd">
<td><code>font.main</code></td>
<td align="left">font type for main titles (1=plain, 2=bold, 3=italic, 4=bolditalic)</td>
</tr>
<tr class="even">
<td><code>font.sub</code></td>
<td align="left">font type for sub titles (1=plain, 2=bold, 3=italic, 4=bolditalic)</td>
</tr>
<tr class="odd">
<td><code>ps</code></td>
<td align="left">point size of text</td>
</tr>
</tbody>
</table>
<p>The various parameters starting with “font” (<code>font</code>, <code>font.axis</code>, <code>font.lab</code>, etc…) do not change the <em>family</em>, they change the <em>style</em> (e.g. plain, bold, italic). These parameters are set via a number; a value of 1 corresponds to a normal (or plain) style, 2 to bold, 3 to italics, 4 to bold italics, and 5 will map the font to a symbol, an usage example is show below (the resulting plot is shown in Figure <a href="#fig:chfontstyle">6.18</a>):</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb398-1" title="1">x =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="fl">0.1</span>)</a>
<a class="sourceLine" id="cb398-2" title="2">y =<span class="st"> </span><span class="kw">sin</span>(x)</a>
<a class="sourceLine" id="cb398-3" title="3"><span class="kw">par</span>(<span class="dt">font=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb398-4" title="4"><span class="kw">plot</span>(x, y, <span class="dt">xlab=</span><span class="st">&quot;x-axis label&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;y-axis label&quot;</span>, <span class="dt">main=</span><span class="st">&quot;Sin(x)&quot;</span>, <span class="dt">type=</span><span class="st">&quot;b&quot;</span>)</a>
<a class="sourceLine" id="cb398-5" title="5"><span class="kw">text</span>(<span class="fl">1.5</span>, <span class="fl">-0.5</span>, <span class="st">&quot;Some text </span><span class="ch">\n</span><span class="st">in italics&quot;</span>)</a></code></pre></div>
<div class="figure"><span id="fig:chfontstyle"></span>
<img src="06_graphics_files/figure-html/chfontstyle-1.png" alt="Changing font style." width="326.4" />
<p class="caption">
Figure 6.18: Changing font style.
</p>
</div>
<p>Note that setting <code>font</code> only changes the font style of plotted text. If you want to change the font style of other textual elements such as the axis labels or the plot title you have to set the corresponding graphics parameters, as shown in the example below (the resulting plot is shown in Figure <a href="#fig:chfontstyle2">6.19</a>):</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb399-1" title="1"><span class="kw">par</span>(<span class="dt">font=</span><span class="dv">3</span>, <span class="dt">font.axis=</span><span class="dv">3</span>, <span class="dt">font.lab=</span><span class="dv">3</span>, <span class="dt">font.main=</span><span class="dv">4</span>, <span class="dt">font.sub=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb399-2" title="2"><span class="kw">plot</span>(x, y, <span class="dt">xlab=</span><span class="st">&quot;x-axis label&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;y-axis label&quot;</span>,</a>
<a class="sourceLine" id="cb399-3" title="3">     <span class="dt">main=</span><span class="st">&quot;Sin(x)&quot;</span>, <span class="dt">sub=</span><span class="st">&quot;subtitle&quot;</span>, <span class="dt">type=</span><span class="st">&quot;b&quot;</span>)</a>
<a class="sourceLine" id="cb399-4" title="4"><span class="kw">text</span>(<span class="fl">1.5</span>, <span class="fl">-0.5</span>, <span class="st">&quot;Some text </span><span class="ch">\n</span><span class="st">in italics&quot;</span>)</a></code></pre></div>
<div class="figure"><span id="fig:chfontstyle2"></span>
<img src="06_graphics_files/figure-html/chfontstyle2-1.png" alt="Changing font style for other textual elements." width="326.4" />
<p class="caption">
Figure 6.19: Changing font style for other textual elements.
</p>
</div>
<p>The <code>ps</code> parameters sets the <em>base</em> point size of the font; the final pointsize is scaled by the <code>cex</code> parameter (i.e. text size = <code>ps</code>*<code>cex</code>), so if <code>cex</code> is different than 1, the final pointsize will not be equal to <code>ps</code>. Note that <code>ps</code> changes only the size of the text font:</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb400-1" title="1">x =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="fl">0.1</span>)</a>
<a class="sourceLine" id="cb400-2" title="2">y =<span class="st"> </span><span class="kw">sin</span>(x)</a>
<a class="sourceLine" id="cb400-3" title="3"><span class="kw">pdf</span>(<span class="dt">file=</span><span class="st">&quot;test_plot.pdf&quot;</span>, <span class="dt">pointsize=</span><span class="dv">12</span>)</a>
<a class="sourceLine" id="cb400-4" title="4"><span class="kw">plot</span>(x, y, <span class="dt">xlab=</span><span class="st">&quot;x-axis label&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;y-axis label&quot;</span>, <span class="dt">main=</span><span class="st">&quot;Sin(x)&quot;</span>, <span class="dt">type=</span><span class="st">&quot;b&quot;</span>)</a>
<a class="sourceLine" id="cb400-5" title="5"><span class="kw">dev.off</span>()</a></code></pre></div>
<p>while setting the <code>pointsize</code> when opening certain graphics devices, such as the <code>pdf</code> device, changes the size of both the font and the plotting symbols:</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb401-1" title="1">x =<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span><span class="op">*</span>pi, <span class="fl">0.1</span>)</a>
<a class="sourceLine" id="cb401-2" title="2">y =<span class="st"> </span><span class="kw">sin</span>(x)</a>
<a class="sourceLine" id="cb401-3" title="3"><span class="kw">pdf</span>(<span class="dt">file=</span><span class="st">&quot;test_plot.pdf&quot;</span>, <span class="dt">pointsize=</span><span class="dv">24</span>)</a>
<a class="sourceLine" id="cb401-4" title="4"><span class="kw">plot</span>(x, y, <span class="dt">xlab=</span><span class="st">&quot;x-axis label&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;y-axis label&quot;</span>, <span class="dt">main=</span><span class="st">&quot;Sin(x)&quot;</span>, <span class="dt">type=</span><span class="st">&quot;b&quot;</span>)</a>
<a class="sourceLine" id="cb401-5" title="5"><span class="kw">dev.off</span>()</a></code></pre></div>
<p>The documentation for the graphics parameter <code>ps</code> also says that “unlike the pointsize argument of most devices, this does not change the relationship between <code>mar</code> and <code>mai</code> (nor <code>oma</code> and <code>omi</code>).”. I’m not sure what this means, but just be aware setting <code>ps</code> with a call to <code>par</code> or setting <code>pointsize</code> when opening a graphics device are not equivalent. Also, keep in mind that if you set the font size when you open a graphics device, the setting may be overridden by subsequent calls to <code>par</code>:</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb402-1" title="1"><span class="kw">pdf</span>(<span class="dt">file=</span><span class="st">&quot;test_plot.pdf&quot;</span>, <span class="dt">pointsize=</span><span class="dv">12</span>) <span class="co">#set font and symbol size in `pdf` call</span></a>
<a class="sourceLine" id="cb402-2" title="2"><span class="kw">par</span>(<span class="dt">ps=</span><span class="dv">24</span>) <span class="co">#override the `pointsize` setting for font</span></a>
<a class="sourceLine" id="cb402-3" title="3">           <span class="co">#(but not plotting symbols)</span></a>
<a class="sourceLine" id="cb402-4" title="4"><span class="kw">plot</span>(x, y, <span class="dt">xlab=</span><span class="st">&quot;x-axis label&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;y-axis label&quot;</span>, <span class="dt">main=</span><span class="st">&quot;Sin(x)&quot;</span>, <span class="dt">type=</span><span class="st">&quot;b&quot;</span>)</a>
<a class="sourceLine" id="cb402-5" title="5"><span class="kw">dev.off</span>()</a></code></pre></div>
<p><code>cex</code> also overrides the graphics device settings:</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb403-1" title="1"><span class="kw">pdf</span>(<span class="dt">file=</span><span class="st">&quot;test_plot.pdf&quot;</span>, <span class="dt">pointsize=</span><span class="dv">24</span>) <span class="co">#set font and symbol size</span></a>
<a class="sourceLine" id="cb403-2" title="2">                                        <span class="co">#in `pdf` call to 24</span></a>
<a class="sourceLine" id="cb403-3" title="3"><span class="kw">par</span>(<span class="dt">cex=</span><span class="fl">0.5</span>) <span class="co">#scale the `pointsize` by half, so now it is 12</span></a>
<a class="sourceLine" id="cb403-4" title="4"><span class="kw">plot</span>(x, y, <span class="dt">xlab=</span><span class="st">&quot;x-axis label&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;y-axis label&quot;</span>, <span class="dt">main=</span><span class="st">&quot;Sin(x)&quot;</span>, <span class="dt">type=</span><span class="st">&quot;b&quot;</span>)</a>
<a class="sourceLine" id="cb403-5" title="5"><span class="kw">dev.off</span>()</a></code></pre></div>
<p>The <code>par</code> setting <code>family</code> can be used to choose a <code>serif</code>, <code>sans</code>, or <code>mono</code> font. The following example shows how to make a plot (displayed in Figure <a href="#fig:figuremono">6.20</a>), with a <code>mono</code> family font:</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb404-1" title="1"><span class="kw">par</span>(<span class="dt">family=</span><span class="st">&quot;mono&quot;</span>)</a>
<a class="sourceLine" id="cb404-2" title="2"><span class="kw">plot</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">main=</span><span class="st">&quot;Mono font&quot;</span>)</a></code></pre></div>
<div class="figure"><span id="fig:figuremono"></span>
<img src="06_graphics_files/figure-html/figuremono-1.png" alt="Changing font family." width="326.4" />
<p class="caption">
Figure 6.20: Changing font family.
</p>
</div>
<p>Note that <code>serif</code>, <code>sans</code>, or <code>mono</code> are generic font families. The actual font family (e.g. Helvetica, Arial, Times New Roman, etc…) that gets used depends on a mapping, which is different between graphics devices, between these generic names and an actual system font. It is possible to directly specify a system font when calling <code>par</code>. Figure <a href="#fig:figurepalatino">6.21</a> shows a plot with the Palatino font set through <code>par</code>:</p>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb405-1" title="1"><span class="kw">plot.new</span>(); <span class="kw">plot.window</span>(<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">10</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb405-2" title="2"><span class="kw">par</span>(<span class="dt">family=</span><span class="st">&quot;Palatino&quot;</span>)</a>
<a class="sourceLine" id="cb405-3" title="3"><span class="kw">plot</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</a></code></pre></div>
<div class="figure"><span id="fig:figurepalatino"></span>
<img src="06_graphics_files/figure-html/figurepalatino-1.png" alt="Plot with Palatino font." width="326.4" />
<p class="caption">
Figure 6.21: Plot with Palatino font.
</p>
</div>
<p>however, this may or may not work depending on 1) whether the font is actually installed on your system 2) the graphics device (not all graphics devices have access to all installed system fonts). More information on how to use system fonts is available in Chapter <a href="#fonts">10.3</a>.</p>
<div class="rmdwarning">
<p>
Not all graphics devices have access to all installed system fonts. For workarounds see Chapter <span class="citation">(<span class="citeproc-not-found" data-reference-id="ref"><strong>???</strong></span>)</span>(fonts).
</p>
</div>
</div>
<div id="parcolors" class="section level3">
<h3><span class="header-section-number">6.5.5</span> Colors</h3>
<p>Table <a href="#tab:parcolors">6.5</a> lists a number of color parameters that can be set through the <code>par</code> interface. See Section <a href="#colorscommon">10.1</a> for indications on how to speficy colors in R.</p>
<table>
<caption><span id="tab:parcolors">Table 6.5: </span> Color parameters that can be set through the <code>par</code> interface.</caption>
<thead>
<tr class="header">
<th align="left">Parameter</th>
<th align="center">Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>col</code></td>
<td align="center">plotting color</td>
</tr>
<tr class="even">
<td align="left"><code>col.axis</code></td>
<td align="center">color for axis annotation</td>
</tr>
<tr class="odd">
<td align="left"><code>col.lab</code></td>
<td align="center">color for x and y labels</td>
</tr>
<tr class="even">
<td align="left"><code>col.main</code></td>
<td align="center">color for main title</td>
</tr>
<tr class="odd">
<td align="left"><code>col.sub</code></td>
<td align="center">color for sub-titles</td>
</tr>
<tr class="even">
<td align="left"><code>bg</code></td>
<td align="center">background color</td>
</tr>
<tr class="odd">
<td align="left"><code>fg</code></td>
<td align="center">foreground color</td>
</tr>
</tbody>
</table>

</div>
</div>
<div id="adding-elements-to-a-plot" class="section level2">
<h2><span class="header-section-number">6.6</span> Adding elements to a plot</h2>
<div id="legend" class="section level3">
<h3><span class="header-section-number">6.6.1</span> Adding a legend</h3>
<p>Some plotting functions (e.g. <code>interaction.plot</code>) by default add a legend to the graph, or allow you to add a legend by setting an option inside the function (e.g. <code>barplot</code>). However, the default settings for the legend, such as positioning, text or symbols, might not be suitable for your graph, in which case you need to turn off the default legend, and add a customised legend with the <code>legend</code> function. You may also need the <code>legend</code> function if the plotting function that you’re using does not automatically add a legend, or if you’re plotting from scratch. Figure <a href="#fig:irislegend1">6.22</a> shows a plot with a legend for the different plotting symbols:</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb406-1" title="1"><span class="kw">data</span>(iris)</a>
<a class="sourceLine" id="cb406-2" title="2">d_set =<span class="st"> </span>iris[iris<span class="op">$</span>Species<span class="op">==</span><span class="st">&quot;setosa&quot;</span>,]</a>
<a class="sourceLine" id="cb406-3" title="3">d_ver =<span class="st"> </span>iris[iris<span class="op">$</span>Species<span class="op">==</span><span class="st">&quot;versicolor&quot;</span>,]</a>
<a class="sourceLine" id="cb406-4" title="4">d_vir =<span class="st"> </span>iris[iris<span class="op">$</span>Species<span class="op">==</span><span class="st">&quot;virginica&quot;</span>,]</a>
<a class="sourceLine" id="cb406-5" title="5">ylim =<span class="st"> </span><span class="kw">c</span>(<span class="kw">min</span>(iris<span class="op">$</span>Sepal.Length), <span class="kw">max</span>(iris<span class="op">$</span>Sepal.Length))</a>
<a class="sourceLine" id="cb406-6" title="6">xlim =<span class="st"> </span><span class="kw">c</span>(<span class="kw">min</span>(iris<span class="op">$</span>Petal.Length), <span class="kw">max</span>(iris<span class="op">$</span>Petal.Length))</a>
<a class="sourceLine" id="cb406-7" title="7"><span class="kw">plot</span>(d_set<span class="op">$</span>Petal.Length, d_set<span class="op">$</span>Sepal.Length, <span class="dt">xlim=</span>xlim, <span class="dt">ylim=</span>ylim, <span class="dt">pch=</span><span class="dv">15</span>,</a>
<a class="sourceLine" id="cb406-8" title="8">     <span class="dt">xlab=</span><span class="st">&quot;Petal Length&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Sepal Length&quot;</span>)</a>
<a class="sourceLine" id="cb406-9" title="9"><span class="kw">points</span>(d_ver<span class="op">$</span>Petal.Length, d_ver<span class="op">$</span>Sepal.Length, <span class="dt">pch=</span><span class="dv">16</span>)</a>
<a class="sourceLine" id="cb406-10" title="10"><span class="kw">points</span>(d_vir<span class="op">$</span>Petal.Length, d_vir<span class="op">$</span>Sepal.Length, <span class="dt">pch=</span><span class="dv">17</span>)</a>
<a class="sourceLine" id="cb406-11" title="11"><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">&quot;Setosa&quot;</span>, <span class="st">&quot;Versicolor&quot;</span>, <span class="st">&quot;Virginica&quot;</span>),</a>
<a class="sourceLine" id="cb406-12" title="12">       <span class="dt">pch=</span><span class="kw">c</span>(<span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">17</span>))</a></code></pre></div>
<div class="figure"><span id="fig:irislegend1"></span>
<img src="06_graphics_files/figure-html/irislegend1-1.png" alt="Plot with legend for plotting symbols." width="326.4" />
<p class="caption">
Figure 6.22: Plot with legend for plotting symbols.
</p>
</div>
<p>The last two lines of code add the legend. The first argument given to the <code>legend</code> function, <code>topright</code>, indicates the position where we want the legend to appear, other possible values are <code>bottomright</code>, <code>bottomleft</code>, <code>right</code>, <code>bottom</code>, <code>center</code> and so on. It is also possible to specify the position of the legend by giving the coordinates of its top-left corner, for the above example we might have written:</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb407-1" title="1"><span class="kw">legend</span>(<span class="dt">x=</span><span class="fl">2.5</span>, <span class="dt">y=</span><span class="dv">7</span>, <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">&quot;Setosa&quot;</span>, <span class="st">&quot;Versicolor&quot;</span>, <span class="st">&quot;Virginica&quot;</span>),</a>
<a class="sourceLine" id="cb407-2" title="2">       <span class="dt">pch=</span><span class="kw">c</span>(<span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">17</span>))</a></code></pre></div>
<p>The text of the legend is passed as a character vector, each element of the vector represents one item of the legend. The next argument, <code>pch</code> indicates that we want each element to represent different plotting symbols, and specifies the plotting symbols to use (15, 16, and 17).</p>
<p>If you do not want a box around the legend, you can set the <code>bty</code> argument to <code>n</code> (default setting is <code>o</code>, which adds the box). If you choose to enclose the legend into a box, you can set its background color through the <code>bg</code> argument.</p>
<p>Sometimes we can encode groupings by more than one dimension. Figure <a href="#fig:irislegend2">6.23</a> shows the data plotted previously with iris species differentiated by both plotting symbols and colors:</p>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb408-1" title="1"><span class="kw">library</span>(RColorBrewer)</a>
<a class="sourceLine" id="cb408-2" title="2">pal =<span class="st"> </span><span class="kw">brewer.pal</span>(<span class="dv">3</span>, <span class="st">&quot;Pastel1&quot;</span>)</a>
<a class="sourceLine" id="cb408-3" title="3"><span class="kw">plot</span>(d_set<span class="op">$</span>Petal.Length, d_set<span class="op">$</span>Sepal.Length, <span class="dt">xlim=</span>xlim, <span class="dt">ylim=</span>ylim, <span class="dt">pch=</span><span class="dv">15</span>,</a>
<a class="sourceLine" id="cb408-4" title="4">     <span class="dt">xlab=</span><span class="st">&quot;Petal Length&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Sepal Length&quot;</span>, <span class="dt">col=</span>pal[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb408-5" title="5"><span class="kw">points</span>(d_ver<span class="op">$</span>Petal.Length, d_ver<span class="op">$</span>Sepal.Length, <span class="dt">pch=</span><span class="dv">16</span>, <span class="dt">col=</span>pal[<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb408-6" title="6"><span class="kw">points</span>(d_vir<span class="op">$</span>Petal.Length, d_vir<span class="op">$</span>Sepal.Length, <span class="dt">pch=</span><span class="dv">17</span>, <span class="dt">col=</span>pal[<span class="dv">3</span>])</a>
<a class="sourceLine" id="cb408-7" title="7"><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">&quot;Setosa&quot;</span>, <span class="st">&quot;Versicolor&quot;</span>, <span class="st">&quot;Virginica&quot;</span>),</a>
<a class="sourceLine" id="cb408-8" title="8">       <span class="dt">pch=</span><span class="kw">c</span>(<span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">17</span>), <span class="dt">col=</span>pal)</a></code></pre></div>
<div class="figure"><span id="fig:irislegend2"></span>
<img src="06_graphics_files/figure-html/irislegend2-1.png" alt="Plot with legend for plotting symbols and colors." width="326.4" />
<p class="caption">
Figure 6.23: Plot with legend for plotting symbols and colors.
</p>
</div>
<p>the only difference with the previous legend is that now we pass an additional argument, <code>col</code> to indicate that we want each element to represent different colors, and specifies the colors to use (those in the <code>pal</code> vector).</p>
<p>We’ve already seen an example of a complex legend specifying different plotting symbols, line types, and colors for its elements in Section <a href="#interactionplots">6.4.5</a>.</p>
<p>Figure <a href="#fig:barplotlegend">6.24</a> shows an example of a legend for a barplot. In this case the legend was positioned outside the plot. Note how we set the <code>xpd</code> argument to <code>NA</code> to avoid the legend being clipped inside the plotting area. Depending on the size and placement of the legend we may also need to enlarge either the margings (<code>mar</code>) or the outer margins (<code>oma</code>) to leave enough room for the legend. An example where this was needed was given in Section <a href="#interactionplots">6.4.5</a>; for an overwiew of plotting regions and margins see Section <a href="#grdevregions">6.8</a>. Finally, note how we set the <code>ncol</code> argument to indicate that the legend should have 4 columns:</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb409-1" title="1"><span class="kw">data</span>(HairEyeColor)</a>
<a class="sourceLine" id="cb409-2" title="2"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb409-3" title="3"><span class="kw">barplot2</span>(HairEyeColor[,,<span class="st">&quot;Male&quot;</span>], <span class="dt">beside=</span>T, <span class="dt">xlab=</span><span class="st">&quot;Eye color&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;# cases&quot;</span>,</a>
<a class="sourceLine" id="cb409-4" title="4">         <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;brown&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;gold&quot;</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">72</span>), <span class="dt">las=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb409-5" title="5"><span class="kw">title</span>(<span class="dt">main=</span><span class="st">&quot;Males&quot;</span>, <span class="dt">line=</span><span class="op">-</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb409-6" title="6"><span class="kw">box</span>()</a>
<a class="sourceLine" id="cb409-7" title="7"><span class="kw">legend</span>(<span class="dv">8</span>, <span class="dv">90</span>, <span class="dt">legend=</span><span class="kw">c</span>(<span class="st">&quot;Black&quot;</span>, <span class="st">&quot;Brown&quot;</span>, <span class="st">&quot;Red&quot;</span>, <span class="st">&quot;Blond&quot;</span>),</a>
<a class="sourceLine" id="cb409-8" title="8">       <span class="dt">fill=</span><span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;brown&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;gold&quot;</span>),</a>
<a class="sourceLine" id="cb409-9" title="9">       <span class="dt">title=</span><span class="st">&quot;Hair color&quot;</span>, <span class="dt">ncol=</span><span class="dv">4</span>, <span class="dt">xpd=</span><span class="ot">NA</span>, <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>)</a>
<a class="sourceLine" id="cb409-10" title="10"></a>
<a class="sourceLine" id="cb409-11" title="11"><span class="kw">barplot2</span>(HairEyeColor[,,<span class="st">&quot;Female&quot;</span>], <span class="dt">beside=</span>T, <span class="dt">xlab=</span><span class="st">&quot;Eye color&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;# cases&quot;</span>,</a>
<a class="sourceLine" id="cb409-12" title="12">         <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;brown&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;gold&quot;</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">72</span>), <span class="dt">las=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb409-13" title="13"><span class="kw">title</span>(<span class="dt">main=</span><span class="st">&quot;Females&quot;</span>, <span class="dt">line=</span><span class="op">-</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb409-14" title="14"></a>
<a class="sourceLine" id="cb409-15" title="15"><span class="kw">box</span>()</a></code></pre></div>
<div class="figure"><span id="fig:barplotlegend"></span>
<img src="06_graphics_files/figure-html/barplotlegend-1.png" alt="Barplot with a legend outside the plot." width="652.8" />
<p class="caption">
Figure 6.24: Barplot with a legend outside the plot.
</p>
</div>
</div>
<div id="adding-text" class="section level3">
<h3><span class="header-section-number">6.6.2</span> Adding text</h3>
<p>You can insert text in a graph with the <code>text</code> function, you have just to specify the x and y coordinates of the point on which to center the text:</p>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb410-1" title="1"><span class="kw">plot</span>(x, y)</a>
<a class="sourceLine" id="cb410-2" title="2"><span class="kw">text</span>(<span class="dt">x=</span><span class="dv">3</span>, <span class="dt">y=</span><span class="fl">1.5</span>, <span class="st">&quot;mean for control group&quot;</span>)</a></code></pre></div>
<p>if you want to use mathematical symbols you can use the <code>expression</code> function:</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb411-1" title="1"><span class="kw">text</span>(<span class="dt">x=</span><span class="dv">3</span>, <span class="dt">y=</span><span class="fl">1.5</span>, <span class="kw">expression</span>(alpha))</a></code></pre></div>
<p>more details on how to use mathematical symbols are given in Section <a href="#plotmath">10.2</a> .</p>
</div>
<div id="addgrid" class="section level3">
<h3><span class="header-section-number">6.6.3</span> Adding a grid</h3>
<p>A grid can be easily added to an existing plot with the function <code>grid</code></p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb412-1" title="1">s =<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from=</span><span class="dv">0</span>, <span class="dt">to=</span><span class="dv">2</span><span class="op">*</span>pi, <span class="dt">length=</span><span class="dv">100</span>)</a>
<a class="sourceLine" id="cb412-2" title="2"><span class="kw">plot</span>(s, <span class="kw">sin</span>(s))</a>
<a class="sourceLine" id="cb412-3" title="3"><span class="kw">plot</span>(s, <span class="kw">sin</span>(s), <span class="dt">type=</span><span class="st">&quot;l&quot;</span>)</a>
<a class="sourceLine" id="cb412-4" title="4"><span class="kw">grid</span>() <span class="co">##add the grid</span></a></code></pre></div>
<p>The default color for the grid is lightgray, you can choose another color setting the <code>col</code> option:</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb413-1" title="1"><span class="kw">grid</span>(<span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</a></code></pre></div>
</div>
<div id="axes" class="section level3">
<h3><span class="header-section-number">6.6.4</span> Setting the axes</h3>
<p>If you don’t like the way the axes are set for a given plot, you can draw the plot without them first, and then add customised axes with the `axis+ function. There are several ways to get rid of the default axes on a plot:</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb414-1" title="1"><span class="kw">plot</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">axes=</span><span class="ot">FALSE</span>) <span class="co">#do not draw any axes or box around</span></a>
<a class="sourceLine" id="cb414-2" title="2">                       <span class="co"># the plot</span></a>
<a class="sourceLine" id="cb414-3" title="3"><span class="kw">plot</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">xaxt=</span><span class="st">&quot;n&quot;</span>)   <span class="co">#don&#39;t draw the x axis </span></a>
<a class="sourceLine" id="cb414-4" title="4"><span class="kw">plot</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">yaxt=</span><span class="st">&quot;n&quot;</span>)   <span class="co">#don&#39;t draw the y axis </span></a></code></pre></div>
<p>Once you’ve removed of one or more axes you can draw them calling the <code>axis</code> function:</p>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb415-1" title="1"><span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at=</span><span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">3</span>), <span class="dt">labels=</span><span class="kw">as.character</span>(<span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">3</span>)))</a></code></pre></div>
<p>the first argument specifies the side on which the axis should be drawn, 1 means the bottom axis, 2 the left axis, 3 the top axis, and 4 the right axis. See <code>?axis</code> for other arguments to the function.</p>
</div>
</div>
<div id="glayout" class="section level2">
<h2><span class="header-section-number">6.7</span> Creating layouts for multiple graphs</h2>
<div id="mfrowmfcol" class="section level3">
<h3><span class="header-section-number">6.7.1</span> <code>mfrow</code> and <code>mfcol</code></h3>
<p>The parameters <code>mfrow</code> and <code>mfcol</code> allow you to divide the graphics device you’re using (e.g. <code>X11</code> or <code>pdf</code>) into multiple boxes, each box will contain a new figure. These parameters are set giving a vector of the form:</p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb416-1" title="1"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(n_rows, n_columns))</a></code></pre></div>
<p>where <code>n_rows</code> is the number of rows and <code>n_columns</code> is the number of columns you want for your layout. For example, the following will create a layout with 2 rows and 3 columns as you can see in Figure <a href="#fig:mfrow23">6.25</a>:</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb417-1" title="1"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">3</span>))</a>
<a class="sourceLine" id="cb417-2" title="2">symb =<span class="st"> </span><span class="kw">as.character</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>)</a>
<a class="sourceLine" id="cb417-3" title="3"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>){</a>
<a class="sourceLine" id="cb417-4" title="4">    <span class="kw">plot</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dt">pch=</span>symb[i], <span class="dt">xlab=</span><span class="st">&quot;&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb417-5" title="5">} </a></code></pre></div>
<div class="figure"><span id="fig:mfrow23"></span>
<img src="06_graphics_files/figure-html/mfrow23-1.png" alt="A 2x3 Layout with `mfrow`" width="326.4" />
<p class="caption">
Figure 6.25: A 2x3 Layout with <code>mfrow</code>
</p>
</div>
<p><code>mfcol</code> works exactly the same way as <code>mfrow</code>, but the figures are drawn in sequence by column rather than by row, for example the following code yields Figure <a href="#fig:mfcol23">6.26</a></p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb418-1" title="1"><span class="kw">par</span>(<span class="dt">mfcol=</span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb418-2" title="2">symb&lt;-<span class="kw">as.character</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>)</a>
<a class="sourceLine" id="cb418-3" title="3"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>){</a>
<a class="sourceLine" id="cb418-4" title="4">  <span class="kw">plot</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dt">pch=</span>symb[i], <span class="dt">xlab=</span><span class="st">&#39;&#39;</span>, <span class="dt">ylab=</span><span class="st">&#39;&#39;</span>)</a>
<a class="sourceLine" id="cb418-5" title="5">} </a></code></pre></div>
<div class="figure"><span id="fig:mfcol23"></span>
<img src="06_graphics_files/figure-html/mfcol23-1.png" alt="A 2x3 Layout with `mfcol`" width="326.4" />
<p class="caption">
Figure 6.26: A 2x3 Layout with <code>mfcol</code>
</p>
</div>
<p>of course you can get other layouts, try:</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb419-1" title="1"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>)) <span class="co">## 4 boxes</span></a>
<a class="sourceLine" id="cb419-2" title="2"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)) <span class="co">## one row, 3 cols</span></a></code></pre></div>
<p>Rather than having the figures drawn sequentially, following the order determined by <code>mfrow</code> or <code>mfcol</code>, it is possible to specify directly the position for the next figure using the <code>mfg</code> parameter. The next example will draw the plot in the slot defined by the crossing between the second row and the first column of a 2x2 layout:</p>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb420-1" title="1"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>)) <span class="co">##create 2x2 layout</span></a>
<a class="sourceLine" id="cb420-2" title="2"><span class="kw">par</span>(<span class="dt">mfg=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>))   <span class="co">##set next fig at 2dn row, 1st col</span></a>
<a class="sourceLine" id="cb420-3" title="3"><span class="kw">plot</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>, <span class="kw">sin</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>))</a></code></pre></div>
</div>
<div id="layout" class="section level3">
<h3><span class="header-section-number">6.7.2</span> <code>layout</code></h3>
<p>A more flexible way to divide a graphics device into multiple plotting regions is given by the <code>layout</code> function. With the <code>layout</code> function, the graphics device is divided into a matrix of <em>n_rows x n_cols</em> sub-regions, and each figure is assigned to one or more of these sub-regions. Let’s look at an example:</p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb421-1" title="1">m =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>), <span class="dt">nrow=</span><span class="dv">2</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb421-2" title="2">m</a></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    1    2
## [2,]    3    4</code></pre>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb423-1" title="1"><span class="kw">layout</span>(m)</a></code></pre></div>
<p>the matrix <code>m</code> we’ve created, completely defines our layout for the graphics window. The window is divided into 2 x 2=4 sub-regions. Moreover, the first figure is assigned the sub-region on the top-left of the window, the second figure the sub-region at the top-right, the third the region at the bottom-left, and the fourth the region at the bottom-right. This example is in itself not very different from what we would get with <code>mfrow</code>, however two key differences make <code>layout</code> more powerful than <code>mfrow</code>. First, it is possible to assign more than a single sub-region to a figure, for example:</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb424-1" title="1">m =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">nrow=</span><span class="dv">2</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb424-2" title="2">m</a></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    1    1
## [2,]    2    3</code></pre>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb426-1" title="1"><span class="kw">layout</span>(m)</a></code></pre></div>
<p>divides the graphics window into 4 sub-regions as above, but the first figure is assigned the two sub-regions on top, while the bottom-left sub-region is assigned to the second figure, and the bottom-right to the third.</p>
<p>The second key difference with <code>mfrow</code> is that with <code>layout</code> it is possible to define the width of the columns, and the height of the rows composing the array of sub-regions in the graphics window. Width and height are given as vectors of <em>relative</em> widths and heights. For example:</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb427-1" title="1">m =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">nrow=</span><span class="dv">2</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb427-2" title="2">m</a></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    1    1
## [2,]    2    3</code></pre>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb429-1" title="1"><span class="kw">layout</span>(m, <span class="dt">width=</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">4</span>,<span class="dv">3</span><span class="op">/</span><span class="dv">4</span>), <span class="dt">height=</span><span class="kw">c</span>(<span class="dv">2</span><span class="op">/</span><span class="dv">3</span>,<span class="dv">1</span><span class="op">/</span><span class="dv">3</span>))</a></code></pre></div>
<p>will make the first column 1/4 of the total width, and the second column the other 3/4, the same reasoning applies to the row heights.
The command <code>layout.show(n)</code>, where <code>n</code> is the number of <span class="math inline">\(n^{th}\)</span> figure that is going to be plotted, will show the outline of its layout in the graphics window.</p>
</div>
</div>
<div id="grdevregions" class="section level2">
<h2><span class="header-section-number">6.8</span> Graphics device regions and coordinates</h2>
<p>In traditional R graphics the graphics device (e.g. the <code>X11</code> window where your plot and annotations appear) is divided into different regions (see Figure <a href="#fig:figureregion">6.27</a>):</p>
<ul>
<li>the <em>plotting region</em> is the area in which the drawing of points or lines representing your data occur. The plotting region is contained into the <em>figure region</em></li>
<li>the <em>figure region</em> is composed of the plotting regions plus the margins where the plot can be annotated with labels for the axes, a title etc…</li>
<li>the <em>outer margins</em> surround the figure region. The outer margins are usually set to zero (i.e. there are no outer margins), they become useful, however, for annotating multiple plots that appear on the same page (e.g.~plots generated with `mfrow+). When multiple plots are arranged on the same page (or device), each is assigned a <em>figure region</em> with its own margins, so the outer margins can be used for annotating the overall page (see Figure <a href="#fig:figureregionsubplot">6.28</a>).</li>
</ul>
<div class="figure"><span id="fig:figureregion"></span>
<img src="06_graphics_files/figure-html/figureregion-1.png" alt="The figure region includes the plotting region and the margins." width="342.72" />
<p class="caption">
Figure 6.27: The figure region includes the plotting region and the margins.
</p>
</div>
<div class="figure"><span id="fig:figureregionsubplot"></span>
<img src="06_graphics_files/figure-html/figureregionsubplot-1.png" alt="Device with outer margins and multiple figure regions." width="489.6" />
<p class="caption">
Figure 6.28: Device with outer margins and multiple figure regions.
</p>
</div>
<p>The width and height of the device is usually specified when the device is opened, for example:</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb430-1" title="1"><span class="kw">X11</span>(<span class="dt">width=</span><span class="dv">8</span>, <span class="dt">height=</span><span class="dv">8</span>)</a></code></pre></div>
<p>opens a <code>X11</code> device measuring 8x8 inches. The size of an open device can be queried with <code>par(&quot;din&quot;)</code>, this is a read only graphics parameter, which I guess means that once a certain device is opened its size cannot be changed (an <code>X11</code> window however can be re-sized with the mouse, and <code>par(&quot;din&quot;)</code> correctly reports the new size).
Different units of measure can be used to specify the size of the areas inside a device, some of these units will be shortly introduced here, others will be explained when they are first used:</p>
<ul>
<li><em>inches</em>: an inch is 2.54 centimetres (notice that the actual physical measure of what you see on your monitor may depend on your monitor’s settings, e.g. dpi, screen resolution, etc…)</li>
<li><em>lines of text</em>: this measure depends on the value of <code>cex</code> and <code>pointsize</code></li>
<li><em>Normalised Device Coordinates (NDC)</em>: the device region is 1x1 NDC whatever the actual physical measure. The lower left corner has coordinates (x=0, y=0) and the upper right corner (x=1, y=1). Using NDC thus the size of regions inside the device can be specified in relative terms to the device size.</li>
</ul>
<p>In the next paragraphs the graphics parameters for controlling the different regions inside the device will be explained. Always keep in mind the layout of a graphics device in R (see Figure <a href="#fig:figureregion">6.27</a> and Figure <a href="#fig:figureregionsubplot">6.28</a>).</p>
<div id="figure-region" class="section level4">
<h4><span class="header-section-number">6.8.0.1</span> Figure region</h4>
<p>The figure region can be set either in inches or in normalised device coordinates.</p>
<ul>
<li><code>fig</code>: NDC coordinates of the device in the form <code>c(x1, x2, y1, y2)</code>, where (x1, y1) are the coordinates of the lower left corner, and (x2, y2) are the coordinates of the upper right corner). Example:</li>
</ul>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb431-1" title="1"><span class="kw">par</span>(<span class="dt">fig=</span><span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.1</span>, <span class="fl">0.6</span>)) </a>
<a class="sourceLine" id="cb431-2" title="2"><span class="kw">plot</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb431-3" title="3"><span class="kw">par</span>(<span class="dt">fig=</span><span class="kw">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span>, <span class="fl">0.1</span>, <span class="fl">0.6</span>)) <span class="co"># the next call to plot will erase the</span></a>
<a class="sourceLine" id="cb431-4" title="4">                             <span class="co"># current plot</span></a>
<a class="sourceLine" id="cb431-5" title="5"><span class="kw">plot</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb431-6" title="6"><span class="kw">par</span>(<span class="dt">fig=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="fl">0.1</span>, <span class="fl">0.6</span>), <span class="dt">new=</span><span class="ot">TRUE</span>) <span class="co"># the next call to plot will not </span></a>
<a class="sourceLine" id="cb431-7" title="7">                                       <span class="co"># erase the current plot</span></a>
<a class="sourceLine" id="cb431-8" title="8"><span class="kw">plot</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</a></code></pre></div>
<p>as shown in the example to change the figure region without starting a new plot add <code>new=TRUE</code>, this may be used for creating complex arrangements for multiple plots within the same device.</p>
<ul>
<li><code>fin</code>: the figure region dimension (width, height) in inches. Example:</li>
</ul>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb432-1" title="1"><span class="kw">par</span>(<span class="dt">fin=</span><span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">5</span>))</a></code></pre></div>
</div>
<div id="plotting-region" class="section level4">
<h4><span class="header-section-number">6.8.0.2</span> Plotting region</h4>
<ul>
<li><code>plt</code>: a vector of the form <code>c(x1, x2, y1, y2)</code> giving the coordinates of the plot region as fractions of the current figure region</li>
<li><code>pin</code>: the current plot dimensions, <code>(width,height)</code>, in inches</li>
</ul>
</div>
<div id="margins" class="section level4">
<h4><span class="header-section-number">6.8.0.3</span> Margins</h4>
<ul>
<li><code>mar</code>: the width of the margins for the four sides of the plot, specified in terms of <em>lines of text</em>. The margins are specified in the form <code>c(bottom, left, top, right)</code>. The default is <code>c(5,4,4,2) + 0.1</code>. Example:</li>
</ul>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb433-1" title="1"><span class="kw">par</span>(<span class="st">&quot;mar&quot;</span>) <span class="co"># get current margins size</span></a>
<a class="sourceLine" id="cb433-2" title="2"><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">0</span>) <span class="op">+</span><span class="st"> </span><span class="fl">0.1</span>) <span class="co">#set new margins size</span></a></code></pre></div>
<ul>
<li><code>mai</code>: the same as <code>mar</code>, but the unit of measure is inches rather than lines of text</li>
</ul>
</div>
<div id="outer-margins" class="section level4">
<h4><span class="header-section-number">6.8.0.4</span> Outer margins</h4>
<ul>
<li><code>oma</code>: a vector of the form <code>c(bottom, left, top, right)</code> giving the size of the outer margins in lines of text</li>
<li>A vector of the form <code>c(bottom, left, top, right)</code> giving the size of the outer margins in inches</li>
<li>A vector of the form <code>c(x1, x2, y1, y2)</code> giving the outer margin region in normalised device coordinates (NDC)</li>
</ul>
</div>
</div>
<div id="plotfromscratch" class="section level2">
<h2><span class="header-section-number">6.9</span> Plotting from scratch</h2>
<p>The high-level plotting functions such as <code>plot</code>, <code>histogram</code>, <code>barplot</code> and so on, provide a good and quick way to produce graphs. Plotting from scratch, using the low-level plotting commands is generally not necessary, unless you want to create some new, customised plotting functions. Learning to plot “from scratch”, however is a very good way to learn how graphics parameters work, which is often necessary to customise plots created with the high-level plotting functions.</p>
<p>We’ll start with a very simple example of a scatterplot:</p>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb434-1" title="1"><span class="kw">plot.new</span>()</a>
<a class="sourceLine" id="cb434-2" title="2"><span class="kw">plot.window</span>(<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">10</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">10</span>))</a></code></pre></div>
<p>the <code>plot.new()</code> command creates a frame for plotting, and opens a graphics device if one is not already opened. <code>plot.window</code> defines the limits for the x and y axes, points outside these limits will not appear in the plot. After these two commands we’re ready to do the actual drawing:</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb435-1" title="1"><span class="kw">points</span>(<span class="dt">x=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">9</span>), <span class="dt">y=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">3</span>))</a>
<a class="sourceLine" id="cb435-2" title="2"><span class="kw">axis</span>(<span class="dt">side=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb435-3" title="3"><span class="kw">axis</span>(<span class="dt">side=</span><span class="dv">2</span>)</a></code></pre></div>
<p><code>points</code> will draw points at the coordinates given in the <code>x</code> an <code>y</code> arguments. To complete this very minimal plot you need at least some axes. The <code>axis</code> function adds the axis, the <code>side</code> argument specifies where the axis should be drawn, 1 means at the “bottom”, 2 at the “left” side, and so on in a clockwise fashion.</p>
</div>
<div id="managing-graphic-devices" class="section level2">
<h2><span class="header-section-number">6.10</span> Managing graphic devices</h2>
<div id="opening-another-graphics-window" class="section level3">
<h3><span class="header-section-number">6.10.1</span> Opening another graphics window</h3>
<p>When you issue the command for a graph R opens a window to show it, if you afterwards issue another command for a graph, if the previous window is still open, R doesn’t open another one, but rather replaces the old graph with the new one. If you wish to show the new graph in a separate window, you have to open the graphic device yourself, this is accomplished with the command <code>X11</code> under Unix and with the command <code>windows</code> under the Windows OS. The device window can also be closed from the command line with:</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb436-1" title="1"><span class="kw">dev.off</span>()</a></code></pre></div>
<p>if you have many device windows open and you want to close them all at once use:</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb437-1" title="1"><span class="kw">graphics.off</span>()</a></code></pre></div>
<p>For further functions to manage multiple device windows see <code>?dev.set</code>.</p>
</div>
<div id="exporting-graphics" class="section level3">
<h3><span class="header-section-number">6.10.2</span> Exporting graphics</h3>
<p>With R it’s also possible to export your graphics in different file formats, such as JPEG or postscript files. To do this, you need to open first the graphics device you want to use, then insert the command for the graphic, and finally turn off the graphic device. Here’s an example of how to produce a graphic in JPEG format:</p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb438-1" title="1"><span class="kw">jpeg</span>(<span class="dt">file=</span><span class="st">&quot;plot.jpeg&quot;</span>)</a>
<a class="sourceLine" id="cb438-2" title="2"><span class="kw">plot</span>(x,y)</a>
<a class="sourceLine" id="cb438-3" title="3"><span class="kw">dev.off</span>()</a></code></pre></div>
<p>Other devices you can use, with their corresponding file format are <code>pdf</code>, <code>postscript</code>, <code>png</code> and <code>bitmap</code>.</p>

</div>
</div>
</div>
<div id="ggplot2" class="section level1">
<h1><span class="header-section-number">7</span> ggplot2</h1>
<p><code>ggplot2</code> is an add-on R library for generating plots. It differs radically from traditional plotting libraries, such as the base R graphics library, because it is based on a formal high-level model of statistical graphics, the “grammar of graphics” <span class="citation">(Wilkinson <a href="#ref-Wilkinson2005">2005</a>)</span>. This makes <code>ggplot2</code> very powerful because it provides a language for succintly translating statistical ideas directly onto graphs. On the other hand, the significant departure of <code>ggplot2</code> from traditional graphics models can make its learning curve somewhat harder, especially if you’re used to traditional graphics models.</p>
<p>The <code>ggplot2</code> book by <span class="citation">Wickham (<a href="#ref-Wickham2009">2009</a>)</span> is the best reference for learning ggplot2. The draft of the third edition of the book is freely available <a href="https://ggplot2-book.org/index.html">here</a>. Other useful resources include <a href="http://www.ling.upenn.edu/~joseff/avml2012/"><code>ggplot2</code> tutorial</a> by Josef Fruehwald, which is one of the best introductions to <code>ggplot2</code> I’ve come across. A more recent version of this tutorial is available <a href="http://jofrhwld.github.io/teaching/courses/2017_lvc/practicals/7_practical_r.html#inheritance">here</a>.</p>
<p>All the examples in this chapter assume that <code>ggplot2</code> has been installed and is loaded in your R session. If not, you can install it with:</p>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb439-1" title="1"><span class="kw">install.packages</span>(<span class="st">&quot;ggplot2&quot;</span>)</a></code></pre></div>
<p>and load it with:</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb440-1" title="1"><span class="kw">library</span>(ggplot2)</a></code></pre></div>
<p>At its essence a plot is a mapping of certain properties of the data to certain visual properties of the medium (paper, screen, etc…) on which it appears. For example, a variable such as blood pressure, may be mapped to the coordinate of a point in the y axis, and another variable such as time, may be mapped to the coordinate of a point on the x axis. Sometimes variables may be mapped to other graphical aspects, such as the color of points, the type (solid, dashed, etc…) of a line, or the size of a point. ggplot2 implements a “grammar” of graphics that allows you to express and control this mappings with a high-level language. Compared to traditional plotting systems (such as base R graphics) this typically allows you to express these mappings concisely; if you master the grammar it may also allow to do it more quickly.</p>
<p>Two basic elements of ggplot2 are <em>aesthetics</em>, and <em>geometries</em>. Aesthetics in ggplot2 define the ways in which data properties are conceptually mapped to graphical elements (e.g. by position, color, shape, size, etc…). Geometries, on the other hand, represent the actual geometrical elements (e.g. points, lines, bars, etc…) used to implement these mappings. Let’s move on to some examples to clarify this. For these examples we’ll use the <code>trees</code> built-in R dataset, which contains measurements of the diameter, height and volume of 31 black cherry trees:</p>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb441-1" title="1"><span class="kw">data</span>(trees)</a>
<a class="sourceLine" id="cb441-2" title="2"><span class="kw">head</span>(trees)</a></code></pre></div>
<pre><code>##   Girth Height Volume
## 1   8.3     70   10.3
## 2   8.6     65   10.3
## 3   8.8     63   10.2
## 4  10.5     72   16.4
## 5  10.7     81   18.8
## 6  10.8     83   19.7</code></pre>
<p>the documentation for the dataset (see <code>?trees</code>) tells us that the diameter (in inches) was erroneously labelled “Girth” in the data, so we’ll correct the column name in the dataset:</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb443-1" title="1">trees =<span class="st"> </span>trees <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">Diameter=</span>Girth)</a></code></pre></div>
<p>We can visualize the diameter and height data, and their relation, by mapping the diameter to position on the x axis, and the height to position on the y axis, then use points to implement these mapping. In ggplot2 we would write:</p>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb444-1" title="1"><span class="kw">ggplot</span>(<span class="dt">data=</span>trees, <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x=</span>Diameter, <span class="dt">y=</span>Height)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a></code></pre></div>
<div class="figure"><span id="fig:ggtrees1"></span>
<img src="07_ggplot2_files/figure-html/ggtrees1-1.png" alt="Diameter and height of 31 black cherry trees." width="326.4" />
<p class="caption">
Figure 7.1: Diameter and height of 31 black cherry trees.
</p>
</div>
<p>the resulting plot is shown in Figure <a href="#fig:ggtrees1">7.1</a>. Note how the <code>ggplot</code> function takes two arguments, <code>data</code> must be a dataframe holding the variables of interest; the <code>mapping</code> argument takes a function called <code>aes</code> that specifies the aesthetic mappings. The geometry is “added” later with the <code>+</code> operator. From now on we will omit for brevity the argument names and simply write:</p>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb445-1" title="1"><span class="kw">ggplot</span>(trees, <span class="kw">aes</span>(<span class="dt">x=</span>Diameter, <span class="dt">y=</span>Height)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p>One way to map the data on the volume of the trees onto the current graph could be to vary the size of the points depending on the volume:</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb446-1" title="1"><span class="kw">ggplot</span>(trees, <span class="kw">aes</span>(<span class="dt">x=</span>Diameter, <span class="dt">y=</span>Height, <span class="dt">size=</span>Volume)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a></code></pre></div>
<div class="figure"><span id="fig:ggtrees2"></span>
<img src="07_ggplot2_files/figure-html/ggtrees2-1.png" alt="Diameter, height, and volume of 31 black cherry trees. The volume of the trees is represented by the size of the plotting points." width="326.4" />
<p class="caption">
Figure 7.2: Diameter, height, and volume of 31 black cherry trees. The volume of the trees is represented by the size of the plotting points.
</p>
</div>
<p>the resulting plot is shown in Figure <a href="#fig:ggtrees2">7.2</a>. Yet another way to map the data on the volume of the trees onto the plot could be to set the color of the points depending on the value of the volume:</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb447-1" title="1"><span class="kw">ggplot</span>(trees, <span class="kw">aes</span>(<span class="dt">x=</span>Diameter, <span class="dt">y=</span>Height, <span class="dt">color=</span>Volume)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a></code></pre></div>
<div class="figure"><span id="fig:ggtrees3"></span>
<img src="07_ggplot2_files/figure-html/ggtrees3-1.png" alt="Diameter, height, and volume of 31 black cherry trees. The volume of the trees is represented by the color of the plotting points." width="326.4" />
<p class="caption">
Figure 7.3: Diameter, height, and volume of 31 black cherry trees. The volume of the trees is represented by the color of the plotting points.
</p>
</div>
<p>The resulting plot is shown in Figure <a href="#fig:ggtrees3">7.3</a>. for this last plot we may want to increase the size of <em>all</em> points to make their color easier to see. We can do this by passing a <code>size</code> argument to <code>geom_point</code> (plot shown in Figure <a href="#fig:ggtrees4">7.4</a>):</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb448-1" title="1"><span class="kw">ggplot</span>(trees, <span class="kw">aes</span>(<span class="dt">x=</span>Diameter, <span class="dt">y=</span>Height, <span class="dt">color=</span>Volume)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">3</span>)</a></code></pre></div>
<div class="figure"><span id="fig:ggtrees4"></span>
<img src="07_ggplot2_files/figure-html/ggtrees4-1.png" alt="Diameter, height, and volume of 31 black cherry trees. The volume of the trees is represented by the color of the plotting points. The points have been set to a relatively large size to make it easier to see their color." width="326.4" />
<p class="caption">
Figure 7.4: Diameter, height, and volume of 31 black cherry trees. The volume of the trees is represented by the color of the plotting points. The points have been set to a relatively large size to make it easier to see their color.
</p>
</div>
<p>although by doing this we are modifying an aesthetic quality of the plot, this does not generate an <em>aesthetic mapping</em> between the data and the graphic in the sense of the grammar of graphics.</p>
<div class="rmdimportant">
<p>
Aesthetic <em>mappings</em> always go within an <code>aes</code> call, while changes of the visual properties of the plot that are not aesthetic mappings go outside <code>aes</code> calls.
</p>
</div>
<p>Check what happens if we pass the call to change the size of all the points (not an aesthetic mapping) inside the <code>aes</code>:</p>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb449-1" title="1"><span class="co"># wrong!</span></a>
<a class="sourceLine" id="cb449-2" title="2"><span class="kw">ggplot</span>(trees, <span class="kw">aes</span>(<span class="dt">x=</span>Diameter, <span class="dt">y=</span>Height, <span class="dt">color=</span>Volume, <span class="dt">size=</span><span class="dv">3</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() </a></code></pre></div>
<p>Some common aesthetics are listed in Table <a href="#tab:aes">7.1</a>, while Table <a href="#tab:geoms">7.2</a> lists some common geometries.</p>
<table>
<caption><span id="tab:aes">Table 7.1: </span> Common <code>ggplot2</code> aesthetics.</caption>
<thead>
<tr class="header">
<th align="left">Aesthetic</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>color</code></td>
<td></td>
</tr>
<tr class="even">
<td align="left"><code>fill</code></td>
<td></td>
</tr>
<tr class="odd">
<td align="left"><code>shape</code></td>
<td></td>
</tr>
<tr class="even">
<td align="left"><code>size</code></td>
<td></td>
</tr>
<tr class="odd">
<td align="left"><code>linetype</code></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<caption><span id="tab:geoms">Table 7.2: </span> Common <code>ggplot2</code> geometries.</caption>
<thead>
<tr class="header">
<th align="left">Geometry</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>geom_point</code></td>
<td></td>
</tr>
<tr class="even">
<td align="left"><code>geom_line</code></td>
<td></td>
</tr>
<tr class="odd">
<td align="left"><code>geom_path</code></td>
<td></td>
</tr>
<tr class="even">
<td align="left"><code>geom_bar</code></td>
<td></td>
</tr>
<tr class="odd">
<td align="left"><code>geom_col</code></td>
<td></td>
</tr>
<tr class="even">
<td align="left"><code>geom_errorbar</code></td>
<td></td>
</tr>
<tr class="odd">
<td align="left"><code>geom_smooth</code></td>
<td></td>
</tr>
<tr class="even">
<td align="left"><code>geom_hline</code></td>
<td></td>
</tr>
<tr class="odd">
<td align="left"><code>geom_vline</code></td>
<td></td>
</tr>
<tr class="even">
<td align="left"><code>geom_abline</code></td>
<td></td>
</tr>
</tbody>
</table>
<div id="ggcommon" class="section level2">
<h2><span class="header-section-number">7.1</span> Common charts</h2>
<div id="scatterplots" class="section level3">
<h3><span class="header-section-number">7.1.1</span> Scatterplots</h3>
<p>We’ve already seen some scatterplots at the beginning of this chapter. We’ll show some new ones in this section using the <code>iris</code> dataset, which contains measurements of various physical properties of 150 flowers from three different species of iris:</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb450-1" title="1"><span class="kw">data</span>(iris)</a>
<a class="sourceLine" id="cb450-2" title="2"><span class="kw">head</span>(iris)</a></code></pre></div>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1          5.1         3.5          1.4         0.2  setosa
## 2          4.9         3.0          1.4         0.2  setosa
## 3          4.7         3.2          1.3         0.2  setosa
## 4          4.6         3.1          1.5         0.2  setosa
## 5          5.0         3.6          1.4         0.2  setosa
## 6          5.4         3.9          1.7         0.4  setosa</code></pre>
<p>We’ll start with a scatterplot of petal length by petal width (shown in Figure <a href="#fig:ggiris1">7.5</a>):</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb452-1" title="1">p =<span class="st"> </span><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(Petal.Width, Petal.Length)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a>
<a class="sourceLine" id="cb452-2" title="2">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Petal Width (cm)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Petal Length (cm)&quot;</span>)</a>
<a class="sourceLine" id="cb452-3" title="3">p</a></code></pre></div>
<div class="figure"><span id="fig:ggiris1"></span>
<img src="07_ggplot2_files/figure-html/ggiris1-1.png" alt="Scatterplot of petal length by petal width for the `iris` dataset." width="326.4" />
<p class="caption">
Figure 7.5: Scatterplot of petal length by petal width for the <code>iris</code> dataset.
</p>
</div>
<p>Next we’ll map the species of each flower to color (plot shown in Figure <a href="#fig:ggiris2">7.6</a>):</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb453-1" title="1">p =<span class="st"> </span><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(Petal.Width, Petal.Length, <span class="dt">color=</span>Species)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a>
<a class="sourceLine" id="cb453-2" title="2">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Petal Width (cm)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Petal Length (cm)&quot;</span>)</a>
<a class="sourceLine" id="cb453-3" title="3">p</a></code></pre></div>
<div class="figure"><span id="fig:ggiris2"></span>
<img src="07_ggplot2_files/figure-html/ggiris2-1.png" alt="Scatterplot of petal length by petal width for the `iris` dataset. Species is mapped to color." width="408" />
<p class="caption">
Figure 7.6: Scatterplot of petal length by petal width for the <code>iris</code> dataset. Species is mapped to color.
</p>
</div>
</div>
<div id="ggtimeseries" class="section level3">
<h3><span class="header-section-number">7.1.2</span> Time series</h3>
<p>We’ll plot a time series using the <code>Orange</code> built-in R datasets, which contains data on the growth of five orange trees. The result can be seen in Figure <a href="#fig:ggorange1">7.7</a>.</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb454-1" title="1">p =<span class="st"> </span><span class="kw">ggplot</span>(Orange, <span class="kw">aes</span>(age, circumference, <span class="dt">color=</span>Tree)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a>
<a class="sourceLine" id="cb454-2" title="2">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_path</span>()</a>
<a class="sourceLine" id="cb454-3" title="3">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Age (days)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Circumference (mm)&quot;</span>)</a>
<a class="sourceLine" id="cb454-4" title="4">p</a></code></pre></div>
<div class="figure"><span id="fig:ggorange1"></span>
<img src="07_ggplot2_files/figure-html/ggorange1-1.png" alt="Growth of orange trees: trunk circumference by age (in days) for five trees." width="326.4" />
<p class="caption">
Figure 7.7: Growth of orange trees: trunk circumference by age (in days) for five trees.
</p>
</div>
</div>
<div id="ggbarplots" class="section level3">
<h3><span class="header-section-number">7.1.3</span> Barplots</h3>
<p>For the following examples we’ll use the <code>npk</code> dataset, which contains data from a factorial experiment on the effects of N, P, K (nitrogen, phosphate, potassium) on the growth of peas.</p>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb455-1" title="1"><span class="kw">data</span>(npk)</a>
<a class="sourceLine" id="cb455-2" title="2"><span class="kw">head</span>(npk)</a></code></pre></div>
<pre><code>##   block N P K yield
## 1     1 0 1 1  49.5
## 2     1 1 1 0  62.8
## 3     1 0 0 0  46.8
## 4     1 1 0 1  57.0
## 5     2 1 0 0  59.8
## 6     2 1 1 1  58.5</code></pre>
<p>in the dataset <code>N</code>, <code>P</code>, and <code>K</code> are indicator variables for the application of the respective element (0=no, 1=yes). We’ll first plot the mean yield as a function of N, averaging across the levels of the other factors. In order to do this we’ll generate a summary data set:</p>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb457-1" title="1">npk_summ_N =<span class="st"> </span>npk <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(N) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">mean_yield=</span><span class="kw">mean</span>(yield),</a>
<a class="sourceLine" id="cb457-2" title="2">                                               <span class="dt">sd_yield=</span><span class="kw">sd</span>(yield))</a></code></pre></div>
<p>the barplot can be generated using <code>geom_col</code> (plot shown in Figure <a href="#fig:npkp1">7.8</a>):</p>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb458-1" title="1">p1 =<span class="st"> </span><span class="kw">ggplot</span>(npk_summ_N, <span class="kw">aes</span>(N, mean_yield)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>()</a>
<a class="sourceLine" id="cb458-2" title="2">p1 =<span class="st"> </span>p1 <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Mean yield&quot;</span>)</a>
<a class="sourceLine" id="cb458-3" title="3">p1</a></code></pre></div>
<div class="figure"><span id="fig:npkp1"></span>
<img src="07_ggplot2_files/figure-html/npkp1-1.png" alt="Yield as a function of nitrogen application." width="326.4" />
<p class="caption">
Figure 7.8: Yield as a function of nitrogen application.
</p>
</div>
<p>we can add error bars showing the standard deviation using <code>geom_errorbar</code> (plot shown in Figure <a href="#fig:npkp1e">7.9</a>):</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb459-1" title="1">p1e =<span class="st"> </span><span class="kw">ggplot</span>(npk_summ_N, <span class="kw">aes</span>(N, mean_yield)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>()</a>
<a class="sourceLine" id="cb459-2" title="2">p1e =<span class="st"> </span>p1e <span class="op">+</span><span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span>mean_yield<span class="op">-</span>sd_yield,</a>
<a class="sourceLine" id="cb459-3" title="3">                              <span class="dt">ymax=</span>mean_yield<span class="op">+</span>sd_yield),</a>
<a class="sourceLine" id="cb459-4" title="4">                          <span class="dt">width=</span><span class="fl">0.2</span>)</a>
<a class="sourceLine" id="cb459-5" title="5">p1e =<span class="st"> </span>p1e <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Mean yield&quot;</span>)</a>
<a class="sourceLine" id="cb459-6" title="6">p1e</a></code></pre></div>
<div class="figure"><span id="fig:npkp1e"></span>
<img src="07_ggplot2_files/figure-html/npkp1e-1.png" alt="Yield as a function of nitrogen application." width="326.4" />
<p class="caption">
Figure 7.9: Yield as a function of nitrogen application.
</p>
</div>
<p>Next, we’ll plot the mean yield as a function of both N and P. We first generate a summary dataset as a function of both N and P with:</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb460-1" title="1">npk_summ_NP =<span class="st"> </span>npk <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(N,P) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">mean_yield=</span><span class="kw">mean</span>(yield),</a>
<a class="sourceLine" id="cb460-2" title="2">                                                  <span class="dt">sd_yield=</span><span class="kw">sd</span>(yield))</a></code></pre></div>
<p>and then generate the barplot (shown in Figure <a href="#fig:npkp2">7.10</a>):</p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb461-1" title="1">p2 =<span class="st"> </span><span class="kw">ggplot</span>(npk_summ_NP, <span class="kw">aes</span>(N, mean_yield, <span class="dt">fill=</span>P))</a>
<a class="sourceLine" id="cb461-2" title="2">p2 =<span class="st"> </span>p2 <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>()</a>
<a class="sourceLine" id="cb461-3" title="3">p2 =<span class="st"> </span>p2 <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Mean yield&quot;</span>)</a>
<a class="sourceLine" id="cb461-4" title="4">p2</a></code></pre></div>
<div class="figure"><span id="fig:npkp2"></span>
<img src="07_ggplot2_files/figure-html/npkp2-1.png" alt="Stacked barplot showing yield as a function of nitrogen and phosphate application." width="326.4" />
<p class="caption">
Figure 7.10: Stacked barplot showing yield as a function of nitrogen and phosphate application.
</p>
</div>
<p>the code above generates a stacked barplot. To generate a barplot with the bars “side to side” rather than stacked on top of each other we have to use <code>position_dodge</code> to offset the position of the bars relative to each other:</p>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb462-1" title="1">dodge_size =<span class="st"> </span><span class="fl">0.9</span></a>
<a class="sourceLine" id="cb462-2" title="2">p2d =<span class="st"> </span><span class="kw">ggplot</span>(npk_summ_NP, <span class="kw">aes</span>(N, mean_yield, <span class="dt">fill=</span>P))</a>
<a class="sourceLine" id="cb462-3" title="3">p2d =<span class="st"> </span>p2d <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>(<span class="dt">position=</span><span class="kw">position_dodge</span>(dodge_size))</a>
<a class="sourceLine" id="cb462-4" title="4">p2d =<span class="st"> </span>p2d <span class="op">+</span><span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span>mean_yield<span class="op">-</span>sd_yield,</a>
<a class="sourceLine" id="cb462-5" title="5">                              <span class="dt">ymax=</span>mean_yield<span class="op">+</span>sd_yield),</a>
<a class="sourceLine" id="cb462-6" title="6">                          <span class="dt">position=</span><span class="kw">position_dodge</span>(dodge_size),</a>
<a class="sourceLine" id="cb462-7" title="7">                          <span class="dt">width=</span><span class="fl">0.2</span>)</a>
<a class="sourceLine" id="cb462-8" title="8">p2d =<span class="st"> </span>p2d <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_manual</span>(<span class="dt">name=</span><span class="st">&quot;P&quot;</span>, <span class="dt">values=</span><span class="kw">palette</span>()[<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">4</span>)])</a>
<a class="sourceLine" id="cb462-9" title="9">p2d =<span class="st"> </span>p2d <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Mean yield&quot;</span>)</a>
<a class="sourceLine" id="cb462-10" title="10">p2d</a></code></pre></div>
<div class="figure"><span id="fig:npkp2d"></span>
<img src="07_ggplot2_files/figure-html/npkp2d-1.png" alt="Barplot with bars side by side showing yield as a function of nitrogen and phosphate application." width="326.4" />
<p class="caption">
Figure 7.11: Barplot with bars side by side showing yield as a function of nitrogen and phosphate application.
</p>
</div>
<p>the resulting plot is shown in Figure <a href="#fig:npkp2d">7.11</a>. Again we added some error bars; note how we had to set the <code>position</code> argument also for <code>geom_errorbar</code> to make sure the error bars are aligned to the bars of the barplot. We also changed the colors of the bars with <code>scale_fill_manual</code>.</p>
<p>We can visualize the effect of all three factors (N, P, K) by showing mean values of K along different panels. We’ll first generate a summary dataset as a function of all three factors:</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb463-1" title="1">npk_summ_NPK =<span class="st"> </span>npk <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(N,P,K) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">mean_yield=</span><span class="kw">mean</span>(yield),</a>
<a class="sourceLine" id="cb463-2" title="2">                                                     <span class="dt">sd_yield=</span><span class="kw">sd</span>(yield))</a></code></pre></div>
<p>and then generate the plot (shown in Figure <a href="#fig:npkp3">7.12</a>):</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb464-1" title="1">p3 =<span class="st"> </span><span class="kw">ggplot</span>(npk_summ_NPK, <span class="kw">aes</span>(N, mean_yield, <span class="dt">fill=</span>P))</a>
<a class="sourceLine" id="cb464-2" title="2">p3 =<span class="st"> </span>p3 <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>(<span class="dt">position=</span><span class="kw">position_dodge</span>(dodge_size))</a>
<a class="sourceLine" id="cb464-3" title="3">p3 =<span class="st"> </span>p3 <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span>K)</a>
<a class="sourceLine" id="cb464-4" title="4">p3 =<span class="st"> </span>p3 <span class="op">+</span><span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span>mean_yield<span class="op">-</span>sd_yield,</a>
<a class="sourceLine" id="cb464-5" title="5">                              <span class="dt">ymax=</span>mean_yield<span class="op">+</span>sd_yield),</a>
<a class="sourceLine" id="cb464-6" title="6">                          <span class="dt">position=</span><span class="kw">position_dodge</span>(dodge_size),</a>
<a class="sourceLine" id="cb464-7" title="7">                          <span class="dt">width=</span><span class="fl">0.2</span>)</a>
<a class="sourceLine" id="cb464-8" title="8">p3 =<span class="st"> </span>p3 <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_manual</span>(<span class="dt">name=</span><span class="st">&quot;P&quot;</span>, <span class="dt">values=</span><span class="kw">palette</span>()[<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">4</span>)])</a>
<a class="sourceLine" id="cb464-9" title="9">p3 =<span class="st"> </span>p3 <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Mean yield&quot;</span>)</a>
<a class="sourceLine" id="cb464-10" title="10">p3</a></code></pre></div>
<div class="figure"><span id="fig:npkp3"></span>
<img src="07_ggplot2_files/figure-html/npkp3-1.png" alt="Barplot showing yield as a function of nitrogen and phosphate application. Panels plot mean yield as a function of the application of potassium (0=no, 1=yes)." width="489.6" />
<p class="caption">
Figure 7.12: Barplot showing yield as a function of nitrogen and phosphate application. Panels plot mean yield as a function of the application of potassium (0=no, 1=yes).
</p>
</div>
<p>Besides <code>geom_col</code> there is a <code>geom_bar</code> that can generate barplots. This geometry, combined with the “identity” stat (<code>geom_bar(stat=&quot;identity&quot;)</code>) will produce the same plot as <code>geom_col</code>. However, the default <code>stat</code> for <code>geom_bar</code> is <code>count</code>, so it will plot the count of cases of a certain factor. For example Figure <a href="#fig:ggmpg1">7.13</a> plots the number of cars for each manufacturer in the <code>mpg</code> dataset, and was obtained with the code below:</p>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb465-1" title="1"><span class="kw">data</span>(mpg)</a>
<a class="sourceLine" id="cb465-2" title="2">p =<span class="st"> </span><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(manufacturer)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>()</a>
<a class="sourceLine" id="cb465-3" title="3">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">45</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb465-4" title="4">p</a></code></pre></div>
<div class="figure"><span id="fig:ggmpg1"></span>
<img src="07_ggplot2_files/figure-html/ggmpg1-1.png" alt="Number of cars by manufacturer in the `mpg` dataset." width="326.4" />
<p class="caption">
Figure 7.13: Number of cars by manufacturer in the <code>mpg</code> dataset.
</p>
</div>
<p>Figure <a href="#fig:ggmpg2">7.14</a> instead, plots the number of cars by manufacturer and type of transmission, and was obtained with the following code:</p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb466-1" title="1">p =<span class="st"> </span><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(manufacturer, <span class="dt">fill=</span>trans))</a>
<a class="sourceLine" id="cb466-2" title="2">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="kw">position_dodge</span>(<span class="fl">0.9</span>))</a>
<a class="sourceLine" id="cb466-3" title="3">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">45</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb466-4" title="4">p</a></code></pre></div>
<div class="figure"><span id="fig:ggmpg2"></span>
<img src="07_ggplot2_files/figure-html/ggmpg2-1.png" alt="Number of cars by manufacturer and type of transmission in the `mpg` dataset." width="432" />
<p class="caption">
Figure 7.14: Number of cars by manufacturer and type of transmission in the <code>mpg</code> dataset.
</p>
</div>
</div>
<div id="ggintplots" class="section level3">
<h3><span class="header-section-number">7.1.4</span> Interaction plots</h3>
<p>For the next example we’ll use the <code>ToothGrowth</code> built-in R dataset, which contains measurements of the length of odontoblasts (cells responsible for tooth growth) in 60 guinea pigs. Each guinea pig had received one of three doses of vitamin C (0.5, 1, and 2 mg/day) by one of two delivery methods, orange juice (OJ) or ascorbic acid (VC).</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb467-1" title="1"><span class="kw">data</span>(ToothGrowth)</a>
<a class="sourceLine" id="cb467-2" title="2"><span class="kw">head</span>(ToothGrowth)</a></code></pre></div>
<pre><code>##    len supp dose
## 1  4.2   VC  0.5
## 2 11.5   VC  0.5
## 3  7.3   VC  0.5
## 4  5.8   VC  0.5
## 5  6.4   VC  0.5
## 6 10.0   VC  0.5</code></pre>
<p>we’ll first generate a summary dataset as a function of delivery method (<code>supp</code> variable), and dose:</p>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb469-1" title="1">ToothGrowthSumm =<span class="st"> </span>ToothGrowth <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(supp, dose) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb469-2" title="2"><span class="st">                                  </span><span class="kw">summarize</span>(<span class="dt">meanLen=</span><span class="kw">mean</span>(len))</a>
<a class="sourceLine" id="cb469-3" title="3">ToothGrowthSumm<span class="op">$</span>dose =<span class="st"> </span><span class="kw">factor</span>(ToothGrowthSumm<span class="op">$</span>dose)</a></code></pre></div>
<p>now we can generate the plot (shown in Figure <a href="#fig:ggtoothgrowth">7.15</a>) with the following code:</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb470-1" title="1">p =<span class="st"> </span><span class="kw">ggplot</span>(ToothGrowthSumm, <span class="kw">aes</span>(<span class="dt">x=</span>supp, <span class="dt">y=</span>meanLen,</a>
<a class="sourceLine" id="cb470-2" title="2">                                <span class="dt">shape=</span>dose, <span class="dt">linetype=</span>dose, <span class="dt">group=</span>dose))</a>
<a class="sourceLine" id="cb470-3" title="3">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a>
<a class="sourceLine" id="cb470-4" title="4">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</a>
<a class="sourceLine" id="cb470-5" title="5">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>()</a>
<a class="sourceLine" id="cb470-6" title="6">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">scale_shape_discrete</span>(<span class="dt">name=</span><span class="st">&quot;Dose&quot;</span>)</a>
<a class="sourceLine" id="cb470-7" title="7">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">scale_linetype_discrete</span>(<span class="dt">name=</span><span class="st">&quot;Dose&quot;</span>)</a>
<a class="sourceLine" id="cb470-8" title="8">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Delivery method&quot;</span>)</a>
<a class="sourceLine" id="cb470-9" title="9">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Mean growth&quot;</span>)</a>
<a class="sourceLine" id="cb470-10" title="10">p</a></code></pre></div>
<div class="figure"><span id="fig:ggtoothgrowth"></span>
<img src="07_ggplot2_files/figure-html/ggtoothgrowth-1.png" alt="Tooth growth by vitamin C dose and delivery method in guinea pigs." width="326.4" />
<p class="caption">
Figure 7.15: Tooth growth by vitamin C dose and delivery method in guinea pigs.
</p>
</div>
</div>
</div>
<div id="scales" class="section level2">
<h2><span class="header-section-number">7.2</span> Scales</h2>
<div id="gglogticks" class="section level3">
<h3><span class="header-section-number">7.2.1</span> Log axis with pretty tickmarks</h3>
<p>The <code>annotation_logticks</code> function can be used to generate “pretty” tickmarks for axes on a log10 scale. An example is given in the code below (plot shown in Figure <a href="#fig:gglogticks">7.16</a>):</p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb471-1" title="1">x =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;cnd1&quot;</span>, <span class="st">&quot;cnd2&quot;</span>)</a>
<a class="sourceLine" id="cb471-2" title="2">y =<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.4</span>, <span class="dv">80</span>)</a>
<a class="sourceLine" id="cb471-3" title="3"></a>
<a class="sourceLine" id="cb471-4" title="4">dat =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y)</a>
<a class="sourceLine" id="cb471-5" title="5"></a>
<a class="sourceLine" id="cb471-6" title="6">p =<span class="st"> </span><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a>
<a class="sourceLine" id="cb471-7" title="7">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_continuous</span>(<span class="dt">trans=</span><span class="st">&quot;log10&quot;</span>)</a>
<a class="sourceLine" id="cb471-8" title="8">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">annotation_logticks</span>(<span class="dt">sides=</span><span class="st">&quot;l&quot;</span>)</a>
<a class="sourceLine" id="cb471-9" title="9">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>(<span class="dt">base_size=</span><span class="dv">12</span>)</a>
<a class="sourceLine" id="cb471-10" title="10">p</a></code></pre></div>
<div class="figure"><span id="fig:gglogticks"></span>
<img src="07_ggplot2_files/figure-html/gglogticks-1.png" alt="Log axis with pretty tickmarks" width="326.4" />
<p class="caption">
Figure 7.16: Log axis with pretty tickmarks
</p>
</div>
</div>
</div>
<div id="ggtheming" class="section level2">
<h2><span class="header-section-number">7.3</span> Themes</h2>
<p><code>ggplot2</code> ships with a number of themes included. The <a href="https://cran.r-project.org/web/packages/ggthemes/index.html"><code>ggthemes</code></a> package provides a number of additional themes.</p>
</div>
<div id="ggtipstricks" class="section level2">
<h2><span class="header-section-number">7.4</span> Tips and tricks</h2>
<div id="fixing-labels-that-wont-fit" class="section level3">
<h3><span class="header-section-number">7.4.1</span> Fixing labels that won’t fit</h3>
<p>Sometimes an axis label may be clipped off as in the next example:</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb472-1" title="1"><span class="kw">set.seed</span>(<span class="dv">260420</span>)</a>
<a class="sourceLine" id="cb472-2" title="2">y=<span class="kw">rnorm</span>(<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb472-3" title="3">dd =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x=</span><span class="kw">c</span>(<span class="st">&quot;Effect of first condition A&quot;</span>,</a>
<a class="sourceLine" id="cb472-4" title="4">                    <span class="st">&quot;Effect condition B&quot;</span>,</a>
<a class="sourceLine" id="cb472-5" title="5">                    <span class="st">&quot;Effect condition C&quot;</span>),</a>
<a class="sourceLine" id="cb472-6" title="6">                <span class="dt">y=</span>y, <span class="dt">lower=</span>y<span class="op">-</span><span class="kw">runif</span>(<span class="dv">3</span>, <span class="fl">0.5</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb472-7" title="7">                <span class="dt">upper=</span>y<span class="op">+</span><span class="kw">runif</span>(<span class="dv">3</span>, <span class="fl">0.5</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb472-8" title="8">p =<span class="st"> </span><span class="kw">ggplot</span>(dd, <span class="kw">aes</span>(x,y)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb472-9" title="9">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span>lower, <span class="dt">ymax=</span>upper), <span class="dt">width=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb472-10" title="10">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">coord_flip</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb472-11" title="11">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;A really long label that won&#39;t easily fit!&quot;</span>)</a>
<a class="sourceLine" id="cb472-12" title="12">p</a></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-15"></span>
<img src="07_ggplot2_files/figure-html/unnamed-chunk-15-1.png" alt="Example of axis label tha doesn't fit" width="276.0192" />
<p class="caption">
Figure 7.17: Example of axis label tha doesn’t fit
</p>
</div>
<p>the label can be shifted by changing the value of <code>hjust</code> for the <code>element_text</code> or the <code>axis.title.x</code>:</p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb473-1" title="1">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title.x =</span> <span class="kw">element_text</span>(<span class="dt">hjust=</span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb473-2" title="2">p</a></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-16"></span>
<img src="07_ggplot2_files/figure-html/unnamed-chunk-16-1.png" alt="Fitting a long label with `hjust`" width="276.0192" />
<p class="caption">
Figure 7.18: Fitting a long label with <code>hjust</code>
</p>
</div>
<p>alternatively we can use the <code>draw_label</code> function from the <code>cowplot</code> package to fine tune the label position:</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb474-1" title="1"><span class="kw">library</span>(cowplot)</a>
<a class="sourceLine" id="cb474-2" title="2">p =<span class="st"> </span><span class="kw">ggplot</span>(dd, <span class="kw">aes</span>(x,y)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb474-3" title="3">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span>lower, <span class="dt">ymax=</span>upper), <span class="dt">width=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb474-4" title="4">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">coord_flip</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb474-5" title="5">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb474-6" title="6">p =<span class="st"> </span><span class="kw">ggdraw</span>(p) <span class="op">+</span><span class="st"> </span><span class="kw">draw_label</span>(<span class="st">&quot;A really long label that won&#39;t easily fit!&quot;</span>,</a>
<a class="sourceLine" id="cb474-7" title="7">                           <span class="dt">x =</span> <span class="fl">0.025</span>, <span class="dt">y =</span> <span class="fl">0.1</span>, <span class="dt">hjust =</span> <span class="dv">0</span>, <span class="dt">vjust =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb474-8" title="8">                           <span class="dt">size =</span> <span class="dv">12</span>)</a>
<a class="sourceLine" id="cb474-9" title="9">p</a></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-17"></span>
<img src="07_ggplot2_files/figure-html/unnamed-chunk-17-1.png" alt="Fitting a long label with `draw_label` from `cowplot`" width="276.0192" />
<p class="caption">
Figure 7.19: Fitting a long label with <code>draw_label</code> from <code>cowplot</code>
</p>
</div>
</div>
<div id="ggasp" class="section level3">
<h3><span class="header-section-number">7.4.2</span> Setting the aspect ratio</h3>
<p>In the following plot (Figure <a href="#fig:ggasp1">7.20</a>) the <code>x</code> and <code>y</code> variables are roughly on the same scale, but we’ve purposefully added an outlier so that the two axes have different ranges:</p>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb475-1" title="1">x =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>) <span class="co">#simulate data</span></a>
<a class="sourceLine" id="cb475-2" title="2">y =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>)</a>
<a class="sourceLine" id="cb475-3" title="3">y[<span class="dv">1</span>] =<span class="st"> </span>y[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span><span class="dv">10</span> <span class="co">#add outlier</span></a>
<a class="sourceLine" id="cb475-4" title="4">dat =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y)</a>
<a class="sourceLine" id="cb475-5" title="5">p =<span class="st"> </span><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(x, y)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a>
<a class="sourceLine" id="cb475-6" title="6">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_abline</span>(<span class="dt">slope=</span><span class="dv">1</span>, <span class="dt">intercept=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb475-7" title="7">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>()</a>
<a class="sourceLine" id="cb475-8" title="8">p</a></code></pre></div>
<div class="figure"><span id="fig:ggasp1"></span>
<img src="07_ggplot2_files/figure-html/ggasp1-1.png" alt="A scatterplot. The aspect ratio is not fixed." width="326.4" />
<p class="caption">
Figure 7.20: A scatterplot. The aspect ratio is not fixed.
</p>
</div>
<p>we can set the aspect ratio to 1 with <code>p = p + coord_fixed(ratio=1)</code>:</p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb476-1" title="1">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">coord_fixed</span>(<span class="dt">ratio=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb476-2" title="2">p</a></code></pre></div>
<div class="figure"><span id="fig:ggasp2"></span>
<img src="07_ggplot2_files/figure-html/ggasp2-1.png" alt="A scatterplot with aspect ratio fixed to 1." width="326.4" />
<p class="caption">
Figure 7.21: A scatterplot with aspect ratio fixed to 1.
</p>
</div>
<p>this fixes the aspect ratio to 1, but the plot, shown in Figure <a href="#fig:ggasp2">7.21</a>, looks somewhat odd because it is not square. To fix this we need to calculate the ranges of both axes and set them at their max/min:</p>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb477-1" title="1">p =<span class="st"> </span><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(x, y)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a>
<a class="sourceLine" id="cb477-2" title="2">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">geom_abline</span>(<span class="dt">slope=</span><span class="dv">1</span>, <span class="dt">intercept=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb477-3" title="3">xmax =<span class="st"> </span><span class="kw">max</span>(<span class="kw">layer_scales</span>(p)<span class="op">$</span>x<span class="op">$</span>range<span class="op">$</span>range)</a>
<a class="sourceLine" id="cb477-4" title="4">ymax =<span class="st"> </span><span class="kw">max</span>(<span class="kw">layer_scales</span>(p)<span class="op">$</span>y<span class="op">$</span>range<span class="op">$</span>range)</a>
<a class="sourceLine" id="cb477-5" title="5">xymax =<span class="st"> </span><span class="kw">max</span>(xmax,ymax)</a>
<a class="sourceLine" id="cb477-6" title="6">xmin =<span class="st"> </span><span class="kw">min</span>(<span class="kw">layer_scales</span>(p)<span class="op">$</span>x<span class="op">$</span>range<span class="op">$</span>range)</a>
<a class="sourceLine" id="cb477-7" title="7">ymin =<span class="st"> </span><span class="kw">min</span>(<span class="kw">layer_scales</span>(p)<span class="op">$</span>y<span class="op">$</span>range<span class="op">$</span>range)</a>
<a class="sourceLine" id="cb477-8" title="8">xymin =<span class="st"> </span><span class="kw">min</span>(xmin,ymin)</a>
<a class="sourceLine" id="cb477-9" title="9">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">coord_equal</span>(<span class="dt">xlim=</span><span class="kw">c</span>(xymin,xymax), <span class="dt">ylim=</span><span class="kw">c</span>(xymin,xymax))</a>
<a class="sourceLine" id="cb477-10" title="10">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>()</a>
<a class="sourceLine" id="cb477-11" title="11">p</a></code></pre></div>
<div class="figure"><span id="fig:ggasp3"></span>
<img src="07_ggplot2_files/figure-html/ggasp3-1.png" alt="A scatterplot with aspect ratio fixed to 1, and a square plotting area." width="326.4" />
<p class="caption">
Figure 7.22: A scatterplot with aspect ratio fixed to 1, and a square plotting area.
</p>
</div>
<p>in this way we obtain the plot shown in Figure <a href="#fig:ggasp3">7.22</a>, which looks better.</p>
</div>
</div>
<div id="ggres" class="section level2">
<h2><span class="header-section-number">7.5</span> Further resources</h2>
<div id="books-articles-and-tutorials" class="section level3">
<h3><span class="header-section-number">7.5.1</span> Books, articles, and tutorials</h3>
<p><a href="https://moc.online.uni-marburg.de/gitbooks/publicationQualityGraphics/_book/index.html">Creating publication quality graphs in R</a> by Tim Appelhans, provides useful notes on both <code>lattice</code> and <code>ggplot2</code>, including ways to manipulate and arrange plots using <code>grid</code>. The git repository of the tutorial is available <a href="https://github.com/tim-salabim/publication-quality-graphics">here</a>.</p>
</div>
<div id="related-packages" class="section level3">
<h3><span class="header-section-number">7.5.2</span> Related packages</h3>
<ul>
<li><a href="https://cran.r-project.org/web/packages/egg/index.html">egg</a></li>
<li><a href="https://cran.r-project.org/web/packages/gridExtra/index.html">gridExtra</a></li>
<li><a href="https://cran.r-project.org/web/packages/gtable/index.html">gtable</a></li>
<li><a href="https://cran.r-project.org/web/packages/cowplot/index.html">cowplot</a></li>
<li><a href="https://cran.r-project.org/web/packages/patchwork/index.html">patchwork</a></li>
</ul>

</div>
</div>
</div>
<div id="plotly" class="section level1">
<h1><span class="header-section-number">8</span> Plotly</h1>
<div class="rmdwarning">
<p>
Figures in this section may not appear in the pdf version of the book. Please use the html version if that is the case: <a href="https://sam81.github.io/r_guide_bookdown/rguide.html" class="uri">https://sam81.github.io/r_guide_bookdown/rguide.html</a>
</p>
</div>
<p>The <a href="https://cpsievert.github.io/plotly_book/">“plotly for R”</a> book <span class="citation">(Sievert <a href="#ref-Sievert2020">2020</a>)</span> is the best introduction for learning plotly.</p>
<p>We’ll start by loading <code>plotly</code> and generating some random data for a scatterplot:</p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb478-1" title="1"><span class="kw">library</span>(plotly)</a>
<a class="sourceLine" id="cb478-2" title="2">x =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">10</span>); y=<span class="kw">rnorm</span>(<span class="dv">10</span>)</a></code></pre></div>
<p>we can now generate a scatterplot, which is shown in Figure <a href="#fig:plotly1">8.1</a>:</p>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb479-1" title="1"><span class="kw">plot_ly</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y, <span class="dt">type=</span><span class="st">&quot;scatter&quot;</span>, <span class="dt">mode=</span><span class="st">&quot;markers&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: `arrange_()` is deprecated as of dplyr 0.7.0.
## Please use `arrange()` instead.
## See vignette(&#39;programming&#39;) for more help
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<div class="figure"><span id="fig:plotly1"></span>
<div id="htmlwidget-557faa00bc9c9c9282de" style="width:432px;height:384px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-557faa00bc9c9c9282de">{"x":{"visdat":{"1ee0347e0dcb":["function () ","plotlyVisDat"]},"cur_data":"1ee0347e0dcb","attrs":{"1ee0347e0dcb":{"x":[-0.10835116898027,-0.757999941880508,-0.925190315503833,1.67867628356928,0.103818980780248,0.576694411491999,2.26599238700777,-0.372173475317593,-0.444696090843634,-0.336733946020538],"y":[0.277531012466541,-0.796364002533291,-0.0853275033803228,-1.08880982776371,1.53684467433694,0.264129140848602,0.520093257696039,0.906311726278922,0.641488145958022,-1.39629215185723],"mode":"markers","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":[]},"yaxis":{"domain":[0,1],"automargin":true,"title":[]},"hovermode":"closest","showlegend":false},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[-0.10835116898027,-0.757999941880508,-0.925190315503833,1.67867628356928,0.103818980780248,0.576694411491999,2.26599238700777,-0.372173475317593,-0.444696090843634,-0.336733946020538],"y":[0.277531012466541,-0.796364002533291,-0.0853275033803228,-1.08880982776371,1.53684467433694,0.264129140848602,0.520093257696039,0.906311726278922,0.641488145958022,-1.39629215185723],"mode":"markers","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 8.1: Plotly example.
</p>
</div>
<p>we can change the color, size and opacity of the plotting points, obtaining the plot shown in Figure <a href="#fig:plotly2">8.2</a>:</p>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb481-1" title="1"><span class="kw">plot_ly</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y, <span class="dt">type=</span><span class="st">&quot;scatter&quot;</span>, <span class="dt">mode=</span><span class="st">&quot;markers&quot;</span>,</a>
<a class="sourceLine" id="cb481-2" title="2">        <span class="dt">marker=</span><span class="kw">list</span>(<span class="dt">color=</span><span class="st">&quot;black&quot;</span> , <span class="dt">size=</span><span class="dv">15</span> , <span class="dt">opacity=</span><span class="fl">0.8</span>))</a></code></pre></div>
<div class="figure"><span id="fig:plotly2"></span>
<div id="htmlwidget-09214ec1297449dc725f" style="width:432px;height:384px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-09214ec1297449dc725f">{"x":{"visdat":{"1ee050a907f8":["function () ","plotlyVisDat"]},"cur_data":"1ee050a907f8","attrs":{"1ee050a907f8":{"x":[-0.10835116898027,-0.757999941880508,-0.925190315503833,1.67867628356928,0.103818980780248,0.576694411491999,2.26599238700777,-0.372173475317593,-0.444696090843634,-0.336733946020538],"y":[0.277531012466541,-0.796364002533291,-0.0853275033803228,-1.08880982776371,1.53684467433694,0.264129140848602,0.520093257696039,0.906311726278922,0.641488145958022,-1.39629215185723],"mode":"markers","marker":{"color":"black","size":15,"opacity":0.8},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":[]},"yaxis":{"domain":[0,1],"automargin":true,"title":[]},"hovermode":"closest","showlegend":false},"source":"A","config":{"showSendToCloud":false},"data":[{"x":[-0.10835116898027,-0.757999941880508,-0.925190315503833,1.67867628356928,0.103818980780248,0.576694411491999,2.26599238700777,-0.372173475317593,-0.444696090843634,-0.336733946020538],"y":[0.277531012466541,-0.796364002533291,-0.0853275033803228,-1.08880982776371,1.53684467433694,0.264129140848602,0.520093257696039,0.906311726278922,0.641488145958022,-1.39629215185723],"mode":"markers","marker":{"color":"black","size":15,"opacity":0.8,"line":{"color":"rgba(31,119,180,1)"}},"type":"scatter","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 8.2: Plotly example.
</p>
</div>
<div id="ggplotly" class="section level2">
<h2><span class="header-section-number">8.1</span> <code>ggplotly</code></h2>
<p>The <code>ggplotly</code> function can be used to convert a <code>ggplot2</code> graphic into an interactive <code>plotly</code> graphic. For example, the following code generates Figure <a href="#fig:ggplotly1">8.3</a>:</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb482-1" title="1">p =<span class="st"> </span><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(Sepal.Width, Sepal.Length, <span class="dt">color=</span>Species)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a>
<a class="sourceLine" id="cb482-2" title="2">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Sepal width&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Sepal length&quot;</span>)</a>
<a class="sourceLine" id="cb482-3" title="3"><span class="kw">ggplotly</span>(p)</a></code></pre></div>
<div class="figure"><span id="fig:ggplotly1"></span>
<div id="htmlwidget-2b9d818db1eb51245667" style="width:432px;height:384px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-2b9d818db1eb51245667">{"x":{"data":[{"x":[3.5,3,3.2,3.1,3.6,3.9,3.4,3.4,2.9,3.1,3.7,3.4,3,3,4,4.4,3.9,3.5,3.8,3.8,3.4,3.7,3.6,3.3,3.4,3,3.4,3.5,3.4,3.2,3.1,3.4,4.1,4.2,3.1,3.2,3.5,3.6,3,3.4,3.5,2.3,3.2,3.5,3.8,3,3.8,3.2,3.7,3.3],"y":[5.1,4.9,4.7,4.6,5,5.4,4.6,5,4.4,4.9,5.4,4.8,4.8,4.3,5.8,5.7,5.4,5.1,5.7,5.1,5.4,5.1,4.6,5.1,4.8,5,5,5.2,5.2,4.7,4.8,5.4,5.2,5.5,4.9,5,5.5,4.9,4.4,5.1,5,4.5,4.4,5,5.1,4.8,5.1,4.6,5.3,5],"text":["Sepal.Width: 3.5<br />Sepal.Length: 5.1<br />Species: setosa","Sepal.Width: 3.0<br />Sepal.Length: 4.9<br />Species: setosa","Sepal.Width: 3.2<br />Sepal.Length: 4.7<br />Species: setosa","Sepal.Width: 3.1<br />Sepal.Length: 4.6<br />Species: setosa","Sepal.Width: 3.6<br />Sepal.Length: 5.0<br />Species: setosa","Sepal.Width: 3.9<br />Sepal.Length: 5.4<br />Species: setosa","Sepal.Width: 3.4<br />Sepal.Length: 4.6<br />Species: setosa","Sepal.Width: 3.4<br />Sepal.Length: 5.0<br />Species: setosa","Sepal.Width: 2.9<br />Sepal.Length: 4.4<br />Species: setosa","Sepal.Width: 3.1<br />Sepal.Length: 4.9<br />Species: setosa","Sepal.Width: 3.7<br />Sepal.Length: 5.4<br />Species: setosa","Sepal.Width: 3.4<br />Sepal.Length: 4.8<br />Species: setosa","Sepal.Width: 3.0<br />Sepal.Length: 4.8<br />Species: setosa","Sepal.Width: 3.0<br />Sepal.Length: 4.3<br />Species: setosa","Sepal.Width: 4.0<br />Sepal.Length: 5.8<br />Species: setosa","Sepal.Width: 4.4<br />Sepal.Length: 5.7<br />Species: setosa","Sepal.Width: 3.9<br />Sepal.Length: 5.4<br />Species: setosa","Sepal.Width: 3.5<br />Sepal.Length: 5.1<br />Species: setosa","Sepal.Width: 3.8<br />Sepal.Length: 5.7<br />Species: setosa","Sepal.Width: 3.8<br />Sepal.Length: 5.1<br />Species: setosa","Sepal.Width: 3.4<br />Sepal.Length: 5.4<br />Species: setosa","Sepal.Width: 3.7<br />Sepal.Length: 5.1<br />Species: setosa","Sepal.Width: 3.6<br />Sepal.Length: 4.6<br />Species: setosa","Sepal.Width: 3.3<br />Sepal.Length: 5.1<br />Species: setosa","Sepal.Width: 3.4<br />Sepal.Length: 4.8<br />Species: setosa","Sepal.Width: 3.0<br />Sepal.Length: 5.0<br />Species: setosa","Sepal.Width: 3.4<br />Sepal.Length: 5.0<br />Species: setosa","Sepal.Width: 3.5<br />Sepal.Length: 5.2<br />Species: setosa","Sepal.Width: 3.4<br />Sepal.Length: 5.2<br />Species: setosa","Sepal.Width: 3.2<br />Sepal.Length: 4.7<br />Species: setosa","Sepal.Width: 3.1<br />Sepal.Length: 4.8<br />Species: setosa","Sepal.Width: 3.4<br />Sepal.Length: 5.4<br />Species: setosa","Sepal.Width: 4.1<br />Sepal.Length: 5.2<br />Species: setosa","Sepal.Width: 4.2<br />Sepal.Length: 5.5<br />Species: setosa","Sepal.Width: 3.1<br />Sepal.Length: 4.9<br />Species: setosa","Sepal.Width: 3.2<br />Sepal.Length: 5.0<br />Species: setosa","Sepal.Width: 3.5<br />Sepal.Length: 5.5<br />Species: setosa","Sepal.Width: 3.6<br />Sepal.Length: 4.9<br />Species: setosa","Sepal.Width: 3.0<br />Sepal.Length: 4.4<br />Species: setosa","Sepal.Width: 3.4<br />Sepal.Length: 5.1<br />Species: setosa","Sepal.Width: 3.5<br />Sepal.Length: 5.0<br />Species: setosa","Sepal.Width: 2.3<br />Sepal.Length: 4.5<br />Species: setosa","Sepal.Width: 3.2<br />Sepal.Length: 4.4<br />Species: setosa","Sepal.Width: 3.5<br />Sepal.Length: 5.0<br />Species: setosa","Sepal.Width: 3.8<br />Sepal.Length: 5.1<br />Species: setosa","Sepal.Width: 3.0<br />Sepal.Length: 4.8<br />Species: setosa","Sepal.Width: 3.8<br />Sepal.Length: 5.1<br />Species: setosa","Sepal.Width: 3.2<br />Sepal.Length: 4.6<br />Species: setosa","Sepal.Width: 3.7<br />Sepal.Length: 5.3<br />Species: setosa","Sepal.Width: 3.3<br />Sepal.Length: 5.0<br />Species: setosa"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"setosa","legendgroup":"setosa","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[3.2,3.2,3.1,2.3,2.8,2.8,3.3,2.4,2.9,2.7,2,3,2.2,2.9,2.9,3.1,3,2.7,2.2,2.5,3.2,2.8,2.5,2.8,2.9,3,2.8,3,2.9,2.6,2.4,2.4,2.7,2.7,3,3.4,3.1,2.3,3,2.5,2.6,3,2.6,2.3,2.7,3,2.9,2.9,2.5,2.8],"y":[7,6.4,6.9,5.5,6.5,5.7,6.3,4.9,6.6,5.2,5,5.9,6,6.1,5.6,6.7,5.6,5.8,6.2,5.6,5.9,6.1,6.3,6.1,6.4,6.6,6.8,6.7,6,5.7,5.5,5.5,5.8,6,5.4,6,6.7,6.3,5.6,5.5,5.5,6.1,5.8,5,5.6,5.7,5.7,6.2,5.1,5.7],"text":["Sepal.Width: 3.2<br />Sepal.Length: 7.0<br />Species: versicolor","Sepal.Width: 3.2<br />Sepal.Length: 6.4<br />Species: versicolor","Sepal.Width: 3.1<br />Sepal.Length: 6.9<br />Species: versicolor","Sepal.Width: 2.3<br />Sepal.Length: 5.5<br />Species: versicolor","Sepal.Width: 2.8<br />Sepal.Length: 6.5<br />Species: versicolor","Sepal.Width: 2.8<br />Sepal.Length: 5.7<br />Species: versicolor","Sepal.Width: 3.3<br />Sepal.Length: 6.3<br />Species: versicolor","Sepal.Width: 2.4<br />Sepal.Length: 4.9<br />Species: versicolor","Sepal.Width: 2.9<br />Sepal.Length: 6.6<br />Species: versicolor","Sepal.Width: 2.7<br />Sepal.Length: 5.2<br />Species: versicolor","Sepal.Width: 2.0<br />Sepal.Length: 5.0<br />Species: versicolor","Sepal.Width: 3.0<br />Sepal.Length: 5.9<br />Species: versicolor","Sepal.Width: 2.2<br />Sepal.Length: 6.0<br />Species: versicolor","Sepal.Width: 2.9<br />Sepal.Length: 6.1<br />Species: versicolor","Sepal.Width: 2.9<br />Sepal.Length: 5.6<br />Species: versicolor","Sepal.Width: 3.1<br />Sepal.Length: 6.7<br />Species: versicolor","Sepal.Width: 3.0<br />Sepal.Length: 5.6<br />Species: versicolor","Sepal.Width: 2.7<br />Sepal.Length: 5.8<br />Species: versicolor","Sepal.Width: 2.2<br />Sepal.Length: 6.2<br />Species: versicolor","Sepal.Width: 2.5<br />Sepal.Length: 5.6<br />Species: versicolor","Sepal.Width: 3.2<br />Sepal.Length: 5.9<br />Species: versicolor","Sepal.Width: 2.8<br />Sepal.Length: 6.1<br />Species: versicolor","Sepal.Width: 2.5<br />Sepal.Length: 6.3<br />Species: versicolor","Sepal.Width: 2.8<br />Sepal.Length: 6.1<br />Species: versicolor","Sepal.Width: 2.9<br />Sepal.Length: 6.4<br />Species: versicolor","Sepal.Width: 3.0<br />Sepal.Length: 6.6<br />Species: versicolor","Sepal.Width: 2.8<br />Sepal.Length: 6.8<br />Species: versicolor","Sepal.Width: 3.0<br />Sepal.Length: 6.7<br />Species: versicolor","Sepal.Width: 2.9<br />Sepal.Length: 6.0<br />Species: versicolor","Sepal.Width: 2.6<br />Sepal.Length: 5.7<br />Species: versicolor","Sepal.Width: 2.4<br />Sepal.Length: 5.5<br />Species: versicolor","Sepal.Width: 2.4<br />Sepal.Length: 5.5<br />Species: versicolor","Sepal.Width: 2.7<br />Sepal.Length: 5.8<br />Species: versicolor","Sepal.Width: 2.7<br />Sepal.Length: 6.0<br />Species: versicolor","Sepal.Width: 3.0<br />Sepal.Length: 5.4<br />Species: versicolor","Sepal.Width: 3.4<br />Sepal.Length: 6.0<br />Species: versicolor","Sepal.Width: 3.1<br />Sepal.Length: 6.7<br />Species: versicolor","Sepal.Width: 2.3<br />Sepal.Length: 6.3<br />Species: versicolor","Sepal.Width: 3.0<br />Sepal.Length: 5.6<br />Species: versicolor","Sepal.Width: 2.5<br />Sepal.Length: 5.5<br />Species: versicolor","Sepal.Width: 2.6<br />Sepal.Length: 5.5<br />Species: versicolor","Sepal.Width: 3.0<br />Sepal.Length: 6.1<br />Species: versicolor","Sepal.Width: 2.6<br />Sepal.Length: 5.8<br />Species: versicolor","Sepal.Width: 2.3<br />Sepal.Length: 5.0<br />Species: versicolor","Sepal.Width: 2.7<br />Sepal.Length: 5.6<br />Species: versicolor","Sepal.Width: 3.0<br />Sepal.Length: 5.7<br />Species: versicolor","Sepal.Width: 2.9<br />Sepal.Length: 5.7<br />Species: versicolor","Sepal.Width: 2.9<br />Sepal.Length: 6.2<br />Species: versicolor","Sepal.Width: 2.5<br />Sepal.Length: 5.1<br />Species: versicolor","Sepal.Width: 2.8<br />Sepal.Length: 5.7<br />Species: versicolor"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,186,56,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(0,186,56,1)"}},"hoveron":"points","name":"versicolor","legendgroup":"versicolor","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[3.3,2.7,3,2.9,3,3,2.5,2.9,2.5,3.6,3.2,2.7,3,2.5,2.8,3.2,3,3.8,2.6,2.2,3.2,2.8,2.8,2.7,3.3,3.2,2.8,3,2.8,3,2.8,3.8,2.8,2.8,2.6,3,3.4,3.1,3,3.1,3.1,3.1,2.7,3.2,3.3,3,2.5,3,3.4,3],"y":[6.3,5.8,7.1,6.3,6.5,7.6,4.9,7.3,6.7,7.2,6.5,6.4,6.8,5.7,5.8,6.4,6.5,7.7,7.7,6,6.9,5.6,7.7,6.3,6.7,7.2,6.2,6.1,6.4,7.2,7.4,7.9,6.4,6.3,6.1,7.7,6.3,6.4,6,6.9,6.7,6.9,5.8,6.8,6.7,6.7,6.3,6.5,6.2,5.9],"text":["Sepal.Width: 3.3<br />Sepal.Length: 6.3<br />Species: virginica","Sepal.Width: 2.7<br />Sepal.Length: 5.8<br />Species: virginica","Sepal.Width: 3.0<br />Sepal.Length: 7.1<br />Species: virginica","Sepal.Width: 2.9<br />Sepal.Length: 6.3<br />Species: virginica","Sepal.Width: 3.0<br />Sepal.Length: 6.5<br />Species: virginica","Sepal.Width: 3.0<br />Sepal.Length: 7.6<br />Species: virginica","Sepal.Width: 2.5<br />Sepal.Length: 4.9<br />Species: virginica","Sepal.Width: 2.9<br />Sepal.Length: 7.3<br />Species: virginica","Sepal.Width: 2.5<br />Sepal.Length: 6.7<br />Species: virginica","Sepal.Width: 3.6<br />Sepal.Length: 7.2<br />Species: virginica","Sepal.Width: 3.2<br />Sepal.Length: 6.5<br />Species: virginica","Sepal.Width: 2.7<br />Sepal.Length: 6.4<br />Species: virginica","Sepal.Width: 3.0<br />Sepal.Length: 6.8<br />Species: virginica","Sepal.Width: 2.5<br />Sepal.Length: 5.7<br />Species: virginica","Sepal.Width: 2.8<br />Sepal.Length: 5.8<br />Species: virginica","Sepal.Width: 3.2<br />Sepal.Length: 6.4<br />Species: virginica","Sepal.Width: 3.0<br />Sepal.Length: 6.5<br />Species: virginica","Sepal.Width: 3.8<br />Sepal.Length: 7.7<br />Species: virginica","Sepal.Width: 2.6<br />Sepal.Length: 7.7<br />Species: virginica","Sepal.Width: 2.2<br />Sepal.Length: 6.0<br />Species: virginica","Sepal.Width: 3.2<br />Sepal.Length: 6.9<br />Species: virginica","Sepal.Width: 2.8<br />Sepal.Length: 5.6<br />Species: virginica","Sepal.Width: 2.8<br />Sepal.Length: 7.7<br />Species: virginica","Sepal.Width: 2.7<br />Sepal.Length: 6.3<br />Species: virginica","Sepal.Width: 3.3<br />Sepal.Length: 6.7<br />Species: virginica","Sepal.Width: 3.2<br />Sepal.Length: 7.2<br />Species: virginica","Sepal.Width: 2.8<br />Sepal.Length: 6.2<br />Species: virginica","Sepal.Width: 3.0<br />Sepal.Length: 6.1<br />Species: virginica","Sepal.Width: 2.8<br />Sepal.Length: 6.4<br />Species: virginica","Sepal.Width: 3.0<br />Sepal.Length: 7.2<br />Species: virginica","Sepal.Width: 2.8<br />Sepal.Length: 7.4<br />Species: virginica","Sepal.Width: 3.8<br />Sepal.Length: 7.9<br />Species: virginica","Sepal.Width: 2.8<br />Sepal.Length: 6.4<br />Species: virginica","Sepal.Width: 2.8<br />Sepal.Length: 6.3<br />Species: virginica","Sepal.Width: 2.6<br />Sepal.Length: 6.1<br />Species: virginica","Sepal.Width: 3.0<br />Sepal.Length: 7.7<br />Species: virginica","Sepal.Width: 3.4<br />Sepal.Length: 6.3<br />Species: virginica","Sepal.Width: 3.1<br />Sepal.Length: 6.4<br />Species: virginica","Sepal.Width: 3.0<br />Sepal.Length: 6.0<br />Species: virginica","Sepal.Width: 3.1<br />Sepal.Length: 6.9<br />Species: virginica","Sepal.Width: 3.1<br />Sepal.Length: 6.7<br />Species: virginica","Sepal.Width: 3.1<br />Sepal.Length: 6.9<br />Species: virginica","Sepal.Width: 2.7<br />Sepal.Length: 5.8<br />Species: virginica","Sepal.Width: 3.2<br />Sepal.Length: 6.8<br />Species: virginica","Sepal.Width: 3.3<br />Sepal.Length: 6.7<br />Species: virginica","Sepal.Width: 3.0<br />Sepal.Length: 6.7<br />Species: virginica","Sepal.Width: 2.5<br />Sepal.Length: 6.3<br />Species: virginica","Sepal.Width: 3.0<br />Sepal.Length: 6.5<br />Species: virginica","Sepal.Width: 3.4<br />Sepal.Length: 6.2<br />Species: virginica","Sepal.Width: 3.0<br />Sepal.Length: 5.9<br />Species: virginica"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(97,156,255,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(97,156,255,1)"}},"hoveron":"points","name":"virginica","legendgroup":"virginica","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":24.2191780821918,"r":7.30593607305936,"b":38.1735159817352,"l":31.4155251141553},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[1.88,4.52],"tickmode":"array","ticktext":["2.0","2.5","3.0","3.5","4.0","4.5"],"tickvals":[2,2.5,3,3.5,4,4.5],"categoryorder":"array","categoryarray":["2.0","2.5","3.0","3.5","4.0","4.5"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"Sepal width","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[4.12,8.08],"tickmode":"array","ticktext":["5","6","7","8"],"tickvals":[5,6,7,8],"categoryorder":"array","categoryarray":["5","6","7","8"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"Sepal length","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"y":0.959399606299213},"annotations":[{"text":"Species","x":1.02,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"left","yanchor":"bottom","legendTitle":true}],"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"1ee055910294":{"x":{},"y":{},"colour":{},"type":"scatter"}},"cur_data":"1ee055910294","visdat":{"1ee055910294":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 8.3: <code>ggplotly</code> example.
</p>
</div>
<p>While the conversion is smooth for simple plots, your mileage may vary with more complex plots. Work is ongoing to improve the conversion process, and hopefully in the future <code>ggplotly</code> will be able to seamlessly convert any <code>ggplot2</code> graphic seamlessly to interactive <code>plotly</code> graphics. In the meantime, you just have to try it to check whether the conversion works for a specific plot you might need.</p>
</div>
<div id="using-plotly-with-knitr" class="section level2">
<h2><span class="header-section-number">8.2</span> Using plotly with knitr</h2>
<p>Plotly figures are rendered directly in the html output with knitr:</p>
<div class="sourceCode" id="cb483"><pre class="sourceCode markdown"><code class="sourceCode markdown"><a class="sourceLine" id="cb483-1" title="1"><span class="bn">```{r chunk-label, fig.cap = &#39;A figure caption.&#39;}</span></a>
<a class="sourceLine" id="cb483-2" title="2"><span class="bn">plot_ly(economics, x = ~date, y = ~unemploy / pop)</span></a>
<a class="sourceLine" id="cb483-3" title="3"><span class="bn">```</span></a></code></pre></div>
<p>please note that if the plot is assigned to a variable you need to call that variable in the code chunk for the plot to be rendered:</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode markdown"><code class="sourceCode markdown"><a class="sourceLine" id="cb484-1" title="1"><span class="bn">```{r chunk-label, fig.cap = &#39;A figure caption.&#39;}</span></a>
<a class="sourceLine" id="cb484-2" title="2"><span class="bn">p = plot_ly(economics, x = ~date, y = ~unemploy / pop)</span></a>
<a class="sourceLine" id="cb484-3" title="3"><span class="bn">p #call the variable storing the plot to render it</span></a>
<a class="sourceLine" id="cb484-4" title="4"><span class="bn">```</span></a></code></pre></div>
<p>Plotly figures can also appear in pdf files generate by knitr if the <code>webshot</code> package is installed. Besides this package, you will also need to have PhantomJS (<a href="http://phantomjs.org/" class="uri">http://phantomjs.org/</a>) installed on your system. You can install both <code>webshot</code> and PhantomJS from within R with the following commands:</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb485-1" title="1"><span class="kw">install.packages</span>(<span class="st">&quot;webshot&quot;</span>)</a>
<a class="sourceLine" id="cb485-2" title="2">webshot<span class="op">::</span><span class="kw">install_phantomjs</span>()</a></code></pre></div>

</div>
</div>
<div id="lattice" class="section level1">
<h1><span class="header-section-number">9</span> Lattice graphics</h1>
<p>The <code>lattice</code> package provides an alternative to the base R graphics system; it is an implementation of the ideas developed and implemented mainly by Rick Becker and Bill Cleveland in the Trellis graphics system for the S language <span class="citation">(Adler <a href="#ref-Adler2010">2010</a>; Crawley <a href="#ref-Crawley2013">2013</a>)</span>. Trellis displays were developed as a framework to easily display of the relationship between a dependent variable and multiple factors.</p>
<p>The best introduction to <code>lattice</code> graphics is the book by <span class="citation">Sarkar (<a href="#ref-Sarkar2008">2008</a>)</span>, the author of <code>lattice</code>. The <code>lattice</code> package documentation, available <a href="https://cran.r-project.org/web/packages/lattice/lattice.pdf">here</a>, is a good reference. The articles of <span class="citation">Sarkar (<a href="#ref-Sarkar2002">2002</a>)</span>, <span class="citation">Sarkar (<a href="#ref-Sarkar2003">2003</a>)</span>, and the book chapter of <span class="citation">Murrell (<a href="#ref-Murrell2001">2001</a>)</span> are good introductory resources.</p>
<p>Because <code>lattice</code> is mostly compatible with the Trellis graphics system in <a href="https://en.wikipedia.org/wiki/S-PLUS">S-Plus</a>, articles/documents written for Trellis <span class="citation">(e.g. Becker et al. <a href="#ref-BeckerEtAl1996">1996</a>; Becker, Cleveland, and Shyu <a href="#ref-BeckerEtAl1996b">1996</a>; Cleveland and Fuentes <a href="#ref-ClevelandAndFuentes1997">1997</a>; Becker and Cleveland <a href="#ref-BeckerAndCleveland2002">2002</a>)</span>, also provide a good introduction to <code>lattice</code> and to the concept of trellis displays.</p>
<div id="overview-of-lattice-graphics" class="section level2">
<h2><span class="header-section-number">9.1</span> Overview of lattice graphics</h2>
<p>Table <a href="#tab:latticefunctions">9.1</a> lists some of the most common high-level <code>lattice</code> plotting functions. We’ll look at some of these in the following sections, but first we’ll describe the model formulae system used by <code>lattice</code> and introduce the concept of multi-panel conditioning in the next section.</p>
<table>
<caption><span id="tab:latticefunctions">Table 9.1: </span> Some high-level plotting functions in <code>lattice</code>.</caption>
<thead>
<tr class="header">
<th align="left">Function</th>
<th align="left">Chart types</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>xyplot</code></td>
<td align="left">scatterplot, time-series, interaction plot</td>
</tr>
<tr class="even">
<td align="left"><code>barchart</code></td>
<td align="left">barplot</td>
</tr>
<tr class="odd">
<td align="left"><code>dotplot</code></td>
<td align="left">dotplot</td>
</tr>
<tr class="even">
<td align="left"><code>stripplot</code></td>
<td align="left">stripplot</td>
</tr>
<tr class="odd">
<td align="left"><code>bwplot</code></td>
<td align="left">box-and-whisker</td>
</tr>
</tbody>
</table>
</div>
<div id="lattmpancond" class="section level2">
<h2><span class="header-section-number">9.2</span> Introduction to model formulae and multi-panel conditioning</h2>
<p>To illustrate how conditioning on one or more factors works in <code>lattice</code> we’ll use the <code>npk</code> dataset, which contains data from a factorial experiment on the effects of N, P, K (nitrogen, phosphate, potassium) on the growth of peas:</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb486-1" title="1"><span class="kw">data</span>(npk)</a>
<a class="sourceLine" id="cb486-2" title="2">npk<span class="op">$</span>P =<span class="st"> </span><span class="kw">factor</span>(npk<span class="op">$</span>P, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;1&quot;</span>), <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;P=0&quot;</span>, <span class="st">&quot;P=1&quot;</span>))</a>
<a class="sourceLine" id="cb486-3" title="3">npk<span class="op">$</span>K =<span class="st"> </span><span class="kw">factor</span>(npk<span class="op">$</span>K, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;1&quot;</span>), <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;K=0&quot;</span>, <span class="st">&quot;K=1&quot;</span>))</a></code></pre></div>
<p>in the dataset <code>N</code>, <code>P</code>, and <code>K</code> are indicator variables for the application of the respective element (0=no, 1=yes). We renamed the levels of the P and K factors to make legends and strip labels easier to read. We’ll first plot the mean yield as a function of N, averaging across the levels of the other factors. In order to do this we’ll generate a summary data set:</p>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb487-1" title="1"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb487-2" title="2">npk_summ_N =<span class="st"> </span>npk <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(N) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">mean_yield=</span><span class="kw">mean</span>(yield),</a>
<a class="sourceLine" id="cb487-3" title="3">                                               <span class="dt">sd_yield=</span><span class="kw">sd</span>(yield))</a></code></pre></div>
<p>Two basic elements of <code>lattice</code> plots consist of a dataframe, and a model formula specifying how you want a given variable to be displayed along the dimensions of one or more factors. In our case, we want <code>mean_yield ~ N</code> (you could read the <code>~</code>, “as a function of”), the barchart can be produced with the code below, and is displayed in Figure <a href="#fig:lattnpkp1">9.1</a>:</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb488-1" title="1"><span class="kw">library</span>(lattice)</a>
<a class="sourceLine" id="cb488-2" title="2"><span class="co">##trellis.device() #optional opens an X11() window on Linux</span></a>
<a class="sourceLine" id="cb488-3" title="3">pl1 =<span class="st"> </span><span class="kw">barchart</span>(mean_yield <span class="op">~</span><span class="st"> </span>N, <span class="dt">data=</span>npk_summ_N,</a>
<a class="sourceLine" id="cb488-4" title="4">               <span class="dt">xlab=</span><span class="st">&quot;N&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Mean yield&quot;</span>)</a>
<a class="sourceLine" id="cb488-5" title="5"><span class="kw">print</span>(pl1)</a></code></pre></div>
<div class="figure"><span id="fig:lattnpkp1"></span>
<img src="09_lattice_files/figure-html/lattnpkp1-1.png" alt="Yield as a function of nitrogen application." width="326.4" />
<p class="caption">
Figure 9.1: Yield as a function of nitrogen application.
</p>
</div>
<p>Now suppose we want to visualise the relation between <code>yield</code> and N depending on P administration. In lattice there are two ways of doing it, one is by the use of a “grouping” factor. The second way is by multi-panel factor conditioning. The advantage of multi-panel conditioning, as we will see soon, is that it can be extended to an unlimited number of factors. Let’s start with the first solution, in which we use a grouping factor. We first generate a summary dataset as a function of both N and P with:</p>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb489-1" title="1">npk_summ_NP =<span class="st"> </span>npk <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(N,P) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">mean_yield=</span><span class="kw">mean</span>(yield),</a>
<a class="sourceLine" id="cb489-2" title="2">                                                  <span class="dt">sd_yield=</span><span class="kw">sd</span>(yield))</a></code></pre></div>
<p>and then generate the barplot (shown in Figure <a href="#fig:lattnpkp2">9.2</a>):</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb490-1" title="1">pl2 =<span class="st"> </span><span class="kw">barchart</span>(mean_yield <span class="op">~</span><span class="st"> </span>N, <span class="dt">groups=</span>P, </a>
<a class="sourceLine" id="cb490-2" title="2">               <span class="dt">data=</span>npk_summ_NP, <span class="dt">auto.key=</span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb490-3" title="3">               <span class="dt">xlab=</span><span class="st">&quot;N&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Mean yield&quot;</span>)</a>
<a class="sourceLine" id="cb490-4" title="4"><span class="kw">print</span>(pl2)</a></code></pre></div>
<div class="figure"><span id="fig:lattnpkp2"></span>
<img src="09_lattice_files/figure-html/lattnpkp2-1.png" alt="Barplot with bars side by side showing yield as a function of nitrogen and potassium application." width="326.4" />
<p class="caption">
Figure 9.2: Barplot with bars side by side showing yield as a function of nitrogen and potassium application.
</p>
</div>
<p>the grouping factor is given by the <code>groups</code> argument, note also that we have set <code>auto.key</code> to <code>TRUE</code> in order to automatically add a legend.</p>
<p>The second way of building the graph is by multi-panel conditioning. We achieve this by setting P as a conditioning factor with the <code>|</code> operator. The model formula becomes <code>mean_yield ~ N | P</code>, which you could read as &quot;mean yield as a function of N, given P`. The plot shown in Figure <a href="#fig:lattnpkp3">9.3</a>:</p>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb491-1" title="1">pl3 =<span class="st"> </span><span class="kw">barchart</span>(mean_yield <span class="op">~</span><span class="st"> </span>N <span class="op">|</span><span class="st"> </span>P, <span class="dt">data=</span>npk_summ_NP,</a>
<a class="sourceLine" id="cb491-2" title="2">               <span class="dt">xlab=</span><span class="st">&quot;N&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Mean yield&quot;</span>)</a>
<a class="sourceLine" id="cb491-3" title="3"><span class="kw">print</span>(pl3)</a></code></pre></div>
<div class="figure"><span id="fig:lattnpkp3"></span>
<img src="09_lattice_files/figure-html/lattnpkp3-1.png" alt="Barplot showing yield as a function of nitrogen and potassium application using multi-panel conditioning." width="326.4" />
<p class="caption">
Figure 9.3: Barplot showing yield as a function of nitrogen and potassium application using multi-panel conditioning.
</p>
</div>
<p>We can visualize the effect of all three factors (N, P, K) by showing mean values of K along different panels. We’ll first generate a summary dataset as a function of all three factors:</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb492-1" title="1">npk_summ_NPK =<span class="st"> </span>npk <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(N,P,K) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">mean_yield=</span><span class="kw">mean</span>(yield),</a>
<a class="sourceLine" id="cb492-2" title="2">                                                     <span class="dt">sd_yield=</span><span class="kw">sd</span>(yield))</a></code></pre></div>
<p>and then generate the plot (shown in Figure <a href="#fig:lattnpkp4">9.4</a>):</p>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb493-1" title="1">pl4 =<span class="st"> </span><span class="kw">barchart</span>(mean_yield <span class="op">~</span><span class="st"> </span>N <span class="op">|</span><span class="st"> </span>P<span class="op">+</span>K, <span class="dt">data=</span>npk_summ_NPK,</a>
<a class="sourceLine" id="cb493-2" title="2">               <span class="dt">xlab=</span><span class="st">&quot;N&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Mean yield&quot;</span>)</a>
<a class="sourceLine" id="cb493-3" title="3"><span class="kw">print</span>(pl4)</a></code></pre></div>
<div class="figure"><span id="fig:lattnpkp4"></span>
<img src="09_lattice_files/figure-html/lattnpkp4-1.png" alt="Barplot showing yield as a function of nitrogen and potassium application. Panels plot mean yield as a function of the application of phosphate (0=no, 1=yes)." width="489.6" />
<p class="caption">
Figure 9.4: Barplot showing yield as a function of nitrogen and potassium application. Panels plot mean yield as a function of the application of phosphate (0=no, 1=yes).
</p>
</div>
<p>Also in this case we could have used a grouping variable rather than using two conditioning factors (Figure <a href="#fig:lattnpkp5">9.5</a>):</p>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb494-1" title="1">pl5 =<span class="st"> </span><span class="kw">barchart</span>(mean_yield <span class="op">~</span><span class="st"> </span>N <span class="op">|</span><span class="st"> </span>P, <span class="dt">groups=</span>K, <span class="dt">data=</span>npk_summ_NPK,</a>
<a class="sourceLine" id="cb494-2" title="2">               <span class="dt">xlab=</span><span class="st">&quot;N&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Mean yield&quot;</span>, <span class="dt">auto.key=</span>T)</a>
<a class="sourceLine" id="cb494-3" title="3"><span class="kw">print</span>(pl5)</a></code></pre></div>
<div class="figure"><span id="fig:lattnpkp5"></span>
<img src="09_lattice_files/figure-html/lattnpkp5-1.png" alt="Barplot showing yield as a function of nitrogen, phosphate, and potassium application. Panels plot mean yield as a function of the application of potassium (0=no, 1=yes)." width="326.4" />
<p class="caption">
Figure 9.5: Barplot showing yield as a function of nitrogen, phosphate, and potassium application. Panels plot mean yield as a function of the application of potassium (0=no, 1=yes).
</p>
</div>
<p>what is the best display is up to the user to decide, and depends from case to case.</p>
</div>
<div id="lattcommon" class="section level2">
<h2><span class="header-section-number">9.3</span> Common charts</h2>
<div id="xyplot" class="section level3">
<h3><span class="header-section-number">9.3.1</span> <code>xyplot</code></h3>
<p>The <code>xyplot</code> function can be used to generate scatterplots and time-series plots.</p>
<p>We’ll plot a scatterplot using the <code>iris</code> dataset (plot shown in Figure <a href="#fig:lattiris2">9.6</a>):</p>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb495-1" title="1">p =<span class="st"> </span><span class="kw">xyplot</span>(Sepal.Length<span class="op">~</span>Sepal.Width, <span class="dt">groups=</span>Species, <span class="dt">data=</span>iris, <span class="dt">auto.key=</span>T)</a>
<a class="sourceLine" id="cb495-2" title="2"><span class="kw">print</span>(p)</a></code></pre></div>
<div class="figure"><span id="fig:lattiris2"></span>
<img src="09_lattice_files/figure-html/lattiris2-1.png" alt="Scatterplot of sepal length by sepal width for the iris measurements in the `iris` dataset." width="326.4" />
<p class="caption">
Figure 9.6: Scatterplot of sepal length by sepal width for the iris measurements in the <code>iris</code> dataset.
</p>
</div>
<p>We can also obtain points connected by lines by passing the <code>type=&quot;b&quot;</code> argument to <code>xyplot</code>. To illustrate this we’ll plot a time series using the <code>Orange</code> built-in R datasets, which contains data on the growth of five orange trees (plot shown in Figure <a href="#fig:lattorange1">9.7</a>):</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb496-1" title="1"><span class="kw">xyplot</span>(circumference<span class="op">~</span>age, <span class="dt">group=</span>Tree, <span class="dt">data=</span>Orange,</a>
<a class="sourceLine" id="cb496-2" title="2">       <span class="dt">type=</span><span class="st">&quot;b&quot;</span>, <span class="dt">as.table=</span>T,</a>
<a class="sourceLine" id="cb496-3" title="3">       <span class="dt">xlab=</span><span class="st">&quot;Age (days)&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Circumference (mm)&quot;</span>,</a>
<a class="sourceLine" id="cb496-4" title="4">       <span class="dt">auto.key=</span><span class="kw">list</span>(<span class="dt">title=</span><span class="st">&quot;Tree&quot;</span>, <span class="dt">space=</span><span class="st">&quot;right&quot;</span>))</a></code></pre></div>
<div class="figure"><span id="fig:lattorange1"></span>
<img src="09_lattice_files/figure-html/lattorange1-1.png" alt="Growth of orange trees: trunk circumference by age (in days) for five trees." width="326.4" />
<p class="caption">
Figure 9.7: Growth of orange trees: trunk circumference by age (in days) for five trees.
</p>
</div>
</div>
<div id="lattbarchart" class="section level3">
<h3><span class="header-section-number">9.3.2</span> <code>barchart</code></h3>
<p>We have already seen a few examples of barcharts built with <code>lattice</code> in Section <a href="#lattmpancond">9.2</a>. We’ll look at a few more examples in this section.</p>
<p>The following dataset contains both positive and negative values:</p>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb497-1" title="1">dat =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">y=</span><span class="kw">c</span>(<span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="dv">1</span>, <span class="fl">-0.8</span>),</a>
<a class="sourceLine" id="cb497-2" title="2">                 <span class="dt">fct1=</span><span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;B&quot;</span>),</a>
<a class="sourceLine" id="cb497-3" title="3">                 <span class="dt">fct2 =</span> <span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>)</a>
<a class="sourceLine" id="cb497-4" title="4">                 )</a></code></pre></div>
<p>in order to plot a barchart with bars going either up or down from a baseline value of zero we have to pass the argument <code>origin=0</code>. We’ll also change the fill color of the bars by changing the <code>col</code> attribute in the <code>superpose.polygon</code> list of settings (more info on setting graphical parameters in <code>lattice</code> are given in Section <a href="#trellispar">9.4.1</a>). The code for the barchart is shown below, the resulting plot is shown in Figure <a href="#fig:lattbarorig1">9.8</a>.</p>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb498-1" title="1"><span class="kw">trellis.par.set</span>(<span class="dt">superpose.polygon =</span> </a>
<a class="sourceLine" id="cb498-2" title="2">                    <span class="kw">list</span>(<span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;darkslateblue&quot;</span>, <span class="st">&quot;indianred&quot;</span>))</a>
<a class="sourceLine" id="cb498-3" title="3">                )</a>
<a class="sourceLine" id="cb498-4" title="4">p =<span class="st"> </span><span class="kw">barchart</span>(y<span class="op">~</span>fct1, <span class="dt">origin=</span><span class="dv">0</span>, <span class="dt">groups=</span>fct2,</a>
<a class="sourceLine" id="cb498-5" title="5">             <span class="dt">data=</span>dat)</a>
<a class="sourceLine" id="cb498-6" title="6"><span class="kw">print</span>(p)</a></code></pre></div>
<div class="figure"><span id="fig:lattbarorig1"></span>
<img src="09_lattice_files/figure-html/lattbarorig1-1.png" alt="Barchart with origin set to zero." width="326.4" />
<p class="caption">
Figure 9.8: Barchart with origin set to zero.
</p>
</div>
</div>
<div id="barcharts-with-error-bars" class="section level3">
<h3><span class="header-section-number">9.3.3</span> Barcharts with error bars</h3>
<p>There is no built-in support to add error bars to barcharts in <code>lattice</code>. This may be partly due to the fact that the <code>lattice</code> author thinks that barcharts with error bars are a bad data visualization choice (see discussion on R mailing list <a href="https://stat.ethz.ch/pipermail/r-help/2006-May/105570.html">here</a>).</p>
<p>Writing a custom panel function (see Section <a href="#trellispanel">9.5</a>) for adding error bars to bar charts is complicated by the fact <code>panel.barchart</code> performs several calculations for placing the bars and the custom function needs to take them into account to work correctly. The code associated with this guide contains a file (<code>barchart_errbar.R</code>) with a modified barchart panel function that can draw error bars in some conditions. We’ll see how to use it shortly, but keep in mind that it may or may not work correctly, and that you should double check that it is doing the right thing! Also, it doesn’t work for horizontal barcharts.</p>
<p>For the following examples we’ll use the <code>npk</code> dataset, which we have introduced in Section <a href="#lattmpancond">9.2</a>. Again, we first generate a summary dataset with mean yield as a function of N with the code below:</p>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb499-1" title="1"><span class="kw">data</span>(npk)</a>
<a class="sourceLine" id="cb499-2" title="2">npk<span class="op">$</span>P =<span class="st"> </span><span class="kw">factor</span>(npk<span class="op">$</span>P, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;1&quot;</span>), <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;P=0&quot;</span>, <span class="st">&quot;P=1&quot;</span>))</a>
<a class="sourceLine" id="cb499-3" title="3">npk<span class="op">$</span>K =<span class="st"> </span><span class="kw">factor</span>(npk<span class="op">$</span>K, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;1&quot;</span>), <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;K=0&quot;</span>, <span class="st">&quot;K=1&quot;</span>))</a>
<a class="sourceLine" id="cb499-4" title="4">npk_summ_N =<span class="st"> </span>npk <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(N) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">mean_yield=</span><span class="kw">mean</span>(yield),</a>
<a class="sourceLine" id="cb499-5" title="5">                                               <span class="dt">sd_yield=</span><span class="kw">sd</span>(yield))</a>
<a class="sourceLine" id="cb499-6" title="6">npk_summ_N<span class="op">$</span>ci.l =<span class="st"> </span>npk_summ_N<span class="op">$</span>mean_yield <span class="op">-</span><span class="st"> </span>npk_summ_N<span class="op">$</span>sd_yield</a>
<a class="sourceLine" id="cb499-7" title="7">npk_summ_N<span class="op">$</span>ci.u =<span class="st"> </span>npk_summ_N<span class="op">$</span>mean_yield <span class="op">+</span><span class="st"> </span>npk_summ_N<span class="op">$</span>sd_yield</a></code></pre></div>
<p>The last two lines of code add a <code>ci.l</code> and a <code>ci.u</code> column, which represent, respectively, the lower and upper limits of the error bars; we’ll use these two columns to add error bars to the plot. The code to draw the barchart with error bars is shown below:</p>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb500-1" title="1"><span class="kw">source</span>(<span class="st">&quot;code/barchart_errbar.R&quot;</span>)</a>
<a class="sourceLine" id="cb500-2" title="2">p1 =<span class="st"> </span><span class="kw">barchart</span>(mean_yield<span class="op">~</span>N, <span class="dt">data=</span>npk_summ_N,</a>
<a class="sourceLine" id="cb500-3" title="3">              <span class="dt">ci.l=</span>npk_summ_N<span class="op">$</span>ci.l, <span class="dt">ci.u=</span>npk_summ_N<span class="op">$</span>ci.u,</a>
<a class="sourceLine" id="cb500-4" title="4">              <span class="dt">plot.ci=</span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb500-5" title="5">              <span class="dt">auto.key=</span><span class="kw">list</span>(<span class="dt">space=</span><span class="st">&quot;top&quot;</span>, <span class="dt">points=</span>F, <span class="dt">rectangles=</span>T),</a>
<a class="sourceLine" id="cb500-6" title="6">              <span class="dt">prepanel=</span>prepanel.barchart_errbar,</a>
<a class="sourceLine" id="cb500-7" title="7">              <span class="dt">panel=</span><span class="cf">function</span>(x,y, ci.l, ci.u, subscripts,...){</a>
<a class="sourceLine" id="cb500-8" title="8">                  ci.l =<span class="st"> </span>ci.l[subscripts]</a>
<a class="sourceLine" id="cb500-9" title="9">                  ci.u =<span class="st"> </span>ci.u[subscripts]</a>
<a class="sourceLine" id="cb500-10" title="10">                  <span class="kw">panel.barchart_errbar</span>(x, y, <span class="dt">ci.l=</span>ci.l, <span class="dt">ci.u=</span>ci.u,</a>
<a class="sourceLine" id="cb500-11" title="11">                                  <span class="dt">subscripts=</span>subscripts,...)</a>
<a class="sourceLine" id="cb500-12" title="12">              }</a>
<a class="sourceLine" id="cb500-13" title="13">              )</a>
<a class="sourceLine" id="cb500-14" title="14"><span class="kw">print</span>(p1)</a></code></pre></div>
<div class="figure"><span id="fig:lattbrcherr1"></span>
<img src="09_lattice_files/figure-html/lattbrcherr1-1.png" alt="Barchart with error bar with no multipanel conditioning and no groups." width="326.4" />
<p class="caption">
Figure 9.9: Barchart with error bar with no multipanel conditioning and no groups.
</p>
</div>
<p>we first <code>source</code> the <code>barchart_errbar.R</code> file containing the custom panel and prepanel functions needed to draw the barchart with error bars, and then call the <code>barchart</code> function to draw the plot. Compared to a normal barchart we need to pass it a few additional arguments: the <code>ci.l</code> and <code>ci.u</code> vectors representing the lower and upper error bars limits; <code>plot.ci</code>, a boolean indicating whether to draw the error bars or not; <code>prepanel</code>, which is used to pass the <code>prepanel.barchart_errbar</code> function that sets the <code>y</code> axis limits so as to accommodate the error bars; a custom panel function, which in turn calls the <code>panel.barchart_errbar</code> function. Both <code>prepanel.barchart_errbar</code>, <code>panel.barchart_errbar</code> are functions defined in the <code>barchart_errbar.R</code> file. The resulting plot is shown in Figure <a href="#fig:lattbrcherr1">9.9</a></p>
<p>Next we’re going to look at the case of a single panel with a <code>groups</code> argument. For the next example we generate a new summary dataset as a function of N and P:</p>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb501-1" title="1">npk_summ_NP =<span class="st"> </span>npk <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(N,P) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">mean_yield=</span><span class="kw">mean</span>(yield),</a>
<a class="sourceLine" id="cb501-2" title="2">                                                  <span class="dt">sd_yield=</span><span class="kw">sd</span>(yield))</a>
<a class="sourceLine" id="cb501-3" title="3">npk_summ_NP<span class="op">$</span>ci.l =<span class="st"> </span>npk_summ_NP<span class="op">$</span>mean_yield <span class="op">-</span><span class="st"> </span>npk_summ_NP<span class="op">$</span>sd_yield</a>
<a class="sourceLine" id="cb501-4" title="4">npk_summ_NP<span class="op">$</span>ci.u =<span class="st"> </span>npk_summ_NP<span class="op">$</span>mean_yield <span class="op">+</span><span class="st"> </span>npk_summ_NP<span class="op">$</span>sd_yield</a></code></pre></div>
<p>then we draw the barchart (shown in Figure <a href="#fig:lattbrcherr2">9.10</a>) with the code below:</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb502-1" title="1">p2 =<span class="st"> </span><span class="kw">barchart</span>(mean_yield<span class="op">~</span>N, <span class="dt">groups=</span>P, <span class="dt">data=</span>npk_summ_NP,</a>
<a class="sourceLine" id="cb502-2" title="2">              <span class="dt">ci.l=</span>npk_summ_NP<span class="op">$</span>ci.l, <span class="dt">ci.u=</span>npk_summ_NP<span class="op">$</span>ci.u,</a>
<a class="sourceLine" id="cb502-3" title="3">              <span class="dt">plot.ci=</span>T, <span class="dt">auto.key=</span><span class="kw">list</span>(<span class="dt">space=</span><span class="st">&quot;top&quot;</span>, <span class="dt">points=</span>F, <span class="dt">rectangles=</span>T),</a>
<a class="sourceLine" id="cb502-4" title="4">              <span class="dt">panel=</span><span class="cf">function</span>(x, y, ci.l, ci.u, subscripts,...){</a>
<a class="sourceLine" id="cb502-5" title="5">                  ci.l =<span class="st"> </span>ci.l[subscripts]</a>
<a class="sourceLine" id="cb502-6" title="6">                  ci.u =<span class="st"> </span>ci.u[subscripts]</a>
<a class="sourceLine" id="cb502-7" title="7">                  <span class="kw">panel.barchart_errbar</span>(x,y, <span class="dt">ci.l=</span>ci.l, <span class="dt">ci.u=</span>ci.u,</a>
<a class="sourceLine" id="cb502-8" title="8">                                  <span class="dt">subscripts=</span>subscripts,...)</a>
<a class="sourceLine" id="cb502-9" title="9">              }, <span class="dt">prepanel=</span>prepanel.barchart_errbar</a>
<a class="sourceLine" id="cb502-10" title="10">              )</a>
<a class="sourceLine" id="cb502-11" title="11"><span class="kw">print</span>(p2)</a></code></pre></div>
<div class="figure"><span id="fig:lattbrcherr2"></span>
<img src="09_lattice_files/figure-html/lattbrcherr2-1.png" alt="Barchart with error bar with groups but no multipanel conditioning." width="326.4" />
<p class="caption">
Figure 9.10: Barchart with error bar with groups but no multipanel conditioning.
</p>
</div>
<p>Finally, we look at the case of multiple panels with grouped bars. For this example we generate a summary dataset as a function of N, P, and K:</p>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb503-1" title="1">npk_summ_NPK =<span class="st"> </span>npk <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(N,P,K) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">mean_yield=</span><span class="kw">mean</span>(yield),</a>
<a class="sourceLine" id="cb503-2" title="2">                                                     <span class="dt">sd_yield=</span><span class="kw">sd</span>(yield))</a>
<a class="sourceLine" id="cb503-3" title="3">npk_summ_NPK<span class="op">$</span>ci.l =<span class="st"> </span>npk_summ_NPK<span class="op">$</span>mean_yield <span class="op">-</span><span class="st"> </span>npk_summ_NPK<span class="op">$</span>sd_yield</a>
<a class="sourceLine" id="cb503-4" title="4">npk_summ_NPK<span class="op">$</span>ci.u =<span class="st"> </span>npk_summ_NPK<span class="op">$</span>mean_yield <span class="op">+</span><span class="st"> </span>npk_summ_NPK<span class="op">$</span>sd_yield</a></code></pre></div>
<p>then we draw the barchart (shown in Figure <a href="#fig:lattbrcherr3">9.11</a>) with the code below:</p>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb504-1" title="1">p3 =<span class="st"> </span><span class="kw">barchart</span>(mean_yield<span class="op">~</span>N <span class="op">|</span><span class="st"> </span>P, <span class="dt">groups=</span>K, <span class="dt">data=</span>npk_summ_NPK,</a>
<a class="sourceLine" id="cb504-2" title="2">             <span class="dt">ci.l=</span>npk_summ_NPK<span class="op">$</span>ci.l, <span class="dt">ci.u=</span>npk_summ_NPK<span class="op">$</span>ci.u,</a>
<a class="sourceLine" id="cb504-3" title="3">             <span class="dt">plot.ci=</span>T, <span class="dt">auto.key=</span><span class="kw">list</span>(<span class="dt">space=</span><span class="st">&quot;top&quot;</span>, <span class="dt">points=</span>F, <span class="dt">rectangles=</span>T),</a>
<a class="sourceLine" id="cb504-4" title="4">             <span class="dt">panel=</span><span class="cf">function</span>(x, y, ci.l, ci.u, subscripts,...){</a>
<a class="sourceLine" id="cb504-5" title="5">                      ci.l =<span class="st"> </span>ci.l[subscripts]</a>
<a class="sourceLine" id="cb504-6" title="6">                      ci.u =<span class="st"> </span>ci.u[subscripts]</a>
<a class="sourceLine" id="cb504-7" title="7">                      <span class="kw">panel.barchart_errbar</span>(x,y, <span class="dt">ci.l=</span>ci.l, <span class="dt">ci.u=</span>ci.u,</a>
<a class="sourceLine" id="cb504-8" title="8">                                      <span class="dt">subscripts=</span>subscripts,...)</a>
<a class="sourceLine" id="cb504-9" title="9">             }, <span class="dt">prepanel=</span>prepanel.barchart_errbar)</a>
<a class="sourceLine" id="cb504-10" title="10"><span class="kw">print</span>(p3)</a></code></pre></div>
<div class="figure"><span id="fig:lattbrcherr3"></span>
<img src="09_lattice_files/figure-html/lattbrcherr3-1.png" alt="Barchart with error bar with groups and multipanel conditioning." width="489.6" />
<p class="caption">
Figure 9.11: Barchart with error bar with groups and multipanel conditioning.
</p>
</div>
</div>
<div id="latthist" class="section level3">
<h3><span class="header-section-number">9.3.4</span> Histograms and density plots</h3>
<p>We’ll plot an histogram of sepal length from the <code>iris</code> dataset (Figure <a href="#fig:latthist1">9.12</a>):</p>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb505-1" title="1"><span class="kw">data</span>(iris)</a>
<a class="sourceLine" id="cb505-2" title="2">p =<span class="st"> </span><span class="kw">histogram</span>(<span class="op">~</span>Sepal.Length, <span class="dt">data=</span>iris)</a>
<a class="sourceLine" id="cb505-3" title="3"><span class="kw">print</span>(p)</a></code></pre></div>
<div class="figure"><span id="fig:latthist1"></span>
<img src="09_lattice_files/figure-html/latthist1-1.png" alt="Histogram of sepal length in the `iris` dataset." width="326.4" />
<p class="caption">
Figure 9.12: Histogram of sepal length in the <code>iris</code> dataset.
</p>
</div>
<p>the model formula for the <code>histogram</code> function is somehow unusual because the “y” variable is computed by <code>lattice</code>, and we pass the variable for which we want to compute it after the tilde (<code>~</code>). As usual it is also possible to use multi-panel conditioning, as shown by the graph in Figure <a href="#fig:latthist2">9.13</a>, which plots histograms for sepal length separately for each iris species, and was obtained with the code below:</p>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb506-1" title="1">p =<span class="st"> </span><span class="kw">histogram</span>(<span class="op">~</span>Sepal.Length <span class="op">|</span><span class="st"> </span>Species, <span class="dt">data=</span>iris)</a>
<a class="sourceLine" id="cb506-2" title="2"><span class="kw">print</span>(p)</a></code></pre></div>
<div class="figure"><span id="fig:latthist2"></span>
<img src="09_lattice_files/figure-html/latthist2-1.png" alt="Histogram of sepal length in the `iris` dataset as a function of iris species." width="489.6" />
<p class="caption">
Figure 9.13: Histogram of sepal length in the <code>iris</code> dataset as a function of iris species.
</p>
</div>
<p>Density plots can be obtained with a similar formula (Figure <a href="#fig:lattdens1">9.14</a>):</p>
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb507-1" title="1">p =<span class="st"> </span><span class="kw">densityplot</span>(<span class="op">~</span>Sepal.Length, <span class="dt">data=</span>iris)</a>
<a class="sourceLine" id="cb507-2" title="2"><span class="kw">print</span>(p)</a></code></pre></div>
<div class="figure"><span id="fig:lattdens1"></span>
<img src="09_lattice_files/figure-html/lattdens1-1.png" alt="Density plot of sepal length in the `iris` dataset." width="326.4" />
<p class="caption">
Figure 9.14: Density plot of sepal length in the <code>iris</code> dataset.
</p>
</div>
<p>by default <code>densityplot</code> plots the individual observation as points. This can be turned off by setting <code>plot.points=FALSE</code>:</p>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb508-1" title="1">p =<span class="st"> </span><span class="kw">densityplot</span>(<span class="op">~</span>Sepal.Length, <span class="dt">plot.points=</span><span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb508-2" title="2">                <span class="dt">data=</span>iris)</a></code></pre></div>
</div>
<div id="interaction-plots" class="section level3">
<h3><span class="header-section-number">9.3.5</span> Interaction plots</h3>
<p>For the next example we’ll use the <code>ToothGrowth</code> built-in R dataset, which contains measurements of the length of odontoblasts (cells responsible for tooth growth) in 60 guinea pigs. Each guinea pig had received one of three doses of vitamin C (0.5, 1, and 2 mg/day) by one of two delivery methods, orange juice (OJ) or ascorbic acid (VC).</p>
<div class="sourceCode" id="cb509"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb509-1" title="1"><span class="kw">data</span>(ToothGrowth)</a>
<a class="sourceLine" id="cb509-2" title="2"><span class="kw">head</span>(ToothGrowth)</a></code></pre></div>
<pre><code>##    len supp dose
## 1  4.2   VC  0.5
## 2 11.5   VC  0.5
## 3  7.3   VC  0.5
## 4  5.8   VC  0.5
## 5  6.4   VC  0.5
## 6 10.0   VC  0.5</code></pre>
<p>we’ll first generate a summary dataset as a function of delivery method (<code>supp</code> variable), and dose:</p>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb511-1" title="1">ToothGrowthSumm =<span class="st"> </span>ToothGrowth <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(supp, dose) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb511-2" title="2"><span class="st">                                  </span><span class="kw">summarize</span>(<span class="dt">meanLen=</span><span class="kw">mean</span>(len))</a>
<a class="sourceLine" id="cb511-3" title="3">ToothGrowthSumm<span class="op">$</span>dose =<span class="st"> </span><span class="kw">factor</span>(ToothGrowthSumm<span class="op">$</span>dose)</a></code></pre></div>
<p>now we can generate the plot (shown in Figure <a href="#fig:latttoothgrowth1">9.15</a>) with the following code:</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb512-1" title="1">p =<span class="st"> </span><span class="kw">xyplot</span>(meanLen<span class="op">~</span>supp, <span class="dt">groups=</span>dose, <span class="dt">data=</span>ToothGrowthSumm,</a>
<a class="sourceLine" id="cb512-2" title="2">           <span class="dt">panel=</span><span class="st">&quot;panel.superpose&quot;</span>, <span class="dt">panel.groups=</span><span class="st">&quot;panel.linejoin&quot;</span>,</a>
<a class="sourceLine" id="cb512-3" title="3">           <span class="dt">auto.key=</span><span class="kw">list</span>(<span class="dt">points=</span>F, <span class="dt">lines=</span>T, <span class="dt">title=</span><span class="st">&quot;Dose&quot;</span>, <span class="dt">space=</span><span class="st">&quot;right&quot;</span>),</a>
<a class="sourceLine" id="cb512-4" title="4">           <span class="dt">xlab=</span><span class="st">&quot;Delivery method&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Mean growth&quot;</span>)</a>
<a class="sourceLine" id="cb512-5" title="5"><span class="kw">print</span>(p)</a></code></pre></div>
<div class="figure"><span id="fig:latttoothgrowth1"></span>
<img src="09_lattice_files/figure-html/latttoothgrowth1-1.png" alt="Tooth growth by vitamin C dose and delivery method in guinea pigs." width="408" />
<p class="caption">
Figure 9.15: Tooth growth by vitamin C dose and delivery method in guinea pigs.
</p>
</div>
<p>Obtaining an interaction plot with both lines and points requires writing a custon panel function:</p>
<div class="sourceCode" id="cb513"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb513-1" title="1">panelint =<span class="st"> </span><span class="cf">function</span>(x, y, ...){</a>
<a class="sourceLine" id="cb513-2" title="2">    <span class="kw">panel.points</span>(x, y, ...)</a>
<a class="sourceLine" id="cb513-3" title="3">    <span class="kw">panel.linejoin</span>(x, y, ...)</a>
<a class="sourceLine" id="cb513-4" title="4">}</a></code></pre></div>
<p>the plot, shown in Figure <a href="#fig:latttoothgrowth2">9.16</a>, can then be obtained by using this custom function:</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb514-1" title="1">p =<span class="st"> </span><span class="kw">xyplot</span>(meanLen<span class="op">~</span>supp, <span class="dt">groups=</span>dose, <span class="dt">data=</span>ToothGrowthSumm,</a>
<a class="sourceLine" id="cb514-2" title="2">           <span class="dt">panel=</span><span class="st">&quot;panel.superpose&quot;</span>, <span class="dt">panel.groups=</span><span class="st">&quot;panelint&quot;</span>,</a>
<a class="sourceLine" id="cb514-3" title="3">           <span class="dt">auto.key=</span><span class="kw">list</span>(<span class="dt">points=</span>T, <span class="dt">lines=</span>T, <span class="dt">title=</span><span class="st">&quot;Dose&quot;</span>, <span class="dt">space=</span><span class="st">&quot;right&quot;</span>),</a>
<a class="sourceLine" id="cb514-4" title="4">           <span class="dt">xlab=</span><span class="st">&quot;Delivery method&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Mean growth&quot;</span>)</a>
<a class="sourceLine" id="cb514-5" title="5"><span class="kw">print</span>(p)</a></code></pre></div>
<div class="figure"><span id="fig:latttoothgrowth2"></span>
<img src="09_lattice_files/figure-html/latttoothgrowth2-1.png" alt="Tooth growth by vitamin C dose and delivery method in guinea pigs." width="408" />
<p class="caption">
Figure 9.16: Tooth growth by vitamin C dose and delivery method in guinea pigs.
</p>
</div>
</div>
</div>
<div id="customizingtrellis" class="section level2">
<h2><span class="header-section-number">9.4</span> Customizing lattice graphics</h2>
<div id="trellispar" class="section level3">
<h3><span class="header-section-number">9.4.1</span> Themes</h3>
<p>The function <code>show.settings</code> gives a graphical overview of the current theme. The settings for the current theme are stored in a list, which you can get with:</p>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb515-1" title="1">curr_theme =<span class="st"> </span><span class="kw">trellis.par.get</span>()</a></code></pre></div>
<p>the list contains many items, which are themselved lists of more basic attributes, we’ll take a peak at the names of the itmes:</p>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb516-1" title="1"><span class="kw">names</span>(curr_theme)</a></code></pre></div>
<p>we can modify this list, for example setting filled points instead of hollow circles as <code>plot.symbol</code> and <code>superpose.symbol</code></p>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb517-1" title="1">curr_theme<span class="op">$</span>plot.symbol<span class="op">$</span>pch =<span class="st"> </span><span class="dv">16</span></a>
<a class="sourceLine" id="cb517-2" title="2">curr_theme<span class="op">$</span>superpose.symbol<span class="op">$</span>pch =<span class="st"> </span><span class="kw">rep</span>(<span class="dv">16</span>, <span class="dv">7</span>)</a></code></pre></div>
<p>once this is done we have to call the <code>trellis.par.set</code> function to use the modified list as the current theme:</p>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb518-1" title="1"><span class="kw">trellis.par.set</span>(curr_theme)</a></code></pre></div>
</div>
<div id="textual-elements" class="section level3">
<h3><span class="header-section-number">9.4.2</span> Textual elements</h3>
<div id="strip-labels" class="section level4">
<h4><span class="header-section-number">9.4.2.1</span> Strip labels</h4>
<p>The labels of the panels strips are the names of the levels of the conditioning factor variable. To change their labels you can pass the <code>factor.levels</code> argument to the <code>strip.custom</code> function:</p>
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb519-1" title="1">x =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">20</span>)</a>
<a class="sourceLine" id="cb519-2" title="2">y =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">20</span>)</a>
<a class="sourceLine" id="cb519-3" title="3">treat =<span class="st"> </span><span class="kw">factor</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>), <span class="dt">each=</span><span class="dv">10</span>))</a>
<a class="sourceLine" id="cb519-4" title="4"><span class="kw">xyplot</span>(y<span class="op">~</span>x<span class="op">|</span>treat, <span class="dt">strip=</span><span class="kw">strip.custom</span>(<span class="dt">factor.levels=</span><span class="kw">c</span>(<span class="st">&quot;Group A&quot;</span>, <span class="st">&quot;Group B&quot;</span>)))</a></code></pre></div>
<div class="figure"><span id="fig:strip1"></span>
<img src="09_lattice_files/figure-html/strip1-1.png" alt="Custom strip labels." width="326.4" />
<p class="caption">
Figure 9.17: Custom strip labels.
</p>
</div>
<p>Alternatively, you change the names for the factor levels:</p>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb520-1" title="1"><span class="kw">levels</span>(treat) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Group A&quot;</span>, <span class="st">&quot;Group B&quot;</span>)</a></code></pre></div>
<p>if you have more than one conditioning factor you can customize the strip labels for each by passing a custom strip function. <code>which.given</code> specifies the conditioning
variable that the strip corresponds to:</p>
<div class="sourceCode" id="cb521"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb521-1" title="1">cnd =<span class="st"> </span><span class="kw">factor</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;I&quot;</span>, <span class="st">&quot;II&quot;</span>), <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb521-2" title="2"></a>
<a class="sourceLine" id="cb521-3" title="3">customstrip =<span class="st"> </span><span class="cf">function</span>(which.given, ..., factor.levels){</a>
<a class="sourceLine" id="cb521-4" title="4">    levs =<span class="st"> </span><span class="cf">if</span> (which.given<span class="op">==</span><span class="dv">1</span>){</a>
<a class="sourceLine" id="cb521-5" title="5">        <span class="kw">c</span>(<span class="st">&quot;Group A&quot;</span>, <span class="st">&quot;Group B&quot;</span>)</a>
<a class="sourceLine" id="cb521-6" title="6">    } <span class="cf">else</span> <span class="cf">if</span>  (which.given<span class="op">==</span><span class="dv">2</span>){</a>
<a class="sourceLine" id="cb521-7" title="7">        <span class="kw">c</span>(<span class="st">&quot;Cnd. I&quot;</span>, <span class="st">&quot;Cnd. II&quot;</span>)</a>
<a class="sourceLine" id="cb521-8" title="8">    }</a>
<a class="sourceLine" id="cb521-9" title="9">    <span class="kw">strip.default</span>(which.given, ..., <span class="dt">factor.levels =</span> levs)</a>
<a class="sourceLine" id="cb521-10" title="10">}</a>
<a class="sourceLine" id="cb521-11" title="11"><span class="kw">xyplot</span>(y<span class="op">~</span>x <span class="op">|</span><span class="st"> </span>treat <span class="op">+</span><span class="st"> </span>cnd, <span class="dt">strip=</span>customstrip, <span class="dt">as.table=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<div class="figure"><span id="fig:strip2"></span>
<img src="09_lattice_files/figure-html/strip2-1.png" alt="Custom strip labels with two conditioning factors." width="489.6" />
<p class="caption">
Figure 9.18: Custom strip labels with two conditioning factors.
</p>
</div>
</div>
</div>
<div id="strips" class="section level3">
<h3><span class="header-section-number">9.4.3</span> Strips</h3>
<div id="changing-the-strip-background-color" class="section level4">
<h4><span class="header-section-number">9.4.3.1</span> Changing the strip background color</h4>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb522-1" title="1"><span class="kw">data</span>(iris)</a>
<a class="sourceLine" id="cb522-2" title="2">ir2 =<span class="st"> </span>iris[iris<span class="op">$</span>Species<span class="op">!=</span><span class="st">&quot;virginica&quot;</span>,]</a>
<a class="sourceLine" id="cb522-3" title="3"><span class="kw">xyplot</span>(Sepal.Length<span class="op">~</span>Sepal.Width <span class="op">|</span><span class="st"> </span>Species, <span class="dt">data=</span>ir2, <span class="dt">as.table=</span>T,</a>
<a class="sourceLine" id="cb522-4" title="4">       <span class="dt">par.settings=</span><span class="kw">list</span>(<span class="dt">strip.background=</span><span class="kw">list</span>(<span class="dt">col=</span><span class="st">&quot;gray90&quot;</span>)))</a></code></pre></div>
<div class="figure"><span id="fig:stripcolor1"></span>
<img src="09_lattice_files/figure-html/stripcolor1-1.png" alt="Changing strip background color." width="456.96" />
<p class="caption">
Figure 9.19: Changing strip background color.
</p>
</div>
<p>or to set a color for several plots:</p>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb523-1" title="1"><span class="kw">trellis.par.set</span>(<span class="dt">strip.background=</span><span class="kw">list</span>(<span class="dt">col=</span><span class="st">&quot;gray90&quot;</span>))</a></code></pre></div>
</div>
<div id="remove-box-and-strip-borders" class="section level4">
<h4><span class="header-section-number">9.4.3.2</span> Remove “box” and strip borders</h4>
<p>The code below plots a figure without a bounding frame and without a strip, the result is shown in Figure <a href="#fig:rmstripbox">9.20</a>.</p>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb524-1" title="1">axis.L =<span class="st">  </span><span class="cf">function</span>(side, ..., line.col){</a>
<a class="sourceLine" id="cb524-2" title="2">    <span class="cf">if</span> (side <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;bottom&quot;</span>, <span class="st">&quot;left&quot;</span>)) {</a>
<a class="sourceLine" id="cb524-3" title="3">        col =<span class="st"> </span><span class="kw">trellis.par.get</span>(<span class="st">&quot;axis.text&quot;</span>)<span class="op">$</span>col</a>
<a class="sourceLine" id="cb524-4" title="4">        <span class="kw">axis.default</span>(side, ..., <span class="dt">line.col =</span> col)</a>
<a class="sourceLine" id="cb524-5" title="5">        <span class="cf">if</span> (side <span class="op">==</span><span class="st"> &quot;bottom&quot;</span>)</a>
<a class="sourceLine" id="cb524-6" title="6">            grid<span class="op">::</span><span class="kw">grid.lines</span>(<span class="dt">y =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb524-7" title="7">        <span class="cf">if</span> (side <span class="op">==</span><span class="st"> &quot;left&quot;</span>)</a>
<a class="sourceLine" id="cb524-8" title="8">            grid<span class="op">::</span><span class="kw">grid.lines</span>(<span class="dt">x =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb524-9" title="9">    }</a>
<a class="sourceLine" id="cb524-10" title="10">}</a>
<a class="sourceLine" id="cb524-11" title="11"><span class="kw">xyplot</span>(Sepal.Length<span class="op">~</span>Sepal.Width <span class="op">|</span><span class="st"> </span>Species, <span class="dt">data=</span>ir2, <span class="dt">axis=</span>axis.L,</a>
<a class="sourceLine" id="cb524-12" title="12">       <span class="dt">scales=</span><span class="kw">list</span>(<span class="dt">x=</span><span class="kw">list</span>(<span class="dt">alternating=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)),</a>
<a class="sourceLine" id="cb524-13" title="13">                   <span class="dt">y=</span><span class="kw">list</span>(<span class="dt">limits=</span><span class="kw">c</span>(<span class="kw">min</span>(ir2<span class="op">$</span>Sepal.Length),</a>
<a class="sourceLine" id="cb524-14" title="14">                                   <span class="kw">max</span>(ir2<span class="op">$</span>Sepal.Length)),</a>
<a class="sourceLine" id="cb524-15" title="15">                          <span class="dt">relation=</span><span class="st">&quot;free&quot;</span>)),</a>
<a class="sourceLine" id="cb524-16" title="16">       <span class="dt">par.settings=</span><span class="kw">list</span>(<span class="dt">strip.border=</span><span class="kw">list</span>(<span class="dt">col=</span><span class="st">&quot;transparent&quot;</span>),</a>
<a class="sourceLine" id="cb524-17" title="17">                         <span class="dt">strip.background=</span><span class="kw">list</span>(<span class="dt">col=</span><span class="st">&quot;transparent&quot;</span>),</a>
<a class="sourceLine" id="cb524-18" title="18">                         <span class="dt">axis.line=</span><span class="kw">list</span>(<span class="dt">col=</span><span class="st">&quot;transparent&quot;</span>)))</a></code></pre></div>
<div class="figure"><span id="fig:rmstripbox"></span>
<img src="09_lattice_files/figure-html/rmstripbox-1.png" alt="Remove strip and box around the panels." width="522.24" />
<p class="caption">
Figure 9.20: Remove strip and box around the panels.
</p>
</div>
<p>The following code is a variant without tick labels on the inner y panel, the result is shown in Figure <a href="#fig:rmstripbox2">9.21</a>.</p>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb525-1" title="1">axis.L2 =<span class="st">  </span><span class="cf">function</span>(side, ..., line.col){</a>
<a class="sourceLine" id="cb525-2" title="2">    <span class="cf">if</span> (side <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;bottom&quot;</span>, <span class="st">&quot;left&quot;</span>)) {</a>
<a class="sourceLine" id="cb525-3" title="3">        col =<span class="st"> </span><span class="kw">trellis.par.get</span>(<span class="st">&quot;axis.text&quot;</span>)<span class="op">$</span>col</a>
<a class="sourceLine" id="cb525-4" title="4">        <span class="cf">if</span> (side <span class="op">==</span><span class="st"> &quot;bottom&quot;</span>){</a>
<a class="sourceLine" id="cb525-5" title="5">            grid<span class="op">::</span><span class="kw">grid.lines</span>(<span class="dt">y =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb525-6" title="6">            <span class="kw">axis.default</span>(side, ..., <span class="dt">line.col =</span> col, <span class="dt">labels=</span><span class="st">&quot;yes&quot;</span>)</a>
<a class="sourceLine" id="cb525-7" title="7">        }</a>
<a class="sourceLine" id="cb525-8" title="8">        <span class="cf">if</span> (side <span class="op">==</span><span class="st"> &quot;left&quot;</span>){</a>
<a class="sourceLine" id="cb525-9" title="9">            grid<span class="op">::</span><span class="kw">grid.lines</span>(<span class="dt">x =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb525-10" title="10">            drawTickLabels =<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">current.column</span>() <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;yes&quot;</span>, <span class="st">&quot;no&quot;</span>)</a>
<a class="sourceLine" id="cb525-11" title="11">            <span class="kw">axis.default</span>(side, ..., <span class="dt">line.col =</span> col, <span class="dt">labels=</span>drawTickLabels)</a>
<a class="sourceLine" id="cb525-12" title="12">        }</a>
<a class="sourceLine" id="cb525-13" title="13">    }</a>
<a class="sourceLine" id="cb525-14" title="14">}</a>
<a class="sourceLine" id="cb525-15" title="15"></a>
<a class="sourceLine" id="cb525-16" title="16"></a>
<a class="sourceLine" id="cb525-17" title="17">p =<span class="st"> </span><span class="kw">xyplot</span>(Sepal.Length<span class="op">~</span>Sepal.Width <span class="op">|</span><span class="st"> </span>Species, <span class="dt">data=</span>ir2, <span class="dt">axis=</span>axis.L2, <span class="dt">as.table=</span>T,</a>
<a class="sourceLine" id="cb525-18" title="18">           <span class="dt">scales=</span><span class="kw">list</span>(<span class="dt">x=</span><span class="kw">list</span>(<span class="dt">alternating=</span><span class="ot">FALSE</span>),</a>
<a class="sourceLine" id="cb525-19" title="19">                       <span class="dt">y=</span><span class="kw">list</span>(<span class="dt">limits=</span><span class="kw">c</span>(<span class="kw">min</span>(ir2<span class="op">$</span>Sepal.Length),</a>
<a class="sourceLine" id="cb525-20" title="20">                                       <span class="kw">max</span>(ir2<span class="op">$</span>Sepal.Length)),</a>
<a class="sourceLine" id="cb525-21" title="21">                              <span class="dt">relation=</span><span class="st">&quot;free&quot;</span>,</a>
<a class="sourceLine" id="cb525-22" title="22">                              <span class="dt">alternating=</span><span class="dv">4</span>)),</a>
<a class="sourceLine" id="cb525-23" title="23">           <span class="dt">par.settings=</span><span class="kw">list</span>(<span class="dt">strip.border=</span><span class="kw">list</span>(<span class="dt">col=</span><span class="st">&quot;transparent&quot;</span>),</a>
<a class="sourceLine" id="cb525-24" title="24">                             <span class="dt">strip.background=</span><span class="kw">list</span>(<span class="dt">col=</span><span class="st">&quot;transparent&quot;</span>),</a>
<a class="sourceLine" id="cb525-25" title="25">                             <span class="dt">axis.line=</span><span class="kw">list</span>(<span class="dt">col=</span><span class="st">&quot;transparent&quot;</span>)))</a>
<a class="sourceLine" id="cb525-26" title="26"><span class="kw">print</span>(p)</a></code></pre></div>
<div class="figure"><span id="fig:rmstripbox2"></span>
<img src="09_lattice_files/figure-html/rmstripbox2-1.png" alt="Remove strip and box around the panels. Do not draw tick labels on the inner y panel." width="522.24" />
<p class="caption">
Figure 9.21: Remove strip and box around the panels. Do not draw tick labels on the inner y panel.
</p>
</div>
</div>
</div>
<div id="log-axis-with-pretty-tickmarks" class="section level3">
<h3><span class="header-section-number">9.4.4</span> Log axis with pretty tickmarks</h3>
<p>The <code>latticeExtra</code> package provides a function to get a log axis with pretty tickmarks in lattice, as shown in the code below. The result is shown in Figure <a href="#fig:lattextrlogaxpretty">9.22</a>.</p>
<div class="sourceCode" id="cb526"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb526-1" title="1"><span class="kw">library</span>(latticeExtra)</a>
<a class="sourceLine" id="cb526-2" title="2">x =<span class="st"> </span><span class="kw">as.factor</span>(<span class="kw">c</span>(<span class="st">&quot;cnd1&quot;</span>, <span class="st">&quot;cnd2&quot;</span>))</a>
<a class="sourceLine" id="cb526-3" title="3">y =<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.4</span>, <span class="dv">80</span>)</a>
<a class="sourceLine" id="cb526-4" title="4">dat =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y)</a>
<a class="sourceLine" id="cb526-5" title="5"><span class="kw">xyplot</span>(y<span class="op">~</span>x, <span class="dt">data=</span>dat,</a>
<a class="sourceLine" id="cb526-6" title="6">       <span class="dt">scales=</span><span class="kw">list</span>(<span class="dt">y=</span><span class="kw">list</span>(<span class="dt">log=</span><span class="dv">10</span>)),</a>
<a class="sourceLine" id="cb526-7" title="7">       <span class="dt">yscale.components =</span> yscale.components.log10ticks)</a></code></pre></div>
<div class="figure"><span id="fig:lattextrlogaxpretty"></span>
<img src="09_lattice_files/figure-html/lattextrlogaxpretty-1.png" alt="Log axis with pretty tickmarks using latticeExtra." width="326.4" />
<p class="caption">
Figure 9.22: Log axis with pretty tickmarks using latticeExtra.
</p>
</div>
<div id="doing-it-manually" class="section level4">
<h4><span class="header-section-number">9.4.4.1</span> Doing it manually</h4>
<p>I had written this before discovering the <code>yscale.components.log10ticks</code> function in <code>latticeExtra</code>. I’m leaving it here in case it’s useful for other similar axis customizations.</p>
<p>The procedure to get a log axis with pretty tickmarks manually in lattice is a bit involved. We’ll only cover the log base 10 case here. The first step is to define a function that returns the tick locations:</p>
<div class="sourceCode" id="cb527"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb527-1" title="1">log10Ticks =<span class="st"> </span><span class="cf">function</span>(lim, <span class="dt">onlyMajor=</span><span class="ot">FALSE</span>){</a>
<a class="sourceLine" id="cb527-2" title="2">    minPow =<span class="st"> </span><span class="kw">floor</span>(<span class="kw">log10</span>(lim[<span class="dv">1</span>]))</a>
<a class="sourceLine" id="cb527-3" title="3">    maxPow =<span class="st"> </span><span class="kw">ceiling</span>(<span class="kw">log10</span>(lim[<span class="dv">2</span>]))</a>
<a class="sourceLine" id="cb527-4" title="4">    powSeq =<span class="st"> </span><span class="kw">seq</span>(minPow, maxPow)</a>
<a class="sourceLine" id="cb527-5" title="5">    majTicks =<span class="st"> </span><span class="dv">10</span><span class="op">^</span>powSeq</a>
<a class="sourceLine" id="cb527-6" title="6">    minTicks =<span class="st"> </span><span class="kw">numeric</span>()</a>
<a class="sourceLine" id="cb527-7" title="7">    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(majTicks)){</a>
<a class="sourceLine" id="cb527-8" title="8">        bb =<span class="st"> </span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)<span class="op">/</span><span class="dv">10</span>;</a>
<a class="sourceLine" id="cb527-9" title="9">        minTicks =<span class="st"> </span><span class="kw">c</span>(minTicks, (bb<span class="op">*</span><span class="dv">10</span><span class="op">^</span>powSeq[i]))</a>
<a class="sourceLine" id="cb527-10" title="10">    }</a>
<a class="sourceLine" id="cb527-11" title="11">    <span class="cf">if</span> (onlyMajor<span class="op">==</span><span class="ot">TRUE</span>){</a>
<a class="sourceLine" id="cb527-12" title="12">        axSeq =<span class="st"> </span>majTicks</a>
<a class="sourceLine" id="cb527-13" title="13">    } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb527-14" title="14">        axSeq =<span class="st"> </span>minTicks</a>
<a class="sourceLine" id="cb527-15" title="15">    }</a>
<a class="sourceLine" id="cb527-16" title="16">    axSeq =<span class="st"> </span>axSeq[lim[<span class="dv">1</span>] <span class="op">&lt;=</span><span class="st"> </span>axSeq <span class="op">&amp;</span><span class="st"> </span>axSeq <span class="op">&lt;=</span><span class="st"> </span>lim[<span class="dv">2</span>]]</a>
<a class="sourceLine" id="cb527-17" title="17">    <span class="kw">return</span>(axSeq)</a>
<a class="sourceLine" id="cb527-18" title="18">}</a></code></pre></div>
<p>by default the function returns both the major (e.g. 1, 10, 100, etc…) and the minor (e.g. 2, 3, 4,…20, 30, 40, etc…) tick locations, but returns only the major tick locations if <code>onlyMajor=TRUE</code>. This function will be used by the <code>yscale.components.log10</code> function below. This function will be passed as the <code>yscale.components</code> argument in the <code>xyplot</code> call that generates the graph. The <code>yscale.components.log10</code> function will return a list specifying all parameters of the y axis. To simplify this process the function calls the <code>yscale.components.default</code> function to retrieve the default parameters, and then simply modifies some of these parameters to draw the pretty log axis:</p>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb528-1" title="1"><span class="co">#the function is automatically passed the limits of the panel as an argument</span></a>
<a class="sourceLine" id="cb528-2" title="2">yscale.components.log10 =<span class="st"> </span><span class="cf">function</span>(lim, ...){</a>
<a class="sourceLine" id="cb528-3" title="3">    <span class="co">#retrieve default parameters</span></a>
<a class="sourceLine" id="cb528-4" title="4">    ans =<span class="st"> </span><span class="kw">yscale.components.default</span>(<span class="dt">lim =</span> lim, ...)</a>
<a class="sourceLine" id="cb528-5" title="5">    <span class="co">#compute major and minor tick locations</span></a>
<a class="sourceLine" id="cb528-6" title="6">    tick.at =<span class="st"> </span><span class="kw">log10Ticks</span>(<span class="dv">10</span><span class="op">^</span>lim, <span class="dt">onlyMajor=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb528-7" title="7">    <span class="co">#compute major tick locations only</span></a>
<a class="sourceLine" id="cb528-8" title="8">    tick.at.major =<span class="st"> </span><span class="kw">log10Ticks</span>(<span class="dv">10</span><span class="op">^</span>lim, <span class="dt">onlyMajor=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb528-9" title="9">    <span class="co">#which are the major ticks?</span></a>
<a class="sourceLine" id="cb528-10" title="10">    major =<span class="st"> </span>tick.at <span class="op">%in%</span><span class="st"> </span>tick.at.major</a>
<a class="sourceLine" id="cb528-11" title="11">    <span class="co">#where the ticks should be position</span></a>
<a class="sourceLine" id="cb528-12" title="12">    ans<span class="op">$</span>left<span class="op">$</span>ticks<span class="op">$</span>at =<span class="st"> </span><span class="kw">log10</span>(tick.at)</a>
<a class="sourceLine" id="cb528-13" title="13">    <span class="co">#set tick length, depending on whether minor or major</span></a>
<a class="sourceLine" id="cb528-14" title="14">    ans<span class="op">$</span>left<span class="op">$</span>ticks<span class="op">$</span>tck =<span class="st"> </span><span class="kw">ifelse</span>(major, <span class="fl">1.5</span>, <span class="fl">0.75</span>)</a>
<a class="sourceLine" id="cb528-15" title="15">    <span class="co">#labels location</span></a>
<a class="sourceLine" id="cb528-16" title="16">    ans<span class="op">$</span>left<span class="op">$</span>labels<span class="op">$</span>at =<span class="st"> </span><span class="kw">log10</span>(tick.at)</a>
<a class="sourceLine" id="cb528-17" title="17">    <span class="co">#set tick labels</span></a>
<a class="sourceLine" id="cb528-18" title="18">    ans<span class="op">$</span>left<span class="op">$</span>labels<span class="op">$</span>labels =<span class="st"> </span><span class="kw">as.character</span>(tick.at)</a>
<a class="sourceLine" id="cb528-19" title="19">    <span class="co">#set minor tick labels as empty</span></a>
<a class="sourceLine" id="cb528-20" title="20">    ans<span class="op">$</span>left<span class="op">$</span>labels<span class="op">$</span>labels[<span class="op">!</span>major] =<span class="st"> &quot;&quot;</span> </a>
<a class="sourceLine" id="cb528-21" title="21">    ans<span class="op">$</span>left<span class="op">$</span>labels<span class="op">$</span>check.overlap =<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb528-22" title="22">    <span class="kw">return</span>(ans)</a>
<a class="sourceLine" id="cb528-23" title="23">}</a></code></pre></div>
<p>once the <code>yscale.components.log10</code> function is ready, we can use it in the call to <code>xyplot</code>, note that we also need to set the y scale to log10 in the <code>scales</code> argument, as shown in the code below. The result is shown in Figure <a href="#fig:latticelogaxispretty">9.23</a>.</p>
<div class="sourceCode" id="cb529"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb529-1" title="1">x =<span class="st"> </span><span class="kw">as.factor</span>(<span class="kw">c</span>(<span class="st">&quot;cnd1&quot;</span>, <span class="st">&quot;cnd2&quot;</span>))</a>
<a class="sourceLine" id="cb529-2" title="2">y =<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.4</span>, <span class="dv">80</span>)</a>
<a class="sourceLine" id="cb529-3" title="3">dat =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y)</a>
<a class="sourceLine" id="cb529-4" title="4"><span class="kw">xyplot</span>(y<span class="op">~</span>x, <span class="dt">data=</span>dat,</a>
<a class="sourceLine" id="cb529-5" title="5">       <span class="dt">scales=</span><span class="kw">list</span>(<span class="dt">y=</span><span class="kw">list</span>(<span class="dt">log=</span><span class="dv">10</span>)),</a>
<a class="sourceLine" id="cb529-6" title="6">       <span class="dt">yscale.components =</span> yscale.components.log10)</a></code></pre></div>
<div class="figure"><span id="fig:latticelogaxispretty"></span>
<img src="09_lattice_files/figure-html/latticelogaxispretty-1.png" alt="Log axis with pretty tickmarks." width="326.4" />
<p class="caption">
Figure 9.23: Log axis with pretty tickmarks.
</p>
</div>
</div>
</div>
<div id="adding-regression-linescurves-to-a-xyplot" class="section level3">
<h3><span class="header-section-number">9.4.5</span> Adding regression lines/curves to a <code>xyplot</code></h3>
<p>For this example we’ll use the <code>mpg</code> dataset from the <code>ggplot2</code> package:</p>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb530-1" title="1">mpg =<span class="st"> </span>ggplot2<span class="op">::</span>mpg</a></code></pre></div>
<p>A loess can be easily added by passing a <code>type</code> argument to <code>xyplot</code>:</p>
<div class="sourceCode" id="cb531"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb531-1" title="1"><span class="kw">xyplot</span>(hwy<span class="op">~</span>displ<span class="op">|</span>drv, <span class="dt">data=</span>mpg, <span class="dt">type=</span><span class="kw">c</span>(<span class="st">&quot;p&quot;</span>, <span class="st">&quot;smooth&quot;</span>), <span class="dt">as.table=</span>T)</a></code></pre></div>
<div class="figure"><span id="fig:lattloess1"></span>
<img src="09_lattice_files/figure-html/lattloess1-1.png" alt="`xyplot` with a loess curve." width="489.6" />
<p class="caption">
Figure 9.24: <code>xyplot</code> with a loess curve.
</p>
</div>
<p>in this case we passed a vector with elements <code>p</code>, for the points, and <code>smooth</code> for the loess curve. The resulting plot is shown in Figure <a href="#fig:lattloess1">9.24</a>.</p>
<p>A linear fit line can be added by passing <code>r</code> as an element in the <code>type</code> argument vector, as shown in the next example using the <code>iris</code> dataset (plot shown in Figure <a href="#fig:lattlinfit1">9.25</a>):</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb532-1" title="1"><span class="kw">data</span>(iris)</a>
<a class="sourceLine" id="cb532-2" title="2"><span class="kw">xyplot</span>(Sepal.Length<span class="op">~</span>Petal.Length<span class="op">|</span>Species, <span class="dt">data=</span>iris,</a>
<a class="sourceLine" id="cb532-3" title="3">       <span class="dt">type=</span><span class="kw">c</span>(<span class="st">&quot;p&quot;</span>, <span class="st">&quot;r&quot;</span>), <span class="dt">as.table=</span>T)</a></code></pre></div>
<div class="figure"><span id="fig:lattlinfit1"></span>
<img src="09_lattice_files/figure-html/lattlinfit1-1.png" alt="`xyplot` with a linear fit line." width="489.6" />
<p class="caption">
Figure 9.25: <code>xyplot</code> with a linear fit line.
</p>
</div>
<p>The <code>panel.smoother</code> function in the <a href="https://cran.r-project.org/web/packages/latticeExtra/index.html"><code>latticeExtra</code></a> package can additionally plot confidence bands.</p>
</div>
</div>
<div id="trellispanel" class="section level2">
<h2><span class="header-section-number">9.5</span> Writing panel functions</h2>
<p>Panel functions allow to customize and extend <code>lattice</code> plots, and can be used to generate new types of plots. The underlying system is sophisticated, but also complex, and overall writing panel function is not easy. Your mileage may vary, some simple customizations and extensions may be relatively easy, but it may be tricky to customize complex plots that include both conditioning and grouping variables. I am still far from mastering the system for writing panel functions, and these notes simply reflect what I’ve learnt so far.</p>
<div id="combining-panel-functions" class="section level3">
<h3><span class="header-section-number">9.5.1</span> Combining panel functions</h3>
<p>Rather than writing a new panel function from scratch, often you just want to add some elements to a plot, for example a regression line, or error bars. The easiest way to do this is writing a panel function that combines two standard panel functions. There are a number of predefined panel functions (see <code>?panel.functions</code>) that can be used to add lines, grids etc…, to a scatterplot, barchart or other high-level lattice plotting function.</p>
<p>We’ll start with a very simple example: adding a horizontal line at a fixed height in each panel. The dataset below contains a variable <code>y</code> with both positive and negative values:</p>
<div class="sourceCode" id="cb533"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb533-1" title="1">dat =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">y=</span><span class="kw">c</span>(<span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="dv">1</span>, <span class="fl">-0.8</span>, <span class="fl">-0.75</span>, <span class="fl">0.25</span>, <span class="fl">0.32</span>, <span class="fl">-0.1</span>),</a>
<a class="sourceLine" id="cb533-2" title="2">                 <span class="dt">fct1=</span><span class="kw">rep</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>), <span class="dt">each=</span><span class="dv">2</span>), <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb533-3" title="3">                 <span class="dt">fct2 =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;L1&quot;</span>, <span class="st">&quot;L2&quot;</span>), <span class="dv">4</span>),</a>
<a class="sourceLine" id="cb533-4" title="4">                 <span class="dt">fct3 =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;F1&quot;</span>, <span class="st">&quot;F2&quot;</span>), <span class="dt">each=</span><span class="dv">4</span>)</a>
<a class="sourceLine" id="cb533-5" title="5">                 )</a></code></pre></div>
<p>we can visualize it with a dotplot (Figure <a href="#fig:dotplotnohline">9.26</a>):</p>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb534-1" title="1"><span class="kw">trellis.par.set</span>(<span class="dt">superpose.symbol =</span> </a>
<a class="sourceLine" id="cb534-2" title="2">                <span class="kw">list</span>(<span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;darkslateblue&quot;</span>, </a>
<a class="sourceLine" id="cb534-3" title="3">                <span class="st">&quot;indianred&quot;</span>), <span class="dt">pch=</span><span class="dv">19</span>))</a>
<a class="sourceLine" id="cb534-4" title="4">p1 =<span class="st"> </span><span class="kw">dotplot</span>(y <span class="op">~</span><span class="st"> </span>fct1 <span class="op">|</span><span class="st"> </span>fct2, <span class="dt">groups=</span>fct3, </a>
<a class="sourceLine" id="cb534-5" title="5">            <span class="dt">data=</span>dat, <span class="dt">auto.key=</span><span class="ot">TRUE</span>, </a>
<a class="sourceLine" id="cb534-6" title="6">            <span class="dt">aspect=</span><span class="dv">1</span>, <span class="dt">as.table=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb534-7" title="7">p1</a></code></pre></div>
<div class="figure"><span id="fig:dotplotnohline"></span>
<img src="09_lattice_files/figure-html/dotplotnohline-1.png" alt="Dotplot without a horizontal line at `y=0`." width="489.6" />
<p class="caption">
Figure 9.26: Dotplot without a horizontal line at <code>y=0</code>.
</p>
</div>
<p>however, because the data represent positive or negative displacements from zero, it would be useful to add a horizontal line passing at zero. In order to do this, we’ll write a panel function that combines the <code>panel.dotplot</code> function with the <code>panel.abline</code> function. The latter function will be used to add the horizontal line:</p>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb535-1" title="1">panel.hRefDotplot =<span class="st"> </span><span class="cf">function</span>(x, y, <span class="dt">ref=</span><span class="ot">NULL</span>, ...){</a>
<a class="sourceLine" id="cb535-2" title="2">    <span class="kw">panel.dotplot</span>(x, y, ...)</a>
<a class="sourceLine" id="cb535-3" title="3">    <span class="kw">panel.abline</span>(<span class="dt">h=</span>ref, ...)</a>
<a class="sourceLine" id="cb535-4" title="4">}</a></code></pre></div>
<p>our new <code>panel.hRefDotplot</code> panel function accepts three arguments, <code>x</code> and <code>y</code>, which are “standard” arguments passed by the higher-level plotting functions (like <code>dotplot</code>, or <code>xyplot</code>) to panel functions to specify the data to draw. The third argument represents the position at which to draw the horizontal line of reference for the data; we want it to be zero in this case, but passing the argument as a variable rather than hard-coding the value into the panel function will allow us to recycle this panel function in case we want the horizontal reference line drawn at some other points in the future. Besides these arguments, our panel function accepts also an undefined number of other arguments, which are designated by the <code>...</code> notation. These are usually graphics parameters that can be specified in the high level plotting function. Our <code>panel.hRefDotplot</code> function is quite simple: we first call <code>panel.dotplot</code> to draw the standard dotplot, and then call <code>panel.abline</code> giving it the value of <code>ref</code> to draw the horizontal line in each panel. The actual plot (Figure <a href="#fig:dotplothline">9.27</a>) is done by calling the high level <code>dotplot</code> function and specifying <code>panel.hRefDotplot</code> as the panel function to use:</p>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb536-1" title="1">p2 =<span class="st"> </span><span class="kw">dotplot</span>(y <span class="op">~</span><span class="st"> </span>fct1 <span class="op">|</span><span class="st"> </span>fct2, <span class="dt">groups=</span>fct3, </a>
<a class="sourceLine" id="cb536-2" title="2">            <span class="dt">data=</span>dat, <span class="dt">auto.key=</span><span class="ot">TRUE</span>, </a>
<a class="sourceLine" id="cb536-3" title="3">            <span class="dt">aspect=</span><span class="dv">1</span>, <span class="dt">as.table=</span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb536-4" title="4">            <span class="dt">panel=</span>panel.hRefDotplot, <span class="dt">ref=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb536-5" title="5">p2</a></code></pre></div>
<div class="figure"><span id="fig:dotplothline"></span>
<img src="09_lattice_files/figure-html/dotplothline-1.png" alt="Dotplot with a horizontal reference line." width="489.6" />
<p class="caption">
Figure 9.27: Dotplot with a horizontal reference line.
</p>
</div>
<p>Note the last line of the call: first, we’re telling <code>dotplot</code> to use our <code>hRefDotplot</code> function to do the plotting by specifying the <code>panel</code> argument, second we’re specifying another argument, <code>ref</code> in the call, this is not a standard argument, but it will be automatically passed to our panel function to decide at which height to draw the horizontal line.</p>
</div>
<div id="adding-error-bars-to-an-xyplot-single-panel-no-groups" class="section level3">
<h3><span class="header-section-number">9.5.2</span> Adding error bars to an <code>xyplot</code> (single panel, no groups)</h3>
<p>We now move on to a slightly more complex example. Adding error bars to an <code>xyplot</code> consisting of a single panel, and with no <code>groups</code> variable. For this example we’ll use the <code>iris</code> dataset, and in particular we’ll plot the mean sepal width <span class="math inline">\(\pm 1\)</span> sd as a function of species. The following lines of code prepare the dataset to plot:</p>
<div class="sourceCode" id="cb537"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb537-1" title="1"><span class="kw">data</span>(iris)</a>
<a class="sourceLine" id="cb537-2" title="2">iris_summ =<span class="st"> </span>iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb537-3" title="3"><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">mean_sep_w =</span> <span class="kw">mean</span>(Sepal.Width), <span class="dt">sd_sep_w=</span><span class="kw">sd</span>(Sepal.Width))</a>
<a class="sourceLine" id="cb537-4" title="4">iris_summ<span class="op">$</span>ylow =<span class="st"> </span>iris_summ<span class="op">$</span>mean_sep_w <span class="op">-</span><span class="st"> </span>iris_summ<span class="op">$</span>sd_sep_w</a>
<a class="sourceLine" id="cb537-5" title="5">iris_summ<span class="op">$</span>yup =<span class="st"> </span>iris_summ<span class="op">$</span>mean_sep_w <span class="op">+</span><span class="st"> </span>iris_summ<span class="op">$</span>sd_sep_w</a></code></pre></div>
<p>The last two lines of code add a <code>ylow</code> and a <code>yup</code> variable, which represent the lower and upper y coordinates of the error bars. Because error bars take space, we have to increase the limits of the y axis. We could do this “manually” by adding a <code>ylim</code> argument to <code>xyplot</code> a more elegant solution is to pass a prepanel function that computes the limits taking into account the space taken by the error bars:</p>
<div class="sourceCode" id="cb538"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb538-1" title="1">prepanel.err =<span class="st"> </span><span class="cf">function</span>(x, y, ylow, yup, ...){</a>
<a class="sourceLine" id="cb538-2" title="2">     <span class="kw">list</span>(<span class="dt">ylim =</span> <span class="kw">range</span>(y, yup, ylow, <span class="dt">finite =</span> <span class="ot">TRUE</span>)) </a>
<a class="sourceLine" id="cb538-3" title="3">}</a></code></pre></div>
<p>Next, we write the panel function that calls <code>xyplot</code>, and adds the error bars by calling <code>panel.arrows</code>:</p>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb539-1" title="1">panel.err0 =<span class="st"> </span><span class="cf">function</span>(x, y, ylow, yup,</a>
<a class="sourceLine" id="cb539-2" title="2">             <span class="dt">col.line=</span><span class="kw">trellis.par.get</span>()[[<span class="st">&quot;superpose.line&quot;</span>]][[<span class="st">&quot;col&quot;</span>]][<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb539-3" title="3">                      ...){</a>
<a class="sourceLine" id="cb539-4" title="4">             <span class="kw">panel.xyplot</span>(x, y, ...)</a>
<a class="sourceLine" id="cb539-5" title="5">             <span class="kw">panel.arrows</span>(<span class="dt">x0 =</span>x, <span class="dt">y0 =</span>ylow, <span class="dt">x1=</span>x, <span class="dt">y1=</span>yup,</a>
<a class="sourceLine" id="cb539-6" title="6">                          <span class="dt">angle=</span><span class="dv">90</span>, <span class="dt">end=</span><span class="st">&quot;both&quot;</span>,</a>
<a class="sourceLine" id="cb539-7" title="7">                          <span class="dt">col=</span>col.line,</a>
<a class="sourceLine" id="cb539-8" title="8">                          <span class="dt">length=</span><span class="fl">0.1</span>, ...)</a>
<a class="sourceLine" id="cb539-9" title="9">}</a></code></pre></div>
<p>we can now draw the plot, which is shown in Figure <a href="#fig:latterrngnp">9.28</a>, with the following code:</p>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb540-1" title="1">p =<span class="st"> </span><span class="kw">xyplot</span>(mean_sep_w<span class="op">~</span>Species, <span class="dt">data=</span>iris_summ,</a>
<a class="sourceLine" id="cb540-2" title="2">           <span class="dt">ylow=</span>iris_summ<span class="op">$</span>ylow, <span class="dt">yup=</span>iris_summ<span class="op">$</span>yup,</a>
<a class="sourceLine" id="cb540-3" title="3">           <span class="dt">panel=</span>panel.err0, <span class="dt">prepanel=</span>prepanel.err)</a>
<a class="sourceLine" id="cb540-4" title="4">p</a></code></pre></div>
<div class="figure"><span id="fig:latterrngnp"></span>
<img src="09_lattice_files/figure-html/latterrngnp-1.png" alt="`xyplot` with error bars for a single panel with no groupings." width="326.4" />
<p class="caption">
Figure 9.28: <code>xyplot</code> with error bars for a single panel with no groupings.
</p>
</div>
<p>the only differences from a plain <code>xyplot</code> call is that we’re passing our panel and prepanel functions as additional arguments.</p>
</div>
<div id="adding-error-bars-to-an-xyplot-with-multiple-panels-no-groups" class="section level3">
<h3><span class="header-section-number">9.5.3</span> Adding error bars to an <code>xyplot</code> with multiple panels (no groups)</h3>
<p>We move on to the case of adding error bars to a <code>xyplot</code> with multiple panels, but no <code>groups</code> variable. We’ll use the <code>npk</code> dataset, and in particular we’ll plot the mean yield <span class="math inline">\(\pm 1\)</span> sd as a function of N and P administration. The following lines of code prepare the dataset to plot:</p>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb541-1" title="1"><span class="kw">data</span>(npk)</a>
<a class="sourceLine" id="cb541-2" title="2">npk_summ_NP =<span class="st"> </span>npk <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(N,P) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">mean_yield=</span><span class="kw">mean</span>(yield),</a>
<a class="sourceLine" id="cb541-3" title="3">                                                  <span class="dt">sd_yield=</span><span class="kw">sd</span>(yield))</a>
<a class="sourceLine" id="cb541-4" title="4">npk_summ_NP<span class="op">$</span>ylow =<span class="st"> </span>npk_summ_NP<span class="op">$</span>mean_yield <span class="op">-</span><span class="st"> </span>npk_summ_NP<span class="op">$</span>sd_yield</a>
<a class="sourceLine" id="cb541-5" title="5">npk_summ_NP<span class="op">$</span>yup =<span class="st"> </span>npk_summ_NP<span class="op">$</span>mean_yield <span class="op">+</span><span class="st"> </span>npk_summ_NP<span class="op">$</span>sd_yield</a></code></pre></div>
<p>The panel function that we’re going to use is given by the following lines of code:</p>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb542-1" title="1">panel.err1 =<span class="st"> </span><span class="cf">function</span>(x, y, subscripts, ylow, yup,</a>
<a class="sourceLine" id="cb542-2" title="2">             <span class="dt">col.line=</span><span class="kw">trellis.par.get</span>()[[<span class="st">&quot;superpose.line&quot;</span>]][[<span class="st">&quot;col&quot;</span>]][<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb542-3" title="3">              ...){</a>
<a class="sourceLine" id="cb542-4" title="4">    <span class="kw">panel.xyplot</span>(x, y, ...)</a>
<a class="sourceLine" id="cb542-5" title="5">    <span class="kw">panel.arrows</span>(<span class="dt">x0 =</span>x, <span class="dt">y0 =</span>ylow[subscripts], <span class="dt">x1=</span>x, <span class="dt">y1=</span>yup[subscripts],</a>
<a class="sourceLine" id="cb542-6" title="6">                 <span class="dt">angle=</span><span class="dv">90</span>, <span class="dt">end=</span><span class="st">&quot;both&quot;</span>,</a>
<a class="sourceLine" id="cb542-7" title="7">                 <span class="dt">col=</span>col.line,</a>
<a class="sourceLine" id="cb542-8" title="8">                 <span class="dt">length=</span><span class="fl">0.1</span>, ...)</a>
<a class="sourceLine" id="cb542-9" title="9">}</a></code></pre></div>
<p>Note how besides the <code>ylow</code> and <code>yup</code> variables the function accepts an additional <code>subscripts</code> variable. This variable holds the indexes of the rows of the dataframe that are used to plot a given panel. The <code>x</code> and <code>y</code> variables have already been “filtered” to contain only the values needed for a given panel; the <code>ylow</code> and <code>yup</code> variables need to be “filtered” using the <code>subscripts</code>. The call to <code>xyplot</code> is given below, and the resulting plot is shown in Figure <a href="#fig:latterrp">9.29</a>:</p>
<div class="sourceCode" id="cb543"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb543-1" title="1">p =<span class="st"> </span><span class="kw">xyplot</span>(mean_yield<span class="op">~</span>N <span class="op">|</span><span class="st"> </span>P, <span class="dt">data=</span>npk_summ_NP,</a>
<a class="sourceLine" id="cb543-2" title="2">           <span class="dt">ylow=</span>npk_summ_NP<span class="op">$</span>ylow, <span class="dt">yup=</span>npk_summ_NP<span class="op">$</span>yup,</a>
<a class="sourceLine" id="cb543-3" title="3">           <span class="dt">panel=</span>panel.err1, <span class="dt">prepanel=</span>prepanel.err)</a>
<a class="sourceLine" id="cb543-4" title="4">p</a></code></pre></div>
<div class="figure"><span id="fig:latterrp"></span>
<img src="09_lattice_files/figure-html/latterrp-1.png" alt="`xyplot` with error bars for a multiple panels with no groups." width="408" />
<p class="caption">
Figure 9.29: <code>xyplot</code> with error bars for a multiple panels with no groups.
</p>
</div>
<p>we’re reusing the prepanel function from the last example (<code>prepanel.err</code>) because for this plot the computations for the y limits are the same.</p>
</div>
<div id="adding-error-bars-to-an-xyplot-with-groups-single-panel" class="section level3">
<h3><span class="header-section-number">9.5.4</span> Adding error bars to an <code>xyplot</code> with groups (single panel)</h3>
<p>We’ll now look at the case of adding error bars to an <code>xyplot</code> in a single panel but with a <code>groups</code> variable. We’ll use the same dataset, and the same prepanel function that we employed in the last example. The panel function is given below:</p>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb544-1" title="1">panel.errg =<span class="st"> </span><span class="cf">function</span>(x, y, subscripts, ylow, yup, <span class="dt">col.line=</span><span class="st">&quot;black&quot;</span>, ...){</a>
<a class="sourceLine" id="cb544-2" title="2">    <span class="kw">panel.xyplot</span>(x, y, ...)</a>
<a class="sourceLine" id="cb544-3" title="3">    <span class="kw">panel.arrows</span>(<span class="dt">x0=</span>x, <span class="dt">y0=</span>ylow[subscripts], <span class="dt">x1=</span>x, <span class="dt">y1=</span>yup[subscripts],</a>
<a class="sourceLine" id="cb544-4" title="4">                 <span class="dt">end=</span><span class="st">&quot;both&quot;</span>, <span class="dt">angle=</span><span class="dv">90</span>, <span class="dt">col=</span>col.line, <span class="dt">length=</span><span class="fl">0.1</span>)</a>
<a class="sourceLine" id="cb544-5" title="5">}</a></code></pre></div>
<p>in this case <code>subscripts</code> reflects the indexes of the rows of the dataframe containing the values for a given <em>group</em>. The call to <code>xyplot</code> is shown below, and the resulting plot is shown in Figure <a href="#fig:latterrg">9.30</a>:</p>
<div class="sourceCode" id="cb545"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb545-1" title="1">p =<span class="st"> </span><span class="kw">xyplot</span>(mean_yield<span class="op">~</span>N, <span class="dt">groups=</span>P, <span class="dt">data=</span>npk_summ_NP,</a>
<a class="sourceLine" id="cb545-2" title="2">           <span class="dt">ylow=</span>npk_summ_NP<span class="op">$</span>ylow, <span class="dt">yup=</span>npk_summ_NP<span class="op">$</span>yup,</a>
<a class="sourceLine" id="cb545-3" title="3">           <span class="dt">panel=</span>panel.superpose, <span class="dt">panel.groups=</span>panel.errg,</a>
<a class="sourceLine" id="cb545-4" title="4">           <span class="dt">prepanel=</span>prepanel.err)</a>
<a class="sourceLine" id="cb545-5" title="5">p</a></code></pre></div>
<div class="figure"><span id="fig:latterrg"></span>
<img src="09_lattice_files/figure-html/latterrg-1.png" alt="`xyplot` with error bars with groups." width="326.4" />
<p class="caption">
Figure 9.30: <code>xyplot</code> with error bars with groups.
</p>
</div>
<p>when groups are involved, <code>lattice</code> calls <code>panel.superpose</code> to handle plotting the data of different groups with distinguishing attributes (e.g. colors, line type, etc…). <code>panel.superpose</code> then calls a <code>panel.groups</code> function to handle the actual plotting for each group. In this case we’re passing our custom <code>panel.groups</code> function to add error bars.</p>
<p>We’ve achieved our aim of adding error bars, but there’s an issue: the bars are overlapping and the plot looks ugly. To fix this issue we write another panel function which will slightly offset the position of the points and the bars on the x axis depending on which group is being plotted. To be able to do this, we let the function accept the <code>group.number</code> argument, a number denoting which group is being plotted:</p>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb546-1" title="1">panel.errg2 =<span class="st"> </span><span class="cf">function</span>(x, y, subscripts, group.number,</a>
<a class="sourceLine" id="cb546-2" title="2">                       ylow, yup, <span class="dt">col.line=</span><span class="st">&quot;black&quot;</span>, ...){</a>
<a class="sourceLine" id="cb546-3" title="3">    offs =<span class="st"> </span><span class="kw">ifelse</span>(group.number<span class="op">==</span><span class="dv">1</span>, <span class="fl">-0.1</span>, <span class="fl">0.1</span>)</a>
<a class="sourceLine" id="cb546-4" title="4">    x =<span class="st"> </span>x <span class="op">+</span><span class="st"> </span>offs</a>
<a class="sourceLine" id="cb546-5" title="5">    <span class="kw">panel.xyplot</span>(x, y, ...)</a>
<a class="sourceLine" id="cb546-6" title="6">    <span class="kw">panel.arrows</span>(<span class="dt">x0=</span>x, <span class="dt">y0=</span>ylow[subscripts], <span class="dt">x1=</span>x, <span class="dt">y1=</span>yup[subscripts],</a>
<a class="sourceLine" id="cb546-7" title="7">                 <span class="dt">end=</span><span class="st">&quot;both&quot;</span>, <span class="dt">angle=</span><span class="dv">90</span>, <span class="dt">col=</span>col.line, <span class="dt">length=</span><span class="fl">0.1</span>)</a>
<a class="sourceLine" id="cb546-8" title="8">}</a></code></pre></div>
<p>The call to <code>xyplot</code> is shown in the code below, and the resulting plot, which now looks better, is shown in Figure <a href="#fig:latterrg2">9.31</a>:</p>
<div class="sourceCode" id="cb547"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb547-1" title="1">p =<span class="st"> </span><span class="kw">xyplot</span>(mean_yield<span class="op">~</span>N, <span class="dt">groups=</span>P, <span class="dt">data=</span>npk_summ_NP,</a>
<a class="sourceLine" id="cb547-2" title="2">           <span class="dt">ylow=</span>npk_summ_NP<span class="op">$</span>ylow, <span class="dt">yup=</span>npk_summ_NP<span class="op">$</span>yup,</a>
<a class="sourceLine" id="cb547-3" title="3">           <span class="dt">panel=</span>panel.superpose, <span class="dt">panel.groups=</span>panel.errg2,</a>
<a class="sourceLine" id="cb547-4" title="4">           <span class="dt">prepanel=</span>prepanel.err)</a>
<a class="sourceLine" id="cb547-5" title="5">p</a></code></pre></div>
<div class="figure"><span id="fig:latterrg2"></span>
<img src="09_lattice_files/figure-html/latterrg2-1.png" alt="`xyplot` with error bars with groups." width="326.4" />
<p class="caption">
Figure 9.31: <code>xyplot</code> with error bars with groups.
</p>
</div>
</div>
<div id="adding-error-bars-to-an-xyplot-with-groups-and-multiple-panels" class="section level3">
<h3><span class="header-section-number">9.5.5</span> Adding error bars to an <code>xyplot</code> with groups and multiple panels</h3>
<p>We’ll now move on to the case of adding error bars to an <code>xyplot</code> with multiple panels and a grouping variable. For this example we’ll again use the <code>npk</code> dataset, but this time we’ll plot the mean yield <span class="math inline">\(\pm 1\)</span> sd as a function of N, P, and K administration. The following lines of code prepare the dataset to plot:</p>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb548-1" title="1">npk_summ_NPK =<span class="st"> </span>npk <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(N,P,K) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">mean_yield=</span><span class="kw">mean</span>(yield),</a>
<a class="sourceLine" id="cb548-2" title="2">                                                     <span class="dt">sd_yield=</span><span class="kw">sd</span>(yield))</a>
<a class="sourceLine" id="cb548-3" title="3">npk_summ_NPK<span class="op">$</span>ylow =<span class="st"> </span>npk_summ_NPK<span class="op">$</span>mean_yield <span class="op">-</span><span class="st"> </span>npk_summ_NPK<span class="op">$</span>sd_yield</a>
<a class="sourceLine" id="cb548-4" title="4">npk_summ_NPK<span class="op">$</span>yup =<span class="st"> </span>npk_summ_NPK<span class="op">$</span>mean_yield <span class="op">+</span><span class="st"> </span>npk_summ_NPK<span class="op">$</span>sd_yield</a></code></pre></div>
<p>We won’t need to write a new prepanel or a new panel function, because those from the last example will be suitable also for the current plot. The call to <code>xyplot</code> is shown in the code below, and the plot is shown in Figure <a href="#fig:latterrgp">9.32</a>:</p>
<div class="sourceCode" id="cb549"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb549-1" title="1">p =<span class="st"> </span><span class="kw">xyplot</span>(mean_yield<span class="op">~</span>N <span class="op">|</span><span class="st"> </span>K, <span class="dt">groups=</span>P, <span class="dt">data=</span>npk_summ_NPK,</a>
<a class="sourceLine" id="cb549-2" title="2">           <span class="dt">ylow=</span>npk_summ_NPK<span class="op">$</span>ylow, <span class="dt">yup=</span>npk_summ_NPK<span class="op">$</span>yup,</a>
<a class="sourceLine" id="cb549-3" title="3">           <span class="dt">panel=</span>panel.superpose, <span class="dt">panel.groups=</span>panel.errg2,</a>
<a class="sourceLine" id="cb549-4" title="4">           <span class="dt">prepanel=</span>prepanel.err)</a>
<a class="sourceLine" id="cb549-5" title="5">p</a></code></pre></div>
<div class="figure"><span id="fig:latterrgp"></span>
<img src="09_lattice_files/figure-html/latterrgp-1.png" alt="`xyplot` with error bars with groups and multiple panels" width="489.6" />
<p class="caption">
Figure 9.32: <code>xyplot</code> with error bars with groups and multiple panels
</p>
</div>
</div>
</div>
<div id="lattres" class="section level2">
<h2><span class="header-section-number">9.6</span> Further resources</h2>
<div id="lattmat" class="section level3">
<h3><span class="header-section-number">9.6.1</span> Books, articles, and tutorials</h3>
<p><a href="https://moc.online.uni-marburg.de/gitbooks/publicationQualityGraphics/_book/index.html">Creating publication quality graphs in R</a> by Tim Appelhans, provides useful notes on both <code>lattice</code> and <code>ggplot2</code>, including ways to manipulate and arrange plots using <code>grid</code>. The git repository of the tutorial is available <a href="https://github.com/tim-salabim/publication-quality-graphics">here</a>.</p>
</div>
<div id="lattrelpkg" class="section level3">
<h3><span class="header-section-number">9.6.2</span> Related packages</h3>
<p><a href="https://cran.r-project.org/web/packages/latticeExtra/index.html"><code>latticeExtra</code></a> provides several additional high-level plotting functions and many utility functions.
<a href="https://github.com/walmes/wzRfun"><code>wzRfun</code></a> contains miscellaneous utilities, including panel functions to add error bars and error bands to <code>lattice</code> plots.</p>

</div>
</div>
</div>
<div id="graphicscommon" class="section level1">
<h1><span class="header-section-number">10</span> Graphics: common elements across plotting libraries</h1>
<p>Although as we have seen R has a number of different plotting libraries, certain plotting procedures, such as choosing colors, choosing fonts, and annotating plots with mathematical expressions that share the same or similar underlying mechanisms/functions across the different plotting libraries. This chapter will illustrate some of these common functions.</p>
<div id="colorscommon" class="section level2">
<h2><span class="header-section-number">10.1</span> Colors for graphics</h2>
The command <code>colors</code> gives a list of built-in colors available for graphics in R. You can see some of these colors in Figure <a href="#fig:color1">10.1</a>. There are 101 built-in shades of gray, from <code>gray0</code>, that is almost black, to <code>gray100</code> that is almost white, you can see some of them in Figure <a href="#fig:color1">10.1</a>. A complete table of built-in R colors is given in Appendix <a href="#fullcoltable">D</a>.
<div class="figure"><span id="fig:color1"></span>
<img src="Figures/sample_colors.png" alt="Some built-in colors in R." width="1725" />
<p class="caption">
Figure 10.1: Some built-in colors in R.
</p>
</div>
<p>You can also specify colors in rgb values. By default R accepts values in the range 0-1, but you can change the range with the <code>max</code> option to set the range as 0-255. Please note that changing the range doesn’t change the colors you can use, it just changes the values you use to specify them, so for example the following graphs will have the same colors:</p>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb550-1" title="1">vec =<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">6</span>)</a>
<a class="sourceLine" id="cb550-2" title="2"><span class="kw">barplot</span> (vec, <span class="dt">col=</span> <span class="kw">c</span>(<span class="kw">rgb</span>(<span class="fl">0.176</span>, <span class="fl">0.262</span>, <span class="fl">0.49</span>),</a>
<a class="sourceLine" id="cb550-3" title="3">         <span class="kw">rgb</span>(<span class="fl">0.568</span>, <span class="fl">0.254</span> <span class="fl">0.654</span>)))</a>
<a class="sourceLine" id="cb550-4" title="4"><span class="kw">barplot</span> (vec, <span class="dt">col=</span> <span class="kw">c</span>(<span class="kw">rgb</span>(<span class="dv">45</span>,<span class="dv">67</span>,<span class="dv">125</span>, <span class="dt">max=</span><span class="dv">255</span>),</a>
<a class="sourceLine" id="cb550-5" title="5">         <span class="kw">rgb</span>(<span class="dv">145</span>,<span class="dv">65</span>,<span class="dv">167</span>, <span class="dt">max=</span><span class="dv">255</span>)))</a></code></pre></div>
<p>the first uses the default range, and the second uses the range 0-255, but I simply derived the values for the first graph, dividing those for the second by 255.</p>
<p>The function <code>col2rgb</code> can be used to get the rgb values of a built-in color from its name. The rgb values are given in this case in the range 0-255. Here’s an example:</p>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb551-1" title="1"><span class="kw">col2rgb</span>(<span class="st">&quot;lightslateblue&quot;</span>)</a></code></pre></div>
<pre><code>##       [,1]
## red    132
## green  112
## blue   255</code></pre>
<div id="color-opacity" class="section level3">
<h3><span class="header-section-number">10.1.1</span> Color opacity</h3>
<p>The <code>adjustcolor</code> function can be used to set the opacity of a color using the <code>alpha.f</code> argument:</p>
<div class="sourceCode" id="cb553"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb553-1" title="1">mycol =<span class="st"> </span><span class="kw">adjustcolor</span>(<span class="st">&quot;skyblue&quot;</span>, <span class="dt">alpha.f=</span><span class="fl">0.5</span>) </a>
<a class="sourceLine" id="cb553-2" title="2">x =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb553-3" title="3">y =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb553-4" title="4"><span class="kw">plot</span>(x, y, <span class="dt">pch=</span><span class="dv">21</span>, <span class="dt">bg=</span>mycol, <span class="dt">cex=</span><span class="fl">1.5</span>)</a></code></pre></div>
<div class="figure"><span id="fig:coltransp"></span>
<img src="10_graphics_common_files/figure-html/coltransp-1.png" alt="Color opacity." width="326.4" />
<p class="caption">
Figure 10.2: Color opacity.
</p>
</div>
<p>the <code>adjustcolor</code> function accepts a vector of colors as an argument, so you can change the transparency of several colors at the same time.</p>
</div>
<div id="color-palettes" class="section level3">
<h3><span class="header-section-number">10.1.2</span> Color palettes</h3>
<p>The <a href="https://cran.r-project.org/web/packages/RColorBrewer/index.html"><code>RColorBrewer</code></a> package provides a number of discrete color palettes. The complete set is shown in Figure <a href="#fig:displaybrewerall">10.3</a> can be seen with the following function:</p>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb554-1" title="1"><span class="kw">library</span>(RColorBrewer) <span class="co">#load package</span></a>
<a class="sourceLine" id="cb554-2" title="2"><span class="kw">display.brewer.all</span>()</a></code></pre></div>
<div class="figure"><span id="fig:displaybrewerall"></span>
<img src="10_graphics_common_files/figure-html/displaybrewerall-1.png" alt="`RColorBrewer` palettes." width="652.8" />
<p class="caption">
Figure 10.3: <code>RColorBrewer</code> palettes.
</p>
</div>
<p>to show only colorblind friendly palettes:</p>
<div class="sourceCode" id="cb555"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb555-1" title="1"><span class="kw">display.brewer.all</span>(<span class="dt">colorblindFriendly=</span>T)</a></code></pre></div>
<p>the palettes can be instantiated by calling the <code>brewer.pal</code> function as follows:</p>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb556-1" title="1">pal1 =<span class="st"> </span><span class="kw">brewer.pal</span>(<span class="dv">3</span>, <span class="st">&quot;Pastel2&quot;</span>)</a></code></pre></div>
<p>the first argument is the number of colors and the second argument is the name of the desired palette. Note that <code>ggplot2</code> has convenience functions to use <code>RColorBrewer</code> palettes (see <a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">here</a>).</p>
<p>The <a href="https://cran.r-project.org/web/packages/colorspace/index.html"><code>colorspace</code></a> package provides an array of utilities for working with colors, including color palettes in <a href="https://en.wikipedia.org/wiki/HCL_color_space">HCL</a> color space.</p>
<p>The <a href="https://cran.r-project.org/web/packages/viridis/"><code>viridis</code></a> package provides a number of continuous color palettes that have been designed to be perceptually uniform and robust to color blindness (see the <a href="https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html"><code>viridis</code> vignette</a>). Note that <code>ggplot2</code> has convenience functions to work with <code>viridis</code> palettes (see <a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">here</a>).</p>
<p>It is important to make sure that important graphical features distinguished by colors can be seen by everyone, including colorblind people. The <a href="https://cran.r-project.org/web/packages/dichromat/"><code>dichromat</code></a> package can simulate the effects of different types of color blindness through the <code>dichromat</code> function. The <a href="https://cran.r-project.org/web/packages/colorspace/index.html"><code>colorspace</code></a> package can also simulate color vision deficiencies through the <code>simulate_cvd</code> function.</p>
<p>Another useful colorblind friendly palette is that provided by Okabe and Ito <a href="https://jfly.uni-koeln.de/color/">here</a>; you can instantiate this palette with the following code:</p>
<div class="sourceCode" id="cb557"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb557-1" title="1">cbPalette =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;#000000&quot;</span>, <span class="st">&quot;#E69F00&quot;</span>, <span class="st">&quot;#56B4E9&quot;</span>, <span class="st">&quot;#009E73&quot;</span>, <span class="st">&quot;#F0E442&quot;</span>,</a>
<a class="sourceLine" id="cb557-2" title="2">              <span class="st">&quot;#0072B2&quot;</span>, <span class="st">&quot;#D55E00&quot;</span>, <span class="st">&quot;#CC79A7&quot;</span>, <span class="st">&quot;#999999&quot;</span>)</a></code></pre></div>
</div>
</div>
<div id="plotmath" class="section level2">
<h2><span class="header-section-number">10.2</span> Mathematical expressions and variables</h2>
<p>It is possible to use mathematical symbols in plot labels and text. The base system for providing math symbols in plot annotations has been described by <span class="citation">Murrell and Ihaka (<a href="#ref-MurrellAndIhaka2000">2000</a>)</span>, which is a recommended reading. An overview of the system with a comprehensive list of all the symbols can be obtained with <code>?plotmath</code>. I don’t find the system particularly intuitive, and can’t claim to fully understand its inner workings, but I’ll nevertheless attempt to explain in rough terms how it works.</p>
<p>The basic idea is that instead of providing a string to <code>text</code>, <code>xlab</code> or other functions through which you want to plot some text, you provide an <code>expression</code>, in the sense of a mathematical expression. Two examples are given below:</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb558-1" title="1"><span class="kw">plot.new</span>(); <span class="kw">plot.window</span>(<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">6</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>))</a>
<a class="sourceLine" id="cb558-2" title="2"><span class="kw">text</span>(<span class="dv">5</span>, <span class="dv">1</span>, <span class="dt">labels=</span><span class="kw">expression</span>(alpha<span class="op">/</span>(x<span class="op">+</span><span class="dv">2</span>)))</a>
<a class="sourceLine" id="cb558-3" title="3"><span class="kw">text</span>(<span class="dv">5</span>, <span class="fl">2.5</span>, <span class="dt">labels=</span><span class="kw">expression</span>(<span class="kw">frac</span>(alpha, x<span class="op">+</span><span class="dv">2</span>)))</a>
<a class="sourceLine" id="cb558-4" title="4"><span class="kw">box</span>()</a></code></pre></div>
<p><img src="10_graphics_common_files/figure-html/unnamed-chunk-6-1.png" width="326.4" /></p>
<p>note how <code>alpha</code> is turned into the corresponding Greek letter. Often you’ll want to combine strings with mathematical expressions in labels. This can be achieved using the <code>paste</code> function, as shown below:</p>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb559-1" title="1"><span class="kw">plot.new</span>(); <span class="kw">plot.window</span>(<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">6</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>))</a>
<a class="sourceLine" id="cb559-2" title="2"><span class="kw">text</span>(<span class="dv">5</span>, <span class="dv">1</span>, <span class="dt">labels=</span><span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;Amplitude (&quot;</span>, mu, <span class="st">&quot;V)&quot;</span>)))</a>
<a class="sourceLine" id="cb559-3" title="3"><span class="kw">box</span>()</a></code></pre></div>
<p><img src="10_graphics_common_files/figure-html/unnamed-chunk-7-1.png" width="326.4" /></p>
<p>Strings and mathematical expressions can also be combined using the multiplication (<code>*</code>) operator (e.g. <code>expression(&quot;Amplitude (&quot; * mu * &quot;V)&quot;)</code>), but this seems somewhat improper and runs into limitations. For example <code>expression(alpha == 3 * beta == 2)</code> results in an error, probably because it is not a valid mathematical expression, while <code>expression(paste(alpha == 3, beta == 2))</code> works without errors.</p>
<p>Spaces between symbols can be obtained by using one or more tilde (<code>~</code>) operators, as shown below:</p>
<div class="sourceCode" id="cb560"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb560-1" title="1"><span class="kw">plot.new</span>(); <span class="kw">plot.window</span>(<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">6</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>))</a>
<a class="sourceLine" id="cb560-2" title="2"><span class="kw">text</span>(<span class="dv">5</span>, <span class="dv">1</span>, <span class="dt">labels=</span><span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;No spaces: &quot;</span>, alpha <span class="op">*</span><span class="st"> </span>beta)))</a>
<a class="sourceLine" id="cb560-3" title="3"><span class="kw">text</span>(<span class="dv">5</span>, <span class="fl">2.5</span>, <span class="dt">labels=</span><span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;Spaces: &quot;</span>, alpha <span class="op">~</span><span class="st"> </span>beta)))</a>
<a class="sourceLine" id="cb560-4" title="4"><span class="kw">box</span>()</a></code></pre></div>
<p><img src="10_graphics_common_files/figure-html/unnamed-chunk-8-1.png" width="326.4" /></p>
<p>Sometimes you may want to print the value of a variable inside the expression of a plot label. In this case you can use the <code>substitute</code> function:</p>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb561-1" title="1">x =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>); y=<span class="kw">rnorm</span>(<span class="dv">100</span>)</a>
<a class="sourceLine" id="cb561-2" title="2">corrOut =<span class="st"> </span><span class="kw">cor.test</span>(x,y)</a>
<a class="sourceLine" id="cb561-3" title="3">corrEst =<span class="st"> </span>corrOut<span class="op">$</span>estimate</a>
<a class="sourceLine" id="cb561-4" title="4">corrPVal =<span class="st"> </span>corrOut<span class="op">$</span>p.value</a>
<a class="sourceLine" id="cb561-5" title="5"><span class="kw">plot</span>(x,y)</a>
<a class="sourceLine" id="cb561-6" title="6"><span class="kw">title</span>(<span class="dt">main=</span><span class="kw">substitute</span>(rho <span class="op">==</span><span class="st"> </span>v1, <span class="kw">list</span>(<span class="dt">v1=</span><span class="kw">round</span>(corrEst,<span class="dv">2</span>))))</a></code></pre></div>
<p><img src="10_graphics_common_files/figure-html/unnamed-chunk-9-1.png" width="326.4" /></p>
<p>the second argument to the function is a list of all the variable values that need to be substituted. In the example below two values are substituted:</p>
<div class="sourceCode" id="cb562"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb562-1" title="1"><span class="kw">plot</span>(x,y)</a>
<a class="sourceLine" id="cb562-2" title="2"><span class="kw">title</span>(<span class="dt">main=</span><span class="kw">substitute</span>(<span class="kw">paste</span>(rho <span class="op">==</span><span class="st"> </span>v1, <span class="st">&quot;; &quot;</span>, <span class="kw">italic</span>(p) <span class="op">==</span><span class="st"> </span>v2),</a>
<a class="sourceLine" id="cb562-3" title="3">                      <span class="kw">list</span>(<span class="dt">v1=</span><span class="kw">round</span>(corrEst,<span class="dv">2</span>), <span class="dt">v2=</span><span class="kw">round</span>(corrPVal, <span class="dv">2</span>))))</a></code></pre></div>
<p><img src="10_graphics_common_files/figure-html/unnamed-chunk-10-1.png" width="326.4" /></p>
<p>A few more example of mathematical expressions in labels are given below:</p>
<div class="sourceCode" id="cb563"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb563-1" title="1">uVText =<span class="st"> </span><span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;Amplitude (&quot;</span>, mu, <span class="st">&quot;V)&quot;</span>))</a>
<a class="sourceLine" id="cb563-2" title="2">dF0Text =<span class="st"> </span><span class="kw">expression</span>(<span class="kw">paste</span>( Delta, <span class="st">&#39;F0 (%)&#39;</span>))</a>
<a class="sourceLine" id="cb563-3" title="3">dpText =<span class="st"> </span><span class="kw">expression</span>(<span class="kw">paste</span>(<span class="kw">italic</span>(<span class="st">&quot;d&#39; &quot;</span>)))</a>
<a class="sourceLine" id="cb563-4" title="4">subText1 =<span class="st"> </span><span class="kw">expression</span>(<span class="kw">paste</span>(sigma, <span class="kw">scriptscriptstyle</span>(c), <span class="st">&quot; (Cents)&quot;</span>))</a>
<a class="sourceLine" id="cb563-5" title="5">subText2 =<span class="st"> </span><span class="kw">expression</span>(<span class="kw">paste</span>(delta, <span class="kw">scriptscriptstyle</span>(k)  <span class="op">%+-%</span><span class="st"> </span><span class="fl">162.5</span>,</a>
<a class="sourceLine" id="cb563-6" title="6">                            <span class="st">&#39; Cents&#39;</span>, <span class="dt">sep=</span><span class="st">&#39;&#39;</span>))</a>
<a class="sourceLine" id="cb563-7" title="7">sqText =<span class="st"> </span><span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&#39;F0 Acceleration (Hz/&#39;</span>, s<span class="op">^</span><span class="dv">2</span>, <span class="st">&#39;)&#39;</span>))</a>
<a class="sourceLine" id="cb563-8" title="8">piText =<span class="st"> </span><span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&#39;Start Phase 1.5&#39;</span>, pi,))</a>
<a class="sourceLine" id="cb563-9" title="9">betaText =<span class="st"> </span><span class="kw">expression</span>(beta[<span class="dv">0</span>])</a>
<a class="sourceLine" id="cb563-10" title="10">log10Text =<span class="st"> </span><span class="kw">expression</span>(log[<span class="dv">10</span>](nu))</a>
<a class="sourceLine" id="cb563-11" title="11">uVsqText =<span class="st"> </span><span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&#39;Level &#39;</span>, <span class="kw">italic</span>(<span class="st">&#39;re&#39;</span>), <span class="st">&#39; 1 &#39;</span>,</a>
<a class="sourceLine" id="cb563-12" title="12">                            mu, V<span class="op">^</span>{<span class="dv">2</span>}, <span class="st">&#39; (dB)&#39;</span>))</a>
<a class="sourceLine" id="cb563-13" title="13">bdText =<span class="st"> </span><span class="kw">expression</span>(<span class="kw">paste</span>( <span class="kw">bold</span>(<span class="st">&quot;Enhancement (&quot;</span>),</a>
<a class="sourceLine" id="cb563-14" title="14">                          <span class="kw">italic</span>(<span class="st">&quot;d&#39;&quot;</span>), <span class="kw">bold</span>(<span class="st">&quot;units)&quot;</span>)))</a>
<a class="sourceLine" id="cb563-15" title="15">zScoreText =<span class="st"> </span><span class="kw">expression</span>(<span class="kw">paste</span>(<span class="kw">italic</span>(z), <span class="st">&quot; Score&quot;</span>))</a>
<a class="sourceLine" id="cb563-16" title="16">densText =<span class="st"> </span><span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;Density (&quot;</span>, kg<span class="op">/</span>m<span class="op">^</span><span class="dv">3</span>, <span class="st">&quot;)&quot;</span>))</a>
<a class="sourceLine" id="cb563-17" title="17">beta2Text =<span class="st"> </span><span class="kw">expression</span>(mu[beta[<span class="dv">0</span>]])</a>
<a class="sourceLine" id="cb563-18" title="18">noiseText =<span class="st"> </span><span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;Noise [&quot;</span>, log[<span class="dv">10</span>], <span class="st">&quot;(Energy)]&quot;</span>))</a>
<a class="sourceLine" id="cb563-19" title="19">PTAText =<span class="st"> </span><span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;PTA&quot;</span>[<span class="st">&quot;0.5-2&quot;</span>], <span class="st">&quot; (dB)&quot;</span>))</a>
<a class="sourceLine" id="cb563-20" title="20">RSqText =<span class="st"> </span><span class="kw">expression</span>(<span class="st">&quot;R&quot;</span><span class="op">^</span><span class="st">&quot;2&quot;</span>)</a>
<a class="sourceLine" id="cb563-21" title="21">atopText =<span class="st"> </span><span class="kw">expression</span>(<span class="kw">atop</span>(<span class="st">&quot;PTA&quot;</span>[<span class="st">&quot;1-2&quot;</span>],<span class="st">&quot;(dB SPL)&quot;</span>))</a>
<a class="sourceLine" id="cb563-22" title="22">latencyText =<span class="st"> </span><span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;Latency (&quot;</span>, <span class="kw">italic</span>(z),</a>
<a class="sourceLine" id="cb563-23" title="23">                               <span class="st">&quot; Score)&quot;</span>))</a>
<a class="sourceLine" id="cb563-24" title="24"></a>
<a class="sourceLine" id="cb563-25" title="25"><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb563-26" title="26"></a>
<a class="sourceLine" id="cb563-27" title="27"><span class="kw">plot.new</span>(); <span class="kw">plot.window</span>(<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb563-28" title="28"><span class="kw">text</span>(<span class="dv">5</span>, <span class="fl">1.00</span>, <span class="dt">labels=</span>uVText)</a>
<a class="sourceLine" id="cb563-29" title="29"><span class="kw">text</span>(<span class="dv">5</span>, <span class="fl">2.25</span>, dF0Text)</a>
<a class="sourceLine" id="cb563-30" title="30"><span class="kw">text</span>(<span class="dv">5</span>, <span class="fl">3.50</span>, dpText)</a>
<a class="sourceLine" id="cb563-31" title="31"><span class="kw">text</span>(<span class="dv">5</span>, <span class="fl">4.75</span>, subText1)</a>
<a class="sourceLine" id="cb563-32" title="32"><span class="kw">text</span>(<span class="dv">5</span>, <span class="fl">6.00</span>, subText2)</a>
<a class="sourceLine" id="cb563-33" title="33"><span class="kw">text</span>(<span class="dv">5</span>, <span class="fl">7.25</span>, sqText)</a>
<a class="sourceLine" id="cb563-34" title="34"><span class="kw">text</span>(<span class="dv">5</span>, <span class="fl">8.5</span>, piText)</a>
<a class="sourceLine" id="cb563-35" title="35"><span class="kw">text</span>(<span class="dv">5</span>, <span class="fl">9.75</span>, betaText)</a>
<a class="sourceLine" id="cb563-36" title="36"><span class="kw">box</span>()</a>
<a class="sourceLine" id="cb563-37" title="37"></a>
<a class="sourceLine" id="cb563-38" title="38"><span class="kw">plot.new</span>(); <span class="kw">plot.window</span>(<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb563-39" title="39"><span class="kw">text</span>(<span class="dv">5</span>, <span class="fl">1.00</span>, <span class="dt">labels=</span>log10Text)</a>
<a class="sourceLine" id="cb563-40" title="40"><span class="kw">text</span>(<span class="dv">5</span>, <span class="fl">2.25</span>, uVsqText)</a>
<a class="sourceLine" id="cb563-41" title="41"><span class="kw">text</span>(<span class="dv">5</span>, <span class="fl">3.50</span>, bdText)</a>
<a class="sourceLine" id="cb563-42" title="42"><span class="kw">text</span>(<span class="dv">5</span>, <span class="fl">4.75</span>, zScoreText)</a>
<a class="sourceLine" id="cb563-43" title="43"><span class="kw">text</span>(<span class="dv">5</span>, <span class="fl">6.00</span>, densText)</a>
<a class="sourceLine" id="cb563-44" title="44"><span class="kw">text</span>(<span class="dv">5</span>, <span class="fl">7.25</span>, beta2Text)</a>
<a class="sourceLine" id="cb563-45" title="45"><span class="kw">text</span>(<span class="dv">5</span>, <span class="fl">8.5</span>, noiseText)</a>
<a class="sourceLine" id="cb563-46" title="46"><span class="kw">text</span>(<span class="dv">5</span>, <span class="fl">9.75</span>, PTAText)</a>
<a class="sourceLine" id="cb563-47" title="47"><span class="kw">box</span>()</a>
<a class="sourceLine" id="cb563-48" title="48"></a>
<a class="sourceLine" id="cb563-49" title="49"><span class="kw">plot.new</span>(); <span class="kw">plot.window</span>(<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb563-50" title="50"><span class="kw">text</span>(<span class="dv">5</span>, <span class="fl">1.00</span>, <span class="dt">labels=</span>latencyText)</a>
<a class="sourceLine" id="cb563-51" title="51"><span class="kw">text</span>(<span class="dv">5</span>, <span class="fl">2.25</span>, RSqText)</a>
<a class="sourceLine" id="cb563-52" title="52"><span class="kw">text</span>(<span class="dv">5</span>, <span class="fl">3.50</span>, <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb563-53" title="53"><span class="kw">text</span>(<span class="dv">5</span>, <span class="fl">4.75</span>, <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb563-54" title="54"><span class="kw">text</span>(<span class="dv">5</span>, <span class="fl">6.00</span>, <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb563-55" title="55"><span class="kw">text</span>(<span class="dv">5</span>, <span class="fl">7.25</span>, <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb563-56" title="56"><span class="kw">text</span>(<span class="dv">5</span>, <span class="fl">8.5</span>, <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb563-57" title="57"><span class="kw">text</span>(<span class="dv">5</span>, <span class="fl">9.75</span>, <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb563-58" title="58"><span class="kw">box</span>()</a>
<a class="sourceLine" id="cb563-59" title="59"><span class="kw">title</span>(<span class="dt">xlab=</span>atopText)</a></code></pre></div>
<p><img src="10_graphics_common_files/figure-html/unnamed-chunk-11-1.png" width="652.8" /></p>
</div>
<div id="fonts" class="section level2">
<h2><span class="header-section-number">10.3</span> Fonts for graphics</h2>
<p>In Section <a href="#parfonts">6.5.4</a> it was mentioned that it is possible to specify a system font (such as Palatino, or Arial) for the R base graphics via the <code>par(family=...)</code> setting, but this may or may not work depending on the specific graphics device (and of course also on whether that font is installed in your system or not).</p>
<p>I’ll focus on the issue of generating pdfs with custom fonts because I mostly use pdf for saving R graphics. The <code>pdf</code> device <em>does not</em> automaticaly embed the fonts in the file, and works only with a limited number of fonts (see <code>?pdfFonts</code> for details). An easy way to get around this issues is to use the <code>cairo_pdf</code> device instead of the <code>pdf</code> device: the <code>cairo_pdf</code> device can access all the true type fonts (TTF) and open type fonts (OTF) in your system and also embeds them in the pdf. The device can be used with both base graphics:</p>
<div class="sourceCode" id="cb564"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb564-1" title="1"><span class="kw">cairo_pdf</span>(<span class="st">&quot;base_graphics_ubuntu_font.pdf&quot;</span>, <span class="dt">family=</span><span class="st">&quot;Ubuntu&quot;</span>)</a>
<a class="sourceLine" id="cb564-2" title="2"><span class="kw">plot</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb564-3" title="3"><span class="kw">dev.off</span>()</a></code></pre></div>
<p>or with ggplot2, by setting the <code>device</code> argument in <code>ggsave</code> to <code>cairo_pdf</code>:</p>
<div class="sourceCode" id="cb565"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb565-1" title="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb565-2" title="2">n=<span class="dv">100</span></a>
<a class="sourceLine" id="cb565-3" title="3">dat=<span class="kw">data.frame</span>(<span class="dt">x=</span><span class="kw">rnorm</span>(n), <span class="dt">y=</span><span class="kw">rnorm</span>(n))</a>
<a class="sourceLine" id="cb565-4" title="4">p =<span class="st"> </span><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a>
<a class="sourceLine" id="cb565-5" title="5">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;X-Label&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Y-Label&quot;</span>)</a>
<a class="sourceLine" id="cb565-6" title="6">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">text=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">12</span>, <span class="dt">family=</span><span class="st">&quot;Ubuntu&quot;</span>))</a>
<a class="sourceLine" id="cb565-7" title="7"><span class="kw">ggsave</span>(<span class="st">&quot;ggplot2_cairo_pdf.pdf&quot;</span>, p, <span class="dt">width=</span><span class="fl">3.4</span>, <span class="dt">height=</span><span class="fl">3.4</span>,</a>
<a class="sourceLine" id="cb565-8" title="8">       <span class="dt">device=</span>cairo_pdf)</a></code></pre></div>
<p>An alternative solution for using system fonts in pdfs is the <a href="https://cran.r-project.org/web/packages/extrafont/README.html"><code>extrafont</code></a> package. Another alternative is the <a href="https://cran.rstudio.com/web/packages/showtext/index.html"><code>showtext</code></a> package. Compared to <code>extrafont</code> the <code>showtext</code> package has the advantage of being able to use open type fonts; however <code>showtext</code> has the disadvantage of not rendering the fonts as “drawings” (you can’t copy and paste text). Overall, my favorite solution is to use <code>cairo_pdf</code> because it handles both TTF and OTF fonts.</p>

</div>
</div>
<div id="graphicspublications" class="section level1">
<h1><span class="header-section-number">11</span> Preparing graphics for publications</h1>
<p>Academic journals usually have a number of stylistic requirements for figures, including for example font family and size, absence of decorative elements such as borders around the figure, and labeling of figures with letters in multi-panel figures. Some people first produce a figure in R (or other software), and then post-process it “manually” using graphics editing software to meet the journal requirements. While this is a viable option, I find it very inefficient and prefer to obtain publication-quality figures directly in R.</p>
<div id="figure-size-and-fonts" class="section level2">
<h2><span class="header-section-number">11.1</span> Figure size and fonts</h2>
<p>This section will cover some common requirements regarding fonts and print size for publication-quality figures, and applies for figures generated with any of the R graphics systems (R base, <code>ggplot</code>, and <code>lattice</code>). The next sections will present specific examples with each graphics system.</p>
<p>Statistical plots for print journals should be saved in a <a href="https://en.wikipedia.org/wiki/Vector_graphics">vector graphics</a> format such as <code>pdf</code> or <code>eps</code>, while images should be saved in a <a href="https://en.wikipedia.org/wiki/Raster_graphics">raster graphics</a> format such as <code>tiff</code>.</p>
<p>Academic journals typically require using a <a href="https://en.wikipedia.org/wiki/Sans-serif">sans-serif</a> font with a 12 point size for figure annotations. Use of fonts for R graphics was covered in Section <a href="#fonts">10.3</a>, but we’ll present some examples in the next sections.</p>
<p>Most journals require you to submit figure files with embedded fonts. For <code>pdf</code> files, the easiest way to do this is to use the <code>cairo_pdf</code> function instead of the <code>pdf</code> function for base R and <code>lattice</code> graphics, and use the <code>device=cairo_pdf</code> in <code>ggsave</code> for <code>ggplot2</code> graphics; the <code>pdf</code> files saved in this way will have their fonts embedded (see Section <a href="#fonts">10.3</a>). Alternatively, you can embed fonts using an external program. On Linux I use the following bash script to embed fonts through the <code>gs</code> program:</p>
<div class="sourceCode" id="cb566"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb566-1" title="1"><span class="co">#! /bin/bash</span></a>
<a class="sourceLine" id="cb566-2" title="2"></a>
<a class="sourceLine" id="cb566-3" title="3"><span class="co">#usage embed_pdf_fonts input output</span></a>
<a class="sourceLine" id="cb566-4" title="4"><span class="fu">gs</span> -q -dNOPAUSE -dBATCH -dEPSCrop \</a>
<a class="sourceLine" id="cb566-5" title="5">   -sDEVICE=pdfwrite -dPDFSETTINGS=/prepress \</a>
<a class="sourceLine" id="cb566-6" title="6">   -dPrinted=false -sOutputFile=<span class="va">$2</span> <span class="va">$1</span> </a></code></pre></div>
<p>Many academic journals use a two column layout, and have guidelines indicating the maximal physical size of a figure. A figure typically spans either one or two columns, although sometimes also figures spanning one and a half, or only half a column are allowed. The exact requirements re maximum figure width by figure type (1-col, 2-col, etc…) vary from journal to journal, but they are usually close to those indicated in Table <a href="#tab:figsize">11.1</a>.</p>
<table>
<caption><span id="tab:figsize">Table 11.1: </span> Typical figure width in academic journals for different figure types. Width in given in inches (in), and millimeters (mm).</caption>
<thead>
<tr class="header">
<th align="left">Fig. type</th>
<th align="left">Fig. width</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1/2 column</td>
<td align="left">1.535 in (39 mm)</td>
</tr>
<tr class="even">
<td align="left">1 column</td>
<td align="left">3.307 in (84 mm)</td>
</tr>
<tr class="odd">
<td align="left">1.5 columns</td>
<td align="left">5.078 in (129 mm)</td>
</tr>
<tr class="even">
<td align="left">2 columns</td>
<td align="left">6.85 in (174 mm)</td>
</tr>
</tbody>
</table>
<p>The default print size of the figures used by the <code>cairo_pdf</code> and <code>ggsave</code> functions (i.e. if you don’t specify <code>width</code> and <code>height</code>) is much larger than the typical 1-column figure size required by academic journals. It becomes more difficult to fit certain elements (e.g. axis labels) in a smaller space, so it’s best to start saving figures in the smaller size typically required by journals early in the paper write-up process and make sure they look right in that size.</p>
<div id="baserlattfigsizefonts" class="section level3">
<h3><span class="header-section-number">11.1.1</span> Baser R and <code>lattice</code> plots</h3>
<p>To obtain <code>pdf</code> figures of a given print width and height we can pass the <code>width</code> and <code>height</code> arguments to the <code>cairo_pdf</code> function, specifying the desired values in inches:</p>
<div class="sourceCode" id="cb567"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb567-1" title="1"><span class="kw">cairo_pdf</span>(<span class="st">&quot;Fig1.pdf&quot;</span>, <span class="dt">width=</span><span class="fl">3.307</span>, <span class="dt">height=</span><span class="fl">3.307</span>)</a></code></pre></div>
<p>The default font used by <code>cairo_pdf</code> is sans-serif at size 12, so you don’t really need to change that, should you need to you can pass the <code>family</code> and <code>pointsize</code> arguments to the function:</p>
<div class="sourceCode" id="cb568"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb568-1" title="1"><span class="kw">cairo_pdf</span>(<span class="st">&quot;Fig1.pdf&quot;</span>, <span class="dt">width=</span><span class="fl">3.307</span>, <span class="dt">height=</span><span class="fl">3.307</span>,</a>
<a class="sourceLine" id="cb568-2" title="2">          <span class="dt">family=</span><span class="st">&quot;Helvetica&quot;</span>, <span class="dt">pointsize=</span><span class="dv">12</span>)</a></code></pre></div>
</div>
<div id="ggplot2figsizefonts" class="section level3">
<h3><span class="header-section-number">11.1.2</span> <code>ggplot2</code></h3>
<p>The pointsize and font depend on the theme you’re using. Many themes use a sans-serif font, so you probably don’t need to change that. However, you may need to change the point size (e.g. the default <code>ggplot2</code> theme uses an 11 point size). You can change that with <code>theme(text=element_text(size=12))</code>. The following code shows an example of changing both the font family and the point size:</p>
<div class="sourceCode" id="cb569"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb569-1" title="1">n=<span class="dv">100</span></a>
<a class="sourceLine" id="cb569-2" title="2">dat=<span class="kw">data.frame</span>(<span class="dt">x=</span><span class="kw">rnorm</span>(n), <span class="dt">y=</span><span class="kw">rnorm</span>(n))</a>
<a class="sourceLine" id="cb569-3" title="3">p =<span class="st"> </span><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a>
<a class="sourceLine" id="cb569-4" title="4">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;X-Label&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Y-Label&quot;</span>)</a>
<a class="sourceLine" id="cb569-5" title="5">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">text=</span><span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">12</span>, <span class="dt">family=</span><span class="st">&quot;Helvetica&quot;</span>))</a></code></pre></div>
<p>Alternatively, you can set the font family and pointsize directly when calling a specific theme, as in the following example:</p>
<div class="sourceCode" id="cb570"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb570-1" title="1">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>(<span class="dt">base_family=</span><span class="st">&quot;Helvetica&quot;</span>, <span class="dt">base_size=</span><span class="dv">12</span>)</a></code></pre></div>
<p>To obtain figures of a certain physical width and height we can pass the <code>width</code> and <code>height</code> arguments to the <code>ggsave</code> function:</p>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb571-1" title="1"><span class="kw">ggsave</span>(<span class="st">&quot;Fig1.pdf&quot;</span>, plot1, <span class="dt">width=</span><span class="fl">3.307</span>, <span class="dt">height=</span><span class="fl">3.307</span>, <span class="dt">device=</span>cairo_pdf)</a></code></pre></div>
<p>by default <code>width</code> and <code>height</code> units are in inches, though this can be changed by passing a <code>units</code> argument if desired (see <code>?ggsave</code>).</p>
</div>
</div>
<div id="pubthemes" class="section level2">
<h2><span class="header-section-number">11.2</span> Themes</h2>
<p>Many journals require a rather plain style for figures, with a white background, no grid lines, and no “borders” or “boxes” around the figure beside the x and y axes.</p>
<div id="baserpubthemes" class="section level3">
<h3><span class="header-section-number">11.2.1</span> Base R</h3>
<p>By default plots have a white background and no grid. The “borders” around the figures can be removed through the <code>bty</code> argument. Setting <code>bty</code> to <code>n</code> removes the borders from all sides, while setting it to <code>L</code> leaves the borders around the bottom and left axes:</p>
<div class="sourceCode" id="cb572"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb572-1" title="1"><span class="kw">plot</span>(<span class="kw">rnorm</span>(<span class="dv">100</span>), <span class="dt">bty=</span><span class="st">&quot;L&quot;</span>)</a></code></pre></div>
</div>
<div id="ggplot2pubthemes" class="section level3">
<h3><span class="header-section-number">11.2.2</span> <code>ggplot2</code></h3>
<p>The <code>theme_classic</code> theme generally follows the style commonly requested by academic journals, so in many cases all you’ll need to do is set this theme, increasing the font point size from 11 to 12:</p>
<div class="sourceCode" id="cb573"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb573-1" title="1">n=<span class="dv">100</span>; dat=<span class="kw">data.frame</span>(<span class="dt">x=</span><span class="kw">rnorm</span>(n), <span class="dt">y=</span><span class="kw">rnorm</span>(n))</a>
<a class="sourceLine" id="cb573-2" title="2">p =<span class="st"> </span><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a>
<a class="sourceLine" id="cb573-3" title="3">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;X-Label&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Y-Label&quot;</span>)</a>
<a class="sourceLine" id="cb573-4" title="4">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">theme_classic</span>(<span class="dt">base_size=</span><span class="dv">12</span>)</a></code></pre></div>
<p>Alternatively, you can use the <code>theme_cowplot</code> from the <a href="https://cran.r-project.org/web/packages/cowplot/index.html"><code>cowplot</code></a> package, which is very similar to <code>theme_classic</code>.</p>
</div>
<div id="lattpubthemes" class="section level3">
<h3><span class="header-section-number">11.2.3</span> <code>lattice</code></h3>
</div>
</div>
<div id="multi-panel-figures" class="section level2">
<h2><span class="header-section-number">11.3</span> Multi-panel figures</h2>
<div id="ggplot2pubmultipanel" class="section level3">
<h3><span class="header-section-number">11.3.1</span> <code>ggplot2</code></h3>
<p>The <code>plot_grid</code> function from the <code>cowplot</code> package can be used to arrange separate <code>ggplot2</code> plots in a grid layout and label them, as shown in Figure <a href="#fig:plotgrid1">11.1</a>, which was obtained with the following code:</p>
<div class="sourceCode" id="cb574"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb574-1" title="1"><span class="kw">library</span>(cowplot); <span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb574-2" title="2"><span class="kw">data</span>(iris)</a>
<a class="sourceLine" id="cb574-3" title="3">p1 =<span class="st"> </span><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(Sepal.Width, Sepal.Length)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a>
<a class="sourceLine" id="cb574-4" title="4">p2 =<span class="st"> </span><span class="kw">ggplot</span>(iris, <span class="kw">aes</span>(Petal.Width, Petal.Length)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a>
<a class="sourceLine" id="cb574-5" title="5"><span class="kw">plot_grid</span>(p1, p2, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&#39;A&#39;</span>, <span class="st">&#39;B&#39;</span>), <span class="dt">label_size =</span> <span class="dv">12</span>)</a></code></pre></div>
<div class="figure"><span id="fig:plotgrid1"></span>
<img src="11_figures_for_publication_files/figure-html/plotgrid1-1.png" alt="Multi-panel figure arranged and labeled with the `plot_grid` function." width="489.6" />
<p class="caption">
Figure 11.1: Multi-panel figure arranged and labeled with the <code>plot_grid</code> function.
</p>
</div>
</div>
<div id="lattpubmultipanel" class="section level3">
<h3><span class="header-section-number">11.3.2</span> <code>lattice</code></h3>
<p>The <code>plot_grid</code> function from the <code>cowplot</code> package can be used to arrange separate <code>lattice</code> plots in a grid layout and label them, as shown in Figure <a href="#fig:lattplotgrid1">11.2</a>, which was obtained with the following code:</p>
<div class="sourceCode" id="cb575"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb575-1" title="1"><span class="kw">library</span>(lattice)</a>
<a class="sourceLine" id="cb575-2" title="2">p1 =<span class="st"> </span><span class="kw">xyplot</span>(Sepal.Length<span class="op">~</span>Sepal.Width, <span class="dt">data=</span>iris)</a>
<a class="sourceLine" id="cb575-3" title="3">p2 =<span class="st"> </span><span class="kw">xyplot</span>(Petal.Length<span class="op">~</span>Petal.Width, <span class="dt">data=</span>iris)</a>
<a class="sourceLine" id="cb575-4" title="4"><span class="kw">plot_grid</span>(p1, p2, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&#39;A&#39;</span>, <span class="st">&#39;B&#39;</span>), <span class="dt">label_size =</span> <span class="dv">12</span>)</a></code></pre></div>
<div class="figure"><span id="fig:lattplotgrid1"></span>
<img src="11_figures_for_publication_files/figure-html/lattplotgrid1-1.png" alt="Multi-panel figure arranged and labeled with the `plot_grid` function." width="489.6" />
<p class="caption">
Figure 11.2: Multi-panel figure arranged and labeled with the <code>plot_grid</code> function.
</p>
</div>
<p>For multi-panel plots obtained via panel conditioning, we can use the <code>page</code> function to add labels. First we write some boilerplate code for preparing the plot.</p>
<div class="sourceCode" id="cb576"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb576-1" title="1"><span class="kw">library</span>(grid)</a>
<a class="sourceLine" id="cb576-2" title="2">ir2 =<span class="st"> </span>iris[iris<span class="op">$</span>Species<span class="op">!=</span><span class="st">&quot;virginica&quot;</span>,]</a>
<a class="sourceLine" id="cb576-3" title="3">axis.L =<span class="st">  </span><span class="cf">function</span>(side, ..., line.col){</a>
<a class="sourceLine" id="cb576-4" title="4">    <span class="cf">if</span> (side <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;bottom&quot;</span>, <span class="st">&quot;left&quot;</span>)) {</a>
<a class="sourceLine" id="cb576-5" title="5">        col =<span class="st"> </span><span class="kw">trellis.par.get</span>(<span class="st">&quot;axis.text&quot;</span>)<span class="op">$</span>col</a>
<a class="sourceLine" id="cb576-6" title="6">        <span class="kw">axis.default</span>(side, ..., <span class="dt">line.col =</span> col)</a>
<a class="sourceLine" id="cb576-7" title="7">        <span class="cf">if</span> (side <span class="op">==</span><span class="st"> &quot;bottom&quot;</span>)</a>
<a class="sourceLine" id="cb576-8" title="8">            grid<span class="op">::</span><span class="kw">grid.lines</span>(<span class="dt">y =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb576-9" title="9">        <span class="cf">if</span> (side <span class="op">==</span><span class="st"> &quot;left&quot;</span>)</a>
<a class="sourceLine" id="cb576-10" title="10">            grid<span class="op">::</span><span class="kw">grid.lines</span>(<span class="dt">x =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb576-11" title="11">    }</a>
<a class="sourceLine" id="cb576-12" title="12">}</a></code></pre></div>
<p>Now we draw the graph (shown in Figure <a href="#fig:lattfiglab1">11.3</a>) with <code>xyplot</code>, and add labels via the <code>page</code> function which uses the whole display area as the default viewport. We use <code>grid</code> functions inside the <code>page</code> function to annotate the plot.</p>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb577-1" title="1">p =<span class="st"> </span><span class="kw">xyplot</span>(Sepal.Length<span class="op">~</span>Sepal.Width <span class="op">|</span><span class="st"> </span>Species, <span class="dt">data=</span>ir2, <span class="dt">axis=</span>axis.L,</a>
<a class="sourceLine" id="cb577-2" title="2">           <span class="dt">scales=</span><span class="kw">list</span>(<span class="dt">x=</span><span class="kw">list</span>(<span class="dt">alternating=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)),</a>
<a class="sourceLine" id="cb577-3" title="3">                       <span class="dt">y=</span><span class="kw">list</span>(<span class="dt">limits=</span><span class="kw">c</span>(<span class="kw">min</span>(ir2<span class="op">$</span>Sepal.Length),</a>
<a class="sourceLine" id="cb577-4" title="4">                                       <span class="kw">max</span>(ir2<span class="op">$</span>Sepal.Length)),</a>
<a class="sourceLine" id="cb577-5" title="5">                              <span class="dt">relation=</span><span class="st">&quot;free&quot;</span>)),</a>
<a class="sourceLine" id="cb577-6" title="6">           <span class="dt">strip=</span><span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb577-7" title="7">           <span class="dt">par.settings=</span><span class="kw">list</span>(<span class="dt">axis.line=</span><span class="kw">list</span>(<span class="dt">col=</span><span class="st">&quot;transparent&quot;</span>)),</a>
<a class="sourceLine" id="cb577-8" title="8">           <span class="dt">page =</span> <span class="cf">function</span>(n) {</a>
<a class="sourceLine" id="cb577-9" title="9">               <span class="kw">grid.text</span>(<span class="dt">label =</span> <span class="st">&quot;A&quot;</span>,</a>
<a class="sourceLine" id="cb577-10" title="10">                         <span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.05</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="fl">0.96</span>, <span class="st">&quot;npc&quot;</span>),</a>
<a class="sourceLine" id="cb577-11" title="11">                         <span class="dt">just =</span> <span class="kw">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;center&quot;</span>), <span class="dt">gp=</span><span class="kw">gpar</span>(<span class="dt">fontface=</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb577-12" title="12">               <span class="kw">grid.text</span>(<span class="dt">label =</span> <span class="st">&quot;B&quot;</span>,</a>
<a class="sourceLine" id="cb577-13" title="13">                         <span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.525</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="fl">0.96</span>, <span class="st">&quot;npc&quot;</span>),</a>
<a class="sourceLine" id="cb577-14" title="14">                         <span class="dt">just =</span> <span class="kw">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;center&quot;</span>), <span class="dt">gp=</span><span class="kw">gpar</span>(<span class="dt">fontface=</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb577-15" title="15">           }</a>
<a class="sourceLine" id="cb577-16" title="16">           )</a>
<a class="sourceLine" id="cb577-17" title="17"><span class="kw">print</span>(p)</a></code></pre></div>
<div class="figure"><span id="fig:lattfiglab1"></span>
<img src="11_figures_for_publication_files/figure-html/lattfiglab1-1.png" alt="`lattice` panels with labels." width="489.6" />
<p class="caption">
Figure 11.3: <code>lattice</code> panels with labels.
</p>
</div>

</div>
</div>
</div>
<div id="tidyverse" class="section level1">
<h1><span class="header-section-number">12</span> Tidyverse</h1>
<p>Tidyverse is a collection of R packages that used in conjuction significantly change the way of working with R.</p>
<p><code>ggplot2</code> and <code>dplyr</code> are probably the most popular packages in <code>tidyverse</code>. When you start using <code>ggplot2</code> it becomes almost essential to use <code>dplyr</code> too because <code>ggplot2</code> is heavily based on dataframes or tibbles as input data. Before covering <code>dplyr</code> we will explain what tibbles are in the next section because <code>dplyr</code> returns tibbles as objects.</p>
<div id="tibbles" class="section level2">
<h2><span class="header-section-number">12.1</span> Tibbles</h2>
<p>Tibbles are a modern take on dataframes (which we introduced in Section <a href="#dataframes">3.5</a>). Tibbles are in fact very similar to dataframes, but if you’re used to dataframes, there are a few things that may surprise you when you start using tibbles.</p>
<p>Tibbles can be constructed with the <code>tibble</code> function, which is similar to the <code>data.frame</code> function for constructing dataframes:</p>
<div class="sourceCode" id="cb578"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb578-1" title="1"><span class="kw">library</span>(tibble)</a>
<a class="sourceLine" id="cb578-2" title="2">dat =<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x=</span><span class="kw">rnorm</span>(<span class="dv">20</span>), <span class="dt">y=</span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>), <span class="dt">each=</span><span class="dv">10</span>))</a></code></pre></div>
<p>They can be easily converted to dataframes with the <code>as.data.frame</code> function if needed:</p>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb579-1" title="1">dat_frame =<span class="st"> </span><span class="kw">as.data.frame</span>(dat)</a></code></pre></div>
<p>and dataframes can also be easily converted to tibbles with the <code>as_tibble</code> function:</p>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb580-1" title="1">dat2 =<span class="st"> </span><span class="kw">as_tibble</span>(dat_frame)</a></code></pre></div>
<p>One feature of tibbles that may surprise you is the fact that, by default, when you use a print method on a tibble only a limited number of rows and columns are shown. This is for me a very annoying thing, because when I load a dataframe I want to see <strong>all</strong> the columns with the variable names (typically I do this with <code>head(df)</code>). Luckily you can change these defaults by specifying the <code>tibble.print_max</code> and <code>tibble.width</code> options. You can do this in your <code>.Rprofile</code> file in your home directory so that your preference sticks across sessions:</p>
<div class="sourceCode" id="cb581"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb581-1" title="1"><span class="co">## This goes in .Rprofile in ~/</span></a>
<a class="sourceLine" id="cb581-2" title="2">.First &lt;-<span class="st"> </span><span class="cf">function</span>(){</a>
<a class="sourceLine" id="cb581-3" title="3">    <span class="kw">.libPaths</span>(<span class="kw">c</span>((<span class="kw">.libPaths</span>()), <span class="st">&quot;~/.R_library/&quot;</span>))</a>
<a class="sourceLine" id="cb581-4" title="4">    <span class="kw">options</span>(<span class="dt">tibble.print_max =</span> <span class="ot">Inf</span>)</a>
<a class="sourceLine" id="cb581-5" title="5">    <span class="kw">options</span>(<span class="dt">tibble.width =</span> <span class="ot">Inf</span>)</a>
<a class="sourceLine" id="cb581-6" title="6">}</a></code></pre></div>
<p>Another aspect of tibbles that may surprise dataframe users is their behavior <em>re</em> subsetting. For example, you might expect that the following returns a vector:</p>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb582-1" title="1">dat[dat<span class="op">$</span>y<span class="op">==</span><span class="st">&quot;A&quot;</span>, <span class="st">&quot;x&quot;</span>]</a></code></pre></div>
<pre><code>## # A tibble: 10 x 1
##          x
##      &lt;dbl&gt;
##  1  0.0983
##  2 -0.280 
##  3  1.02  
##  4  0.0584
##  5 -0.417 
##  6 -1.74  
##  7  0.365 
##  8 -0.317 
##  9 -1.37  
## 10 -0.501</code></pre>
<p>but it returns a 1-column tibble instead. Furthermore trying <code>as.numeric(dat[dat$y==&quot;A&quot;, &quot;x&quot;])</code> to convert it to a vector doesn’t work. The solution is to use the <code>pull</code> function from <code>dplyr</code>:</p>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb584-1" title="1"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb584-2" title="2"><span class="kw">pull</span>(dat[dat<span class="op">$</span>y<span class="op">==</span><span class="st">&quot;A&quot;</span>, ], x)</a></code></pre></div>
<pre><code>##  [1]  0.09831035 -0.27951673  1.02105526  0.05843470 -0.41656644 -1.73980278
##  [7]  0.36467128 -0.31725294 -1.36515908 -0.50087454</code></pre>
<p>More succintly, if, for example, you wanted to run a <span class="math inline">\(t\)</span>-test on the groups indicated by the <code>y</code> variable, you could do the following through <code>dplyr</code>:</p>
<div class="sourceCode" id="cb586"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb586-1" title="1"><span class="kw">t.test</span>(dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(y<span class="op">==</span><span class="st">&quot;A&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(x),</a>
<a class="sourceLine" id="cb586-2" title="2">       dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(y<span class="op">==</span><span class="st">&quot;B&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(x))</a></code></pre></div>
<pre><code>## 
## 	Welch Two Sample t-test
## 
## data:  dat %&gt;% filter(y == &quot;A&quot;) %&gt;% pull(x) and dat %&gt;% filter(y == &quot;B&quot;) %&gt;% pull(x)
## t = -0.52826, df = 14.151, p-value = 0.6055
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -1.3785623  0.8332464
## sample estimates:
##   mean of x   mean of y 
## -0.30767009 -0.03501214</code></pre>
</div>
<div id="dplyr" class="section level2">
<h2><span class="header-section-number">12.2</span> <code>dplyr</code></h2>
<p><code>dplyr</code> is the Swiss army knife of dataframe manipulation. It can be used to take subsets of the rows of a dataframe on the basis of the values of one or more variables (<code>filter</code> function). It can be used to take subsets of the column of a dataframe (<code>select</code> function). It can be used to create new columns that are functions of one or more rows of a dataframe (<code>mutate</code> function). It can be used to create dataframes that summarize variables of another dataframe on the basis of factor groupings (<code>summarize</code> combined with <code>group_by</code> functions). All these operations could be done also without <code>dplyr</code> through base R functions. However, <code>dplyr</code> really shines in making these operations seamless and straightforward, with a concise sintax.</p>
<p>A key element that allows you to seamlessly manipulate dataframes with <code>dplyr</code> with a concise sintax is the pipe operator <code>%&gt;%</code>. This operator comes from the <code>magrittr</code> package that is automaticaly loaded when you lod <code>dplyr</code>. Let’s suppose that we want to take the subset of the <code>iris</code> dataframe consisting of observations for the species setosa, and we’re only interested in the columns for petal length and width. We can do this without using the pipe operator as follows:</p>
<div class="sourceCode" id="cb588"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb588-1" title="1">iris_set =<span class="st"> </span><span class="kw">filter</span>(iris, Species<span class="op">==</span><span class="st">&quot;setosa&quot;</span>)</a>
<a class="sourceLine" id="cb588-2" title="2">iris_set =<span class="st"> </span><span class="kw">select</span>(iris_set, Petal.Length, Petal.Width)</a></code></pre></div>
<p>when used without the pipe operator, the first argument that we pass to the <code>filter</code> and <code>select</code> functions is the dataframe on which they need to operate. With the pipe we don’t need to pass this argument to the functions, we simply “pipe” the dataframe through as follows:</p>
<div class="sourceCode" id="cb589"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb589-1" title="1">iris_set =<span class="st"> </span>iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Species<span class="op">==</span><span class="st">&quot;setosa&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(Petal.Length, Petal.Width)</a></code></pre></div>
<p>this way we’ve “chained” two operations and accomplised our aim with a single, less verbose, line of code! You can think of the <code>%&gt;%</code> operator as taking the output of the function on its left and passing it forward to the function on its right for further processing.</p>
<div id="group_by-and-summarize" class="section level3">
<h3><span class="header-section-number">12.2.1</span> <code>group_by</code> and <code>summarize</code></h3>
<p>The <code>group_by</code> function generates a “grouped” tibble:</p>
<div class="sourceCode" id="cb590"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb590-1" title="1">grIris =<span class="st"> </span>iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Species);</a>
<a class="sourceLine" id="cb590-2" title="2"><span class="kw">str</span>(grIris)</a></code></pre></div>
<pre><code>## tibble [150 × 5] (S3: grouped_df/tbl_df/tbl/data.frame)
##  $ Sepal.Length: num [1:150] 5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...
##  $ Sepal.Width : num [1:150] 3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...
##  $ Petal.Length: num [1:150] 1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...
##  $ Petal.Width : num [1:150] 0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...
##  $ Species     : Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  - attr(*, &quot;groups&quot;)= tibble [3 × 2] (S3: tbl_df/tbl/data.frame)
##   ..$ Species: Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 1 2 3
##   ..$ .rows  : list&lt;int&gt; [1:3] 
##   .. ..$ : int [1:50] 1 2 3 4 5 6 7 8 9 10 ...
##   .. ..$ : int [1:50] 51 52 53 54 55 56 57 58 59 60 ...
##   .. ..$ : int [1:50] 101 102 103 104 105 106 107 108 109 110 ...
##   .. ..@ ptype: int(0) 
##   ..- attr(*, &quot;.drop&quot;)= logi TRUE</code></pre>
<p>this is useful because subsequent functions in the pipeline operate on the groups defined with <code>group_by</code>. For example, the following lines will compute the mean petal length for each species:</p>
<div class="sourceCode" id="cb592"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb592-1" title="1">iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">meanPetLen=</span><span class="kw">mean</span>(Petal.Length))</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   Species    meanPetLen
##   &lt;fct&gt;           &lt;dbl&gt;
## 1 setosa           1.46
## 2 versicolor       4.26
## 3 virginica        5.55</code></pre>
<p>note that we can group by more than one variable, and we can compute more than one statistics in the <code>summarize</code> call, as shown in the following example which uses the <code>mpg</code> dataset provided by <code>ggplot2</code>:</p>
<div class="sourceCode" id="cb594"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb594-1" title="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb594-2" title="2">mpg_grpd =<span class="st"> </span>mpg <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(manufacturer, trans) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">meanHWY=</span><span class="kw">mean</span>(hwy),</a>
<a class="sourceLine" id="cb594-3" title="3">                                                               <span class="dt">sdHWY=</span><span class="kw">sd</span>(hwy),</a>
<a class="sourceLine" id="cb594-4" title="4">                                                               <span class="dt">meanCTY=</span><span class="kw">mean</span>(cty),</a>
<a class="sourceLine" id="cb594-5" title="5">                                                               <span class="dt">sdCTY=</span><span class="kw">sd</span>(cty))</a>
<a class="sourceLine" id="cb594-6" title="6"><span class="kw">head</span>(mpg_grpd)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 6
## # Groups:   manufacturer [2]
##   manufacturer trans      meanHWY sdHWY meanCTY sdCTY
##   &lt;chr&gt;        &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1 audi         auto(av)      28.5  2.12    19.5  2.12
## 2 audi         auto(l5)      25.8  1.92    16    1.22
## 3 audi         auto(s6)      25    1.63    17.2  1.26
## 4 audi         manual(m5)    26.5  1.73    18.5  1.73
## 5 audi         manual(m6)    28    3       18.3  2.89
## 6 chevrolet    auto(l4)      20.6  5.43    14.7  3.36</code></pre>
</div>
<div id="getting-counts-of-cases" class="section level3">
<h3><span class="header-section-number">12.2.2</span> Getting counts of cases</h3>
<div class="sourceCode" id="cb596"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb596-1" title="1">y =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dt">mean=</span><span class="dv">100</span>, <span class="dt">sd=</span><span class="dv">20</span>)</a>
<a class="sourceLine" id="cb596-2" title="2">fct =<span class="st"> </span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;D&quot;</span>), <span class="dt">each=</span><span class="dv">25</span>)</a>
<a class="sourceLine" id="cb596-3" title="3">dat =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">fct=</span>fct, <span class="dt">y=</span>y)</a>
<a class="sourceLine" id="cb596-4" title="4">dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(fct) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(y<span class="op">&gt;</span><span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="kw">n</span>())</a></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   fct   `n()`
##   &lt;chr&gt; &lt;int&gt;
## 1 A        13
## 2 B        16
## 3 C         8
## 4 D        15</code></pre>
<div class="sourceCode" id="cb598"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb598-1" title="1"><span class="co">## shorthand version</span></a>
<a class="sourceLine" id="cb598-2" title="2">dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(y<span class="op">&gt;</span><span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(fct)</a></code></pre></div>
<pre><code>##   fct  n
## 1   A 13
## 2   B 16
## 3   C  8
## 4   D 15</code></pre>
<div class="sourceCode" id="cb600"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb600-1" title="1"><span class="co">## alternative version</span></a>
<a class="sourceLine" id="cb600-2" title="2">dat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(fct) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(y<span class="op">&gt;</span><span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tally</span>()</a></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   fct       n
##   &lt;chr&gt; &lt;int&gt;
## 1 A        13
## 2 B        16
## 3 C         8
## 4 D        15</code></pre>
</div>
</div>
<div id="tests-statistics-with-dplyr-and-broom" class="section level2">
<h2><span class="header-section-number">12.3</span> Tests statistics with <code>dplyr</code> and <code>broom</code></h2>
<p>The <a href="https://cran.r-project.org/web/packages/broom/"><code>broom</code></a> package converts the output of some R models to tibbles. As we will see below, used in conjunction with <code>dplyr</code> this provides a very efficient way of fitting models or performing statistical tests on grouped data. Let’s first see an example of what <code>broom</code> does. We’ll fit a simple linear regression model using the <code>iris</code> dataset. We’ll first fit the model on the data of the setosa species only:</p>
<div class="sourceCode" id="cb602"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb602-1" title="1"><span class="kw">data</span>(iris)</a>
<a class="sourceLine" id="cb602-2" title="2">fit_single =<span class="st"> </span><span class="kw">lm</span>(Petal.Length<span class="op">~</span>Sepal.Length, <span class="dt">data=</span>iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Species<span class="op">==</span><span class="st">&quot;setosa&quot;</span>))</a></code></pre></div>
<p>if we run <code>str(fit_single)</code> we can see that the output of <code>lm</code> is a list. We can get a nice printout of the results with <code>summary(fit_single)</code>, but while easy to read, such output is again stored in a list (you can check with <code>str(summary(fit_single))</code>) which is not easy to store or process further (e.g. combining the output with that of other model fits and storing in a CSV file). <code>broom</code> aims to solve this issue. The <code>tidy</code> function turns the coefficients and test statistics for each term of the model into a tibble:</p>
<div class="sourceCode" id="cb603"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb603-1" title="1"><span class="kw">library</span>(broom)</a>
<a class="sourceLine" id="cb603-2" title="2">fit_single_tidy =<span class="st"> </span><span class="kw">tidy</span>(fit_single)</a></code></pre></div>
<p>the <code>glance</code> function turns parameters and statistics <em>global</em> to the model (as opposed to being specific to a given term) into a tibble:</p>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb604-1" title="1">fit_single_glance =<span class="st"> </span><span class="kw">glance</span>(fit_single)</a></code></pre></div>
<p>finally the <code>augment</code> function computes statistics such as the fitted values and residuals that can be added back to the input dataframe, thus <em>augmenting</em> it.</p>
<div class="sourceCode" id="cb605"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb605-1" title="1">iris_aug =<span class="st"> </span>iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">lmfit=</span><span class="kw">augment</span>(<span class="kw">lm</span>(Petal.Length<span class="op">~</span>Sepal.Length)))</a></code></pre></div>
<p>Combined with <code>dplyr</code> the <code>broom</code> function makes fitting statistical models on grouped data efficient. Below we’ll use again the <code>iris</code> dataset, but we’ll use the whole dataset, fitting a separate model for each iris species in one go:</p>
<div class="sourceCode" id="cb606"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb606-1" title="1">fit_frame_tidy =<span class="st"> </span>iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">lmfit=</span><span class="kw">tidy</span>(<span class="kw">lm</span>(Petal.Length<span class="op">~</span>Sepal.Length)))</a>
<a class="sourceLine" id="cb606-2" title="2">fit_frame_glance =<span class="st"> </span>iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">lmfit=</span><span class="kw">glance</span>(<span class="kw">lm</span>(Petal.Length<span class="op">~</span>Sepal.Length)))</a></code></pre></div>

</div>
</div>
<div id="probability-distributions" class="section level1">
<h1><span class="header-section-number">13</span> Probability distributions</h1>
<div id="bernoulli" class="section level2">
<h2><span class="header-section-number">13.1</span> The Bernoulli distribution</h2>
<p>A random variable <span class="math inline">\(X\)</span> that takes a value of 0 or 1 depending on the result of an experiment that can have only two possible outcomes, follows a Bernoulli distribution. If the probability of one outcome is <span class="math inline">\(p\)</span>, the probability of the other outcome will be <span class="math inline">\(p-1\)</span>:
<span class="math display">\[ P(X=1) = p\]</span>
<span class="math display">\[ P(X=0) = p-1\]</span>
The expected value of a Bernoulli random variable is <span class="math inline">\(p\)</span>:
<span class="math display">\[ E[X]= 1\cdot p + 0\cdot p = p\]</span>
the variance of a Bernoulli random variable is given by:
<span class="math display">\[ Var(X) = E[X^2] - E[X]^2 = 1^2\cdot p + 0^2\cdot p - p^2 \]</span>
<span class="math display">\[Var(X) = p-p^2 = p\cdot(1-p)\]</span></p>
<p>Figure <a href="#fig:bernmass">13.1</a> shows the probability mass function of a Bernoulli random variable with <span class="math inline">\(p=0.7\)</span>.</p>
<div class="figure"><span id="fig:bernmass"></span>
<img src="13_distributions_files/figure-html/bernmass-1.png" alt="Probability mass function for a Bernoulli random variable." width="326.4" />
<p class="caption">
Figure 13.1: Probability mass function for a Bernoulli random variable.
</p>
</div>
<p>As far as I know, there are no special functions in R for computations related to the Bernoulli distribution (mass function, distribution, and quantile function). However, since the Bernoulli distribution is a special case of the binomial distribution, with the parameter <span class="math inline">\(n\)</span> equal to 1, the R functions for the binomial distribution can be used for the Bernoulli distribution as well. Most of the calculations involved are quite simple anyway. The probability mass function can be calculated as follows:</p>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb607-1" title="1"><span class="kw">dbinom</span>(<span class="dt">x=</span><span class="dv">0</span>, <span class="dt">size=</span><span class="dv">1</span>, <span class="dt">prob=</span><span class="fl">0.7</span>)</a></code></pre></div>
<pre><code>## [1] 0.3</code></pre>
<div class="sourceCode" id="cb609"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb609-1" title="1"><span class="kw">dbinom</span>(<span class="dt">x=</span><span class="dv">1</span>, <span class="dt">size=</span><span class="dv">1</span>, <span class="dt">prob=</span><span class="fl">0.7</span>)</a></code></pre></div>
<pre><code>## [1] 0.7</code></pre>
<p>note that the parameter <span class="math inline">\(n\)</span> of the binomial distribution in R functions is passed through the <code>size</code> argument.</p>
<p>The cumulative distribution function can be computed as follows:</p>
<div class="sourceCode" id="cb611"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb611-1" title="1"><span class="kw">pbinom</span>(<span class="dt">q=</span><span class="dv">0</span>, <span class="dt">size=</span><span class="dv">1</span>, <span class="dt">prob=</span><span class="fl">0.7</span>)</a></code></pre></div>
<pre><code>## [1] 0.3</code></pre>
<div class="sourceCode" id="cb613"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb613-1" title="1"><span class="kw">pbinom</span>(<span class="dt">q=</span><span class="dv">1</span>, <span class="dt">size=</span><span class="dv">1</span>, <span class="dt">prob=</span><span class="fl">0.7</span>)</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>The quantile function can be computed as follows:</p>
<div class="sourceCode" id="cb615"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb615-1" title="1"><span class="kw">qbinom</span>(<span class="dt">p=</span><span class="fl">0.3</span>, <span class="dt">size=</span><span class="dv">1</span>, <span class="dt">prob=</span><span class="fl">0.7</span>)</a></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb617"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb617-1" title="1"><span class="kw">qbinom</span>(<span class="dt">p=</span><span class="dv">1</span>, <span class="dt">size=</span><span class="dv">1</span>, <span class="dt">prob=</span><span class="fl">0.7</span>)</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>Finally, one can generate a random sample from a Bernoulli distribution as follows:</p>
<div class="sourceCode" id="cb619"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb619-1" title="1"><span class="kw">rbinom</span>(<span class="dt">n=</span><span class="dv">10</span>, <span class="dt">size=</span><span class="dv">1</span>, <span class="dt">prob=</span><span class="fl">0.7</span>)</a></code></pre></div>
<pre><code>##  [1] 0 1 1 1 1 1 0 1 0 1</code></pre>
</div>
<div id="binomial" class="section level2">
<h2><span class="header-section-number">13.2</span> The binomial distribution</h2>
<p>The binomial distribution with parameters <span class="math inline">\(n\)</span> and <span class="math inline">\(p\)</span> represents the number of “successes” in a sequence of <span class="math inline">\(n\)</span> independent Bernoulli trials, each with a <span class="math inline">\(p\)</span> probability of success. The probability mass function is given by Eq. <a href="#eq:binommass">(13.1)</a>:
<span class="math display" id="eq:binommass">\[\begin{equation} 
	P(X=k) = \dbinom{n}{k} p^k (1-p)^{n-k}
	\tag{13.1}
\end{equation}\]</span>
where <span class="math inline">\(k\)</span> is the number of successes. Figure <a href="#fig:binommass">13.2</a> shows the probability mass function for a binomial random variable with <span class="math inline">\(n=10\)</span>, and <span class="math inline">\(p=0.7\)</span>.</p>
<div class="figure"><span id="fig:binommass"></span>
<img src="13_distributions_files/figure-html/binommass-1.png" alt="Probability mass function for a binomial random variable with $n=10$ and $p=0.7$. The plot shows the probability of obtaining exactly $k$ successes out of $n$ trials." width="359.04" />
<p class="caption">
Figure 13.2: Probability mass function for a binomial random variable with <span class="math inline">\(n=10\)</span> and <span class="math inline">\(p=0.7\)</span>. The plot shows the probability of obtaining exactly <span class="math inline">\(k\)</span> successes out of <span class="math inline">\(n\)</span> trials.
</p>
</div>
<p>In R the probability mass function can be computed via the <code>dbinom</code> function. For example, the probability of obtaining exactly 7 success out of 10 trials with <span class="math inline">\(p\)</span> for each trial = 0.7 is:</p>
<div class="sourceCode" id="cb621"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb621-1" title="1"><span class="kw">dbinom</span>(<span class="dt">x=</span><span class="dv">7</span>, <span class="dt">size=</span><span class="dv">10</span>, <span class="dt">prob=</span><span class="fl">0.7</span>)</a></code></pre></div>
<pre><code>## [1] 0.2668279</code></pre>
<p>The binomial cumulative distribution function represents the probability of obtaining <span class="math inline">\(\leq k\)</span> successes in <span class="math inline">\(n\)</span> trials in which the probability of success for a single trial is <span class="math inline">\(p\)</span>. In R it can be computed with the <code>pbinom</code> function. For example, the probability of obtaining <span class="math inline">\(\leq 7\)</span> success in 10 trials, with <span class="math inline">\(p=0.7\)</span> is:</p>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb623-1" title="1"><span class="kw">pbinom</span>(<span class="dt">q=</span><span class="dv">7</span>, <span class="dt">size=</span><span class="dv">10</span>, <span class="dt">p=</span><span class="fl">0.7</span>)</a></code></pre></div>
<pre><code>## [1] 0.6172172</code></pre>
<p>The quantile function can be computed with the <code>qbinom</code> function:</p>
<div class="sourceCode" id="cb625"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb625-1" title="1"><span class="kw">qbinom</span>(<span class="dt">p=</span><span class="kw">pbinom</span>(<span class="dt">q=</span><span class="dv">7</span>, <span class="dt">size=</span><span class="dv">10</span>, <span class="dt">prob=</span><span class="fl">0.7</span>), <span class="dt">size=</span><span class="dv">10</span>, <span class="dt">prob=</span><span class="fl">0.7</span>)</a></code></pre></div>
<pre><code>## [1] 7</code></pre>
<p>Random binomial samples can be obtained with the <code>rbinom</code> function:</p>
<div class="sourceCode" id="cb627"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb627-1" title="1"><span class="kw">rbinom</span>(<span class="dt">n=</span><span class="dv">5</span>, <span class="dt">size=</span><span class="dv">10</span>, <span class="dt">prob=</span><span class="fl">0.7</span>)</a></code></pre></div>
<pre><code>## [1] 8 9 7 8 8</code></pre>
<p>note that <code>n</code> here represents the number of samples to draw, while <code>size</code> refers to the number of Bernoulli trials of the binomial distribution.</p>
</div>
<div id="normal" class="section level2">
<h2><span class="header-section-number">13.3</span> The normal distribution</h2>
<p>The desnity function for the normal distribution in R is given by <code>dnorm</code>. For example the density function for a value of 0.5 for a normal distribution with a mean of zero and a standard deviation of one can be computed with:</p>
<div class="sourceCode" id="cb629"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb629-1" title="1"><span class="kw">dnorm</span>(<span class="dt">x=</span><span class="fl">0.5</span>, <span class="dt">mean=</span><span class="dv">0</span>, <span class="dt">sd=</span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1] 0.3520653</code></pre>
<p>The code below plots a standard normal distribution between -3 and 3 using the <code>dnorm</code> function, and shades its right <span class="math inline">\(0.05\%\)</span> tail. The resulting plot is shown in Figure <a href="#fig:norm">13.3</a>.</p>
<div class="sourceCode" id="cb631"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb631-1" title="1"><span class="kw">curve</span>(<span class="kw">dnorm</span>(x, <span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">from=</span><span class="op">-</span><span class="dv">3</span>, <span class="dt">to=</span><span class="dv">3</span>, <span class="dt">ylab=</span><span class="st">&quot;Density.&quot;</span>)</a>
<a class="sourceLine" id="cb631-2" title="2">coord =<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from=</span><span class="dv">0</span><span class="op">+</span><span class="kw">qnorm</span>(.<span class="dv">95</span>)<span class="op">*</span><span class="dv">1</span>, <span class="dt">to=</span><span class="dv">3</span>, <span class="dt">length=</span><span class="dv">30</span>)</a>
<a class="sourceLine" id="cb631-3" title="3">dcoord =<span class="st"> </span><span class="kw">dnorm</span>(coord, <span class="dv">0</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb631-4" title="4"><span class="kw">polygon</span>(<span class="dt">x=</span><span class="kw">c</span>(<span class="dv">0</span><span class="op">+</span><span class="kw">qnorm</span>(.<span class="dv">95</span>)<span class="op">*</span><span class="dv">1</span>, coord, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb631-5" title="5">        <span class="dt">y=</span><span class="kw">c</span>(<span class="dv">0</span>, dcoord, <span class="dv">0</span>), <span class="dt">col =</span> <span class="st">&quot;skyblue&quot;</span>)</a></code></pre></div>
<div class="figure"><span id="fig:norm"></span>
<img src="13_distributions_files/figure-html/norm-1.png" alt="The standard normal distribution" width="326.4" />
<p class="caption">
Figure 13.3: The standard normal distribution
</p>
</div>
<p>The cumulative normal distribution function in R is given by <code>pnorm</code>. For example <code>pnorm</code> can be used to find the probability value associated with a given <span class="math inline">\(z\)</span> point of the standard normal distribution:</p>
<div class="sourceCode" id="cb632"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb632-1" title="1"><span class="kw">pnorm</span>(<span class="fl">1.96</span>, <span class="dt">mean=</span><span class="dv">0</span>, <span class="dt">sd=</span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1] 0.9750021</code></pre>
<p>will give the value of the area under the standard normal distribution curve from <span class="math inline">\(-\infty\)</span> to <span class="math inline">\(1.96\)</span>.</p>
<p>The quantal function of the normal distribution in R is given by <code>qnorm</code>. For a standard normal distribution, <code>qnorm</code> gives the <em>z</em> point associated with a given probability area under the curve. For example:</p>
<div class="sourceCode" id="cb634"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb634-1" title="1"><span class="kw">qnorm</span>(<span class="fl">0.975</span>, <span class="dt">mean=</span><span class="dv">0</span>, <span class="dt">sd=</span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1] 1.959964</code></pre>
<div id="using-the-normal-distribution-to-run-a-z-test" class="section level3">
<h3><span class="header-section-number">13.3.1</span> Using the normal distribution to run a <em>z</em>-test</h3>
<p>We can use the <code>pnorm</code> function to test hypotheses with a <em>z</em>-test. Suppose we have a sample of 40 computer science students with a mean short term memory span of <span class="math inline">\(7.4\)</span> digits (that is, they can repeat in sequence, about <span class="math inline">\(7\)</span> digits you read them, without making a mistake), and standard deviation of <span class="math inline">\(2.3\)</span>. The mean for the general population is <span class="math inline">\(6.5\)</span> digits, and the variance in the population is unknown. We’re interested in seeing if the memory span for computer science students is higher than that of the general population. We’ll run a <em>z</em>-test as
<span class="math display">\[z=\frac{\overline x - \mu_{\overline x} }{\frac{s}{\sqrt{n-1}}}\]</span>
where <span class="math inline">\(\overline x\)</span> is the mean short term memory span for our sample, and <span class="math inline">\(s\)</span> is its standard deviation. The z value for our sample is:</p>
<div class="sourceCode" id="cb636"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb636-1" title="1">z =<span class="st"> </span>(<span class="fl">7.4-6.5</span>)<span class="op">/</span>(<span class="fl">2.3</span><span class="op">/</span><span class="kw">sqrt</span>(<span class="dv">40-1</span>))</a>
<a class="sourceLine" id="cb636-2" title="2">z</a></code></pre></div>
<pre><code>## [1] 2.443695</code></pre>
<p>we then get the area under the curve from <span class="math inline">\(-\infty\)</span> to our <em>z</em>-value, which gives us the probability of a score lower than <span class="math inline">\(7.4\)</span>:</p>
<div class="sourceCode" id="cb638"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb638-1" title="1"><span class="kw">pnorm</span>(z)</a></code></pre></div>
<pre><code>## [1] 0.9927311</code></pre>
<p>To get the <em>p</em>-value we subtract that probability value from <span class="math inline">\(1\)</span>, this would give us the probability of getting a score equal to or higher than <span class="math inline">\(7.4\)</span> for a one-tailed test. Because we want a two-tailed test instead, we multiply that value by two, to get the <em>p</em>-value.</p>
<div class="sourceCode" id="cb640"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb640-1" title="1"><span class="dv">1</span><span class="op">-</span><span class="kw">pnorm</span>(z) <span class="co">#this would do for a one tailed test</span></a></code></pre></div>
<pre><code>## [1] 0.007268858</code></pre>
<div class="sourceCode" id="cb642"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb642-1" title="1">(<span class="dv">1</span><span class="op">-</span><span class="kw">pnorm</span>(z))<span class="op">*</span><span class="dv">2</span> <span class="co">#p-value for two-tailed test</span></a></code></pre></div>
<pre><code>## [1] 0.01453772</code></pre>
<p>The <code>qnorm</code> command on the other hand, can be used to set confidence limits on the mean, for the example above we would use the following formula:
<span class="math display">\[CI= \overline x \pm z_{\alpha/2} \frac{s}{\sqrt{n-1}}\]</span>
to set a <span class="math inline">\(95\%\)</span> confidence interval on the mean short term memory span for the computer science students:</p>
<div class="sourceCode" id="cb644"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb644-1" title="1">alpha =<span class="st"> </span><span class="fl">0.05</span></a>
<a class="sourceLine" id="cb644-2" title="2">s =<span class="st"> </span>(<span class="fl">2.3</span><span class="op">/</span><span class="kw">sqrt</span>(<span class="dv">40-1</span>))</a>
<a class="sourceLine" id="cb644-3" title="3">zp =<span class="st"> </span>(<span class="dv">1</span><span class="op">-</span>alpha<span class="op">/</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb644-4" title="4">ciup =<span class="st"> </span><span class="fl">7.4</span> <span class="op">+</span><span class="st"> </span>zp<span class="op">*</span>s</a>
<a class="sourceLine" id="cb644-5" title="5">cilow =<span class="st"> </span><span class="fl">7.4</span> <span class="op">-</span><span class="st"> </span>zp<span class="op">*</span>s</a>
<a class="sourceLine" id="cb644-6" title="6"><span class="kw">cat</span>(<span class="st">&quot;The 95% CI is: </span><span class="ch">\n</span><span class="st">&quot;</span>, cilow, <span class="st">&quot;&lt;&quot;</span>, <span class="st">&quot;mu&quot;</span>, <span class="st">&quot;&lt;&quot;</span>, ciup, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a></code></pre></div>
<pre><code>## The 95% CI is: 
##  7.040913 &lt; mu &lt; 7.759087</code></pre>
<p>The following code summarizes the situation graphically, as shown in Figure <a href="#fig:compscience">13.4</a>.</p>
<div class="sourceCode" id="cb646"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb646-1" title="1">s =<span class="st"> </span>(<span class="fl">2.3</span><span class="op">/</span><span class="kw">sqrt</span>(<span class="dv">40-1</span>))</a>
<a class="sourceLine" id="cb646-2" title="2">up =<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">6.5</span><span class="op">+</span><span class="kw">qnorm</span>(.<span class="dv">975</span>)<span class="op">*</span>s, <span class="dt">to =</span> <span class="fl">9.5</span>, <span class="dt">length =</span> <span class="dv">30</span>)</a>
<a class="sourceLine" id="cb646-3" title="3">low =<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span><span class="fl">3.5</span> , <span class="dt">to =</span><span class="fl">6.5</span><span class="op">-</span><span class="kw">qnorm</span>(.<span class="dv">975</span>)<span class="op">*</span>s , <span class="dt">length =</span> <span class="dv">30</span>)</a>
<a class="sourceLine" id="cb646-4" title="4">dup =<span class="st"> </span><span class="kw">dnorm</span>(up, <span class="fl">6.5</span>, s)</a>
<a class="sourceLine" id="cb646-5" title="5">dlow =<span class="st"> </span><span class="kw">dnorm</span>(low, <span class="fl">6.5</span>, s)</a>
<a class="sourceLine" id="cb646-6" title="6"><span class="kw">curve</span>(<span class="kw">dnorm</span>(x, <span class="fl">6.5</span>, s), <span class="dt">from=</span> <span class="fl">4.5</span>, <span class="dt">to=</span> <span class="fl">8.5</span>, <span class="dt">ylab=</span><span class="st">&quot;Density&quot;</span>)</a>
<a class="sourceLine" id="cb646-7" title="7"><span class="kw">polygon</span>(<span class="dt">x =</span> <span class="kw">c</span>( <span class="fl">6.5</span><span class="op">+</span><span class="kw">qnorm</span>(.<span class="dv">975</span>)<span class="op">*</span>s, up, <span class="fl">9.5</span>),</a>
<a class="sourceLine" id="cb646-8" title="8">        <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">0</span>, dup, <span class="dv">0</span>), <span class="dt">col =</span> <span class="st">&quot;orange&quot;</span>)</a>
<a class="sourceLine" id="cb646-9" title="9"><span class="kw">polygon</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="fl">3.5</span>,low, <span class="fl">6.5</span><span class="op">-</span><span class="kw">qnorm</span>(.<span class="dv">975</span>)<span class="op">*</span>s),</a>
<a class="sourceLine" id="cb646-10" title="10">        <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">0</span>, dlow, <span class="dv">0</span>), <span class="dt">col =</span> <span class="st">&quot;orange&quot;</span>)</a>
<a class="sourceLine" id="cb646-11" title="11"><span class="kw">text</span>(<span class="dt">x=</span><span class="kw">c</span>(<span class="fl">7.38</span>,<span class="fl">5.62</span>), <span class="dt">y=</span><span class="kw">c</span>(<span class="fl">0.02</span>,<span class="fl">0.02</span>), <span class="kw">expression</span>(alpha<span class="op">/</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb646-12" title="12"><span class="kw">text</span>(<span class="dt">x=</span><span class="kw">c</span>(<span class="fl">6.5</span>), <span class="dt">y=</span><span class="kw">c</span>(<span class="fl">0.3</span>), <span class="kw">expression</span>(<span class="dv">1</span><span class="op">-</span>alpha))</a>
<a class="sourceLine" id="cb646-13" title="13"><span class="kw">lines</span>(<span class="dt">x=</span><span class="kw">c</span>(<span class="fl">7.8</span>, <span class="fl">7.4</span>), <span class="dt">y=</span><span class="kw">c</span>(<span class="fl">0.28</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb646-14" title="14"><span class="kw">text</span>(<span class="dt">x=</span><span class="kw">c</span>(<span class="fl">7.4</span>), <span class="dt">y=</span><span class="kw">c</span>(<span class="op">-</span><span class="fl">0.025</span>), <span class="kw">expression</span>(<span class="fl">7.4</span>))</a>
<a class="sourceLine" id="cb646-15" title="15"><span class="kw">text</span>(<span class="dt">x=</span><span class="kw">c</span>(<span class="fl">7.8</span>), <span class="dt">y=</span><span class="kw">c</span>(<span class="fl">0.32</span>), <span class="st">&quot;comp. science </span><span class="ch">\n</span><span class="st">group score&quot;</span>)</a></code></pre></div>
<div class="figure"><span id="fig:compscience"></span>
<img src="13_distributions_files/figure-html/compscience-1.png" alt="Illustration of the *z*-test for the short term memory span experiment." width="489.6" />
<p class="caption">
Figure 13.4: Illustration of the <em>z</em>-test for the short term memory span experiment.
</p>
</div>
</div>
</div>
<div id="distrres" class="section level2">
<h2><span class="header-section-number">13.4</span> Further resources</h2>
<div id="distrrelpkg" class="section level3">
<h3><span class="header-section-number">13.4.1</span> Related packages</h3>
<p>The <a href="https://cran.r-project.org/web/packages/distributions3/">distributions3</a> package provides an alternative interface to computations of functions related to probability distributions.</p>

</div>
</div>
</div>
<div id="frequentist-hypothesis-tests" class="section level1">
<h1><span class="header-section-number">14</span> Frequentist hypothesis tests</h1>
<div class="rmdwarning">
<p>
This is not a statistics textbook. The examples are simply meant to show the syntax to perform certain tests in R, the correct execution of tests and the interpretation of their results depend on good theoretical knowledge of the statistical tests and their assumptions.
</p>
</div>
<div id="chi2-test" class="section level2">
<h2><span class="header-section-number">14.1</span> <span class="math inline">\(\chi^2\)</span> test</h2>
<div id="testing-hypotheses-about-the-distribution-of-a-categorical-variable" class="section level3">
<h3><span class="header-section-number">14.1.1</span> Testing hypotheses about the distribution of a categorical variable</h3>
<p>The <span class="math inline">\(\chi^2\)</span> test can be used to verify hypotheses about the distribution of a categorical variable. For example we might test whether a given population of participants, say guitar players, follows the pattern of handedness found in the general population, known to have a distribution of <span class="math inline">\(80\%\)</span> right-handed, <span class="math inline">\(15\%\)</span> left-handed, and <span class="math inline">\(5\%\)</span> ambidextrous individuals (all the data in this example are made up). The handedness frequencies for a hypothetical sample of guitar players are given in Table <a href="#tab:hand">14.1</a></p>
<table>
<caption><span id="tab:hand">Table 14.1: </span> Table of handedness frequencies for a sample of guitar players.</caption>
<thead>
<tr class="header">
<th>Right</th>
<th align="left">Left</th>
<th align="left">Both</th>
<th>Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>93</td>
<td align="left">18</td>
<td align="left">2</td>
<td>113</td>
</tr>
</tbody>
</table>
<p>we can run the test with the following command:</p>
<div class="sourceCode" id="cb647"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb647-1" title="1"><span class="kw">chisq.test</span>(<span class="dt">x=</span><span class="kw">c</span>(<span class="dv">93</span>,<span class="dv">18</span>,<span class="dv">2</span>), <span class="dt">p=</span><span class="kw">c</span>(<span class="fl">0.8</span>,<span class="fl">0.15</span>,<span class="fl">0.05</span>))</a></code></pre></div>
<pre><code>## 
## 	Chi-squared test for given probabilities
## 
## data:  c(93, 18, 2)
## X-squared = 2.4978, df = 2, p-value = 0.2868</code></pre>
<p>we give the function a vector <code>x</code> with the handedness counts for each category in our sample of guitar players, and a vector <code>p</code> of the expected frequencies for each category in the general population. R returns the value of the <span class="math inline">\(\chi^2\)</span> statistics and its associated <em>p</em>-value. In our case, assuming <span class="math inline">\(\alpha=0.05\)</span>, the <em>p</em>-value indicates that the <span class="math inline">\(\chi^2\)</span> statistics is not significant, , therefore we do not reject the null hypothesis that the distribution of handedness in the population of guitar players differs from that of the general population.</p>
</div>
<div id="testing-hypotheses-about-the-association-between-two-categorical-variables" class="section level3">
<h3><span class="header-section-number">14.1.2</span> Testing hypotheses about the association between two categorical variables</h3>
<p>The <span class="math inline">\(\chi^2\)</span> test can also be used to verify a possible association between two categorical variables, for example sex and cosmetic products usage (classified as “high”, “medium” or “low”). A contingency table showing hypothetical data on cosmetic usage for a sample of <span class="math inline">\(44\)</span> males and <span class="math inline">\(67\)</span> females is shown in Table <a href="#tab:cosmetic">14.2</a>.</p>
<table>
<caption><span id="tab:cosmetic">Table 14.2: </span> Cosmetic usage by sex.</caption>
<thead>
<tr class="header">
<th></th>
<th>High</th>
<th>Medium</th>
<th align="left">Low</th>
<th>Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Males</td>
<td><span class="math inline">\(6\)</span></td>
<td><span class="math inline">\(11\)</span></td>
<td align="left"><span class="math inline">\(27\)</span></td>
<td><span class="math inline">\(44\)</span></td>
</tr>
<tr class="even">
<td>Females</td>
<td><span class="math inline">\(25\)</span></td>
<td><span class="math inline">\(30\)</span></td>
<td align="left"><span class="math inline">\(12\)</span></td>
<td><span class="math inline">\(67\)</span></td>
</tr>
<tr class="odd">
<td>Total</td>
<td><span class="math inline">\(31\)</span></td>
<td><span class="math inline">\(41\)</span></td>
<td align="left"><span class="math inline">\(39\)</span></td>
<td><span class="math inline">\(111\)</span></td>
</tr>
</tbody>
</table>
<p>The formula for the <span class="math inline">\(\chi^2\)</span> statistics is
<span class="math display" id="eq:chisq">\[\begin{equation}
  \chi^2=\sum\frac{(f_e - f_o)^2}{f_e}
  \tag{14.1}
  \end{equation}\]</span></p>
<p>where <span class="math inline">\(f_e\)</span> are the expected frequencies and <span class="math inline">\(f_o\)</span> are the observed frequencies. In order to get the statistics and perform a test of significance on it with R we can first arrange the data in a matrix:</p>
<div class="sourceCode" id="cb649"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb649-1" title="1">cosm =<span class="st"> </span><span class="kw">c</span>(<span class="dv">6</span>, <span class="dv">11</span>, <span class="dv">27</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">12</span>)</a>
<a class="sourceLine" id="cb649-2" title="2">cosm =<span class="st"> </span><span class="kw">matrix</span>(cosm, <span class="dt">nrow=</span><span class="dv">2</span>, <span class="dt">byrow=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<p>then we can pass the matrix to the <code>chisq.test()</code> function to test the null hypothesis that there is no association between sex and cosmetic usage:</p>
<div class="sourceCode" id="cb650"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb650-1" title="1"><span class="kw">chisq.test</span>(cosm)</a></code></pre></div>
<pre><code>## 
## 	Pearson&#39;s Chi-squared test
## 
## data:  cosm
## X-squared = 22.416, df = 2, p-value = 1.357e-05</code></pre>
<p>the <em>p</em>-value tells us that the null hypothesis does not hold, there is indeed an association between sex and degree of cosmetic usage. If we store the results of the test in a variable, we’ll be able to get the matrices of the expected frequencies and residuals:</p>
<div class="sourceCode" id="cb652"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb652-1" title="1">cosmtest =<span class="st"> </span><span class="kw">chisq.test</span>(cosm)</a>
<a class="sourceLine" id="cb652-2" title="2">cosmtest<span class="op">$</span>expect <span class="co">## expected frequencies under a true null hypothesis</span></a></code></pre></div>
<pre><code>##          [,1]     [,2]     [,3]
## [1,] 12.28829 16.25225 15.45946
## [2,] 18.71171 24.74775 23.54054</code></pre>
<p>If we have only a few observations and want to use the Yate’s correction for continuity we have to set the optional argument <code>correct</code> to <code>TRUE</code>:</p>
<div class="sourceCode" id="cb654"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb654-1" title="1"><span class="kw">chisq.test</span>(<span class="dt">x=</span>mydata, <span class="dt">correct=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<p>Often we might not have the data already tabulated in a contingency table, however if we have a series of observations classified according to two categorical variables we can easily get a contingency table with the <code>table()</code> function. The next example uses the data in the file <code>hair_eyes.txt</code>, that lists the hair and eyes colors for 260 females. We will first build our contingency table from that:</p>
<div class="sourceCode" id="cb655"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb655-1" title="1">dat =<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;datasets/hair_eyes.txt&quot;</span>, <span class="dt">header=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb655-2" title="2">tabdat =<span class="st"> </span><span class="kw">table</span>(dat<span class="op">$</span>hair, dat<span class="op">$</span>eyes)</a></code></pre></div>
<p>now we can perform the <span class="math inline">\(\chi^2\)</span> test directly on the table to test for an association between hair and eyes color:</p>
<div class="sourceCode" id="cb656"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb656-1" title="1"><span class="kw">chisq.test</span>(tabdat)</a></code></pre></div>
<pre><code>## Warning in chisq.test(tabdat): Chi-squared approximation may be incorrect</code></pre>
<pre><code>## 
## 	Pearson&#39;s Chi-squared test
## 
## data:  tabdat
## X-squared = 142.9, df = 9, p-value &lt; 2.2e-16</code></pre>
<p>the <span class="math inline">\(\chi^2\)</span> statistics is significant, suggesting an association between hair and eyes color.</p>
</div>
</div>
<div id="students-t-test" class="section level2">
<h2><span class="header-section-number">14.2</span> Student’s <em>t</em>-test</h2>
<div id="one-sample-t-test" class="section level3">
<h3><span class="header-section-number">14.2.1</span> One sample <em>t</em>-test</h3>
<p>A one-sample <em>t</em>-test can be used to test if a group mean is significantly different from a given, known, population mean (<span class="math inline">\(\mu\)</span>). The following example simulates some data and runs a one-sample <em>t</em>-test of the hypothesis that the group mean is equal to a known population mean of 18:</p>
<div class="sourceCode" id="cb659"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb659-1" title="1"><span class="kw">set.seed</span>(<span class="dv">938</span>) <span class="co">#set random seed</span></a>
<a class="sourceLine" id="cb659-2" title="2">gr1 =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">20</span>, <span class="dt">mean=</span><span class="dv">20</span>, <span class="dt">sd=</span><span class="dv">4</span>) <span class="co">#simulate data</span></a>
<a class="sourceLine" id="cb659-3" title="3"><span class="kw">t.test</span>(gr1, <span class="dt">mu =</span> <span class="dv">18</span>)</a></code></pre></div>
<pre><code>## 
## 	One Sample t-test
## 
## data:  gr1
## t = 3.0375, df = 19, p-value = 0.006774
## alternative hypothesis: true mean is not equal to 18
## 95 percent confidence interval:
##  18.65846 21.57681
## sample estimates:
## mean of x 
##  20.11763</code></pre>
<p>For the example we simulated data from a normal distribution with a mean of 20, so unsurprisingly the null hypothesis that the group mean is equal to 18 is rejected at the 0.05 alpha level. By default the test is run as a two-sided test, but this can be changed by passing the <code>alternative</code> argument (valid options for this argument are: <code>two-sided</code>, <code>less</code>, <code>greater</code>). For example, to test the hypothesis that the group mean is &gt; 18 we would call the function as follows:</p>
<div class="sourceCode" id="cb661"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb661-1" title="1"><span class="kw">t.test</span>(gr1, <span class="dt">mu=</span><span class="dv">18</span>, <span class="dt">alternative=</span><span class="st">&quot;greater&quot;</span>)</a></code></pre></div>
<pre><code>## 
## 	One Sample t-test
## 
## data:  gr1
## t = 3.0375, df = 19, p-value = 0.003387
## alternative hypothesis: true mean is greater than 18
## 95 percent confidence interval:
##  18.91215      Inf
## sample estimates:
## mean of x 
##  20.11763</code></pre>
<p>By default the output reports the bounds of a 95% confidence interval on the group mean. The confidence level of this interval can be changed via the <code>conf.level</code> argument. For example, to print out a 99% confidence interval:</p>
<div class="sourceCode" id="cb663"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb663-1" title="1"><span class="kw">t.test</span>(gr1, <span class="dt">mu =</span> <span class="dv">18</span>, <span class="dt">conf.level=</span><span class="fl">0.99</span>)</a></code></pre></div>
<pre><code>## 
## 	One Sample t-test
## 
## data:  gr1
## t = 3.0375, df = 19, p-value = 0.006774
## alternative hypothesis: true mean is not equal to 18
## 99 percent confidence interval:
##  18.12310 22.11216
## sample estimates:
## mean of x 
##  20.11763</code></pre>
</div>
<div id="two-sample-t-test" class="section level3">
<h3><span class="header-section-number">14.2.2</span> Two-sample <em>t</em>-test</h3>
<p>A two-sample <em>t</em>-test can be used to test whether there is a significant difference between the means of two groups. In the following example we’ll simulate data for the two groups and run the test:</p>
<div class="sourceCode" id="cb665"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb665-1" title="1">gr1 =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">25</span>, <span class="dt">mean=</span><span class="dv">10</span>, <span class="dt">sd=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb665-2" title="2">gr2 =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">25</span>, <span class="dt">mean=</span><span class="dv">8</span>, <span class="dt">sd=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb665-3" title="3"><span class="kw">t.test</span>(gr1, gr2)</a></code></pre></div>
<pre><code>## 
## 	Welch Two Sample t-test
## 
## data:  gr1 and gr2
## t = 3.3003, df = 46.562, p-value = 0.001858
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  0.7978221 3.2906509
## sample estimates:
## mean of x mean of y 
##  9.821537  7.777301</code></pre>
<p>as for the one-sample <em>t</em> test described in the previous section it is possible to run either a two-sided (the default) or a directional one-sided test via the <code>alternative</code> argument, and it is also possible to set the confidence level for the confidence interval reported via the <code>conf.level</code> argument. An additional argument that can be passed for a two-sample <em>t</em>-test is <code>var.equal</code>, if this is set to <code>TRUE</code>, then the variances of the two groups are treated as being equal, and the pooled variance is used to estimate the variance otherwise the Welch (or Satterthwaite) approximation to the degrees of freedom is used <span class="citation">(Derrick, Toher, and White <a href="#ref-DerrickEtAl2016">2016</a>)</span>. One way to decide whether to treat the variances of the two groups as equal is by running the Levene test for homogeneity of variances which is described in Section <a href="#levenetest">14.3</a>.</p>
</div>
<div id="paired-t-test" class="section level3">
<h3><span class="header-section-number">14.2.3</span> Paired <em>t</em>-test</h3>
<p>A paired sample <em>t</em>-test can be used to test whether the means of the same group of participants differ between two conditions. We’ll simulate again some data and run the test:</p>
<div class="sourceCode" id="cb667"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb667-1" title="1">base =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">30</span>, <span class="dt">mean=</span><span class="dv">0</span>, <span class="dt">sd=</span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb667-2" title="2">cnd1 =<span class="st"> </span>base <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">30</span>, <span class="dt">mean=</span><span class="op">-</span><span class="dv">2</span>, <span class="dt">sd=</span><span class="fl">2.5</span>)</a>
<a class="sourceLine" id="cb667-3" title="3">cnd2 =<span class="st"> </span>cnd1 <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">30</span>, <span class="dt">mean=</span><span class="dv">2</span>, <span class="dt">sd=</span><span class="fl">2.5</span>)</a>
<a class="sourceLine" id="cb667-4" title="4"><span class="kw">t.test</span>(cnd1, cnd2, <span class="dt">paired=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## 
## 	Paired t-test
## 
## data:  cnd1 and cnd2
## t = -4.4552, df = 29, p-value = 0.0001149
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -2.995939 -1.110716
## sample estimates:
## mean of the differences 
##               -2.053328</code></pre>
<p>as for the one-sample <em>t</em> test described previously it is possible to run either a two-sided (the default) or a directional one-sided test via the <code>alternative</code> argument, and it is also possible to set the confidence level for the confidence interval reported via the <code>conf.level</code> argument.</p>
<p>A paired <em>t</em>-test could also be calculated as a one-sample <em>t</em>-test on the difference between the scores in the two conditions:</p>
<div class="sourceCode" id="cb669"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb669-1" title="1"><span class="kw">t.test</span>(cnd1<span class="op">-</span>cnd2, <span class="dt">mu=</span><span class="dv">0</span>)</a></code></pre></div>
<pre><code>## 
## 	One Sample t-test
## 
## data:  cnd1 - cnd2
## t = -4.4552, df = 29, p-value = 0.0001149
## alternative hypothesis: true mean is not equal to 0
## 95 percent confidence interval:
##  -2.995939 -1.110716
## sample estimates:
## mean of x 
## -2.053328</code></pre>
</div>
</div>
<div id="levenetest" class="section level2">
<h2><span class="header-section-number">14.3</span> The Levene test for homogeneity of variances</h2>
<p>The Levene test can be used to test if the variances of two samples are significantly different from each other. This procedure is important because some statistical tests, such as the two independent sample <em>t</em>-test, are based on the assumption that the variances of the samples being tested are equal. In R the function to perform the Levene test is contained in the <code>car</code> package, so in order to call it the package must be installed and the <code>car</code> library has to be loaded with the command:</p>
<div class="sourceCode" id="cb671"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb671-1" title="1"><span class="kw">library</span>(car)</a></code></pre></div>
<p>We’ll first simulate some data:</p>
<div class="sourceCode" id="cb672"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb672-1" title="1">y1 =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">25</span>, <span class="dt">mean=</span><span class="dv">0</span>, <span class="dt">sd=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb672-2" title="2">y2 =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">25</span>, <span class="dt">mean=</span><span class="dv">0</span>, <span class="dt">sd=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb672-3" title="3">y =<span class="st"> </span><span class="kw">c</span>(y1, y2)</a>
<a class="sourceLine" id="cb672-4" title="4">grps =<span class="st"> </span><span class="kw">factor</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>), <span class="dt">each=</span><span class="dv">25</span>))</a></code></pre></div>
<p>we need a vector (<code>y</code> in our case) with the values of the dependent variable that we are measuring, and another vector (<code>grps</code> in our case) defining the group to which a given observation belongs to. We can then run the test with:</p>
<div class="sourceCode" id="cb673"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb673-1" title="1"><span class="kw">leveneTest</span>(y, grps)</a></code></pre></div>
<pre><code>## Levene&#39;s Test for Homogeneity of Variance (center = median)
##       Df F value   Pr(&gt;F)   
## group  1   9.787 0.002986 **
##       48                    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>We’ll present another example with three groups. Let’s imagine that in a verbal memory task we have the measures (number of words recalled) of three groups that have been given three different treatments (e.g. three different rehearsal procedures). We want to see if there are significant differences in the variance between the groups. The data are stored in a text file <code>verbal.txt</code>, as in Table <a href="#tab:levene">14.3</a>, but with no header indicating the column names.</p>
<table>
<caption><span id="tab:levene">Table 14.3: </span> Data for the Levene test example.</caption>
<thead>
<tr class="header">
<th>Procedure 1</th>
<th>Procedure 2</th>
<th>Procedure 3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>12</td>
<td>13</td>
<td>15</td>
</tr>
<tr class="even">
<td>9</td>
<td>12</td>
<td>17</td>
</tr>
<tr class="odd">
<td>9</td>
<td>11</td>
<td>15</td>
</tr>
<tr class="even">
<td>8</td>
<td>7</td>
<td>13</td>
</tr>
<tr class="odd">
<td>7</td>
<td>14</td>
<td>16</td>
</tr>
<tr class="even">
<td>12</td>
<td>10</td>
<td>17</td>
</tr>
<tr class="odd">
<td>8</td>
<td>10</td>
<td>12</td>
</tr>
<tr class="even">
<td>7</td>
<td>10</td>
<td>16</td>
</tr>
<tr class="odd">
<td>10</td>
<td>12</td>
<td>14</td>
</tr>
<tr class="even">
<td>7</td>
<td>9</td>
<td>15</td>
</tr>
</tbody>
</table>
<p>First we will create the vector with the values of the dependent variables, by reading in the file with the <code>scan</code> function:</p>
<div class="sourceCode" id="cb675"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb675-1" title="1">values =<span class="st"> </span><span class="kw">scan</span>(<span class="st">&quot;datasets/verbal.txt&quot;</span>)</a></code></pre></div>
<p>Now we need to create a second vector defining the group to which a given observation on the data vector belongs to. We will use the <code>rep</code> function to do this, and for convenience we’ll give the labels <code>1</code>, <code>2</code> and <code>3</code> to the three groups:</p>
<div class="sourceCode" id="cb676"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb676-1" title="1">groups =<span class="st"> </span><span class="kw">factor</span>(<span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">10</span>))</a></code></pre></div>
<p>Now the data are in a proper format for using the <code>leveneTest</code> function. This format can be called the “one row per observation” format. You can find more info on this format in Section <a href="#onerowperobservation">3.8.1</a>. To perform the test we can use the following commands:</p>
<div class="sourceCode" id="cb677"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb677-1" title="1"><span class="kw">leveneTest</span>(values, groups)</a></code></pre></div>
<pre><code>## Levene&#39;s Test for Homogeneity of Variance (center = median)
##       Df F value Pr(&gt;F)
## group  2  0.3391 0.7154
##       27</code></pre>
<p>As you can see we have an <em>F</em> value with its associated <em>p</em> value, if the <em>p</em> value is significant, then we reject the null hypothesis of equal variances between the groups. In our case below the <em>p</em> value is greater than 0.05 so we cannot reject the null hypothesis that the variances in the three groups are equal.</p>
</div>
<div id="analysis-of-variance" class="section level2">
<h2><span class="header-section-number">14.4</span> Analysis of variance</h2>
<p>We’ll start with an example showing how we can perform a one-way between-subjects analysis of variance (ANOVA) in R. The example uses a dataset from a fictitious experiment on the effect of three types of memory-boosting drugs. Thirty participants were randomly assigned to one of three groups, each given a different memory-boosting drug (drug “A”, “B”, or “C”), and afterwards their memory was assessed by counting the number of words they could recall from a list. The data is shown in Table <a href="#tab:drugmem">14.4</a>.</p>
<table>
<caption><span id="tab:drugmem">Table 14.4: </span> Number of words recalled from a list for participants treated with drug A, B, or C.</caption>
<thead>
<tr class="header">
<th align="left">Drug A</th>
<th align="left">Drug B</th>
<th align="left">Drug C</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">12</td>
<td align="left">13</td>
<td align="left">15</td>
</tr>
<tr class="even">
<td align="left">9</td>
<td align="left">12</td>
<td align="left">17</td>
</tr>
<tr class="odd">
<td align="left">9</td>
<td align="left">11</td>
<td align="left">15</td>
</tr>
<tr class="even">
<td align="left">8</td>
<td align="left">7</td>
<td align="left">13</td>
</tr>
<tr class="odd">
<td align="left">7</td>
<td align="left">14</td>
<td align="left">16</td>
</tr>
<tr class="even">
<td align="left">12</td>
<td align="left">10</td>
<td align="left">17</td>
</tr>
<tr class="odd">
<td align="left">8</td>
<td align="left">10</td>
<td align="left">12</td>
</tr>
<tr class="even">
<td align="left">7</td>
<td align="left">10</td>
<td align="left">16</td>
</tr>
<tr class="odd">
<td align="left">10</td>
<td align="left">12</td>
<td align="left">14</td>
</tr>
<tr class="even">
<td align="left">7</td>
<td align="left">9</td>
<td align="left">15</td>
</tr>
</tbody>
</table>
<p>We read in the dataset:</p>
<div class="sourceCode" id="cb679"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb679-1" title="1">drug_mem =<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;datasets/drug_memory.csv&quot;</span>, <span class="dt">header=</span>T, <span class="dt">sep=</span><span class="st">&quot;,&quot;</span>)</a>
<a class="sourceLine" id="cb679-2" title="2"><span class="kw">head</span>(drug_mem)</a></code></pre></div>
<pre><code>##   n_words drug
## 1      12    A
## 2      13    B
## 3      15    C
## 4       9    A
## 5      12    B
## 6      17    C</code></pre>
<p>the dependent variable is the number of words correctly recalled from the list (<code>n_words</code>), while the other column (<code>drug</code>) denotes the experimental group. We can have a look at the data through a dotplot:</p>
<div class="sourceCode" id="cb681"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb681-1" title="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb681-2" title="2">p =<span class="st"> </span><span class="kw">ggplot</span>(drug_mem, <span class="kw">aes</span>(drug, n_words)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a>
<a class="sourceLine" id="cb681-3" title="3">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Drug&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;# words recalled&quot;</span>)</a>
<a class="sourceLine" id="cb681-4" title="4">p =<span class="st"> </span>p <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>()</a>
<a class="sourceLine" id="cb681-5" title="5"><span class="kw">print</span>(p)</a></code></pre></div>
<div class="figure"><span id="fig:drugmem"></span>
<img src="14_hypotheses_files/figure-html/drugmem-1.png" alt="Number of words recalled for participants administered different types of memory-boosting drugs." width="326.4" />
<p class="caption">
Figure 14.1: Number of words recalled for participants administered different types of memory-boosting drugs.
</p>
</div>
<p>the dotplot, shown in Figure <a href="#fig:drugmem">14.1</a>, suggests that the drugs have different effects on the number of recalled words. We can run the ANOVA with the <code>aov</code> function:</p>
<div class="sourceCode" id="cb682"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb682-1" title="1">drug_mem_aov =<span class="st"> </span><span class="kw">aov</span>(n_words <span class="op">~</span><span class="st"> </span>drug, <span class="dt">data=</span>drug_mem)</a></code></pre></div>
<p>the first argument passed to the function is the model formula, which you can read as “explain <code>n_words</code> as a function of <code>drug</code>”; the other argument, <code>data</code>, is the dataframe containing the data. Calling <code>summary</code> on the <code>aov</code> output gives a pretty printout with various info we need to report the results (degrees of freedom, <em>F</em> value, <em>p</em>-value, etc…)</p>
<div class="sourceCode" id="cb683"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb683-1" title="1"><span class="kw">summary</span>(drug_mem_aov)</a></code></pre></div>
<pre><code>##             Df Sum Sq Mean Sq F value   Pr(&gt;F)    
## drug         2  194.9   97.43   27.84 2.75e-07 ***
## Residuals   27   94.5    3.50                     
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>assuming a significance level of 0.05 the results of the test reject the null hypothesis that the three drugs have the same effectiveness on the number of recalled words from a list.</p>
<p>Another function that can run a one-way ANOVA in R is <code>oneway.test</code>. Its syntax is very similar to that of <code>aov</code>, but it has an additional argument, <code>var.equal</code>, to indicate whether homogeneity of variance should be assumed or not. If not, a Welch-type test is run (see <code>?oneway.test</code>). For example, if we had reason to suspect non-homogeneous variances across the groups we could have run the test with:</p>
<div class="sourceCode" id="cb685"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb685-1" title="1"><span class="kw">oneway.test</span>(n_words <span class="op">~</span><span class="st"> </span>drug, <span class="dt">data=</span>drug_mem, <span class="dt">var.equal=</span>F)</a></code></pre></div>
<pre><code>## 
## 	One-way analysis of means (not assuming equal variances)
## 
## data:  n_words and drug
## F = 30.598, num df = 2.000, denom df = 17.831, p-value = 1.719e-06</code></pre>
<p>The <code>aov</code> function is quite flexible, and can handle multiple factors. For example, the syntax to run an ANOVA on a dependent variable <code>y</code> with two factors <code>fct1</code> and <code>fct2</code> stored in a dataframe called <code>dat</code> would be:</p>
<div class="sourceCode" id="cb687"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb687-1" title="1"><span class="kw">aov</span>(y <span class="op">~</span><span class="st"> </span>fct1<span class="op">*</span>fct2, <span class="dt">data=</span>dat)</a></code></pre></div>
<p>the above would estimate the effects of <code>fct1</code>, <code>fct2</code>, and their interaction. It would also be possible to estimate only the main effects, without the interaction term, if desired, with the following syntax:</p>
<div class="sourceCode" id="cb688"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb688-1" title="1"><span class="kw">aov</span>(y <span class="op">~</span><span class="st"> </span>fct1<span class="op">+</span>fct2, <span class="dt">data=</span>dat)</a></code></pre></div>
<p>The syntax for performing repeated measures ANOVA with <code>aov</code> becomes relatively complex because it is necessary to specify appropriate error strata. This is explained in detail in <span class="citation">Baron and Li (<a href="#ref-BaronAndLi2003">2003</a>)</span>, and <span class="citation">Li and Baron (<a href="#ref-LiAndBaron2012">2012</a>)</span>. The <a href="https://cran.r-project.org/web/packages/ez/index.html"><code>ez</code></a> package provides an easier interface for running ANOVAs, and for this reason we’ll focus on it.</p>
<p>The function to run ANOVAs through the <code>ez</code> package is called <code>ezANOVA</code> and we’ll first show how to use it by running the one-way between-subjects ANOVA that we ran earlier with <code>aov</code>. The <code>ezANOVA</code> function requires a subject identifier even for between-subjects designs, so we’ll add one to the <code>drug_mem</code> data. Each observation came from a different participant, so we’ll simply label the participants as P1, P2, P3, etc…:</p>
<div class="sourceCode" id="cb689"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb689-1" title="1">drug_mem<span class="op">$</span>id =<span class="st"> </span><span class="kw">factor</span>(<span class="kw">paste0</span>(<span class="st">&quot;P&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="kw">dim</span>(drug_mem)[<span class="dv">1</span>]))</a></code></pre></div>
<p>next we load the <code>ez</code> package and run the ANOVA:</p>
<div class="sourceCode" id="cb690"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb690-1" title="1"><span class="kw">library</span>(ez)</a>
<a class="sourceLine" id="cb690-2" title="2"><span class="kw">ezANOVA</span>(drug_mem, <span class="dt">dv=</span>n_words, <span class="dt">between=</span>drug, <span class="dt">wid=</span>id)</a></code></pre></div>
<pre><code>## Warning: Converting &quot;drug&quot; to factor for ANOVA.</code></pre>
<pre><code>## $ANOVA
##   Effect DFn DFd       F            p p&lt;.05       ges
## 1   drug   2  27 27.8381 2.746469e-07     * 0.6734247
## 
## $`Levene&#39;s Test for Homogeneity of Variance`
##   DFn DFd       SSn  SSd         F         p p&lt;.05
## 1   2  27 0.8666667 34.5 0.3391304 0.7153804</code></pre>
<p>the first argument passed to the <code>ezANOVA</code> function is the dataframe holding the data, the second argument <code>dv</code>, is the name of the dependent variable, the <code>between</code> argument is used to pass the names of the between-subject factor(s), and the <code>wid</code> argument is used to pass the name of the variable holding the subject identifiers. The syntax for specifying multiple factors is a bit unusual (but not difficult). For example, if in the above example we had a second between-subject factor called <code>dose</code>, to use both factors in the analysis we would have written <code>between=.(drug, dose)</code>. We’ll see a concrete example with the <code>ToothGrowth</code> dataset. In the dataset <code>dose</code> is a numeric variable; for this example we’ll treat it as a factor, and therefore, after loading the dataset, the code below converts it to a factor:</p>
<div class="sourceCode" id="cb693"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb693-1" title="1"><span class="kw">data</span>(ToothGrowth)</a>
<a class="sourceLine" id="cb693-2" title="2">ToothGrowth<span class="op">$</span>dose =<span class="st"> </span><span class="kw">factor</span>(ToothGrowth<span class="op">$</span>dose)</a>
<a class="sourceLine" id="cb693-3" title="3">ToothGrowth<span class="op">$</span>id =<span class="st"> </span><span class="kw">factor</span>(<span class="kw">paste0</span>(<span class="st">&quot;P&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="kw">dim</span>(ToothGrowth)[<span class="dv">1</span>]))</a></code></pre></div>
<p>again, we added a subject identifier to the dataset, and we’re now ready to run the analysis with the code below:</p>
<div class="sourceCode" id="cb694"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb694-1" title="1"><span class="kw">ezANOVA</span>(ToothGrowth, <span class="dt">dv=</span>len, <span class="dt">between=</span>.(supp, dose), <span class="dt">wid=</span>id)</a></code></pre></div>
<pre><code>## Coefficient covariances computed by hccm()</code></pre>
<pre><code>## $ANOVA
##      Effect DFn DFd         F            p p&lt;.05       ges
## 1      supp   1  54 15.571979 2.311828e-04     * 0.2238254
## 2      dose   2  54 91.999965 4.046291e-18     * 0.7731092
## 3 supp:dose   2  54  4.106991 2.186027e-02     * 0.1320279
## 
## $`Levene&#39;s Test for Homogeneity of Variance`
##   DFn DFd    SSn     SSd        F         p p&lt;.05
## 1   5  54 38.926 246.053 1.708578 0.1483606</code></pre>
<p>In order to run repeated measures ANOVAs, in which there are one or more within-subject factors we need to list these factors in the <code>within</code> argument. For example, the following dataset contains data from a fictitious experiment on the effects of a drug and of alcohol on social interaction in rats. Two species of rats were tested (the between-subject factor <code>group</code>). Each rat was tested with or without the drug, and with or without alcohol. The dependent measure was the number of social interactions recorded by the experimenter. The fictitious data are in the <code>socialint_drug_alcohol_species.csv</code> dataset:</p>
<div class="sourceCode" id="cb697"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb697-1" title="1">dat =<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;datasets/socialint_drug_alcohol_species.csv&quot;</span>,</a>
<a class="sourceLine" id="cb697-2" title="2">                 <span class="dt">header=</span>T, <span class="dt">sep=</span><span class="st">&quot;,&quot;</span>, <span class="dt">stringsAsFactor=</span>T)</a></code></pre></div>
<p>next we run the ANOVA with the code below:</p>
<div class="sourceCode" id="cb698"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb698-1" title="1"><span class="kw">ezANOVA</span>(dat, <span class="dt">dv=</span>socialint,</a>
<a class="sourceLine" id="cb698-2" title="2">        <span class="dt">between=</span>.(group),</a>
<a class="sourceLine" id="cb698-3" title="3">        <span class="dt">within=</span>.(drug, alcohol),</a>
<a class="sourceLine" id="cb698-4" title="4">        <span class="dt">wid=</span>id,</a>
<a class="sourceLine" id="cb698-5" title="5">        <span class="dt">type=</span><span class="st">&quot;3&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: Converting &quot;id&quot; to factor for ANOVA.</code></pre>
<pre><code>## $ANOVA
##               Effect DFn DFd            F            p p&lt;.05          ges
## 2              group   1  14 4.615385e-01 5.079831e-01       2.290076e-02
## 3               drug   1  14 8.104819e+01 3.376241e-07     * 3.848618e-01
## 5            alcohol   1  14 2.276577e+01 2.982114e-04     * 1.903005e-01
## 4         group:drug   1  14 6.831325e+00 2.042593e-02     * 5.009276e-02
## 6      group:alcohol   1  14 6.306306e-02 8.053669e-01       6.506181e-04
## 7       drug:alcohol   1  14 1.600000e+01 1.316049e-03     * 4.000000e-02
## 8 group:drug:alcohol   1  14 4.437343e-31 1.000000e+00       1.155558e-33</code></pre>
<p>note that we added a <code>type</code> argument, this specifies the sum of squares type to be used for the analysis. In balanced designs, in which you have equal numbers of observations per cell this won’t make a difference, but for unbalanced designs it does. There is some controversy over the most appropriate sum of squares type to use, and the most appropriate choice may depend on the goals and the context of the sudy/analysis. You can read more about the different sum of square types <a href="http://md.psych.bio.uni-goettingen.de/mv/unit/lm_cat/lm_cat_unbal_ss_explained.html">here</a>.</p>

</div>
</div>
<div id="correlation-and-regression" class="section level1">
<h1><span class="header-section-number">15</span> Correlation and regression</h1>
<p>The function <code>cor</code> can be used to compute Pearson’s <span class="math inline">\(r\)</span> correlation coefficient. For example, using the <code>iris</code> dataset we can compute the correlation between petal length and petal width for the setosa iris species as follows:</p>
<div class="sourceCode" id="cb701"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb701-1" title="1"><span class="kw">data</span>(iris)</a>
<a class="sourceLine" id="cb701-2" title="2">iris_setosa =<span class="st"> </span>iris[iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;setosa&quot;</span>,]</a>
<a class="sourceLine" id="cb701-3" title="3"><span class="kw">cor</span>(iris_setosa<span class="op">$</span>Petal.Length, iris_setosa<span class="op">$</span>Petal.Width)</a></code></pre></div>
<pre><code>## [1] 0.33163</code></pre>
<p>Kendall’s <span class="math inline">\(\tau\)</span>, or Spearman’s <span class="math inline">\(\rho\)</span> rank correlation coefficients can be obtained with the same function by changing the <code>method</code> argument from its default value (<code>pearson</code>) to <code>kendall</code>, or <code>spearman</code>, e.g.:</p>
<div class="sourceCode" id="cb703"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb703-1" title="1"><span class="kw">cor</span>(iris_setosa<span class="op">$</span>Petal.Length, iris_setosa<span class="op">$</span>Petal.Width, <span class="dt">method=</span><span class="st">&quot;kendall&quot;</span>)</a></code></pre></div>
<pre><code>## [1] 0.2217029</code></pre>
<p>A significance test on the correlation coefficient can be obtain with the <code>cor.test</code> function:</p>
<div class="sourceCode" id="cb705"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb705-1" title="1"><span class="kw">cor.test</span>(iris_setosa<span class="op">$</span>Petal.Length, iris_setosa<span class="op">$</span>Petal.Width)</a></code></pre></div>
<pre><code>## 
## 	Pearson&#39;s product-moment correlation
## 
## data:  iris_setosa$Petal.Length and iris_setosa$Petal.Width
## t = 2.4354, df = 48, p-value = 0.01864
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.05870091 0.55842995
## sample estimates:
##     cor 
## 0.33163</code></pre>
<p>If we pass a matrix or dataframe to the <code>cor</code> function, it will compute the correlations between each pair of columns of the matrix/dataframe:</p>
<div class="sourceCode" id="cb707"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb707-1" title="1"><span class="kw">cor</span>(iris_setosa[, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>])</a></code></pre></div>
<pre><code>##              Sepal.Length Sepal.Width Petal.Length Petal.Width
## Sepal.Length    1.0000000   0.7425467    0.2671758   0.2780984
## Sepal.Width     0.7425467   1.0000000    0.1777000   0.2327520
## Petal.Length    0.2671758   0.1777000    1.0000000   0.3316300
## Petal.Width     0.2780984   0.2327520    0.3316300   1.0000000</code></pre>
<p>in the code above we selected columns 1-4 to remove the non-numerical column specifying the iris species. The <code>cor.test</code> function, however, cannot be passed a matrix or dataframe as input. The <code>rcorr</code> function in the <a href="https://cran.r-project.org/web/packages/Hmisc/index.html"><code>Hmisc</code></a> package can be used to compute correlations and significance tests between all the columns of a matrix:</p>
<div class="sourceCode" id="cb709"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb709-1" title="1">corr_mat =<span class="st"> </span>Hmisc<span class="op">::</span><span class="kw">rcorr</span>(<span class="kw">as.matrix</span>(iris_setosa[,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]))</a>
<a class="sourceLine" id="cb709-2" title="2">corr_mat<span class="op">$</span>r <span class="co"># correlation coefficients</span></a></code></pre></div>
<pre><code>##              Sepal.Length Sepal.Width Petal.Length Petal.Width
## Sepal.Length    1.0000000   0.7425467    0.2671758   0.2780984
## Sepal.Width     0.7425467   1.0000000    0.1777000   0.2327520
## Petal.Length    0.2671758   0.1777000    1.0000000   0.3316300
## Petal.Width     0.2780984   0.2327520    0.3316300   1.0000000</code></pre>
<div class="sourceCode" id="cb711"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb711-1" title="1">corr_mat<span class="op">$</span>P <span class="co"># corresponding p-values</span></a></code></pre></div>
<pre><code>##              Sepal.Length  Sepal.Width Petal.Length Petal.Width
## Sepal.Length           NA 6.709842e-10   0.06069778  0.05052644
## Sepal.Width  6.709842e-10           NA   0.21697892  0.10382114
## Petal.Length 6.069778e-02 2.169789e-01           NA  0.01863892
## Petal.Width  5.052644e-02 1.038211e-01   0.01863892          NA</code></pre>
<p>note that <code>rcorr</code> can compute only Pearson’s <span class="math inline">\(r\)</span> or Spearman’s <span class="math inline">\(\rho\)</span> correlation coefficients, by passing an argument named <code>type</code> (rather than <code>method</code>, as for the <code>cor</code> function).</p>
<p>Functions to compute partial, and semi-partial correlations are available in the <a href="https://cran.r-project.org/web/packages/ppcor/"><code>ppcor</code></a> package.</p>
<div id="linear-regression" class="section level2">
<h2><span class="header-section-number">15.1</span> Linear regression</h2>
<p>Regression models are expressed in R with a symbolic syntax that is clean and convenient. If you have a dependent variable <code>rts</code> and you want to check the influence of an independent variable <code>age</code> on it, this would be expressed as:</p>
<div class="sourceCode" id="cb713"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb713-1" title="1">rtfit =<span class="st"> </span><span class="kw">lm</span>(rts <span class="op">~</span><span class="st"> </span>age)</a>
<a class="sourceLine" id="cb713-2" title="2"><span class="kw">plot</span>(rts <span class="op">~</span><span class="st"> </span>age)</a>
<a class="sourceLine" id="cb713-3" title="3"><span class="kw">abline</span>(rtfit)</a></code></pre></div>
<p>if you want to add another predictor <code>score</code></p>
<div class="sourceCode" id="cb714"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb714-1" title="1">rtfit2 =<span class="st"> </span><span class="kw">lm</span>(rts <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>score)</a></code></pre></div>

</div>
</div>
<div id="adjusting-the-p-values-for-multiple-comparisons" class="section level1">
<h1><span class="header-section-number">16</span> Adjusting the <em>p</em>-values for multiple comparisons</h1>
<p>The base R program comes with a number of functions to perform multiple comparisons. Not all the possible procedures are available, and some of them might not be applicable to the object resulting from the specific analysis you’re doing. Additional packages might cover your specific needs.</p>
<div id="the-p.adjust-function" class="section level4">
<h4><span class="header-section-number">16.0.0.1</span> The <code>p.adjust</code> function</h4>
<p>The function <code>p.adjust</code> comes with the base R program, in the package package stats, so you don’t need to install anything else on your machine apart from R to get it. This function takes a vector of p-values as an argument, and returns a vector of adjusted p-values according to one of the following methods:</p>
<ul>
<li><code>holm</code></li>
<li><code>hochberg</code></li>
<li><code>hommel</code></li>
<li><code>bonferroni</code></li>
<li><code>BH</code></li>
<li><code>BY</code></li>
<li><code>fdr</code></li>
<li><code>none</code></li>
</ul>
<p>So, if for example you’ve run 3 <em>t</em>-test after a one-way ANOVA with 3 groups, to compare each mean group’s mean with the others, and you want to correct the resulting <em>p</em>-values with the Bonferroni procedure, you can use <code>p.adjust</code> as follows:</p>
<div class="sourceCode" id="cb715"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb715-1" title="1">ps =<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.001</span>, <span class="fl">0.0092</span>, <span class="fl">0.037</span>) <span class="co">#p values from the t-tests</span></a>
<a class="sourceLine" id="cb715-2" title="2"><span class="kw">p.adjust</span>(ps, <span class="dt">method=</span><span class="st">&quot;bonferroni&quot;</span>)</a></code></pre></div>
<pre><code>## [1] 0.0030 0.0276 0.1110</code></pre>
<p>the last line of the example gives the p-values corrected for the number of comparisons made (3 in our case), using the Bonferroni method. As you can see from the output, the first 2 values would still be significant after the correction, while the last one would not.</p>
<p>You can use any of the procedures listed above, instead of the Bonferroni procedure, by setting it in the <code>method</code> option. If you don’t set this option at all you get the Holm procedure by default. Look up the Reference Manual for further information on these methods.</p>
<p>The method <code>none</code> returns the p-values without any adjustment.</p>
</div>
<div id="the-mt.rawp2adjp-function" class="section level4">
<h4><span class="header-section-number">16.0.0.2</span> The <code>mt.rawp2adjp</code> function</h4>
<p>The package multtest contains a function very similar to <code>p.adjust</code>, and offers some other correction methods.</p>
<div class="sourceCode" id="cb717"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb717-1" title="1"><span class="kw">library</span>(multtest)</a>
<a class="sourceLine" id="cb717-2" title="2">ps =<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.001</span>, <span class="fl">0.0092</span>, <span class="fl">0.037</span>) <span class="co">#p values from the t-tests</span></a>
<a class="sourceLine" id="cb717-3" title="3"><span class="kw">mt.rawp2adjp</span>(ps, <span class="dt">proc=</span><span class="st">&quot;Bonferroni&quot;</span>)</a></code></pre></div>
<pre><code>## $adjp
##        rawp Bonferroni
## [1,] 0.0010     0.0030
## [2,] 0.0092     0.0276
## [3,] 0.0370     0.1110
## 
## $index
## [1] 1 2 3
## 
## $h0.ABH
## NULL
## 
## $h0.TSBH
## NULL</code></pre>
<p>or, if you want to see the adjusted p-values with more than one method at once:</p>
<div class="sourceCode" id="cb719"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb719-1" title="1"><span class="kw">library</span>(multtest)</a>
<a class="sourceLine" id="cb719-2" title="2">ps &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.001</span>, <span class="fl">0.0092</span>, <span class="fl">0.037</span>) <span class="co">#p values from the t-tests</span></a>
<a class="sourceLine" id="cb719-3" title="3"><span class="kw">mt.rawp2adjp</span>(ps, <span class="dt">proc=</span><span class="kw">c</span>(<span class="st">&quot;Bonferroni&quot;</span>, <span class="st">&quot;Holm&quot;</span>, <span class="st">&quot;Hochberg&quot;</span>, <span class="st">&quot;SidakSS&quot;</span>))</a></code></pre></div>
<pre><code>## $adjp
##        rawp Bonferroni   Holm Hochberg     SidakSS
## [1,] 0.0010     0.0030 0.0030   0.0030 0.002997001
## [2,] 0.0092     0.0276 0.0184   0.0184 0.027346859
## [3,] 0.0370     0.1110 0.0370   0.0370 0.106943653
## 
## $index
## [1] 1 2 3
## 
## $h0.ABH
## NULL
## 
## $h0.TSBH
## NULL</code></pre>

</div>
</div>
<div id="admin" class="section level1">
<h1><span class="header-section-number">17</span> Administration and maintenance</h1>
<div id="custom" class="section level2">
<h2><span class="header-section-number">17.1</span> Environment customisation</h2>
<p>Probably the best way to customise your R environment is through the use of a <code>.Rprofile</code> file, that you put in your <code>HOME</code> directory. This is a simple text file that is sourced every time R is started, so you can put in it your own functions, and any operations that you would like R to perform at start-up. Also in this file, you can write two special functions, the <code>.First</code> is executed first at the beginning of a session, and the <code>.Last</code> is executed at the end of a session. The <code>.First</code> function is normally used to initialise the environment setting the desired options. Here’s an example of a <code>.Rprofile</code> file</p>
<div class="sourceCode" id="cb721"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb721-1" title="1"><span class="co">##This is my .Rprofile in ~/</span></a>
<a class="sourceLine" id="cb721-2" title="2">.First &lt;-<span class="st"> </span><span class="cf">function</span>(){</a>
<a class="sourceLine" id="cb721-3" title="3">    <span class="kw">options</span>(<span class="dt">prompt=</span><span class="st">&quot;&gt;&gt;&gt; &quot;</span>, <span class="dt">continue=</span><span class="st">&quot;+</span><span class="ch">\t</span><span class="st">&quot;</span>)  <span class="co">##change the prompt</span></a>
<a class="sourceLine" id="cb721-4" title="4">    <span class="kw">options</span>(<span class="dt">digits=</span><span class="dv">5</span>, <span class="dt">length=</span><span class="dv">999</span>)           <span class="co">##display max 5 digits</span></a>
<a class="sourceLine" id="cb721-5" title="5">}</a>
<a class="sourceLine" id="cb721-6" title="6"></a>
<a class="sourceLine" id="cb721-7" title="7"><span class="kw">setwd</span>(<span class="st">&quot;~/rwork&quot;</span>)   <span class="co">##Start R in this directory</span></a></code></pre></div>
<p>for a full listing of the options that can be set see <code>?options</code>.
You can change temporarily the options, only for the running session, directly from R, for example:</p>
<div class="sourceCode" id="cb722"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb722-1" title="1"><span class="kw">options</span>(<span class="dt">digits=</span><span class="dv">9</span>)</a></code></pre></div>
<p>The <code>.Rprofile</code> file in the user’s <code>HOME</code> is only one of the files that can be used to initialise the environment and set the options. The file that is looked up first by R is the one defined by the <code>R_PROFILE</code> environment variable if this variable is set. To verify the value of this variable you can use</p>
<div class="sourceCode" id="cb723"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb723-1" title="1"><span class="kw">Sys.getenv</span>(<span class="st">&quot;R_PROFILE&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;&quot;</code></pre>
<div class="sourceCode" id="cb725"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb725-1" title="1"><span class="kw">system</span>(<span class="st">&quot;echo $R_PROFILE&quot;</span>)</a></code></pre></div>
<p>if the variable is unset, R looks for a file called <code>Rprofile.site</code> that is in the <code>etc</code> sub-directory of your R installation directory. To find out your R installation directory on a Unix-like system you can use</p>
<div class="sourceCode" id="cb726"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb726-1" title="1"><span class="kw">system</span>(<span class="st">&quot;echo $R_HOME&quot;</span>)</a></code></pre></div>
<p>The <code>Rprofile.site</code> or the file pointed to by the <code>R_PROFILE</code> environment variable can be used for system-wide configuration. Note that if the <code>R_PROFILE</code> environment variable is set the file pointed to by this variable is used, and if this is not <code>Rprofile.site</code>, the latter is ignored.</p>
<p>The <code>.Rprofile</code> file in the user’s <code>HOME</code> can be used for user specific initialisation, and the functions written in this file overwrite, or better “mask” functions with the same name defined in either the file pointed to by the <code>R_PROFILE</code> variable or in <code>Rprofile.site</code>. Moreover a <code>.Rprofile</code> file can be put in any directory, then, if R is started from that directory, this file is sourced, and it masks the definitions given in the user’s <code>HOME</code> <code>.Rprofile</code> file, in this way, it is possible to customise the initialisation for a particular data analysis. Finally, a directory specific initialisation can be given in a <code>.RData</code> file, the definitions given here mask also the definitions given in any <code>.Rprofile</code> files.</p>
</div>
<div id="compiling-r-on-debianubuntu" class="section level2">
<h2><span class="header-section-number">17.2</span> Compiling R on Debian/Ubuntu</h2>
<p>get all the dependencies needed:</p>
<div class="sourceCode" id="cb727"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb727-1" title="1"><span class="ex">apt-get</span> build-dep r-base-core</a></code></pre></div>
<p>run configure:</p>
<div class="sourceCode" id="cb728"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb728-1" title="1"><span class="ex">./configure</span> --prefix=/path/to/install_loc/ \</a>
<a class="sourceLine" id="cb728-2" title="2">--with-cairo --with-jpeglib \</a>
<a class="sourceLine" id="cb728-3" title="3">--with-readline --with-tcltk \</a>
<a class="sourceLine" id="cb728-4" title="4">--enable-R-profiling --enable-R-shlib \</a>
<a class="sourceLine" id="cb728-5" title="5">--enable-memory-profiling \</a>
<a class="sourceLine" id="cb728-6" title="6">--with-blas --with-lapack</a></code></pre></div>
<p><code>--prefix</code> can be used to indicate the directory where R will be installed.</p>
<div class="sourceCode" id="cb729"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb729-1" title="1"><span class="fu">make</span> -j8</a>
<a class="sourceLine" id="cb729-2" title="2"><span class="fu">make</span> install</a></code></pre></div>
<p>If you don’t have some development graphics libraries installed in your system R may nonetheless compile fine, but some functionality may be missing. For example you may have issues with missing fonts (a workaround for this issue is to install <code>gsfonts-x11</code> and restart the <code>X</code> server or the computer, but the fonts you get by compiling R with all the needed development libraries look better).</p>

</div>
</div>
<div id="ess-using-emacs-speaks-statistics-with-r" class="section level1">
<h1><span class="header-section-number">18</span> ESS: Using Emacs Speaks Statistics with R</h1>
<p>If you have the Emacs Speaks Statistics (ESS) package installed, you can use Emacs for both editing R source files when working in batch mode, and running a R process from within Emacs. ESS provides an extended set of facilities for both these tasks, among these are syntax highlighting, indentation of code and the ability to work with multiple buffers.</p>
<p>To get syntax highlighting, just use the <code>.R</code> extension for naming your file.</p>
<p>To start an R session from within Emacs, press <code>M-x</code>, type R in the minibuffer, and press <code>Enter</code>.</p>
<p>Another way of running an R session from inside Emacs is to run first a shell in Emacs (press <code>M-x</code> and then type shell in the minibuffer), and then calling R from that shell. However, this doesn’t involve ESS, so you won’t have all the features that ESS adds to the Emacs editing facilities.</p>
<p>For sake of clarity, the use of ESS for editing R source files, and for running a R session will be addressed in two separate sections; however, this separation is quite artificial, first because the most proficient use of ESS involves editing an R source file while running an R session, and second because some of the tips given in one section apply also to the usage of ESS illustrated in the other section. Therefore you’re invited to at least skim through both sections, even if you’re interested on one usage of ESS only.</p>
<div id="using-ess-for-editing-and-debugging-r-source-files" class="section level2">
<h2><span class="header-section-number">18.1</span> Using ESS for editing and debugging R source files</h2>
<p>If you have a basic knowledge of Emacs you will feel at home with ESS. A good way to use ESS is to split the Emacs window horizontally (<code>C-x 2</code>) and have a R source file in one buffer, and a R process running in the other buffer. You basically write the R code in the first buffer, and then send it to the R process for evaluation in the second buffer. Below are the shortcuts for sending input to the R process:</p>
<ul>
<li><p><code>C-c C-b</code> Evaluate buffer. This means that all the commands present in the source file will be executed</p></li>
<li><p><code>C-c C-j</code> Evaluate only the current line</p></li>
<li><p><code>C-c C-r</code> Evaluate selected region</p></li>
</ul>
<p>There is a set of commands that is equivalent to the above, but moves the cursor to the R process window after the evaluation, that is they `Evaluate and go’ (to the other window):</p>
<ul>
<li><p><code>C-c M-b</code> Evaluate buffer and go</p></li>
<li><p><code>C-c M-j</code> Evaluate line and go</p></li>
<li><p><code>C-c M-r</code> Evaluate region and go</p></li>
</ul>
<p>To comment/uncomment a region you can use</p>
<ul>
<li><p><code>M-x comment-region</code> Comment region</p></li>
<li><p><code>M-x uncomment-region</code> Uncomment region</p></li>
<li><p><code>M-;</code> Comment/Uncomment region</p></li>
</ul>
<p>If you want to switch from a buffer to the other one you can use <code>C-x o</code>. Moreover, when you are in a buffer you can make the other window scroll without moving the cursor with <code>C-M-v</code>.</p>
<div id="italian-keyboard-mapping-issues" class="section level4">
<h4><span class="header-section-number">18.1.0.1</span> Italian keyboard mapping issues</h4>
<p>Italian keyboards (usually) don’t have the braces <code>{</code> <code>}</code> and some other symbols like the tilde <code>~</code>, however, on Linux systems, if you’ve chosen an Italian keyboard layout they’re mapped somewhere, and you can access them through a combination of keys, likely combinations are:</p>
<pre><code>Shift + AltGr + [   for {
Shift + AltGr + ]   for }
AltGr + ^           for ~</code></pre>
<p>if you still can’t find them, try pressing <code>AltGr</code> with some keys in the upper part of the keyboard, and see if you can spot them.</p>
<p>In Microsoft Windows the braces <code>{</code> <code>}</code> can be accessed as above, while to access the tilde in most applications, including the R console, you have to write the ASCII code <code>126</code> with some modifier function key (in my laptop that’s <code>Alt+Fn 126</code>). In Emacs, however, you can’t write the tilde in this way, a solution is to write the character in octal code by typing:</p>
<pre><code>Ctrl-q 176 RETURN</code></pre>
</div>
</div>
<div id="using-ess-to-interact-with-a-r-process" class="section level2">
<h2><span class="header-section-number">18.2</span> Using ESS to interact with a R process</h2>
<p>To start a R process type <code>M-x R</code>. <code>C-p</code> and <code>C-n</code>, or <code>C</code>-↑ and <code>C</code>-↓ are for scrolling through the command history.</p>
<p>One thing you need to know, is the ESS “smart underscore” behaviour, that is if you press the underscore once, you get the assignment operator <code>&lt;-</code>, if you press the underscore twice you get a literal underscore <code>_</code>. This shortcut for the assignment operator can be very annoying if you use the underscore often in variable names, to turn-off this smart behaviour you need to put the following line somewhere in your <code>.emacs</code> file, but before ESS is loaded:</p>
<pre><code>(ess-toggle-underscore nil)</code></pre>
<p>When you are running R inside Emacs, if the cursor is not positioned at the current command line, and you try to retrieve some command from the command history with <code>C-p</code> or <code>C</code>-↑, Emacs will complain saying that you are “not at command line”. To get at the command line without using the mouse, press <code>M-Shift-&gt;</code>.</p>
<p>If you set the cursor at a previous command, and then press `Enter}, that command will be evaluated again.</p>
<p>There is a quick way to source a file, <code>C-c C-l filename</code> will load and source your file.</p>
<p><code>C-c C-q</code> is another way of quitting R in ESS mode, but I guess <code>C-d</code> is the fastest one.</p>

</div>
</div>
<div id="writing-reports-with-rmarkdown-or-sweave" class="section level1">
<h1><span class="header-section-number">19</span> Writing reports with <code>rmarkdown</code> or Sweave</h1>
<div id="rmarkdown" class="section level2">
<h2><span class="header-section-number">19.1</span> <code>rmarkdown</code></h2>
<p><a href="https://bookdown.org/yihui/rmarkdown/" class="uri">https://bookdown.org/yihui/rmarkdown/</a></p>
</div>
<div id="using-sweave-to-write-documents-with-r-and-latex" class="section level2">
<h2><span class="header-section-number">19.2</span> Using Sweave to write documents with R and LaTeX</h2>
<div id="what-is-sweave" class="section level3">
<h3><span class="header-section-number">19.2.1</span> What is Sweave?</h3>
<p>Sweave provides a way of writing documents or reports that contain both text and R objects, namely figures, syntax and raw or nicely formatted output produced by R. Sweave is also a way to automate the production of documents. Usually when you write a document with some statistical content, you first write the text, and then add the graphics produced by some statistical software or spreadsheet application. Of course this process is time consuming, not to mention the fact that often you have to manually fill in tables with the statistics produced by the application you’re using. Even worse, if you’ve already prepared your report, but then you have to change something in the statistical analyses, for example you have to add or drop a subject, the entire process must be repeated again from scratch. Sweave is aimed at easing this process, it works like this: you write a single source file which contains your text, written with the LaTeX markup language, and embed in it the R syntax needed for producing the figures and tables to appear in your document. You process this file with Sweave through R, and you get a plain LaTeX source file which you can compile with LaTeX to get your nicely formatted output. If your data happen to change for any reasons, you don’t have to start again from scratch, you can just run your old Sweave source file on your new dataset, and everything will be automatically updated.</p>
<p>If you already know how to use LaTeX and R, learning to use Sweave will be easy, the additional syntax required by Sweave to integrate R and LaTeX source code is minimal.</p>
</div>
<div id="usage" class="section level3">
<h3><span class="header-section-number">19.2.2</span> Usage</h3>
<p>R come with Sweave already in the base system (in the package <code>utils</code>), so you don’t need to install it separately. Of course you need LaTeX installed to produce the document later, Sweave only outputs a LaTeX source file and all the graphics needed for your document.</p>
<p>You start the Sweave source file as a normal LaTeX document with the usual preamble, if you name the file with the <code>.Rnw</code> extension, Emacs should recognise it and highlight the syntax for you. Then, at the point where you want to embed a chunk of R syntax, you add the following tag:</p>
<pre><code>&lt;&lt;&gt;&gt;=</code></pre>
<p>after you’ve finished with the R syntax chunk, you need to add the following tag to start another piece of text written with LaTeX:</p>
<pre><code>@</code></pre>
<p>in this way you can alternate chunks of R code with pieces of LaTeX syntax. If you forget to add the <code>@</code> tag before a piece of LaTeX syntax Sweave will complain and abort the process, if you instead make a mistake with LaTeX syntax, Sweave won’t complain and will normally produce the <code>.tex</code> file, however the compilation with LaTeX won’t work.</p>
<p>There are different options that determine which R objects will appear in the final document. If you want both the R code, and its output to appear in the document, just use the <code>&lt;&lt;&gt;&gt;=</code> empty tag. They will both be inserted in the LaTeX file in a redefined <code>verbatim</code> environment. Setting the option <code>echo=FALSE</code> lines of R code are not included in the document, while with the option <code>results=hide</code> the output of the R code won’t appear in the document. Therefore if you want to run some R code, but neither the code nor its output should appear in the document, use:</p>
<pre><code>&lt;&lt;echo=FALSE, results=hide&gt;&gt;= </code></pre>
<p>Another option will suppress all the output, except the figures:</p>
<pre><code>&lt;&lt;echo=FALSE, fig=TRUE&gt;&gt;=</code></pre>
<p>Sweave will automatically put a <code>\includegraphics{}</code> command for a figure.</p>
<p>Finally, if you want to use some utilities, like <code>xtable</code>, that automatically produce LaTeX objects from R objects, you will want to use the following options to tell Sweave not to put the R output in a <code>verbatim</code> environment:</p>
<pre><code>&lt;&lt;echo=FALSE, results=tex&gt;&gt;=</code></pre>

</div>
</div>
</div>
<div id="soundprocessing" class="section level1">
<h1><span class="header-section-number">20</span> Sound processing</h1>
<div id="libraries-for-sound-analysis-and-signal-processing" class="section level2">
<h2><span class="header-section-number">20.1</span> Libraries for sound analysis and signal processing</h2>
<div id="seewave" class="section level3">
<h3><span class="header-section-number">20.1.1</span> <code>seewave</code></h3>
<p>The package <code>seewave</code> provides functions for analysing, manipulating, displaying, editing and synthesising time waves (particularly sound). This package processes time analysis (oscillograms and envelopes), spectral content, resonance quality factor, cross correlation and autocorrelation, zero-crossing, dominant frequency, 2D and 3D spectrograms.</p>
<p><a href="https://cran.r-project.org/web/packages/seewave/index.html" class="uri">https://cran.r-project.org/web/packages/seewave/index.html</a></p>
</div>
<div id="sound" class="section level3">
<h3><span class="header-section-number">20.1.2</span> <code>sound</code></h3>
<p>Basic functions for dealing with wav files and sound samples.</p>
<p><a href="https://cran.r-project.org/web/packages/sound/index.html" class="uri">https://cran.r-project.org/web/packages/sound/index.html</a></p>
</div>
<div id="tuner" class="section level3">
<h3><span class="header-section-number">20.1.3</span> <code>tuneR</code></h3>
<p>Collection of tools to analyse music, handling wave files, transcription.</p>
<p><a href="https://cran.r-project.org/web/packages/tuneR/index.html" class="uri">https://cran.r-project.org/web/packages/tuneR/index.html</a></p>
</div>
<div id="signal" class="section level3">
<h3><span class="header-section-number">20.1.4</span> <code>signal</code></h3>
<p>A set of generally Matlab/Octave-compatible signal processing functions. Includes filter generation utilities, filtering functions, re-sampling routines, and visualisation of filter models. It also includes interpolation functions and some Matlab compatibility functions.</p>
<p><a href="https://cran.r-project.org/web/packages/signal/index.html" class="uri">https://cran.r-project.org/web/packages/signal/index.html</a></p>

</div>
</div>
</div>



<div id="partial-list-of-packages-by-category" class="section level1">
<h1><span class="header-section-number">A</span> Partial list of packages by category</h1>
<div id="graphics-packages" class="section level2">
<h2><span class="header-section-number">A.1</span> Graphics packages</h2>
<ul>
<li>ggplot2 <a href="http://ggplot2.org/" class="uri">http://ggplot2.org/</a></li>
<li>lattice <a href="https://cran.r-project.org/web/packages/lattice/index.html" class="uri">https://cran.r-project.org/web/packages/lattice/index.html</a></li>
<li>rgl <a href="https://cran.r-project.org/web/packages/rgl/index.html" class="uri">https://cran.r-project.org/web/packages/rgl/index.html</a></li>
<li>tkrplot <a href="https://cran.r-project.org/web/packages/tkrplot/index.html" class="uri">https://cran.r-project.org/web/packages/tkrplot/index.html</a></li>
<li>iplots <a href="https://cran.r-project.org/web/packages/iplots/index.html" class="uri">https://cran.r-project.org/web/packages/iplots/index.html</a></li>
<li>rpanel provides a set of functions to build simple GUI controls for R functions. These are built on the tcltk package. Uses could include changing a parameter on a graph by animating it with a slider or a “doublebutton”, up to more sophisticated control panels. <a href="https://cran.r-project.org/web/packages/rpanel/index.html" class="uri">https://cran.r-project.org/web/packages/rpanel/index.html</a></li>
</ul>
</div>
<div id="gui-packages" class="section level2">
<h2><span class="header-section-number">A.2</span> GUI packages</h2>
<ul>
<li>Rcmdr <a href="https://cran.r-project.org/web/packages/Rcmdr/index.html" class="uri">https://cran.r-project.org/web/packages/Rcmdr/index.html</a></li>
<li>JGR <a href="https://cran.r-project.org/web/packages/JGR/index.html" class="uri">https://cran.r-project.org/web/packages/JGR/index.html</a></li>
<li>pmg Simple GUI for R using gWidgets <a href="https://cran.r-project.org/web/packages/pmg/index.html" class="uri">https://cran.r-project.org/web/packages/pmg/index.html</a> <a href="http://www.math.csi.cuny.edu/pmg" class="uri">http://www.math.csi.cuny.edu/pmg</a></li>
</ul>
</div>
<div id="bibliography-management" class="section level2">
<h2><span class="header-section-number">A.3</span> Bibliography management</h2>
<ul>
<li><p><a href="https://cran.r-project.org/web/packages/RefManageR/index.html"><code>RefManageR</code></a>. Provides functions to query PubMed and convert results to BibTeX entries. Query PubMed:</p>
<div class="sourceCode" id="cb738"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb738-1" title="1">hits =<span class="st"> </span><span class="kw">ReadPubMed</span>(<span class="st">&quot;Nose bleed&quot;</span>, <span class="dt">database=</span> <span class="st">&quot;PubMed&quot;</span>)</a></code></pre></div>
<p>the retrieved articles can then be turned into BibTeX entries:</p>
<div class="sourceCode" id="cb739"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb739-1" title="1"><span class="kw">toBiblatex</span>(hits[<span class="dv">1</span>])</a></code></pre></div></li>
</ul>

</div>
</div>
<div id="miscellaneous-commands" class="section level1">
<h1><span class="header-section-number">B</span> Miscellaneous commands</h1>
<div id="data" class="section level2">
<h2><span class="header-section-number">B.1</span> Data</h2>
<ul>
<li><code>head(dat)</code> print the first part of the object <code>dat</code></li>
<li><code>tail(dat)</code> print the last part of the object <code>dat</code></li>
</ul>
</div>
<div id="help" class="section level2">
<h2><span class="header-section-number">B.2</span> Help</h2>
<ul>
<li><code>?foo</code> find help on command <code>foo</code></li>
</ul>
</div>
<div id="objects" class="section level2">
<h2><span class="header-section-number">B.3</span> Objects</h2>
<ul>
<li><code>class(foo)</code> get the class of object <code>&quot;foo&quot;</code></li>
<li><code>ls()</code> or<code>objects()</code> list objects present in the workspace</li>
</ul>
</div>
<div id="organize-a-session" class="section level2">
<h2><span class="header-section-number">B.4</span> Organize a session</h2>
<ul>
<li><code>dir()</code> or <code>list.files()</code>list the files in the current directory</li>
<li><code>getwd()</code> get the current directory</li>
<li><code>library(foo)</code> load library foo</li>
<li><code>library()</code> list all available packages</li>
<li><code>q()</code> or <code>quit()</code> quit from current session</li>
<li><code>require(foo)</code> require the library foo, use in scripts</li>
<li><code>setwd(&quot;home/foo&quot;)</code> set the working directory</li>
<li><code>system(&quot;foo&quot;)</code> execute the system command <code>foo</code> as if it were from the shell</li>
</ul>
</div>
<div id="r-administration" class="section level2">
<h2><span class="header-section-number">B.5</span> R administration</h2>
<ul>
<li><code>library()</code> list all installed packages</li>
<li><code>R.version</code> info on R version and the platform it is running on</li>
</ul>
</div>
<div id="syntax" class="section level2">
<h2><span class="header-section-number">B.6</span> Syntax</h2>
<ul>
<li><code>#</code> starts a comment</li>
<li><code>mydata$foo</code> refer to the variable <code>foo</code> in the dataframe <code>mydata</code></li>
<li><code>:</code> interaction operator for model formulae, <code>a:b</code> is the interaction between <code>a</code> and <code>b</code></li>
<li><code>*</code> crossing operator for model formulae, <code>a*b = a+b+a:b</code></li>
</ul>

</div>
</div>
<div id="other-manuals-and-sources-of-information-on-r" class="section level1">
<h1><span class="header-section-number">C</span> Other manuals and sources of information on R</h1>
<ul>
<li><p>R Project Homepage <a href="http://www.r-project.org/" class="uri">http://www.r-project.org/</a></p></li>
<li><p>CRAN <a href="http://cran.r-project.org/" class="uri">http://cran.r-project.org/</a></p></li>
<li><p>R mailing lists <a href="http://www.r-project.org/mail.html" class="uri">http://www.r-project.org/mail.html</a></p></li>
<li><p>Notes on the use of R for psychology experiments and questionnaires by J. Baron and Y. Li <a href="http://www.psych.upenn.edu/~baron/rpsych.pdf" class="uri">http://www.psych.upenn.edu/~baron/rpsych.pdf</a></p></li>
<li><p>Simple R by J.Verzani <a href="http://www.math.csi.cuny.edu/Statistics/R/simpleR" class="uri">http://www.math.csi.cuny.edu/Statistics/R/simpleR</a></p></li>
<li><p>Using R for psychological research: A very simple guide to a very elegant package by William Revelle <a href="http://personality-project.org/r/" class="uri">http://personality-project.org/r/</a></p></li>
<li><p>Jonathan Baron’s R page <a href="http://finzi.psych.upenn.edu/" class="uri">http://finzi.psych.upenn.edu/</a></p></li>
<li><p>Vincent Zoonekynd’s R page <a href="http://zoonek2.free.fr/UNIX/48_R/all.html" class="uri">http://zoonek2.free.fr/UNIX/48_R/all.html</a></p></li>
<li><p>P.M.E. Altham’s page on multivariate analysis with R notes <a href="http://www.statslab.cam.ac.uk/~pat/" class="uri">http://www.statslab.cam.ac.uk/~pat/</a></p></li>
<li><p>Patrick Burns’ R page <a href="http://www.burns-stat.com/" class="uri">http://www.burns-stat.com/</a></p></li>
</ul>
<div id="in-italian" class="section level2">
<h2><span class="header-section-number">C.1</span> In Italian</h2>
<ul>
<li>Ricerca sociale con R <a href="https://www.agnesevardanega.eu/metref/start" class="uri">https://www.agnesevardanega.eu/metref/start</a></li>
</ul>
</div>
<div id="other-useful-statistics-resources" class="section level2">
<h2><span class="header-section-number">C.2</span> Other useful statistics resources</h2>
<div id="in-italian-1" class="section level3">
<h3><span class="header-section-number">C.2.1</span> In Italian</h3>
<ul>
<li>Statistica univariata e bivariata parametrica e non-parametrica per le discipline ambientali e biologiche di Lamberto Soliani <a href="http://www.dsa.unipr.it/soliani/soliani.html" class="uri">http://www.dsa.unipr.it/soliani/soliani.html</a></li>
</ul>

</div>
</div>
</div>
<div id="fullcoltable" class="section level1">
<h1><span class="header-section-number">D</span> Full colors table</h1>
<p>All named colors are listed below:</p>
<div class="figure"><span id="fig:fullcoltab1"></span>
<img src="Figures/t1.png" alt="Complete color table, part I." width="1725" />
<p class="caption">
Figure D.1: Complete color table, part I.
</p>
</div>
<div class="figure"><span id="fig:fullcoltab2"></span>
<img src="Figures/t2.png" alt="Complete color table, part II." width="1725" />
<p class="caption">
Figure D.2: Complete color table, part II.
</p>
</div>
<div class="figure"><span id="fig:fullcoltab3"></span>
<img src="Figures/t3.png" alt="Complete color table, part III." width="1725" />
<p class="caption">
Figure D.3: Complete color table, part III.
</p>
</div>
<div class="figure"><span id="fig:fullcoltab4"></span>
<img src="Figures/t4.png" alt="Complete color table, part IV." width="1725" />
<p class="caption">
Figure D.4: Complete color table, part IV.
</p>
</div>
<div class="figure"><span id="fig:fullcoltab5"></span>
<img src="Figures/t5.png" alt="Complete color table, part V." width="1725" />
<p class="caption">
Figure D.5: Complete color table, part V.
</p>
</div>
<div class="figure"><span id="fig:fullcoltab6"></span>
<img src="Figures/t6.png" alt="Complete color table, part VI." width="1725" />
<p class="caption">
Figure D.6: Complete color table, part VI.
</p>
</div>
<div class="figure"><span id="fig:fullcoltab7"></span>
<img src="Figures/t7.png" alt="Complete color table, part VII." width="1725" />
<p class="caption">
Figure D.7: Complete color table, part VII.
</p>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>

<div id="refs" class="references">
<div id="ref-Adler2010">
<p>Adler, Joseph. 2010. <em>R in a Nutshell. A Desktop Quick Reference</em>. First. Sebastopol, CA: O’Reilly.</p>
</div>
<div id="ref-BaronAndLi2003">
<p>Baron, Jonathan, and Yuelin Li. 2003. <em>Notes on the use of R for psychology experiments and questionnaires</em>.</p>
</div>
<div id="ref-BeckerAndCleveland2002">
<p>Becker, Richard A, and William S Cleveland. 2002. <em>S-Plus Trellis Graphics User’s Manual</em>. Seattle: MathSoft, Inc., Murray Hill: Bell Labs.</p>
</div>
<div id="ref-BeckerEtAl1996b">
<p>Becker, Richard A, William S Cleveland, and Ming-Jen Shyu. 1996. “The Visual Design and Control of Trellis Display.” <em>Journal of Computational and Graphical Statistics</em> 5: 123–55.</p>
</div>
<div id="ref-BeckerEtAl1996">
<p>Becker, Richard A, William S Cleveland, Ming-Jen Shyu, and S P Kaluzny. 1996. <em>A Tour of Trellis Graphics</em>.</p>
</div>
<div id="ref-ClevelandAndFuentes1997">
<p>Cleveland, W. S., and M. Fuentes. 1997. “Trellis Display: Modeling Data from Designed Experiments.” Bell Labs.</p>
</div>
<div id="ref-Crawley2013">
<p>Crawley, M. J. 2013. <em>The R Book</em>. Second. Chichester, United Kingdom: Wiley.</p>
</div>
<div id="ref-DerrickEtAl2016">
<p>Derrick, Ben, Deirdre Toher, and Paul White. 2016. “Why Welch’s Test Is Type I Error Robust.” <em>The Quantitative Methods for Psychology</em> 12 (1): 30–38. <a href="https://doi.org/10.20982/tqmp.12.1.p030" class="uri">https://doi.org/10.20982/tqmp.12.1.p030</a>.</p>
</div>
<div id="ref-LiAndBaron2012">
<p>Li, Yuelin, and Jonathan Baron. 2012. <em>Behavioral Research Data Analysis with R</em>. New York, NY: Springer. <a href="https://doi.org/10.1007/978-1-4614-1238-0" class="uri">https://doi.org/10.1007/978-1-4614-1238-0</a>.</p>
</div>
<div id="ref-Murrell2001">
<p>Murrell, Paul. 2001. “R Lattice Graphics.” In <em>Proceedings of the 2nd International Workshop on Distributed Statistical Computing, March 15-17, 2001, Technische Universität Wien, Vienna, Austria</em>, edited by Kurt Hornik and Friedrich Leisch. <a href="https://www.r-project.org/conferences/DSC-2001/Proceedings/" class="uri">https://www.r-project.org/conferences/DSC-2001/Proceedings/</a>.</p>
</div>
<div id="ref-MurrellAndIhaka2000">
<p>Murrell, Paul, and Ross Ihaka. 2000. “An Approach to Providing Mathematical Annotation in Plots.” <em>Journal of Computational and Graphical Statistics</em> 9 (3): 582–99. <a href="https://doi.org/10.1080/10618600.2000.10474900" class="uri">https://doi.org/10.1080/10618600.2000.10474900</a>.</p>
</div>
<div id="ref-Sarkar2002">
<p>Sarkar, Deepayan. 2002. “Lattice, an Implementation of Trellis Graphics in R.” <em>R News</em> 2 (2): 19–22.</p>
</div>
<div id="ref-Sarkar2003">
<p>———. 2003. “Some Notes on Lattice.” In <em>Proceedings of the 3nd International Workshop on Distributed Statistical Computing, March 20-22, 2003, Technische Universität Wien, Vienna, Austria</em>, edited by Kurt Hornik and Friedrich Leisch. <a href="https://www.r-project.org/conferences/DSC-2003/Proceedings/" class="uri">https://www.r-project.org/conferences/DSC-2003/Proceedings/</a>.</p>
</div>
<div id="ref-Sarkar2008">
<p>———. 2008. <em>Lattice: Multivariate Data Visualization with R</em>. New York: Springer. <a href="http://lmdvr.r-forge.r-project.org" class="uri">http://lmdvr.r-forge.r-project.org</a>.</p>
</div>
<div id="ref-Sievert2020">
<p>Sievert, Carson. 2020. <em>Interactive Web-Based Data Visualization with R, Plotly, and Shiny</em>. Chapman; Hall/CRC. <a href="https://plotly-r.com" class="uri">https://plotly-r.com</a>.</p>
</div>
<div id="ref-Wickham2009">
<p>Wickham, H. 2009. <em>ggplot2. Elegant Graphics for Data Analysis</em>. New York: Springer-Verlag. <a href="https://doi.org/10.1007/978-0-387-98141-3" class="uri">https://doi.org/10.1007/978-0-387-98141-3</a>.</p>
</div>
<div id="ref-Wickham2015">
<p>———. 2015. <em>R Packages</em>. Sebastopol, CA: O’Reilly. <a href="http://r-pkgs.had.co.nz/" class="uri">http://r-pkgs.had.co.nz/</a>.</p>
</div>
<div id="ref-Wilke2019">
<p>Wilke, Claus O. 2019. <em>Fundamentals of Data Visualization: A Primer on Making Informative and Compelling Figures</em>. Sebastopol, CA: Oreilly &amp; Associates Inc. <a href="https://serialmentor.com/dataviz/" class="uri">https://serialmentor.com/dataviz/</a>.</p>
</div>
<div id="ref-Wilkinson2005">
<p>Wilkinson, Leland. 2005. <em>The Grammar of Graphics</em>. Second edition. New York: Springer-Verlag. <a href="https://doi.org/10.1007/0-387-28695-0" class="uri">https://doi.org/10.1007/0-387-28695-0</a>.</p>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Although there are dedicated functions for writing <code>CSV</code> files (<code>write.csv</code>, and <code>write.csv2</code>), they are just wrappers around the <code>write.table</code> function.<a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["rguide.pdf"],
"toc": {
"collapse": "subsection",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
